(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[605],{9762:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/s/[projectId]/[uid]",function(){return r(2258)}])},2258:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return g},default:function(){return y}});var a=r(5893),s=r(7294),n=r(1163),o=r(7066),l=e=>{let{onDataCollected:t,startTracking:r=!0}=e,a=(0,s.useRef)({mouseMovements:0,keyboardEvents:0,clickPattern:[],idleTime:0,mouseCurve:[],copyPasteEvents:0}),n=(0,s.useRef)(Date.now()),o=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!r)return;let e=e=>{a.current.mouseMovements++,n.current=Date.now(),a.current.mouseMovements%10==0&&(a.current.mouseCurve.push({x:e.clientX,y:e.clientY,timestamp:Date.now()}),a.current.mouseCurve.length>100&&a.current.mouseCurve.shift())},s=e=>{a.current.clickPattern.push(Date.now()),n.current=Date.now(),a.current.clickPattern.length>50&&a.current.clickPattern.shift()},l=e=>{a.current.keyboardEvents++,n.current=Date.now()},i=e=>{a.current.copyPasteEvents++,n.current=Date.now()},c=e=>{a.current.copyPasteEvents++,n.current=Date.now()};return o.current=setInterval(()=>{let e=Date.now()-n.current;a.current.idleTime=Math.floor(e/1e3),e%5e3<1e3&&t({...a.current})},1e3),document.addEventListener("mousemove",e),document.addEventListener("click",s),document.addEventListener("keydown",l),document.addEventListener("copy",i),document.addEventListener("paste",c),t({...a.current}),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("click",s),document.removeEventListener("keydown",l),document.removeEventListener("copy",i),document.removeEventListener("paste",c),o.current&&clearInterval(o.current),t({...a.current})}},[t,r]),null},i=r(6164),c=r(9556),d=r(1354);"localhost"===window.location.hostname||window.location.hostname,c.V.configure(d.A);let u=(0,i.d)({authMode:"apiKey"}),m=e=>e.data,h={questions:{create:async e=>({data:m(await u.models.Question.create(e))}),get:async e=>({data:m(await u.models.Question.get({id:e}))}),list:async e=>({data:(await u.models.Question.list(e)).data||[]}),listByProject:async e=>({data:(await u.models.Question.list({filter:{projectId:{eq:e}}})).data||[]}),update:async(e,t)=>({data:m(await u.models.Question.update({id:e,...t}))}),delete:async e=>({data:m(await u.models.Question.delete({id:e}))})}};var p=e=>{let{projectId:t,onAnswer:r}=e,[n,o]=(0,s.useState)(!0),[l,i]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(""),[p,x]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{(async()=>{try{o(!0),i(null);let e=(await h.questions.listByProject(t)).data||[];if(0===e.length){i("No questions available"),o(!1);return}let r=Math.floor(Math.random()*e.length),a=e[r],s=[];if(a.options)try{"string"==typeof a.options?s=JSON.parse(a.options):Array.isArray(a.options)&&(s=a.options)}catch(e){console.error("Error parsing question options:",e)}d({id:a.id,text:a.text,type:a.type||"TEXT",options:s,correctAnswer:"object"==typeof a.options&&null!==a.options&&a.options.correctAnswer||""})}catch(e){console.error("Error fetching trap question:",e),i("Failed to load question")}finally{o(!1)}})()},[t]),l)?(0,a.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,a.jsx)("p",{className:"text-red-600",children:l})}):n?(0,a.jsx)("div",{className:"flex justify-center p-4",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):c?p?(0,a.jsx)("div",{className:"bg-green-50 p-4 rounded-md",children:(0,a.jsx)("p",{className:"text-green-600",children:"Thank you for your response."})}):(0,a.jsxs)("div",{className:"border p-4 rounded-md shadow-sm mb-4",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-800 mb-3",children:c.text}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),x(!0),!c)return;let t="MULTIPLE_CHOICE"===c.type?u===c.correctAnswer:u.toLowerCase().trim()===c.correctAnswer.toLowerCase().trim();r(c.text,u,t)},children:["MULTIPLE_CHOICE"===c.type&&c.options&&(0,a.jsx)("div",{className:"space-y-2",children:c.options.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",id:"option-".concat(t),name:"trapAnswer",value:e,onChange:e=>m(e.target.value),required:!0,className:"mr-2"}),(0,a.jsx)("label",{htmlFor:"option-".concat(t),className:"text-gray-700",children:e})]},t))}),"TEXT"===c.type&&(0,a.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),required:!0,placeholder:"Enter your answer here",className:"w-full p-2 border border-gray-300 rounded-md"}),"COUNTRY"===c.type&&(0,a.jsxs)("select",{value:u,onChange:e=>m(e.target.value),required:!0,className:"w-full p-2 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"",children:"Select your country"}),(0,a.jsx)("option",{value:"US",children:"United States"}),(0,a.jsx)("option",{value:"CA",children:"Canada"}),(0,a.jsx)("option",{value:"GB",children:"United Kingdom"}),(0,a.jsx)("option",{value:"AU",children:"Australia"})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Submit Answer"})})]})]}):null},x=e=>{var t;let{onVerify:r,difficulty:n="medium"}=e,[o,l]=(0,s.useState)(!0),[i,c]=(0,s.useState)({question:"",answer:"",type:"math"}),[d,u]=(0,s.useState)(""),[m,h]=(0,s.useState)(null),[p,x]=(0,s.useState)(!1),[f,v]=(0,s.useState)(0),[g,y]=(0,s.useState)([]),[b,w]=(0,s.useState)([]),[j,N]=(0,s.useState)(0),S=(0,s.useRef)(null),E=(0,s.useRef)(null);(0,s.useEffect)(()=>{T()},[n]);let T=()=>{l(!0),h(null);try{let e;switch(n){case"easy":e=D();break;case"hard":e=I();break;default:e=k()}c(e),"drag"===e.type&&e.items&&(y(e.items),w([]))}catch(e){console.error("Error generating CAPTCHA challenge:",e),h("Failed to generate CAPTCHA challenge")}finally{l(!1)}},D=()=>{let e=Math.floor(10*Math.random()),t=Math.floor(10*Math.random());return{question:"What is ".concat(e," + ").concat(t,"?"),answer:String(e+t),type:"math"}},k=()=>{if("math"==(Math.random()>.5?"math":"drag")){let e,t,r;let a=["+","-","*"],s=a[Math.floor(Math.random()*a.length)];switch(s){case"+":r=(e=Math.floor(20*Math.random()))+(t=Math.floor(20*Math.random()));break;case"-":t=Math.floor(Math.random()*(e=Math.floor(20*Math.random())+10)),r=e-t;break;case"*":r=(e=Math.floor(10*Math.random()))*(t=Math.floor(10*Math.random()));break;default:e=0,t=0,r=0}return{question:"What is ".concat(e," ").concat(s," ").concat(t,"?"),answer:String(r),type:"math"}}{let e=[{question:"Drag to order from smallest to largest",items:["5","2","9","1","7"],answer:"12579"},{question:"Drag to order alphabetically",items:["dog","cat","bird","fish","ant"],answer:"antbirddogcatfish"}],t=e[Math.floor(Math.random()*e.length)];return{question:t.question,items:[...t.items].sort(()=>Math.random()-.5),answer:t.answer,type:"drag"}}},I=()=>({question:"Hold the button and click the targets that appear",answer:"hold-complete",type:"hold"}),M=e=>{e.preventDefault(),v(e=>e+1),("drag"===i.type?b.join(""):d).trim()===i.answer?(x(!0),r(!0)):(h("Incorrect answer, please try again"),f>=2&&(T(),v(0)))},q=(e,t)=>{e.dataTransfer.setData("text/plain",t)},L=()=>{E.current=Date.now(),S.current=setInterval(()=>{if(E.current){let e=Math.min((Date.now()-E.current)/3e3,1);N(e),e>=1&&(S.current&&clearInterval(S.current),x(!0),r(!0))}},50)},C=()=>{S.current&&(clearInterval(S.current),S.current=null),j<1&&(N(0),E.current=null)};return((0,s.useEffect)(()=>()=>{S.current&&clearInterval(S.current)},[]),o)?(0,a.jsx)("div",{className:"flex justify-center p-4",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):p?(0,a.jsx)("div",{className:"bg-green-50 p-4 rounded-md",children:(0,a.jsx)("p",{className:"text-green-600",children:"Verification successful"})}):(0,a.jsxs)("div",{className:"border p-4 rounded-md shadow-sm mb-4",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-800 mb-3",children:"Security Verification"}),m&&(0,a.jsx)("div",{className:"bg-red-50 p-2 rounded-md mb-3",children:(0,a.jsx)("p",{className:"text-red-600 text-sm",children:m})}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("p",{className:"text-gray-700",children:i.question})}),"math"===i.type&&(0,a.jsxs)("form",{onSubmit:M,children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),required:!0,placeholder:"Your answer",className:"w-full p-2 border border-gray-300 rounded-md"}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Verify"})})]}),"drag"===i.type&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"min-h-[100px] bg-gray-100 p-4 rounded-md border-2 border-dashed border-gray-300 mb-4",onDrop:e=>{e.preventDefault();let t=e.dataTransfer.getData("text/plain");w(e=>[...e,t]),y(e=>e.filter(e=>e!==t))},onDragOver:e=>{e.preventDefault()},children:[(0,a.jsx)("p",{className:"text-gray-500 mb-2",children:"Drop items here in the correct order"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:b.map((e,t)=>(0,a.jsx)("div",{className:"bg-blue-100 p-2 rounded-md",children:e},"result-".concat(t)))})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:g.map((e,t)=>(0,a.jsx)("div",{draggable:!0,onDragStart:t=>q(t,e),className:"bg-gray-200 p-2 rounded-md cursor-move",children:e},"item-".concat(t)))}),b.length===(null===(t=i.items)||void 0===t?void 0:t.length)&&(0,a.jsx)("button",{onClick:M,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Verify"})]}),"hold"===i.type&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-4",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:"".concat(100*j,"%")}})}),(0,a.jsx)("button",{onMouseDown:L,onMouseUp:C,onMouseLeave:C,onTouchStart:L,onTouchEnd:C,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 w-full",children:"Hold to verify"})]})]})},f=e=>{let{projectId:t,uid:r,url:n,onStatusChange:l}=e,[i,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),m=(0,s.useRef)(null),h=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!i||!m.current)return;let e=0;return h.current=setInterval(()=>{e++;try{var t,r;let e=null===(r=m.current)||void 0===r?void 0:null===(t=r.contentWindow)||void 0===t?void 0:t.location.href;if(e&&e.includes("protegeresearchsurvey.com")){clearInterval(h.current);let t="COMPLETED";e.includes("/quota")?t="QUOTA_FULL":(e.includes("/not-eligible")||e.includes("/disqualified"))&&(t="DISQUALIFIED"),u(t),p(t,{completionUrl:e})}}catch(e){}e>=300&&clearInterval(h.current)},1e3),()=>{h.current&&clearInterval(h.current)}},[i,t,r]);let p=async(e,a)=>{try{let s={completionTimestamp:new Date().toISOString(),browser:navigator.userAgent,screenSize:{width:window.screen.width,height:window.screen.height,colorDepth:window.screen.colorDepth},language:navigator.language,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,completionUrl:null==a?void 0:a.completionUrl,referrer:document.referrer};await o.Z.post("/api/links/update-status",{projectId:t,uid:r,status:e,metadata:s}),l(e,{metadata:s,timestamp:Date.now()})}catch(e){console.error("Failed to update survey status:",e)}};return(0,a.jsxs)("div",{className:"iframe-container w-full h-full relative",children:[d&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-10 bg-white bg-opacity-90",children:(0,a.jsxs)("div",{className:"text-center p-8",children:["COMPLETED"===d&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-green-600 mb-4",children:"Survey Completed"}),(0,a.jsx)("p",{children:"Thank you for completing the survey! You'll be redirected shortly."})]}),"QUOTA_FULL"===d&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-blue-600 mb-4",children:"Survey Quota Full"}),(0,a.jsx)("p",{children:"The quota for this survey has been filled. Thank you for your interest!"})]}),"DISQUALIFIED"===d&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-amber-600 mb-4",children:"Not Eligible"}),(0,a.jsx)("p",{children:"You don't match the criteria for this survey. Thank you for your interest!"})]})]})}),(0,a.jsx)("iframe",{ref:m,src:n,onLoad:()=>{c(!0);try{var e,t;let r=null===(t=m.current)||void 0===t?void 0:null===(e=t.contentWindow)||void 0===e?void 0:e.location.href;if(r&&r.includes("protegeresearchsurvey.com")){let e="COMPLETED";r.includes("/quota")?e="QUOTA_FULL":(r.includes("/not-eligible")||r.includes("/disqualified"))&&(e="DISQUALIFIED"),u(e),p(e,{completionUrl:r})}else p("STARTED")}catch(e){p("STARTED")}},className:"w-full h-full border-0 min-h-[500px]",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups",title:"Survey iframe"})]})},v=e=>{let{projectId:t,uid:r,surveyUrl:i,vendorId:c}=e,d=(0,n.useRouter)(),[u,m]=(0,s.useState)("captcha"),[h,v]=(0,s.useState)(null),[g,y]=(0,s.useState)(null),[b,w]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),[S,E]=(0,s.useState)({token:Math.random().toString(36).substring(2,15),projectId:t,uid:r,vendorId:c,startTime:Date.now(),answers:[],metadata:{}}),T=(0,s.useRef)({rapidAnswers:!1,inconsistentAnswers:!1,botLikeBehavior:!1,flagged:!1,flags:[]});(0,s.useEffect)(()=>{if(S)try{sessionStorage.setItem("surveySession",JSON.stringify(S))}catch(e){console.error("Failed to save session data to sessionStorage:",e)}},[S]);let D=async(e,a,s)=>{if(E(t=>({...t,answers:[...t.answers,{question:e,answer:a,isCorrect:s}]})),!s){T.current.inconsistentAnswers=!0,T.current.flags.push("Incorrect trap question answer");try{await o.Z.post("/api/links/flag",{projectId:t,uid:r,reason:"Failed trap question",metadata:{question:e,answer:a,timestamp:Date.now()}})}catch(e){console.error("Failed to flag incorrect trap question:",e)}}N(!0),m("survey")};return(0,a.jsxs)("div",{className:"survey-flow-container relative",children:[(0,a.jsx)(l,{onDataCollected:e=>{y(e),E(t=>({...t,metadata:{...t.metadata,behavior:e}})),e.mouseMovements/(e.idleTime||1)>100&&(T.current.botLikeBehavior=!0,T.current.flags.push("Unusually fast mouse movements")),e.copyPasteEvents>5&&(T.current.botLikeBehavior=!0,T.current.flags.push("Excessive copy/paste detected")),T.current.flags.length>0&&E(e=>({...e,metadata:{...e.metadata,suspiciousFlags:T.current.flags}}))},startTracking:!0}),"captcha"===u&&(0,a.jsxs)("div",{className:"p-6 max-w-md mx-auto bg-white rounded-xl shadow-md",children:[(0,a.jsx)("h2",{className:"text-xl font-medium text-gray-900 mb-4",children:"Please Verify You Are Human"}),(0,a.jsx)(x,{onVerify:e=>{w(e),e&&(E(e=>({...e,metadata:{...e.metadata,captchaVerified:!0,captchaVerifiedAt:Date.now()}})),m("trap-question"))},difficulty:"medium"})]}),"trap-question"===u&&b&&(0,a.jsxs)("div",{className:"p-6 max-w-md mx-auto bg-white rounded-xl shadow-md",children:[(0,a.jsx)("h2",{className:"text-xl font-medium text-gray-900 mb-4",children:"Quick Question"}),(0,a.jsx)(p,{projectId:t,onAnswer:D})]}),"survey"===u&&b&&(0,a.jsx)("div",{className:"w-full h-full",children:(0,a.jsx)(f,{projectId:t,uid:r,url:i,onStatusChange:(e,a)=>{switch(e){case"COMPLETED":m("completed"),setTimeout(()=>{d.push("/thank-you-completed?projectId=".concat(t,"&uid=").concat(r))},2e3);break;case"QUOTA_FULL":m("quota-full"),setTimeout(()=>{d.push("/sorry-quota-full?projectId=".concat(t,"&uid=").concat(r))},2e3);break;case"DISQUALIFIED":m("disqualified"),setTimeout(()=>{d.push("/sorry-disqualified?projectId=".concat(t,"&uid=").concat(r))},2e3)}}})}),"error"===u&&(0,a.jsxs)("div",{className:"p-6 max-w-md mx-auto bg-white rounded-xl shadow-md",children:[(0,a.jsx)("h2",{className:"text-xl font-medium text-red-600 mb-2",children:"Error"}),(0,a.jsx)("p",{className:"text-gray-700",children:h}),(0,a.jsx)("button",{onClick:()=>m("captcha"),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]}),("completed"===u||"disqualified"===u||"quota-full"===u)&&(0,a.jsxs)("div",{className:"p-6 max-w-md mx-auto bg-white rounded-xl shadow-md",children:[(0,a.jsx)("h2",{className:"text-xl font-medium text-gray-900 mb-4",children:"completed"===u?"Survey Completed":"quota-full"===u?"Survey Quota Full":"Not Eligible"}),(0,a.jsx)("p",{className:"text-gray-700",children:"completed"===u?"Thank you for completing the survey. You will be redirected shortly.":"quota-full"===u?"The quota for this survey has been filled. Thank you for your interest.":"You do not match the criteria for this survey. Thank you for your interest."}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:"Redirecting you in a few seconds..."})]})]})},g=!0;function y(e){let{projectId:t,uid:r,project:o,surveyLink:l,isValid:i,errorMessage:c}=e;(0,n.useRouter)();let[d,u]=(0,s.useState)(c||null);return i&&o?(null==l?void 0:l.status)==="COMPLETED"?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-green-600 mb-4",children:"Survey Already Completed"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"You have already completed this survey. Thank you for your participation!"}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:()=>window.location.href="https://protegeresearch.com",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Return to ProtegeResearch"})})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,a.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:o.name})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-2 md:p-6",children:(0,a.jsx)(v,{projectId:t,uid:r,surveyUrl:o.surveyUrl,vendorId:(null==l?void 0:l.vendorId)||void 0})})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Invalid Survey Link"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:c||"This survey link is invalid or has expired."}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:()=>window.location.href="https://protegeresearch.com",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Return to ProtegeResearch"})})]})})}}},function(e){e.O(0,[143,164,888,774,179],function(){return e(e.s=9762)}),_N_E=e.O()}]);