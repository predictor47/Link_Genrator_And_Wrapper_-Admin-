(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[627],{8263:function(e,o,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/diagnostics",function(){return i(8436)}])},1354:function(e,o,i){"use strict";i.d(o,{Ao:function(){return f},nq:function(){return p}});var n,t,d,a,s,l,r,c=i(9556),u=i(6164);window.location.hostname;let m=!1,h=null;function p(){if(!m){if(!h)try{console.log("Using environment variables for Amplify configuration"),h={auth:{user_pool_id:"us-east-1_Gh00T12dW",aws_region:"us-east-1",user_pool_client_id:"5e5a5drp00jd43tr7ph1ceg412"},data:{url:"https://vth6pntotrhvfpxo2gwn3kzqry.appsync-api.us-east-1.amazonaws.com/graphql",aws_region:"us-east-1",api_key:"da2-ee26yqskvzfpjpquwbi53shbvu",authorization_types:["API_KEY","AMAZON_COGNITO_USER_POOLS"]}},v();return}catch(e){console.warn("Failed to load amplify_outputs.json on client:",e)}v()}}function v(){var e,o,i,n,t,d,a,s,l,r,u;h||(console.log("Using environment variables for Amplify configuration"),h={auth:{user_pool_id:"us-east-1_Gh00T12dW",user_pool_client_id:"5e5a5drp00jd43tr7ph1ceg412",identity_pool_id:"us-east-1:a0b02f73-93a3-4b52-b1cb-eaa306375a33",aws_region:"us-east-1"},data:{url:"https://vth6pntotrhvfpxo2gwn3kzqry.appsync-api.us-east-1.amazonaws.com/graphql",aws_region:"us-east-1",api_key:"da2-ee26yqskvzfpjpquwbi53shbvu"}});let p=(null===(e=h.auth)||void 0===e?void 0:e.aws_region)||(null===(o=h.data)||void 0===o?void 0:o.aws_region)||"us-east-1",v="localhost"!==window.location.hostname&&!window.location.hostname.includes("amplifyapp.com"),f=window.location.hostname,g=v?f.split(".").slice(-2).join("."):void 0;try{let e={Auth:{Cognito:{userPoolId:(null===(i=h.auth)||void 0===i?void 0:i.user_pool_id)||"",userPoolClientId:(null===(n=h.auth)||void 0===n?void 0:n.user_pool_client_id)||"",identityPoolId:(null===(t=h.auth)||void 0===t?void 0:t.identity_pool_id)||"",region:(null===(d=h.auth)||void 0===d?void 0:d.aws_region)||p,loginWith:{oauth:!1,email:!0,phone:!1,username:!0},tokenProvider:{storage:window.sessionStorage,cookieStorage:{domain:g,path:"/",expires:365,secure:v,sameSite:"strict"},disableCookieStorage:!1,enableCookieStorage:!0}}},API:{GraphQL:{endpoint:(null===(a=h.data)||void 0===a?void 0:a.url)||"",region:(null===(s=h.data)||void 0===s?void 0:s.aws_region)||p,defaultAuthMode:"apiKey",apiKey:(null===(l=h.data)||void 0===l?void 0:l.api_key)||""}}};e.region=p,c.V.configure(e),m=!0,console.log("Amplify configured in ".concat("PRODUCTION"," environment")),console.log("Using User Pool ID:",null===(r=h.auth)||void 0===r?void 0:r.user_pool_id),console.log("API Key configured:",(null===(u=h.data)||void 0===u?void 0:u.api_key)?"Yes (masked)":"No"),console.log("Cookie domain:",g||"default")}catch(e){console.error("Error configuring Amplify:",e)}}(0,u.d)();let f={Auth:{Cognito:{userPoolId:(null==h?void 0:null===(n=h.auth)||void 0===n?void 0:n.user_pool_id)||"us-east-1_Gh00T12dW",userPoolClientId:(null==h?void 0:null===(t=h.auth)||void 0===t?void 0:t.user_pool_client_id)||"5e5a5drp00jd43tr7ph1ceg412",identityPoolId:(null==h?void 0:null===(d=h.auth)||void 0===d?void 0:d.identity_pool_id)||"us-east-1:a0b02f73-93a3-4b52-b1cb-eaa306375a33",region:(null==h?void 0:null===(a=h.auth)||void 0===a?void 0:a.aws_region)||"us-east-1"}},API:{GraphQL:{endpoint:(null==h?void 0:null===(s=h.data)||void 0===s?void 0:s.url)||"https://vth6pntotrhvfpxo2gwn3kzqry.appsync-api.us-east-1.amazonaws.com/graphql",region:(null==h?void 0:null===(l=h.data)||void 0===l?void 0:l.aws_region)||"us-east-1",defaultAuthMode:"apiKey",apiKey:(null==h?void 0:null===(r=h.data)||void 0===r?void 0:r.api_key)||"da2-ee26yqskvzfpjpquwbi53shbvu"}},domains:{main:"protegeresearchsurvey.com"},environment:"production"}},287:function(e,o,i){"use strict";function n(e,o){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("undefined"==typeof document)return;let{days:n=7,path:t="/",domain:d,secure:a=!0,sameSite:s="lax"}=i,l=new Date;l.setTime(l.getTime()+864e5*n);let r="".concat(e,"=").concat(encodeURIComponent(o),"; expires=").concat(l.toUTCString(),"; path=").concat(t);d&&(r+="; domain=".concat(d)),a&&(r+="; secure"),r+="; samesite=".concat(s),document.cookie=r}function t(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("undefined"==typeof document)return;let{path:i="/",domain:n}=o,t="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=").concat(i);n&&(t+="; domain=".concat(n)),document.cookie=t}function d(){let e=window.location.hostname;if("localhost"!==e&&"127.0.0.1"!==e)return e.includes("amplifyapp.com"),e}function a(){if("undefined"==typeof document)return;let e=d();["amplify-signin-with-hostedUI","amplify-redirected-from-hosted-ui","amplify.auth.tokens","CognitoIdentityServiceProvider.*","amazon-cognito-advanced-security-data","aws.cognito.*","idToken","accessToken","refreshToken","auth_tokens","CognitoIdentityServiceProvider.*","Authorization"].forEach(o=>{o.includes("*")?document.cookie.split(";").forEach(i=>{let n=i.split("=")[0].trim();n.includes(o.replace("*",""))&&(t(n,{domain:e}),t(n))}):(t(o,{domain:e}),t(o))}),n("redirect_count","0",{days:1}),console.log("All authentication cookies cleared")}function s(){if("undefined"!=typeof document){n("redirect_count","0",{days:1}),function(e){var o;if("undefined"==typeof document)return null;let i=null===(o=document.cookie.split("; ").find(o=>o.startsWith("".concat(e,"="))))||void 0===o?void 0:o.split("=")[1];return i?decodeURIComponent(i):null}("Authorization")&&t("Authorization");{var e;let o=new URL(window.location.href);(o.searchParams.has("redirect_loop")||o.searchParams.has("error")&&(null===(e=o.searchParams.get("error"))||void 0===e?void 0:e.includes("redirect")))&&(a(),o.searchParams.delete("redirect_loop"),o.searchParams.delete("error"),window.history.replaceState({},"",o.toString()))}}}function l(){let e=()=>{s(),(window.location.href.includes("ERR_TOO_MANY_REDIRECTS")||window.location.href.includes("error=redirect_loop"))&&(console.log("Detected redirect loop, clearing all authentication cookies"),a(),window.location.href=window.location.origin+"/admin/login?fixed=true")};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}i.d(o,{DZ:function(){return l},Wx:function(){return a},nT:function(){return s},yT:function(){return d}})},8436:function(e,o,i){"use strict";i.r(o),i.d(o,{default:function(){return l}});var n=i(5893),t=i(7294),d=i(1163),a=i(1354),s=i(287);function l(){var e,o,i,l;let r=(0,d.useRouter)(),[c,u]=(0,t.useState)({environment:"production",domain:window.location.hostname,path:window.location.pathname,amplifyConfigured:!1,authConfigured:!1,apiConfigured:!1,userPoolId:(null===a.Ao||void 0===a.Ao?void 0:null===(o=a.Ao.Auth)||void 0===o?void 0:null===(e=o.Cognito)||void 0===e?void 0:e.userPoolId)||"not-found",apiEndpoint:(null===a.Ao||void 0===a.Ao?void 0:null===(l=a.Ao.API)||void 0===l?void 0:null===(i=l.GraphQL)||void 0===i?void 0:i.endpoint)||"not-found",headers:{},cookies:{},cookieDomain:"",redirectHistory:[],middlewareChecks:0,isAdminDomain:!1,authCookiesFound:!1,potentialRedirectLoop:!1,timestamp:new Date().toISOString()});return(0,t.useEffect)(()=>{let e={};document.cookie.split(";").forEach(o=>{let[i,n]=o.trim().split("=");i&&(e[i]=n||"empty")});let o=sessionStorage.getItem("redirect_count")||"0",i=JSON.parse(sessionStorage.getItem("redirect_history")||"[]"),n=function(){let e={};return"undefined"!=typeof document&&document.cookie.split(";").forEach(o=>{let[i,n]=o.trim().split("=");i&&(e[i]=n||"empty")}),e}(),t=Object.keys(n).some(e=>e.includes("Token")||e.includes("token")||e.includes("Cognito")||e.includes("cognito")||e.includes("aws")||e.includes("Auth")),d=parseInt(o,10)>3||"true"===r.query.redirect_loop||"true"===r.query.fixed;u(l=>{var r,c,u,m;return{...l,domain:window.location.hostname,path:window.location.pathname,headers:e,cookies:n,cookieDomain:(0,s.yT)()||"not-set",amplifyConfigured:!!a.Ao,authConfigured:!!(null===a.Ao||void 0===a.Ao?void 0:null===(c=a.Ao.Auth)||void 0===c?void 0:null===(r=c.Cognito)||void 0===r?void 0:r.userPoolId),apiConfigured:!!(null===a.Ao||void 0===a.Ao?void 0:null===(m=a.Ao.API)||void 0===m?void 0:null===(u=m.GraphQL)||void 0===u?void 0:u.endpoint),middlewareChecks:parseInt(o,10),redirectHistory:i,isAdminDomain:window.location.hostname.startsWith("admin."),authCookiesFound:t,potentialRedirectLoop:d,timestamp:new Date().toISOString()}})},[r.query]),(0,n.jsx)("div",{className:"min-h-screen bg-gray-100 p-8",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Application Diagnostics"}),(0,n.jsxs)("div",{className:"mb-8 p-4 bg-blue-50 rounded-lg",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Actions"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,n.jsx)("button",{onClick:()=>{(0,s.Wx)(),alert("Authentication cookies cleared. Page will reload."),window.location.reload()},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Clear Auth Cookies"}),(0,n.jsx)("button",{onClick:()=>{(0,s.nT)(),alert("Cookies fixed. Page will reload."),window.location.reload()},className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700",children:"Fix Problem Cookies"}),(0,n.jsx)("button",{onClick:()=>{r.push("/admin/login?fixed=true")},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Go to Login Page"})]})]}),c.potentialRedirectLoop&&(0,n.jsxs)("div",{className:"mb-8 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-red-700 mb-2",children:"⚠️ Potential Redirect Loop Detected"}),(0,n.jsx)("p",{className:"text-red-600 mb-2",children:"The system has detected a high number of redirects or a redirect loop parameter in the URL. This may indicate an authentication issue."}),(0,n.jsx)("p",{className:"text-red-600",children:"Try clearing your auth cookies using the button above and then go to the login page."})]}),(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Environment Information"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[(0,n.jsx)("div",{className:"font-medium",children:"Environment:"}),(0,n.jsx)("div",{children:c.environment}),(0,n.jsx)("div",{className:"font-medium",children:"Current Domain:"}),(0,n.jsx)("div",{children:c.domain}),(0,n.jsx)("div",{className:"font-medium",children:"Current Path:"}),(0,n.jsx)("div",{children:c.path}),(0,n.jsx)("div",{className:"font-medium",children:"Cookie Domain:"}),(0,n.jsx)("div",{children:c.cookieDomain}),(0,n.jsx)("div",{className:"font-medium",children:"Timestamp:"}),(0,n.jsx)("div",{children:c.timestamp})]})]}),(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Amplify Configuration"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[(0,n.jsx)("div",{className:"font-medium",children:"Configured:"}),(0,n.jsx)("div",{children:c.amplifyConfigured?"Yes":"No"}),(0,n.jsx)("div",{className:"font-medium",children:"Auth Configured:"}),(0,n.jsx)("div",{children:c.authConfigured?"Yes":"No"}),(0,n.jsx)("div",{className:"font-medium",children:"API Configured:"}),(0,n.jsx)("div",{children:c.apiConfigured?"Yes":"No"})]})]}),(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Auth Details"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[(0,n.jsx)("div",{className:"font-medium",children:"User Pool ID:"}),(0,n.jsx)("div",{className:"break-all",children:c.userPoolId}),(0,n.jsx)("div",{className:"font-medium",children:"Auth Cookies Found:"}),(0,n.jsx)("div",{className:c.authCookiesFound?"text-green-600":"text-red-600",children:c.authCookiesFound?"Yes":"No"})]})]}),(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"API Details"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[(0,n.jsx)("div",{className:"font-medium",children:"GraphQL Endpoint:"}),(0,n.jsx)("div",{className:"break-all",children:c.apiEndpoint})]})]}),(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Cookie Information"}),(0,n.jsx)("pre",{className:"bg-gray-100 p-3 rounded overflow-auto max-h-60",children:JSON.stringify(c.cookies,null,2)})]}),(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Redirect Information"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[(0,n.jsx)("div",{className:"font-medium",children:"Is Admin Domain:"}),(0,n.jsx)("div",{children:c.isAdminDomain?"Yes":"No"}),(0,n.jsx)("div",{className:"font-medium",children:"Middleware Check Count:"}),(0,n.jsxs)("div",{className:c.middlewareChecks>3?"text-red-600 font-bold":"",children:[c.middlewareChecks,c.middlewareChecks>3&&" (High - possible redirect loop)"]}),(0,n.jsx)("div",{className:"font-medium",children:"Query Parameters:"}),(0,n.jsx)("div",{className:"break-all",children:JSON.stringify(r.query)})]}),(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Redirect History:"}),(0,n.jsx)("pre",{className:"bg-gray-100 p-3 rounded overflow-auto max-h-60",children:JSON.stringify(c.redirectHistory,null,2)})]})]})})}(0,a.nq)()}},function(e){e.O(0,[282,797,888,774,179],function(){return e(e.s=8263)}),_N_E=e.O()}]);