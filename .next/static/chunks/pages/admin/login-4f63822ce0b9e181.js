(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{6177:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/login",function(){return n(707)}])},5230:function(e,s,n){"use strict";n.d(s,{Z:function(){return o}});var i=n(5893),r=n(7294),t=n(1163),a=n(9051);function o(e){let{children:s,redirectTo:n="/admin"}=e,{isAuthenticated:o,isLoading:l,refreshAuthState:d}=(0,a.a)(),c=(0,t.useRouter)(),{redirect:u,fixed:m}=c.query,[g,x]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{d()},[d]),(0,r.useEffect)(()=>{!o||l||u||"true"===m||g||(console.log("User already authenticated, redirecting to dashboard"),x(!0),setTimeout(()=>{c.replace(n)},500))},[o,l,u,m,n,c,g]),g)?(0,i.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,i.jsx)("p",{children:"You are already signed in. Redirecting to dashboard..."})]})}):(0,i.jsx)(i.Fragment,{children:s})}},9051:function(e,s,n){"use strict";n.d(s,{a:function(){return i.a}});var i=n(8877)},707:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return g}});var i=n(5893),r=n(7294),t=n(1163),a=n(9008),o=n.n(a),l=n(1664),d=n.n(l),c=n(9051),u=n(287),m=n(5230);function g(){let e=(0,t.useRouter)(),{login:s,completeNewPassword:n,refreshAuthState:a}=(0,c.a)(),[l,g]=(0,r.useState)(""),[x,f]=(0,r.useState)(""),[h,p]=(0,r.useState)(""),[w,v]=(0,r.useState)(""),[y,j]=(0,r.useState)(null),[b,N]=(0,r.useState)(!1),[P,S]=(0,r.useState)(!1),{redirect:_,fixed:k}=e.query;(0,r.useEffect)(()=>{(0,u.DZ)(),"true"===k&&console.log("Login page loaded after fixing redirect loop")},[k]),(0,r.useEffect)(()=>{console.log("Login page loaded on domain:",window.location.hostname)},[]);let C=async e=>{var n,i,r;e.preventDefault(),j(null),N(!0);try{(0,u.nT)(),console.log("Logging in user:",l);let e=await s(l,x);if((null===(n=e.nextStep)||void 0===n?void 0:n.signInStep)==="CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED"){console.log("New password required, showing password change form"),S(!0),N(!1);return}if(e.isSuccess){console.log("Sign in successful, redirecting to admin panel"),await new Promise(e=>setTimeout(e,1500)),await a();let e="string"==typeof _?_:"/admin";window.location.href=e}else j(e.message||"Failed to sign in. Please try again.")}catch(e){console.error("Login error:",e),j(e.message||"Failed to sign in. Please check your credentials."),((null===(i=e.message)||void 0===i?void 0:i.includes("Token"))||(null===(r=e.message)||void 0===r?void 0:r.includes("authentication")))&&(0,u.Wx)()}finally{N(!1)}},R=async s=>{if(s.preventDefault(),j(null),N(!0),h!==w){j("Passwords do not match"),N(!1);return}try{console.log("Submitting new password");let s=await n(h);s.isSuccess?(console.log("Password changed successfully"),S(!1),setTimeout(()=>{e.push("string"==typeof _?_:"/admin")},1e3)):(console.error("Failed to set new password:",s.message),j(s.message))}catch(e){console.error("Password change error:",e),j(e.message||"Failed to set new password")}finally{N(!1)}};return(0,i.jsxs)(m.Z,{redirectTo:"/admin",children:[(0,i.jsxs)(o(),{children:[(0,i.jsx)("title",{children:"Admin Login | Protege Research Survey"}),(0,i.jsx)("meta",{name:"description",content:"Login to the Protege Research Survey admin panel"}),(0,i.jsx)("meta",{name:"robots",content:"noindex, nofollow"})]}),(0,i.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gray-100 px-4 py-12 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"w-full max-w-md space-y-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900",children:"Admin Login"}),(0,i.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to access the survey management dashboard"})]}),y&&(0,i.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z",clipRule:"evenodd"})})}),(0,i.jsx)("div",{className:"ml-3",children:(0,i.jsx)("p",{className:"text-sm text-red-700",children:y})})]})}),"true"===e.query.fixed&&(0,i.jsx)("div",{className:"rounded-md bg-green-50 p-4",children:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})})}),(0,i.jsx)("div",{className:"ml-3",children:(0,i.jsx)("p",{className:"text-sm text-green-700",children:"Login issues fixed. Please sign in again."})})]})}),P?(0,i.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:R,children:[(0,i.jsxs)("div",{className:"-space-y-px rounded-md shadow-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"newPassword",className:"sr-only",children:"New Password"}),(0,i.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",autoComplete:"new-password",required:!0,className:"relative block w-full rounded-t-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"New Password",value:h,onChange:e=>p(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"confirmPassword",className:"sr-only",children:"Confirm Password"}),(0,i.jsx)("input",{id:"confirmPassword",name:"confirmPassword",autoComplete:"new-password",required:!0,className:"relative block w-full rounded-b-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Confirm Password",value:w,onChange:e=>v(e.target.value)})]})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",className:"group relative flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Set New Password"})})]}):(0,i.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:C,children:[(0,i.jsxs)("div",{className:"-space-y-px rounded-md shadow-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"username",className:"sr-only",children:"Username"}),(0,i.jsx)("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"relative block w-full rounded-t-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Username",value:l,onChange:e=>g(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),(0,i.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"relative block w-full rounded-b-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Password",value:x,onChange:e=>f(e.target.value)})]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,i.jsx)("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900",children:"Remember me"})]}),(0,i.jsx)("div",{className:"text-sm",children:(0,i.jsx)(d(),{href:"/admin/forgot-password",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Forgot your password?"})})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",className:"group relative flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Sign in"})}),(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsx)("div",{className:"text-sm",children:(0,i.jsx)(d(),{href:"/admin/signup",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Don't have an account? Sign up"})})})]})]})})]})}},1163:function(e,s,n){e.exports=n(3079)}},function(e){e.O(0,[664,888,774,179],function(){return e(e.s=6177)}),_N_E=e.O()}]);