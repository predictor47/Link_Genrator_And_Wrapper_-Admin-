(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{6177:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/login",function(){return t(707)}])},7555:function(e,s,t){"use strict";t.d(s,{OA:function(){return a},XR:function(){return o}});var n=t(9319),i=t(6398);async function r(){let e={timestamp:new Date().toISOString(),cookies:{},session:null,user:null,errors:[]};"undefined"!=typeof document&&document.cookie.split(";").forEach(s=>{let[t,n]=s.split("=").map(e=>e.trim());(t.includes("CognitoIdentityServiceProvider")||t.includes("amplify")||t.includes("Token"))&&(e.cookies[t]=n?"present":"empty")});try{var s,t;let i=await (0,n.y)();e.session={hasIdToken:!!(null===(s=i.tokens)||void 0===s?void 0:s.idToken),hasAccessToken:!!(null===(t=i.tokens)||void 0===t?void 0:t.accessToken),hasTokens:!!i.tokens}}catch(s){e.errors.push({source:"fetchAuthSession",message:s instanceof Error?s.message:String(s)})}try{let s=await (0,i.t)();e.user={userId:s.userId,username:s.username,signInDetails:s.signInDetails}}catch(s){e.errors.push({source:"getCurrentUser",message:s instanceof Error?s.message:String(s)})}return e}async function o(){try{let e=await r();console.log("=== AUTH DIAGNOSTICS ==="),console.log(JSON.stringify(e,null,2)),console.log("=======================")}catch(e){console.error("Failed to get auth diagnostics:",e)}}async function a(){try{let e=await r();if(e.errors.length>0&&Object.keys(e.cookies).length>0)return"undefined"!=typeof document&&document.cookie.split(";").forEach(e=>{let[s]=e.split("=").map(e=>e.trim());(s.includes("CognitoIdentityServiceProvider")||s.includes("amplify")||s.includes("Token"))&&(console.log("Clearing problematic cookie:",s),document.cookie="".concat(s,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"))}),window.location.reload(),!0;return!1}catch(e){return console.error("Failed to fix auth issues:",e),!1}}},5230:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});var n=t(5893),i=t(7294),r=t(1163),o=t(9051);function a(e){let{children:s,redirectTo:t="/admin"}=e,{isAuthenticated:a,isLoading:l,refreshAuthState:c}=(0,o.a)();(0,r.useRouter)();let[d,u]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{c(),console.log("Auth state refreshed, current state:",{isAuthenticated:a,isLoading:l})},[c]),(0,i.useEffect)(()=>{console.log("AuthRedirectCheck effect triggered:",{isAuthenticated:a,isLoading:l,hasAttemptedRedirect:d,redirectTo:t,currentPath:window.location.pathname}),!a||l||d||(console.log("User is authenticated, attempting redirect to:",t),u(!0),setTimeout(()=>{console.log("Executing redirect to:",t),window.location.replace(t)},100))},[a,l,t,d]),a&&!l)?(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,n.jsx)("p",{children:"You are already signed in. Redirecting to dashboard..."})]})}):(0,n.jsx)(n.Fragment,{children:s})}},9051:function(e,s,t){"use strict";t.d(s,{a:function(){return n.a}});var n=t(9985)},707:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return f}});var n=t(5893),i=t(7294),r=t(1163),o=t(9008),a=t.n(o),l=t(1664),c=t.n(l),d=t(9051),u=t(5551),m=t(287),g=t(5230),h=t(7555);function f(){let e=(0,r.useRouter)(),{login:s,completeNewPassword:t,refreshAuthState:o}=(0,d.a)(),[l,f]=(0,i.useState)(""),[x,p]=(0,i.useState)(""),[w,v]=(0,i.useState)(""),[y,j]=(0,i.useState)(""),[b,N]=(0,i.useState)(null),[k,S]=(0,i.useState)(!1),[P,C]=(0,i.useState)(!1),{redirect:T,fixed:_}=e.query;(0,i.useEffect)(()=>{(0,m.DZ)(),"true"===_&&console.log("Login page loaded after fixing redirect loop")},[_]),(0,i.useEffect)(()=>{console.log("Login page loaded on domain:",window.location.hostname),(async()=>{console.log("Current auth state from service:",await u.AuthService.isAuthenticated())})()},[]);let E=async e=>{var t,n,i;e.preventDefault(),N(null),S(!0);try{(0,m.nT)(),console.log("Logging in user:",l);let e=await s(l,x);if((null===(t=e.nextStep)||void 0===t?void 0:t.signInStep)==="CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED"){console.log("New password required, showing password change form"),C(!0),S(!1);return}if(e.isSuccess){console.log("Sign in successful, redirecting to admin panel"),await new Promise(e=>setTimeout(e,1500)),await o();let e="string"==typeof T?T:"/admin";window.location.href=e}else N(e.message||"Failed to sign in. Please try again.")}catch(e){console.error("Login error:",e),N(e.message||"Failed to sign in. Please check your credentials."),((null===(n=e.message)||void 0===n?void 0:n.includes("Token"))||(null===(i=e.message)||void 0===i?void 0:i.includes("authentication")))&&(0,m.Wx)()}finally{S(!1)}},I=async s=>{if(s.preventDefault(),N(null),S(!0),w!==y){N("Passwords do not match"),S(!1);return}try{console.log("Submitting new password");let s=await t(w);s.isSuccess?(console.log("Password changed successfully"),C(!1),setTimeout(()=>{e.push("string"==typeof T?T:"/admin")},1e3)):(console.error("Failed to set new password:",s.message),N(s.message))}catch(e){console.error("Password change error:",e),N(e.message||"Failed to set new password")}finally{S(!1)}};return(0,n.jsxs)(g.Z,{redirectTo:"/admin",children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:"Admin Login | Protege Research Survey"}),(0,n.jsx)("meta",{name:"description",content:"Login to the Protege Research Survey admin panel"}),(0,n.jsx)("meta",{name:"robots",content:"noindex, nofollow"})]}),(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gray-100 px-4 py-12 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"w-full max-w-md space-y-8",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900",children:"Admin Login"}),(0,n.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to access the survey management dashboard"})]}),b&&(0,n.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z",clipRule:"evenodd"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("p",{className:"text-sm text-red-700",children:b})})]})}),"true"===e.query.fixed&&(0,n.jsx)("div",{className:"rounded-md bg-green-50 p-4",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("p",{className:"text-sm text-green-700",children:"Login issues fixed. Please sign in again."})})]})}),P?(0,n.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:I,children:[(0,n.jsxs)("div",{className:"-space-y-px rounded-md shadow-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"newPassword",className:"sr-only",children:"New Password"}),(0,n.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",autoComplete:"new-password",required:!0,className:"relative block w-full rounded-t-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"New Password",value:w,onChange:e=>v(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"confirmPassword",className:"sr-only",children:"Confirm Password"}),(0,n.jsx)("input",{id:"confirmPassword",name:"confirmPassword",autoComplete:"new-password",required:!0,className:"relative block w-full rounded-b-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Confirm Password",value:y,onChange:e=>j(e.target.value)})]})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"submit",className:"group relative flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Set New Password"})})]}):(0,n.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:E,children:[(0,n.jsxs)("div",{className:"-space-y-px rounded-md shadow-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"username",className:"sr-only",children:"Username"}),(0,n.jsx)("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"relative block w-full rounded-t-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Username",value:l,onChange:e=>f(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),(0,n.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"relative block w-full rounded-b-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Password",value:x,onChange:e=>p(e.target.value)})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,n.jsx)("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900",children:"Remember me"})]}),(0,n.jsx)("div",{className:"text-sm",children:(0,n.jsx)(c(),{href:"/admin/forgot-password",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Forgot your password?"})})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"submit",className:"group relative flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Sign in"})}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("div",{className:"text-sm",children:(0,n.jsx)(c(),{href:"/admin/signup",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Don't have an account? Sign up"})})}),(0,n.jsxs)("div",{className:"flex justify-center mt-4",children:[(0,n.jsx)("button",{type:"button",onClick:()=>window.location.href="/admin",className:"text-sm text-gray-600 hover:text-indigo-600 mr-4",children:"Debug: Go directly to dashboard"}),(0,n.jsx)("button",{type:"button",onClick:()=>{(0,h.XR)(),(0,h.OA)().then(e=>{e?alert("Authentication issues fixed. Page will reload."):alert("Diagnostics logged to console. Check browser dev tools.")})},className:"text-sm text-gray-600 hover:text-indigo-600",children:"Debug: Fix Auth Issues"})]})]})]})})]})}},1163:function(e,s,t){e.exports=t(3079)}},function(e){e.O(0,[664,888,774,179],function(){return e(e.s=6177)}),_N_E=e.O()}]);