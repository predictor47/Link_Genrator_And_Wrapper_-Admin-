(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[705],{8680:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/projects/new",function(){return a(247)}])},1359:function(e,t,a){"use strict";a.d(t,{d:function(){return i}});var s=a(6164),r=a(9556),n=a(7510);let o=null;async function i(){var e;if(o)return o;let t=(0,n.m)();if(!(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.url))throw Error("Amplify config is missing GraphQL endpoint.");r.V.configure(t);let a=(0,s.d)({authMode:"userPool"});if(console.log("Amplify Data client:",a),console.log("client.models:",a.models),!a.models||0===Object.keys(a.models).length)throw console.error("client.models is empty! This usually means the Amplify backend is not properly connected."),Error("Amplify Data models are not available. Please check your backend connection.");let i=["Project","Vendor","Question","SurveyLink","ProjectVendor"];for(let e of i)if(!a.models[e])throw console.error("".concat(e," model is missing from Amplify Data client!")),Error("Required model ".concat(e," is not available in the Amplify Data client."));console.log("All required models are available:",i);let l=e=>e.data,d=(e,t)=>{let a=e.message||"Unknown error",s=e.name||"Error";throw console.error("Amplify Error (".concat(t,"):"),{name:s,message:a}),e};return o={client:a,projects:{create:async e=>{try{let t=await a.models.Project.create(e);return{data:l(t)}}catch(e){return d(e,"projects.create"),{data:null}}},get:async e=>({data:l(await a.models.Project.get({id:e}))}),list:async e=>({data:(await a.models.Project.list(e)).data||[]}),update:async(e,t)=>({data:l(await a.models.Project.update({id:e,...t}))}),delete:async e=>({data:l(await a.models.Project.delete({id:e}))}),getWithRelations:async e=>{let t=await a.models.Project.get({id:e});if(t.data){let s=await a.models.SurveyLink.list({filter:{projectId:{eq:e}}}),r=(await a.models.ProjectVendor.list({filter:{projectId:{eq:e}}})).data.map(e=>e.vendorId).filter(e=>null!=e),n=[];r.length>0&&(n=(await Promise.all(r.map(e=>a.models.Vendor.get({id:e})))).filter(e=>null!==e.data).map(e=>e.data));let o=await a.models.Question.list({filter:{projectId:{eq:e}}});return{data:{...t.data,surveyLinks:s.data||[],vendors:n,questions:o.data||[]}}}return{data:null}}},surveyLinks:{create:async e=>({data:l(await a.models.SurveyLink.create(e))}),get:async e=>({data:l(await a.models.SurveyLink.get({id:e}))}),getByUid:async e=>{let t=await a.models.SurveyLink.list({filter:{uid:{eq:e}}});return{data:t.data&&t.data.length>0?t.data[0]:null}},update:async(e,t)=>({data:l(await a.models.SurveyLink.update({id:e,...t}))}),list:async e=>({data:(await a.models.SurveyLink.list(e)).data||[]}),listByProject:async e=>({data:(await a.models.SurveyLink.list({filter:{projectId:{eq:e}}})).data||[]}),delete:async e=>({data:l(await a.models.SurveyLink.delete({id:e}))})},vendors:{create:async e=>({data:l(await a.models.Vendor.create(e))}),get:async e=>({data:l(await a.models.Vendor.get({id:e}))}),list:async e=>({data:(await a.models.Vendor.list(e)).data||[]}),listByProject:async e=>{let t=(await a.models.ProjectVendor.list({filter:{projectId:{eq:e}}})).data.map(e=>e.vendorId).filter(e=>null!=e);return t.length>0?{data:(await Promise.all(t.map(e=>a.models.Vendor.get({id:e})))).map(e=>e.data).filter(e=>null!==e)}:{data:[]}},update:async(e,t)=>({data:l(await a.models.Vendor.update({id:e,...t}))}),delete:async e=>({data:l(await a.models.Vendor.delete({id:e}))})},questions:{create:async e=>({data:l(await a.models.Question.create(e))}),get:async e=>({data:l(await a.models.Question.get({id:e}))}),list:async e=>({data:(await a.models.Question.list(e)).data||[]}),listByProject:async e=>({data:(await a.models.Question.list({filter:{projectId:{eq:e}}})).data||[]}),update:async(e,t)=>({data:l(await a.models.Question.update({id:e,...t}))}),delete:async e=>({data:l(await a.models.Question.delete({id:e}))})},transaction:{execute:async e=>{let t=[];for(let a of e){let e=await a;t.push(e)}return t}}}}},7555:function(e,t,a){"use strict";a.d(t,{OA:function(){return i},XR:function(){return o}});var s=a(9319),r=a(6398);async function n(){let e={timestamp:new Date().toISOString(),cookies:{},session:null,user:null,errors:[]};"undefined"!=typeof document&&document.cookie.split(";").forEach(t=>{let[a,s]=t.split("=").map(e=>e.trim());(a.includes("CognitoIdentityServiceProvider")||a.includes("amplify")||a.includes("Token"))&&(e.cookies[a]=s?"present":"empty")});try{var t,a;let r=await (0,s.y)();e.session={hasIdToken:!!(null===(t=r.tokens)||void 0===t?void 0:t.idToken),hasAccessToken:!!(null===(a=r.tokens)||void 0===a?void 0:a.accessToken),hasTokens:!!r.tokens}}catch(t){e.errors.push({source:"fetchAuthSession",message:t instanceof Error?t.message:String(t)})}try{let t=await (0,r.t)();e.user={userId:t.userId,username:t.username,signInDetails:t.signInDetails}}catch(t){e.errors.push({source:"getCurrentUser",message:t instanceof Error?t.message:String(t)})}return e}async function o(){try{let e=await n();console.log("=== AUTH DIAGNOSTICS ==="),console.log(JSON.stringify(e,null,2)),console.log("=======================")}catch(e){console.error("Failed to get auth diagnostics:",e)}}async function i(){try{let e=await n();if(e.errors.length>0&&Object.keys(e.cookies).length>0)return"undefined"!=typeof document&&document.cookie.split(";").forEach(e=>{let[t]=e.split("=").map(e=>e.trim());(t.includes("CognitoIdentityServiceProvider")||t.includes("amplify")||t.includes("Token"))&&(console.log("Clearing problematic cookie:",t),document.cookie="".concat(t,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"))}),window.location.reload(),!0;return!1}catch(e){return console.error("Failed to fix auth issues:",e),!1}}},9051:function(e,t,a){"use strict";a.d(t,{a:function(){return s.a}});var s=a(9985)},3101:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(5893),r=a(7294),n=a(1163),o=a(9051),i=a(7555);function l(e){let{children:t,redirectTo:a="/admin/login"}=e,{isAuthenticated:l,isLoading:d}=(0,o.a)(),c=(0,n.useRouter)(),[u,m]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{if("undefined"!=typeof document){let e=document.cookie.match(/redirect_count=(\d+)/);if((e?parseInt(e[1],10):0)>5){m(!0);return}}d||l||(console.log("User not authenticated, redirecting to login page"),(0,i.XR)().then(()=>{let e=encodeURIComponent(c.asPath);window.location.href="".concat(a,"?redirect=").concat(e)}))},[l,d,a,c]),u)?(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white p-8 rounded shadow text-center max-w-md mx-auto",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4 text-red-600",children:"Too many login attempts"}),(0,s.jsx)("p",{className:"mb-4",children:"You have been redirected too many times. Please clear your cookies, log in again, or contact support if the problem persists."})]})}):d?(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):l?(0,s.jsx)(s.Fragment,{children:t}):null}},247:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var s=a(5893),r=a(7294),n=a(1163),o=a(1664),i=a.n(o),l=a(3101),d=a(1359);function c(){let e=(0,n.useRouter)(),[t,a]=(0,r.useState)(""),[o,c]=(0,r.useState)(""),[u,m]=(0,r.useState)([]),[p,f]=(0,r.useState)(""),[y,h]=(0,r.useState)(""),[g,x]=(0,r.useState)(!1),[b,j]=(0,r.useState)(""),v=e=>{m(u.filter((t,a)=>a!==e))},w=async a=>{if(a.preventDefault(),!t.trim()){j("Project name is required");return}x(!0),j("");try{let a=await (0,d.d)();if(!a||!a.projects){console.error("amplifyDataService or amplifyDataService.projects is undefined:",{amplifyDataService:a}),j("Project creation service is not available (projects undefined)."),x(!1);return}if("function"!=typeof a.projects.create){console.error("amplifyDataService.projects.create is not a function:",a.projects),j("Project creation service is not available (create not a function)."),x(!1);return}let s=new Date().toISOString(),r=await a.projects.create({name:t,description:o||"",surveyUrl:"".concat(window.location.origin,"/survey"),status:"ACTIVE",targetCompletions:100,currentCompletions:0,createdAt:s,updatedAt:s,settings:null});if(!r||!r.data){j("Failed to create project. Project creation returned null."),x(!1);return}if(u&&Array.isArray(u)&&u.length>0){let e=r.data.id,t=u.map((t,r)=>a.questions.create({projectId:e,text:t.text,type:"MULTIPLE_CHOICE",options:JSON.stringify(t.options||[]),sequence:r+1,isRequired:!0,createdAt:s,updatedAt:s}));await Promise.all(t)}e.push("/admin")}catch(e){j(e.message||"Failed to create project")}finally{x(!1)}};return(0,s.jsx)(l.Z,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsx)("div",{className:"bg-white shadow",children:(0,s.jsxs)("div",{className:"container mx-auto py-6 px-4 sm:px-6 lg:px-8 flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create New Project"}),(0,s.jsx)(i(),{href:"/admin",className:"text-blue-600 hover:text-blue-800",children:"Back to Dashboard"})]})}),(0,s.jsx)("div",{className:"container mx-auto py-6 px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Project Details"})}),(0,s.jsxs)("form",{onSubmit:w,className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Project Name *"}),(0,s.jsx)("input",{type:"text",id:"name",value:t,onChange:e=>a(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (optional)"}),(0,s.jsx)("textarea",{id:"description",value:o,onChange:e=>c(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{className:"mb-6 border-t border-gray-200 pt-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Pre-survey Questions"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"These questions will be asked before the survey and used for validation."}),(0,s.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-md",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"question",className:"block text-sm font-medium text-gray-700 mb-1",children:"Question Text"}),(0,s.jsx)("input",{type:"text",id:"question",value:p,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"E.g., What is your age group?"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"options",className:"block text-sm font-medium text-gray-700 mb-1",children:"Options (comma separated)"}),(0,s.jsx)("input",{type:"text",id:"options",value:y,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"E.g., 18-24, 25-34, 35-44, 45+"})]}),(0,s.jsx)("button",{type:"button",onClick:()=>{if(!p.trim()){j("Question text is required");return}let e=y.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(e.length<2){j("At least two options are required");return}m([...u,{text:p,options:e}]),f(""),h(""),j("")},className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",children:"Add Question"})]}),u.length>0?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-700",children:"Added Questions:"}),u.map((e,t)=>(0,s.jsxs)("div",{className:"p-4 border border-gray-200 rounded-md bg-white flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.text}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Options: ",e.options.join(", ")]})]}),(0,s.jsx)("button",{type:"button",onClick:()=>v(t),className:"text-red-600 hover:text-red-800 font-medium",children:"Remove"})]},t))]}):(0,s.jsx)("p",{className:"text-gray-500 italic",children:"No questions added yet"})]}),b&&(0,s.jsx)("div",{className:"mb-6 p-3 bg-red-100 text-red-700 rounded-md",children:b}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:g,className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 disabled:opacity-50",children:g?"Creating...":"Create Project"})})]})]})})]})})}},1163:function(e,t,a){e.exports=a(3079)}},function(e){e.O(0,[664,164,888,774,179],function(){return e(e.s=8680)}),_N_E=e.O()}]);