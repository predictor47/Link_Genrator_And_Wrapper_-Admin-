(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[897],{5489:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/projects/[id]/questions",function(){return s(2472)}])},7555:function(e,t,s){"use strict";s.d(t,{OA:function(){return r},XR:function(){return a}});var n=s(9319),i=s(6398);async function o(){let e={timestamp:new Date().toISOString(),cookies:{},session:null,user:null,errors:[]};"undefined"!=typeof document&&document.cookie.split(";").forEach(t=>{let[s,n]=t.split("=").map(e=>e.trim());(s.includes("CognitoIdentityServiceProvider")||s.includes("amplify")||s.includes("Token"))&&(e.cookies[s]=n?"present":"empty")});try{var t,s;let i=await (0,n.y)();e.session={hasIdToken:!!(null===(t=i.tokens)||void 0===t?void 0:t.idToken),hasAccessToken:!!(null===(s=i.tokens)||void 0===s?void 0:s.accessToken),hasTokens:!!i.tokens}}catch(t){e.errors.push({source:"fetchAuthSession",message:t instanceof Error?t.message:String(t)})}try{let t=await (0,i.t)();e.user={userId:t.userId,username:t.username,signInDetails:t.signInDetails}}catch(t){e.errors.push({source:"getCurrentUser",message:t instanceof Error?t.message:String(t)})}return e}async function a(){try{let e=await o();console.log("=== AUTH DIAGNOSTICS ==="),console.log(JSON.stringify(e,null,2)),console.log("=======================")}catch(e){console.error("Failed to get auth diagnostics:",e)}}async function r(){try{let e=await o();if(e.errors.length>0&&Object.keys(e.cookies).length>0)return"undefined"!=typeof document&&document.cookie.split(";").forEach(e=>{let[t]=e.split("=").map(e=>e.trim());(t.includes("CognitoIdentityServiceProvider")||t.includes("amplify")||t.includes("Token"))&&(console.log("Clearing problematic cookie:",t),document.cookie="".concat(t,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"))}),window.location.reload(),!0;return!1}catch(e){return console.error("Failed to fix auth issues:",e),!1}}},9051:function(e,t,s){"use strict";s.d(t,{a:function(){return n.a}});var n=s(9985)},3101:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var n=s(5893),i=s(7294),o=s(1163),a=s(9051),r=s(7555);function l(e){let{children:t,redirectTo:s="/admin/login"}=e,{isAuthenticated:l,isLoading:d}=(0,a.a)(),c=(0,o.useRouter)(),[u,m]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{if("undefined"!=typeof document){let e=document.cookie.match(/redirect_count=(\d+)/);if((e?parseInt(e[1],10):0)>5){m(!0);return}}d||l||(console.log("User not authenticated, redirecting to login page"),(0,r.XR)().then(()=>{let e=encodeURIComponent(c.asPath);window.location.href="".concat(s,"?redirect=").concat(e)}))},[l,d,s,c]),u)?(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-white p-8 rounded shadow text-center max-w-md mx-auto",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4 text-red-600",children:"Too many login attempts"}),(0,n.jsx)("p",{className:"mb-4",children:"You have been redirected too many times. Please clear your cookies, log in again, or contact support if the problem persists."})]})}):d?(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):l?(0,n.jsx)(n.Fragment,{children:t}):null}},2472:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return c},default:function(){return u}});var n=s(5893),i=s(7294),o=s(1163),a=s(1664),r=s.n(a),l=s(7066),d=s(3101),c=!0;function u(e){let{project:t,initialQuestions:s}=e;(0,o.useRouter)();let[a,c]=(0,i.useState)(s),[u,m]=(0,i.useState)(""),[h,x]=(0,i.useState)(""),[p,g]=(0,i.useState)(!1),[f,v]=(0,i.useState)(null),[y,b]=(0,i.useState)(null),j=async e=>{if(e.preventDefault(),g(!0),v(null),!u.trim()){v("Question text is required"),g(!1);return}let s=h.split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(s.length<2){v("At least two options are required"),g(!1);return}try{let e=await l.Z.post("/api/projects/".concat(t.id,"/questions"),{text:u,options:s});e.data.success&&(c([e.data.question,...a]),m(""),x(""),b("Question added successfully"),setTimeout(()=>b(null),3e3))}catch(e){var n,i;v((null===(i=e.response)||void 0===i?void 0:null===(n=i.data)||void 0===n?void 0:n.message)||"Failed to add question")}finally{g(!1)}},w=async e=>{if(confirm("Are you sure you want to delete this question?"))try{(await l.Z.delete("/api/projects/".concat(t.id,"/questions"),{data:{questionId:e}})).data.success&&(c(a.filter(t=>t.id!==e)),b("Question deleted successfully"),setTimeout(()=>b(null),3e3))}catch(e){var s,n;v((null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.message)||"Failed to delete question")}};return(0,n.jsx)(d.Z,{children:(0,n.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)(r(),{href:"/admin/projects/".concat(t.id),className:"text-blue-600 hover:text-blue-800",children:"â† Back to project"}),(0,n.jsx)("h1",{className:"text-3xl font-bold mt-2",children:t.name}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-700",children:"Pre-Survey Questions"}),(0,n.jsx)("p",{className:"text-gray-600 mt-1",children:"These questions will be asked before the survey starts and randomly during the survey as a validation check."})]}),f&&(0,n.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:f}),y&&(0,n.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",children:y}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,n.jsx)("div",{className:"md:col-span-1",children:(0,n.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Add New Question"}),(0,n.jsxs)("form",{onSubmit:j,children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"newQuestion",children:"Question Text"}),(0,n.jsx)("input",{id:"newQuestion",type:"text",placeholder:"e.g., What is your age range?",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:u,onChange:e=>m(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"newOptions",children:"Options (one per line)"}),(0,n.jsx)("textarea",{id:"newOptions",placeholder:"e.g., 18-24 25-34 35-44 45+",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:h,onChange:e=>x(e.target.value),rows:5,required:!0}),(0,n.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Enter each option on a new line. At least 2 options are required."})]}),(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50",disabled:p,children:p?"Adding...":"Add Question"})]})]})}),(0,n.jsx)("div",{className:"md:col-span-2",children:(0,n.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Existing Questions"}),0===a.length?(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,n.jsx)("p",{children:"No questions added yet."}),(0,n.jsx)("p",{className:"text-sm mt-2",children:"Add questions to enable mid-survey validation."})]}):(0,n.jsx)("div",{className:"space-y-6",children:a.map(e=>(0,n.jsx)("div",{className:"border border-gray-200 rounded-md p-4",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-lg",children:e.text}),(0,n.jsx)("ul",{className:"mt-3 list-disc pl-6",children:e.options.map((e,t)=>(0,n.jsx)("li",{className:"text-gray-600",children:e},t))})]}),(0,n.jsx)("button",{onClick:()=>w(e.id),className:"text-red-500 hover:text-red-700",title:"Delete question",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})},e.id))})]})})]})]})})}}},function(e){e.O(0,[664,143,888,774,179],function(){return e(e.s=5489)}),_N_E=e.O()}]);