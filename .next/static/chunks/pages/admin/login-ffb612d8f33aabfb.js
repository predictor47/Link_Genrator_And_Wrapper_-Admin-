(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{6177:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/login",function(){return n(3680)}])},287:function(e,t,n){"use strict";function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("undefined"==typeof document)return;let{days:i=7,path:s="/",domain:r,secure:o=!0,sameSite:a="lax"}=n,l=new Date;l.setTime(l.getTime()+864e5*i);let d="".concat(e,"=").concat(encodeURIComponent(t),"; expires=").concat(l.toUTCString(),"; path=").concat(s);r&&(d+="; domain=".concat(r)),o&&(d+="; secure"),d+="; samesite=".concat(a),document.cookie=d}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("undefined"==typeof document)return;let{path:n="/",domain:i}=t,s="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=").concat(n);i&&(s+="; domain=".concat(i)),document.cookie=s}function r(){let e=window.location.hostname;if("localhost"!==e&&"127.0.0.1"!==e)return e.includes("amplifyapp.com"),e}function o(){if("undefined"==typeof document)return;let e=r();["amplify-signin-with-hostedUI","amplify-redirected-from-hosted-ui","amplify.auth.tokens","CognitoIdentityServiceProvider.*","amazon-cognito-advanced-security-data","aws.cognito.*","idToken","accessToken","refreshToken","auth_tokens","CognitoIdentityServiceProvider.*","Authorization"].forEach(t=>{t.includes("*")?document.cookie.split(";").forEach(n=>{let i=n.split("=")[0].trim();i.includes(t.replace("*",""))&&(s(i,{domain:e}),s(i))}):(s(t,{domain:e}),s(t))}),i("redirect_count","0",{days:1}),console.log("All authentication cookies cleared")}function a(){if("undefined"!=typeof document){i("redirect_count","0",{days:1}),function(e){var t;if("undefined"==typeof document)return null;let n=null===(t=document.cookie.split("; ").find(t=>t.startsWith("".concat(e,"="))))||void 0===t?void 0:t.split("=")[1];return n?decodeURIComponent(n):null}("Authorization")&&s("Authorization");{var e;let t=new URL(window.location.href);(t.searchParams.has("redirect_loop")||t.searchParams.has("error")&&(null===(e=t.searchParams.get("error"))||void 0===e?void 0:e.includes("redirect")))&&(o(),t.searchParams.delete("redirect_loop"),t.searchParams.delete("error"),window.history.replaceState({},"",t.toString()))}}}function l(){let e=()=>{a(),(window.location.href.includes("ERR_TOO_MANY_REDIRECTS")||window.location.href.includes("error=redirect_loop"))&&(console.log("Detected redirect loop, clearing all authentication cookies"),o(),window.location.href=window.location.origin+"/admin/login?fixed=true")};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}n.d(t,{DZ:function(){return l},Wx:function(){return o},nT:function(){return a},yT:function(){return r}})},3680:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var i=n(5893),s=n(7294),r=n(1163),o=n(9008),a=n.n(o),l=n(1664),d=n.n(l),c=n(6359),u=n(1354);let m=()=>{let[e,t]=(0,s.useState)(!1),[n,i]=(0,s.useState)(!0),[r,o]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let n=async()=>{try{i(!0);let e=await c.e.isAuthenticated();if(t(e),e){let e=await c.e.getCurrentUser(),t=await c.e.getUserAttributes();o({...e,attributes:t})}else o(null)}catch(e){console.error("Error checking authentication:",e),t(!1),o(null)}finally{i(!1)}};n();let s=setInterval(async()=>{try{await c.e.isAuthenticated()!==e&&n()}catch(e){console.error("Error refreshing authentication status:",e)}},3e5);return()=>clearInterval(s)},[e]),{isAuthenticated:e,isLoading:n,user:r,signIn:c.e.signIn,signOut:c.e.signOut,signUp:c.e.signUp,confirmSignUp:c.e.confirmSignUp}};var g=n(287);function f(){let e=(0,r.useRouter)(),{isAuthenticated:t,isLoading:n}=m(),[o,l]=(0,s.useState)(""),[u,f]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[p,v]=(0,s.useState)(""),[w,y]=(0,s.useState)(null),[j,N]=(0,s.useState)(!1),{redirect:b,fixed:S}=e.query;(0,s.useEffect)(()=>{(0,g.DZ)(),"true"===S&&console.log("Login page loaded after fixing redirect loop")},[S]),(0,s.useEffect)(()=>{(async()=>{try{if("true"===e.query.fixed)return;await c.e.isAuthenticated()&&(console.log("User is already authenticated, redirecting..."),e.replace("string"==typeof b?b:"/admin"))}catch(e){console.error("Auth check error:",e),(0,g.nT)()}})()},[b,e]),(0,s.useEffect)(()=>{console.log("Login page loaded on domain:",window.location.hostname)},[]);let P=async t=>{var n,i,s;t.preventDefault(),y(null);try{(0,g.nT)();let t=await c.e.signIn({username:o,password:u});if((null===(n=t.nextStep)||void 0===n?void 0:n.signInStep)==="CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED"){N(!0);return}e.push("string"==typeof b?b:"/admin")}catch(e){y(e.message||"Failed to sign in. Please check your credentials."),((null===(i=e.message)||void 0===i?void 0:i.includes("Token"))||(null===(s=e.message)||void 0===s?void 0:s.includes("authentication")))&&(0,g.Wx)()}},k=async t=>{if(t.preventDefault(),y(null),h!==p){y("Passwords do not match");return}try{let t=await c.e.completeNewPassword(o,h);t.isSuccess?(N(!1),e.push("string"==typeof b?b:"/admin")):y(t.message)}catch(e){y(e.message||"Failed to set new password")}};return(0,s.useEffect)(()=>{!t||n||e.query.redirect||e.query.fixed||e.push("/admin")},[t,n,e]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(a(),{children:[(0,i.jsx)("title",{children:"Admin Login | Protege Research Survey"}),(0,i.jsx)("meta",{name:"description",content:"Login to the Protege Research Survey admin panel"}),(0,i.jsx)("meta",{name:"robots",content:"noindex, nofollow"})]}),(0,i.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gray-100 px-4 py-12 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"w-full max-w-md space-y-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900",children:"Admin Login"}),(0,i.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to access the survey management dashboard"})]}),w&&(0,i.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z",clipRule:"evenodd"})})}),(0,i.jsx)("div",{className:"ml-3",children:(0,i.jsx)("p",{className:"text-sm text-red-700",children:w})})]})}),"true"===e.query.fixed&&(0,i.jsx)("div",{className:"rounded-md bg-green-50 p-4",children:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})})}),(0,i.jsx)("div",{className:"ml-3",children:(0,i.jsx)("p",{className:"text-sm text-green-700",children:"Login issues fixed. Please sign in again."})})]})}),j?(0,i.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:k,children:[(0,i.jsxs)("div",{className:"-space-y-px rounded-md shadow-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"newPassword",className:"sr-only",children:"New Password"}),(0,i.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",autoComplete:"new-password",required:!0,className:"relative block w-full rounded-t-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"New Password",value:h,onChange:e=>x(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"confirmPassword",className:"sr-only",children:"Confirm Password"}),(0,i.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",autoComplete:"new-password",required:!0,className:"relative block w-full rounded-b-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Confirm Password",value:p,onChange:e=>v(e.target.value)})]})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",className:"group relative flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Set New Password"})})]}):(0,i.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:P,children:[(0,i.jsxs)("div",{className:"-space-y-px rounded-md shadow-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"username",className:"sr-only",children:"Username"}),(0,i.jsx)("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"relative block w-full rounded-t-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Username",value:o,onChange:e=>l(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),(0,i.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"relative block w-full rounded-b-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",placeholder:"Password",value:u,onChange:e=>f(e.target.value)})]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,i.jsx)("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900",children:"Remember me"})]}),(0,i.jsx)("div",{className:"text-sm",children:(0,i.jsx)(d(),{href:"/admin/forgot-password",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Forgot your password?"})})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",className:"group relative flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Sign in"})}),(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsx)("div",{className:"text-sm",children:(0,i.jsx)(d(),{href:"/admin/signup",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Don't have an account? Sign up"})})})]})]})})]})}(0,u.nq)()}},function(e){e.O(0,[282,664,797,847,359,888,774,179],function(){return e(e.s=6177)}),_N_E=e.O()}]);