(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[487],{2342:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/completion/[projectId]/[uid]",function(){return t(9333)}])},9333:function(e,r,t){"use strict";t.r(r),t.d(r,{__N_SSP:function(){return c},default:function(){return d}});var s=t(5893),n=t(7294),o=t(1163),l=t(9008),a=t.n(l),i=t(7066),c=!0;function d(e){let{project:r,surveyLink:t,error:l}=e;(0,o.useRouter)();let[c,d]=(0,n.useState)(!l&&!!t),[u,m]=(0,n.useState)(l||null),[x,h]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{if(!r||!t||l){d(!1);return}let e=async()=>{try{let e=null;try{let r=sessionStorage.getItem("surveySession");r&&(e=JSON.parse(r))}catch(e){console.error("Error reading session storage:",e)}let s=await i.Z.post("/api/links/complete",{projectId:r.id,uid:t.uid,token:null==e?void 0:e.token,metadata:{completionTimestamp:new Date().toISOString(),browser:navigator.userAgent,completionHost:window.location.hostname,referrer:document.referrer,sessionData:e}});s.data.success?(h(!0),sessionStorage.removeItem("surveySession")):m(s.data.message||"Failed to record survey completion")}catch(r){var e,s;console.error("Error marking survey as complete:",r),m((null===(s=r.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"An error occurred while recording your completion")}finally{d(!1)}};"COMPLETED"!==t.status?e():(h(!0),d(!1))},[r,t,l]),!r||!t)return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-md bg-white rounded-lg shadow-md p-8 text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Survey Not Found"}),(0,s.jsx)("p",{className:"text-gray-700 mb-6",children:"Sorry, the survey you are looking for does not exist or has expired."})]})});let f=t.vendorCode?"Thank you for completing the survey via ".concat(t.vendorCode,"."):"Thank you for completing the survey.";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(a(),{children:[(0,s.jsxs)("title",{children:["Survey Completed | ",r.name]}),(0,s.jsx)("meta",{name:"description",content:"Thank you for completing the survey"})]}),(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4",children:(0,s.jsx)("div",{className:"w-full max-w-md bg-white rounded-lg shadow-md p-8 text-center",children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Recording Completion"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Please wait while we record your survey completion..."}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"})})]}):u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),(0,s.jsx)("p",{className:"text-gray-700 mb-6",children:u}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"If this error persists, please contact the survey administrator."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-6 flex justify-center",children:(0,s.jsx)("div",{className:"rounded-full bg-green-100 p-3",children:(0,s.jsx)("svg",{className:"h-12 w-12 text-green-600",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{d:"M5 13l4 4L19 7"})})})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Thank You!"}),(0,s.jsxs)("p",{className:"text-gray-600 mb-6",children:[f," Your response has been successfully recorded."]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"You may now close this window."})]})})})]})}}},function(e){e.O(0,[143,888,774,179],function(){return e(e.s=2342)}),_N_E=e.O()}]);