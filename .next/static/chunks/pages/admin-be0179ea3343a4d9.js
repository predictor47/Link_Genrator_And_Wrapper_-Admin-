(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{4830:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return s(2921)}])},1359:function(e,t,s){"use strict";s.d(t,{d:function(){return l}});var a=s(6164),n=s(9556),r=s(7510);let i=null;async function l(){var e;if(i)return i;let t=(0,r.m)();if(!(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.url))throw Error("Amplify config is missing GraphQL endpoint.");n.V.configure(t);let s=(0,a.d)({authMode:"userPool"});if(console.log("Amplify Data client:",s),console.log("client.models:",s.models),!s.models||0===Object.keys(s.models).length)throw console.error("client.models is empty! This usually means the Amplify backend is not properly connected."),Error("Amplify Data models are not available. Please check your backend connection.");let l=["Project","Vendor","Question","SurveyLink","ProjectVendor"];for(let e of l)if(!s.models[e])throw console.error("".concat(e," model is missing from Amplify Data client!")),Error("Required model ".concat(e," is not available in the Amplify Data client."));console.log("All required models are available:",l);let d=e=>e.data,c=(e,t)=>{let s=e.message||"Unknown error",a=e.name||"Error";throw console.error("Amplify Error (".concat(t,"):"),{name:a,message:s}),e};return i={client:s,projects:{create:async e=>{try{let t=await s.models.Project.create(e);return{data:d(t)}}catch(e){return c(e,"projects.create"),{data:null}}},get:async e=>({data:d(await s.models.Project.get({id:e}))}),list:async e=>({data:(await s.models.Project.list(e)).data||[]}),update:async(e,t)=>({data:d(await s.models.Project.update({id:e,...t}))}),delete:async e=>({data:d(await s.models.Project.delete({id:e}))}),getWithRelations:async e=>{let t=await s.models.Project.get({id:e});if(t.data){let a=await s.models.SurveyLink.list({filter:{projectId:{eq:e}}}),n=(await s.models.ProjectVendor.list({filter:{projectId:{eq:e}}})).data.map(e=>e.vendorId).filter(e=>null!=e),r=[];n.length>0&&(r=(await Promise.all(n.map(e=>s.models.Vendor.get({id:e})))).filter(e=>null!==e.data).map(e=>e.data));let i=await s.models.Question.list({filter:{projectId:{eq:e}}});return{data:{...t.data,surveyLinks:a.data||[],vendors:r,questions:i.data||[]}}}return{data:null}}},surveyLinks:{create:async e=>({data:d(await s.models.SurveyLink.create(e))}),get:async e=>({data:d(await s.models.SurveyLink.get({id:e}))}),getByUid:async e=>{let t=await s.models.SurveyLink.list({filter:{uid:{eq:e}}});return{data:t.data&&t.data.length>0?t.data[0]:null}},update:async(e,t)=>({data:d(await s.models.SurveyLink.update({id:e,...t}))}),list:async e=>({data:(await s.models.SurveyLink.list(e)).data||[]}),listByProject:async e=>({data:(await s.models.SurveyLink.list({filter:{projectId:{eq:e}}})).data||[]}),delete:async e=>({data:d(await s.models.SurveyLink.delete({id:e}))})},vendors:{create:async e=>({data:d(await s.models.Vendor.create(e))}),get:async e=>({data:d(await s.models.Vendor.get({id:e}))}),list:async e=>({data:(await s.models.Vendor.list(e)).data||[]}),listByProject:async e=>{let t=(await s.models.ProjectVendor.list({filter:{projectId:{eq:e}}})).data.map(e=>e.vendorId).filter(e=>null!=e);return t.length>0?{data:(await Promise.all(t.map(e=>s.models.Vendor.get({id:e})))).map(e=>e.data).filter(e=>null!==e)}:{data:[]}},update:async(e,t)=>({data:d(await s.models.Vendor.update({id:e,...t}))}),delete:async e=>({data:d(await s.models.Vendor.delete({id:e}))})},questions:{create:async e=>({data:d(await s.models.Question.create(e))}),get:async e=>({data:d(await s.models.Question.get({id:e}))}),list:async e=>({data:(await s.models.Question.list(e)).data||[]}),listByProject:async e=>({data:(await s.models.Question.list({filter:{projectId:{eq:e}}})).data||[]}),update:async(e,t)=>({data:d(await s.models.Question.update({id:e,...t}))}),delete:async e=>({data:d(await s.models.Question.delete({id:e}))})},transaction:{execute:async e=>{let t=[];for(let s of e){let e=await s;t.push(e)}return t}}}}},7555:function(e,t,s){"use strict";s.d(t,{OA:function(){return l},XR:function(){return i}});var a=s(9319),n=s(6398);async function r(){let e={timestamp:new Date().toISOString(),cookies:{},session:null,user:null,errors:[]};"undefined"!=typeof document&&document.cookie.split(";").forEach(t=>{let[s,a]=t.split("=").map(e=>e.trim());(s.includes("CognitoIdentityServiceProvider")||s.includes("amplify")||s.includes("Token"))&&(e.cookies[s]=a?"present":"empty")});try{var t,s;let n=await (0,a.y)();e.session={hasIdToken:!!(null===(t=n.tokens)||void 0===t?void 0:t.idToken),hasAccessToken:!!(null===(s=n.tokens)||void 0===s?void 0:s.accessToken),hasTokens:!!n.tokens}}catch(t){e.errors.push({source:"fetchAuthSession",message:t instanceof Error?t.message:String(t)})}try{let t=await (0,n.t)();e.user={userId:t.userId,username:t.username,signInDetails:t.signInDetails}}catch(t){e.errors.push({source:"getCurrentUser",message:t instanceof Error?t.message:String(t)})}return e}async function i(){try{let e=await r();console.log("=== AUTH DIAGNOSTICS ==="),console.log(JSON.stringify(e,null,2)),console.log("=======================")}catch(e){console.error("Failed to get auth diagnostics:",e)}}async function l(){try{let e=await r();if(e.errors.length>0&&Object.keys(e.cookies).length>0)return"undefined"!=typeof document&&document.cookie.split(";").forEach(e=>{let[t]=e.split("=").map(e=>e.trim());(t.includes("CognitoIdentityServiceProvider")||t.includes("amplify")||t.includes("Token"))&&(console.log("Clearing problematic cookie:",t),document.cookie="".concat(t,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"))}),window.location.reload(),!0;return!1}catch(e){return console.error("Failed to fix auth issues:",e),!1}}},9051:function(e,t,s){"use strict";s.d(t,{a:function(){return a.a}});var a=s(9985)},3101:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var a=s(5893),n=s(7294),r=s(1163),i=s(9051),l=s(7555);function d(e){let{children:t,redirectTo:s="/admin/login"}=e,{isAuthenticated:d,isLoading:c}=(0,i.a)(),o=(0,r.useRouter)(),[m,u]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{if("undefined"!=typeof document){let e=document.cookie.match(/redirect_count=(\d+)/);if((e?parseInt(e[1],10):0)>5){u(!0);return}}c||d||(console.log("User not authenticated, redirecting to login page"),(0,l.XR)().then(()=>{let e=encodeURIComponent(o.asPath);window.location.href="".concat(s,"?redirect=").concat(e)}))},[d,c,s,o]),m)?(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded shadow text-center max-w-md mx-auto",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-red-600",children:"Too many login attempts"}),(0,a.jsx)("p",{className:"mb-4",children:"You have been redirected too many times. Please clear your cookies, log in again, or contact support if the problem persists."})]})}):c?(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):d?(0,a.jsx)(a.Fragment,{children:t}):null}},2921:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return m},default:function(){return u}});var a=s(5893),n=s(7294),r=s(1163),i=s(1664),l=s.n(i),d=s(3101),c=s(1359);let o=e=>{let{value:t,max:s,color:n,size:r=60,strokeWidth:i=6}=e,l=r/2-i,d=2*Math.PI*l,c=d-t/(s||1)*d;return(0,a.jsxs)("div",{className:"relative inline-flex",children:[(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 ".concat(r," ").concat(r),children:[(0,a.jsx)("circle",{cx:r/2,cy:r/2,r:l,fill:"none",stroke:"#e5e7eb",strokeWidth:i}),(0,a.jsx)("circle",{cx:r/2,cy:r/2,r:l,fill:"none",stroke:n,strokeWidth:i,strokeDasharray:d,strokeDashoffset:c,strokeLinecap:"round",transform:"rotate(-90 ".concat(r/2," ").concat(r/2,")")})]}),(0,a.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium",children:[t,"/",s]})]})};var m=!0;function u(){let e=(0,r.useRouter)(),[t,i]=(0,n.useState)([]),[m,u]=(0,n.useState)(null),[x,h]=(0,n.useState)({}),[g,f]=(0,n.useState)(!0),[p,y]=(0,n.useState)(""),[j,w]=(0,n.useState)(null),[v,N]=(0,n.useState)(!1),[b,k]=(0,n.useState)(null);(0,n.useEffect)(()=>{P()},[]);let P=async()=>{try{f(!0),y("");let e=await (0,c.d)(),t=((await e.projects.list()).data||[]).map(e=>({id:e.id,name:e.name,description:e.description||"",status:e.status||"ACTIVE",targetCompletions:e.targetCompletions||0,currentCompletions:e.currentCompletions||0,createdAt:e.createdAt,updatedAt:e.updatedAt}));i(t);let s=(await e.surveyLinks.list()).data||[],a=t.length,n=s.length,r=s.filter(e=>"UNUSED"===e.status).length,l=s.filter(e=>"CLICKED"===e.status).length,d=s.filter(e=>"IN_PROGRESS"===e.status).length,o=s.filter(e=>"COMPLETED"===e.status).length,m=s.filter(e=>"DISQUALIFIED"===e.status).length;u({totalProjects:a,totalLinks:n,pendingLinks:r,startedLinks:l,inProgressLinks:d,completedLinks:o,flaggedLinks:m});let x={};t.forEach(e=>{let t=s.filter(t=>t.projectId===e.id);x[e.id]={pending:t.filter(e=>"UNUSED"===e.status).length,started:t.filter(e=>"CLICKED"===e.status).length,inProgress:t.filter(e=>"IN_PROGRESS"===e.status).length,completed:t.filter(e=>"COMPLETED"===e.status).length,flagged:t.filter(e=>"DISQUALIFIED"===e.status).length,total:t.length}}),h(x)}catch(e){console.error("Error fetching dashboard data:",e),y("Failed to load dashboard data. Please check your connection and try again.")}finally{f(!1)}},S=e=>{k(e),N(!0)},C=async()=>{if(b)try{w(b.id);let e=await (0,c.d)();await e.projects.delete(b.id),await P(),N(!1),k(null)}catch(e){console.error("Error deleting project:",e),y("Failed to delete project. Please try again.")}finally{w(null)}},E=async()=>{try{let{AuthService:t}=await Promise.resolve().then(s.bind(s,5551));await t.signOut(),e.push("/admin/login")}catch(e){console.error("Error signing out:",e)}};return g?(0,a.jsx)(d.Z,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})})}):(0,a.jsx)(d.Z,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,a.jsx)("nav",{className:"bg-white shadow-lg",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex justify-between h-16",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-800",children:"Admin Dashboard"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(l(),{href:"/admin/projects/new",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",children:"Create Project"}),(0,a.jsx)("button",{onClick:E,className:"text-gray-600 hover:text-gray-800",children:"Logout"})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[p&&(0,a.jsxs)("div",{className:"mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[p,(0,a.jsx)("button",{onClick:()=>y(""),className:"ml-4 text-red-700 hover:text-red-900",children:"\xd7"})]}),m&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold",children:"P"})})}),(0,a.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,a.jsxs)("dl",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Projects"}),(0,a.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:m.totalProjects})]})})]})})}),(0,a.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-green-500 rounded-md flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold",children:"L"})})}),(0,a.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,a.jsxs)("dl",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Links"}),(0,a.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:m.totalLinks})]})})]})})}),(0,a.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold",children:"C"})})}),(0,a.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,a.jsxs)("dl",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Completed"}),(0,a.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:m.completedLinks})]})})]})})}),(0,a.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-orange-500 rounded-md flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold",children:"A"})})}),(0,a.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,a.jsxs)("dl",{children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Active Links"}),(0,a.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:m.inProgressLinks})]})})]})})})]}),(0,a.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Projects"}),(0,a.jsx)("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Manage your research projects and survey campaigns."})]}),(0,a.jsx)("button",{onClick:P,disabled:g,className:"bg-gray-100 hover:bg-gray-200 disabled:opacity-50 text-gray-700 font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50",children:g?"Refreshing...":"Refresh"})]}),0===t.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500 text-lg mb-4",children:"No projects found"}),(0,a.jsx)(l(),{href:"/admin/projects/new",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",children:"Create Your First Project"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Project"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Links"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>{let t=x[e.id]||{pending:0,started:0,inProgress:0,completed:0,flagged:0,total:0};return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("ACTIVE"===e.status?"bg-green-100 text-green-800":"PAUSED"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o,{value:e.currentCompletions,max:e.targetCompletions,color:"#10B981",size:40,strokeWidth:4}),(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-600",children:[Math.round(e.currentCompletions/(e.targetCompletions||1)*100),"%"]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-medium",children:t.total}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[t.completed," completed"]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[(0,a.jsx)(l(),{href:"/admin/projects/".concat(e.id),className:"text-blue-600 hover:text-blue-900 mr-4",children:"View"}),(0,a.jsx)("button",{onClick:()=>S(e),disabled:j===e.id,className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:j===e.id?"Deleting...":"Delete"})]})]},e.id)})})]})})]})]}),v&&b&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3 text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Confirm Delete"}),(0,a.jsx)("div",{className:"mt-2 px-7 py-3",children:(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:['Are you sure you want to delete project "',b.name,'"? This action cannot be undone.']})}),(0,a.jsxs)("div",{className:"flex justify-center space-x-4 mt-4",children:[(0,a.jsx)("button",{onClick:()=>{N(!1),k(null)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Cancel"}),(0,a.jsx)("button",{onClick:C,disabled:null!==j,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50",children:j?"Deleting...":"Delete"})]})]})})})]})})}},1163:function(e,t,s){e.exports=s(3079)}},function(e){e.O(0,[664,164,888,774,179],function(){return e(e.s=4830)}),_N_E=e.O()}]);