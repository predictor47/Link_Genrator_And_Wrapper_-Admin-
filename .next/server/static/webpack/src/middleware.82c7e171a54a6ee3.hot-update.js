"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var jwt_decode__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jwt-decode */ \"(middleware)/./node_modules/jwt-decode/build/esm/index.js\");\n\n\n// Define admin paths that need protection\nconst ADMIN_PATHS = [\n    \"/admin\"\n];\n// Public paths that don't require authentication\n// Only include authentication-related paths and non-admin paths\nconst PUBLIC_PATHS = [\n    \"/admin/login\",\n    \"/admin/signup\",\n    \"/admin/verify\",\n    \"/admin/forgot-password\",\n    \"/\",\n    \"/favicon.ico\",\n    \"/_next/\",\n    \"/public/\",\n    \"/api/\",\n    \"/assets/\",\n    \"/s/\",\n    \"/survey/\",\n    \"/completion/\",\n    \"/sorry-quota-full\",\n    \"/sorry-disqualified\",\n    \"/thank-you-completed\",\n    \"/diagnostics\",\n    \"/amplify_outputs.json\" // Allow access to amplify outputs for configuration\n];\n// Domain configuration\nconst MAIN_DOMAIN = \"localhost:3000\" || 0;\n// Cognito User Pool ID - will be auto-detected in development mode\nconst COGNITO_USER_POOL_ID =  true ? \"us-east-1_SANDBOX\" // This will be overridden by the validation logic\n : 0;\n/**\n * Apply security headers to the response\n */ function applySecurityHeaders(response, isAdminRoute) {\n    // Define security headers\n    const securityHeaders = {\n        // Prevent MIME type sniffing\n        \"X-Content-Type-Options\": \"nosniff\",\n        // Prevent clickjacking\n        \"X-Frame-Options\": \"DENY\",\n        // XSS Protection header (legacy browsers)\n        \"X-XSS-Protection\": \"1; mode=block\",\n        // Disable client-side caching for sensitive areas\n        \"Cache-Control\": isAdminRoute ? \"no-store, max-age=0\" : \"public, max-age=300\",\n        // Referrer Policy\n        \"Referrer-Policy\": \"strict-origin-when-cross-origin\"\n    };\n    // Apply headers to response\n    Object.entries(securityHeaders).forEach(([key, value])=>{\n        response.headers.set(key, value);\n    });\n    return response;\n}\n/**\n * Validate the JWT token from Cognito\n * @param token JWT token to validate\n * @returns boolean indicating if token is valid\n */ function validateToken(token) {\n    try {\n        // No more special case for a development sandbox token\n        // We need to let Amplify handle the real tokens\n        // Basic format check\n        if (!token || !token.includes(\".\")) {\n            console.log(\"Invalid token format\");\n            return false;\n        }\n        // Decode the token\n        const decodedToken = (0,jwt_decode__WEBPACK_IMPORTED_MODULE_1__.jwtDecode)(token);\n        console.log(\"Token decoded:\", {\n            sub: decodedToken.sub,\n            exp: decodedToken.exp,\n            iss: decodedToken.iss\n        });\n        // Check token expiration - allow expired tokens in development\n        const currentTime = Math.floor(Date.now() / 1000);\n        if (!decodedToken.exp) {\n            console.log(\"Token missing expiration\");\n            if (true) {\n                // Allow tokens without expiration in development\n                console.log(\"Token missing expiration but allowing in development mode\");\n            } else {}\n        }\n        if (decodedToken.exp && decodedToken.exp < currentTime) {\n            if (true) {\n                console.log(\"Token expired but allowing in development mode\");\n            } else {}\n        }\n        // In development/sandbox environment, be more flexible with issuer validation\n        if (true) {\n            // For sandbox, check if the token has typical JWT fields or allow any valid JWT\n            console.log(\"Development mode: Simplified token validation\");\n            return true;\n        }\n        // In production, check the exact issuer\n        if (false) {}\n        // Token is valid\n        return true;\n    } catch (error) {\n        console.error(\"Token validation error:\", error);\n        return false;\n    }\n}\n/**\n * Check if a path is public (doesn't require authentication)\n */ function isPublicPath(pathname) {\n    // Check exact matches first\n    if (PUBLIC_PATHS.includes(pathname)) {\n        return true;\n    }\n    // Always allow access to authentication and public routes\n    const authRoutes = [\n        \"/admin/login\",\n        \"/admin/signup\",\n        \"/admin/verify\",\n        \"/admin/forgot-password\"\n    ];\n    if (authRoutes.some((route)=>pathname === route)) {\n        return true;\n    }\n    // Check path prefixes for static assets and public paths\n    return PUBLIC_PATHS.some((publicPath)=>pathname.startsWith(publicPath) && // Ensure we don't accidentally match admin paths that should be protected\n        !(pathname.startsWith(\"/admin\") && !pathname.startsWith(\"/admin/login\") && !pathname.startsWith(\"/admin/signup\") && !pathname.startsWith(\"/admin/verify\") && !pathname.startsWith(\"/admin/forgot-password\")));\n}\n// Update the isAdminRoute function to properly handle login paths\nfunction isAdminRoute(pathname) {\n    // Admin routes start with /admin, but exclude login-related routes to prevent loops\n    return pathname.startsWith(\"/admin\") && !pathname.includes(\"/admin/login\") && !pathname.includes(\"/admin/signup\") && !pathname.includes(\"/admin/verify\") && !pathname.includes(\"/admin/forgot-password\") && !pathname.includes(\"/api/auth\");\n}\n// Update the middleware handler function\nasync function middleware(request) {\n    const { pathname } = request.nextUrl;\n    const hostname = request.headers.get(\"host\") || \"\";\n    // Always allow access to diagnostics page - useful for debugging\n    if (pathname === \"/diagnostics\") {\n        console.log(\"Allowing access to diagnostics page\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // Log request details to help debug\n    console.log(`Middleware processing: ${pathname} on host: ${hostname}`);\n    // Add redirect count to help debug redirect loops\n    const redirectCount = request.cookies.get(\"redirect_count\");\n    let count = redirectCount ? parseInt(redirectCount.value, 10) : 0;\n    count++;\n    // Always clear redirect count cookie for login routes\n    if (pathname === \"/admin/login\") {\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n        response.cookies.set(\"redirect_count\", \"0\", {\n            maxAge: 60 * 60 * 24,\n            path: \"/\"\n        });\n        console.log(\"On login page, resetting redirect count\");\n        return response;\n    }\n    // If count gets too high, we're probably in a loop - allow the request through\n    if (count > 5) {\n        console.log(\"Detected potential redirect loop (count: \" + count + \") - allowing request\");\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n        response.cookies.set(\"redirect_count\", \"0\", {\n            maxAge: 60 * 60 * 24,\n            path: \"/\"\n        });\n        return response;\n    }\n    // Store the updated redirect count\n    const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    response.cookies.set(\"redirect_count\", count.toString(), {\n        maxAge: 60 * 60 * 24,\n        path: \"/\"\n    });\n    // Handle public paths - no auth needed\n    if (isPublicPath(pathname)) {\n        console.log(`Public path detected [${pathname}]: allowing access`);\n        return applySecurityHeaders(response, false);\n    }\n    // If this is an admin route, we need to check authentication (works on any domain)\n    if (isAdminRoute(pathname)) {\n        console.log(\"Protected admin route - checking auth\");\n        // Check for authentication token in cookies\n        const authCookie = request.cookies.get(\"idToken\")?.value;\n        const accessToken = request.cookies.get(\"accessToken\")?.value;\n        // If no token found, redirect to login\n        if (!authCookie && !accessToken) {\n            console.log(\"No auth token found - redirecting to login\");\n            // Create a login URL with proper redirect parameter\n            const url = new URL(\"/admin/login\", request.url);\n            // Only add redirect if it's not already the login page to avoid loops\n            if (pathname !== \"/admin/login\") {\n                url.searchParams.set(\"redirect\", pathname);\n            }\n            const redirectResponse = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n            // Update redirect count\n            redirectResponse.cookies.set(\"redirect_count\", count.toString(), {\n                maxAge: 60 * 60 * 24,\n                path: \"/\"\n            });\n            return applySecurityHeaders(redirectResponse, true);\n        }\n        // Use the first available token\n        const token = authCookie || accessToken || \"\";\n        // If token is invalid or empty, redirect to login\n        if (!token || !validateToken(token)) {\n            console.log(\"Invalid token - redirecting to login\");\n            // Redirect to login page with return URL\n            const url = new URL(\"/admin/login\", request.url);\n            url.searchParams.set(\"redirect\", pathname);\n            url.searchParams.set(\"fixed\", \"true\"); // Add fixed param to avoid loops\n            const redirectResponse = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n            // Clear invalid tokens\n            const cookiesToClear = [\n                \"idToken\",\n                \"accessToken\",\n                \"refreshToken\",\n                \"amplify-signin-with-hostedUI\",\n                \"amplify-redirected-from-hosted-ui\",\n                \"amplify.auth.tokens\",\n                \"Authorization\"\n            ];\n            cookiesToClear.forEach((cookie)=>{\n                redirectResponse.cookies.delete(cookie);\n            });\n            return applySecurityHeaders(redirectResponse, true);\n        }\n        // Token is valid, allow access to admin routes\n        console.log(\"Valid token found - allowing admin access\");\n        return applySecurityHeaders(response, true);\n    }\n    // Default: apply security headers and continue\n    return applySecurityHeaders(response, pathname.startsWith(\"/admin\"));\n}\n// Configure matchers to run middleware on all paths\nconst config = {\n    matcher: [\n        // Match all paths for proper routing\n        \"/(.*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZSxNQUFNLENBQUNEO1lBQ2xDO1lBRUEsT0FBT3RELHFCQUFxQm1ELGtCQUFrQjtRQUNoRDtRQUVBLCtDQUErQztRQUMvQ3JDLFFBQVFDLEdBQUcsQ0FBQztRQUNaLE9BQU9mLHFCQUFxQkMsVUFBVTtJQUN4QztJQUVBLCtDQUErQztJQUMvQyxPQUFPRCxxQkFBcUJDLFVBQVUwQixTQUFTSyxVQUFVLENBQUM7QUFDNUQ7QUFFQSxvREFBb0Q7QUFDN0MsTUFBTXdCLFNBQVM7SUFDcEJDLFNBQVM7UUFDUCxxQ0FBcUM7UUFDckM7S0FDRDtBQUNILEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vc3JjL21pZGRsZXdhcmUudHM/ZDE5OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgdHlwZSB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgand0RGVjb2RlIH0gZnJvbSAnand0LWRlY29kZSc7XG5cbi8vIE5leHQuanMgYXV0b21hdGljYWxseSBpbmxpbmVzIGVudmlyb25tZW50IHZhcmlhYmxlcyBmb3IgRWRnZSBSdW50aW1lXG4vLyBGb3IgZGV2ZWxvcG1lbnQgdHlwZSBzYWZldHksIGRlY2xhcmUgdGhlIGdsb2JhbCBwcm9jZXNzXG5kZWNsYXJlIGNvbnN0IHByb2Nlc3M6IHtcbiAgZW52OiB7XG4gICAgTk9ERV9FTlY6ICdkZXZlbG9wbWVudCcgfCAncHJvZHVjdGlvbicgfCAndGVzdCc7XG4gICAgTkVYVF9QVUJMSUNfRE9NQUlOPzogc3RyaW5nO1xuICB9XG59O1xuXG4vLyBEZWZpbmUgYWRtaW4gcGF0aHMgdGhhdCBuZWVkIHByb3RlY3Rpb25cbmNvbnN0IEFETUlOX1BBVEhTID0gWycvYWRtaW4nXTtcblxuLy8gUHVibGljIHBhdGhzIHRoYXQgZG9uJ3QgcmVxdWlyZSBhdXRoZW50aWNhdGlvblxuLy8gT25seSBpbmNsdWRlIGF1dGhlbnRpY2F0aW9uLXJlbGF0ZWQgcGF0aHMgYW5kIG5vbi1hZG1pbiBwYXRoc1xuY29uc3QgUFVCTElDX1BBVEhTID0gW1xuICAnL2FkbWluL2xvZ2luJyxcbiAgJy9hZG1pbi9zaWdudXAnLFxuICAnL2FkbWluL3ZlcmlmeScsXG4gICcvYWRtaW4vZm9yZ290LXBhc3N3b3JkJyxcbiAgJy8nLFxuICAnL2Zhdmljb24uaWNvJyxcbiAgJy9fbmV4dC8nLCAgLy8gTmV4dC5qcyBzdGF0aWMgYXNzZXRzXG4gICcvcHVibGljLycsICAvLyBQdWJsaWMgYXNzZXRzXG4gICcvYXBpLycsICAgIC8vIEFQSSByb3V0ZXNcbiAgJy9hc3NldHMvJywgLy8gU3RhdGljIGFzc2V0c1xuICAnL3MvJywgICAgICAgLy8gU2hvcnQgbGluayByb3V0ZSAocHVibGljLWZhY2luZylcbiAgJy9zdXJ2ZXkvJywgIC8vIFN1cnZleSBsaW5rIHJvdXRlIChwdWJsaWMtZmFjaW5nKVxuICAnL2NvbXBsZXRpb24vJywgLy8gQ29tcGxldGlvbiByb3V0ZSAocHVibGljLWZhY2luZylcbiAgJy9zb3JyeS1xdW90YS1mdWxsJyxcbiAgJy9zb3JyeS1kaXNxdWFsaWZpZWQnLFxuICAnL3RoYW5rLXlvdS1jb21wbGV0ZWQnLFxuICAnL2RpYWdub3N0aWNzJyxcbiAgJy9hbXBsaWZ5X291dHB1dHMuanNvbicgLy8gQWxsb3cgYWNjZXNzIHRvIGFtcGxpZnkgb3V0cHV0cyBmb3IgY29uZmlndXJhdGlvblxuXTtcblxuLy8gRG9tYWluIGNvbmZpZ3VyYXRpb25cbmNvbnN0IE1BSU5fRE9NQUlOID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfRE9NQUlOIHx8ICdwcm90ZWdlcmVzZWFyY2hzdXJ2ZXkuY29tJztcblxuLy8gQ29nbml0byBVc2VyIFBvb2wgSUQgLSB3aWxsIGJlIGF1dG8tZGV0ZWN0ZWQgaW4gZGV2ZWxvcG1lbnQgbW9kZVxuY29uc3QgQ09HTklUT19VU0VSX1BPT0xfSUQgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyBcbiAgPyAndXMtZWFzdC0xX1NBTkRCT1gnIC8vIFRoaXMgd2lsbCBiZSBvdmVycmlkZGVuIGJ5IHRoZSB2YWxpZGF0aW9uIGxvZ2ljXG4gIDogJ3VzLWVhc3QtMV9RSXd3TWRva3QnO1xuXG4vKipcbiAqIEFwcGx5IHNlY3VyaXR5IGhlYWRlcnMgdG8gdGhlIHJlc3BvbnNlXG4gKi9cbmZ1bmN0aW9uIGFwcGx5U2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlOiBOZXh0UmVzcG9uc2UsIGlzQWRtaW5Sb3V0ZTogYm9vbGVhbik6IE5leHRSZXNwb25zZSB7XG4gIC8vIERlZmluZSBzZWN1cml0eSBoZWFkZXJzXG4gIGNvbnN0IHNlY3VyaXR5SGVhZGVycyA9IHtcbiAgICAvLyBQcmV2ZW50IE1JTUUgdHlwZSBzbmlmZmluZ1xuICAgICdYLUNvbnRlbnQtVHlwZS1PcHRpb25zJzogJ25vc25pZmYnLFxuICAgIFxuICAgIC8vIFByZXZlbnQgY2xpY2tqYWNraW5nXG4gICAgJ1gtRnJhbWUtT3B0aW9ucyc6ICdERU5ZJyxcbiAgICBcbiAgICAvLyBYU1MgUHJvdGVjdGlvbiBoZWFkZXIgKGxlZ2FjeSBicm93c2VycylcbiAgICAnWC1YU1MtUHJvdGVjdGlvbic6ICcxOyBtb2RlPWJsb2NrJyxcbiAgICBcbiAgICAvLyBEaXNhYmxlIGNsaWVudC1zaWRlIGNhY2hpbmcgZm9yIHNlbnNpdGl2ZSBhcmVhc1xuICAgICdDYWNoZS1Db250cm9sJzogaXNBZG1pblJvdXRlID8gJ25vLXN0b3JlLCBtYXgtYWdlPTAnIDogJ3B1YmxpYywgbWF4LWFnZT0zMDAnLFxuICAgIFxuICAgIC8vIFJlZmVycmVyIFBvbGljeVxuICAgICdSZWZlcnJlci1Qb2xpY3knOiAnc3RyaWN0LW9yaWdpbi13aGVuLWNyb3NzLW9yaWdpbicsXG4gIH07XG4gIFxuICAvLyBBcHBseSBoZWFkZXJzIHRvIHJlc3BvbnNlXG4gIE9iamVjdC5lbnRyaWVzKHNlY3VyaXR5SGVhZGVycykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoa2V5LCB2YWx1ZSk7XG4gIH0pO1xuICBcbiAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoZSBKV1QgdG9rZW4gZnJvbSBDb2duaXRvXG4gKiBAcGFyYW0gdG9rZW4gSldUIHRva2VuIHRvIHZhbGlkYXRlXG4gKiBAcmV0dXJucyBib29sZWFuIGluZGljYXRpbmcgaWYgdG9rZW4gaXMgdmFsaWRcbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVUb2tlbih0b2tlbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHRyeSB7XG4gICAgLy8gTm8gbW9yZSBzcGVjaWFsIGNhc2UgZm9yIGEgZGV2ZWxvcG1lbnQgc2FuZGJveCB0b2tlblxuICAgIC8vIFdlIG5lZWQgdG8gbGV0IEFtcGxpZnkgaGFuZGxlIHRoZSByZWFsIHRva2Vuc1xuXG4gICAgLy8gQmFzaWMgZm9ybWF0IGNoZWNrXG4gICAgaWYgKCF0b2tlbiB8fCAhdG9rZW4uaW5jbHVkZXMoJy4nKSkge1xuICAgICAgY29uc29sZS5sb2coJ0ludmFsaWQgdG9rZW4gZm9ybWF0Jyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gRGVjb2RlIHRoZSB0b2tlblxuICAgIGNvbnN0IGRlY29kZWRUb2tlbiA9IGp3dERlY29kZTxhbnk+KHRva2VuKTtcbiAgICBjb25zb2xlLmxvZygnVG9rZW4gZGVjb2RlZDonLCB7IHN1YjogZGVjb2RlZFRva2VuLnN1YiwgZXhwOiBkZWNvZGVkVG9rZW4uZXhwLCBpc3M6IGRlY29kZWRUb2tlbi5pc3MgfSk7XG4gICAgXG4gICAgLy8gQ2hlY2sgdG9rZW4gZXhwaXJhdGlvbiAtIGFsbG93IGV4cGlyZWQgdG9rZW5zIGluIGRldmVsb3BtZW50XG4gICAgY29uc3QgY3VycmVudFRpbWUgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcbiAgICBpZiAoIWRlY29kZWRUb2tlbi5leHApIHtcbiAgICAgIGNvbnNvbGUubG9nKCdUb2tlbiBtaXNzaW5nIGV4cGlyYXRpb24nKTtcbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgICAgICAvLyBBbGxvdyB0b2tlbnMgd2l0aG91dCBleHBpcmF0aW9uIGluIGRldmVsb3BtZW50XG4gICAgICAgIGNvbnNvbGUubG9nKCdUb2tlbiBtaXNzaW5nIGV4cGlyYXRpb24gYnV0IGFsbG93aW5nIGluIGRldmVsb3BtZW50IG1vZGUnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgaWYgKGRlY29kZWRUb2tlbi5leHAgJiYgZGVjb2RlZFRva2VuLmV4cCA8IGN1cnJlbnRUaW1lKSB7XG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1Rva2VuIGV4cGlyZWQgYnV0IGFsbG93aW5nIGluIGRldmVsb3BtZW50IG1vZGUnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdUb2tlbiBleHBpcmVkJyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gSW4gZGV2ZWxvcG1lbnQvc2FuZGJveCBlbnZpcm9ubWVudCwgYmUgbW9yZSBmbGV4aWJsZSB3aXRoIGlzc3VlciB2YWxpZGF0aW9uXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgICAvLyBGb3Igc2FuZGJveCwgY2hlY2sgaWYgdGhlIHRva2VuIGhhcyB0eXBpY2FsIEpXVCBmaWVsZHMgb3IgYWxsb3cgYW55IHZhbGlkIEpXVFxuICAgICAgY29uc29sZS5sb2coJ0RldmVsb3BtZW50IG1vZGU6IFNpbXBsaWZpZWQgdG9rZW4gdmFsaWRhdGlvbicpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8vIEluIHByb2R1Y3Rpb24sIGNoZWNrIHRoZSBleGFjdCBpc3N1ZXJcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyB8fCBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnKSB7XG4gICAgICBpZiAoZGVjb2RlZFRva2VuLmlzcyAhPT0gYGh0dHBzOi8vY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vJHtDT0dOSVRPX1VTRVJfUE9PTF9JRH1gKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdUb2tlbiBpc3N1ZXIgbWlzbWF0Y2gnKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBUb2tlbiBpcyB2YWxpZFxuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Rva2VuIHZhbGlkYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIENoZWNrIGlmIGEgcGF0aCBpcyBwdWJsaWMgKGRvZXNuJ3QgcmVxdWlyZSBhdXRoZW50aWNhdGlvbilcbiAqL1xuZnVuY3Rpb24gaXNQdWJsaWNQYXRoKHBhdGhuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgLy8gQ2hlY2sgZXhhY3QgbWF0Y2hlcyBmaXJzdFxuICBpZiAoUFVCTElDX1BBVEhTLmluY2x1ZGVzKHBhdGhuYW1lKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIFxuICAvLyBBbHdheXMgYWxsb3cgYWNjZXNzIHRvIGF1dGhlbnRpY2F0aW9uIGFuZCBwdWJsaWMgcm91dGVzXG4gIGNvbnN0IGF1dGhSb3V0ZXMgPSBbJy9hZG1pbi9sb2dpbicsICcvYWRtaW4vc2lnbnVwJywgJy9hZG1pbi92ZXJpZnknLCAnL2FkbWluL2ZvcmdvdC1wYXNzd29yZCddO1xuICBpZiAoYXV0aFJvdXRlcy5zb21lKHJvdXRlID0+IHBhdGhuYW1lID09PSByb3V0ZSkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBcbiAgLy8gQ2hlY2sgcGF0aCBwcmVmaXhlcyBmb3Igc3RhdGljIGFzc2V0cyBhbmQgcHVibGljIHBhdGhzXG4gIHJldHVybiBQVUJMSUNfUEFUSFMuc29tZShwdWJsaWNQYXRoID0+IFxuICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgocHVibGljUGF0aCkgJiYgXG4gICAgLy8gRW5zdXJlIHdlIGRvbid0IGFjY2lkZW50YWxseSBtYXRjaCBhZG1pbiBwYXRocyB0aGF0IHNob3VsZCBiZSBwcm90ZWN0ZWRcbiAgICAhKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hZG1pbicpICYmIFxuICAgICAgIXBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hZG1pbi9sb2dpbicpICYmIFxuICAgICAgIXBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hZG1pbi9zaWdudXAnKSAmJiBcbiAgICAgICFwYXRobmFtZS5zdGFydHNXaXRoKCcvYWRtaW4vdmVyaWZ5JykgJiYgXG4gICAgICAhcGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluL2ZvcmdvdC1wYXNzd29yZCcpKVxuICApO1xufVxuXG4vLyBVcGRhdGUgdGhlIGlzQWRtaW5Sb3V0ZSBmdW5jdGlvbiB0byBwcm9wZXJseSBoYW5kbGUgbG9naW4gcGF0aHNcbmZ1bmN0aW9uIGlzQWRtaW5Sb3V0ZShwYXRobmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIC8vIEFkbWluIHJvdXRlcyBzdGFydCB3aXRoIC9hZG1pbiwgYnV0IGV4Y2x1ZGUgbG9naW4tcmVsYXRlZCByb3V0ZXMgdG8gcHJldmVudCBsb29wc1xuICByZXR1cm4gcGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluJykgJiYgXG4gICAgIXBhdGhuYW1lLmluY2x1ZGVzKCcvYWRtaW4vbG9naW4nKSAmJiBcbiAgICAhcGF0aG5hbWUuaW5jbHVkZXMoJy9hZG1pbi9zaWdudXAnKSAmJlxuICAgICFwYXRobmFtZS5pbmNsdWRlcygnL2FkbWluL3ZlcmlmeScpICYmXG4gICAgIXBhdGhuYW1lLmluY2x1ZGVzKCcvYWRtaW4vZm9yZ290LXBhc3N3b3JkJykgJiZcbiAgICAhcGF0aG5hbWUuaW5jbHVkZXMoJy9hcGkvYXV0aCcpO1xufVxuXG4vLyBVcGRhdGUgdGhlIG1pZGRsZXdhcmUgaGFuZGxlciBmdW5jdGlvblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgeyBwYXRobmFtZSB9ID0gcmVxdWVzdC5uZXh0VXJsO1xuICBjb25zdCBob3N0bmFtZSA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ2hvc3QnKSB8fCAnJztcbiAgXG4gIC8vIEFsd2F5cyBhbGxvdyBhY2Nlc3MgdG8gZGlhZ25vc3RpY3MgcGFnZSAtIHVzZWZ1bCBmb3IgZGVidWdnaW5nXG4gIGlmIChwYXRobmFtZSA9PT0gJy9kaWFnbm9zdGljcycpIHtcbiAgICBjb25zb2xlLmxvZygnQWxsb3dpbmcgYWNjZXNzIHRvIGRpYWdub3N0aWNzIHBhZ2UnKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcbiAgfVxuICBcbiAgLy8gTG9nIHJlcXVlc3QgZGV0YWlscyB0byBoZWxwIGRlYnVnXG4gIGNvbnNvbGUubG9nKGBNaWRkbGV3YXJlIHByb2Nlc3Npbmc6ICR7cGF0aG5hbWV9IG9uIGhvc3Q6ICR7aG9zdG5hbWV9YCk7XG4gIFxuICAvLyBBZGQgcmVkaXJlY3QgY291bnQgdG8gaGVscCBkZWJ1ZyByZWRpcmVjdCBsb29wc1xuICBjb25zdCByZWRpcmVjdENvdW50ID0gcmVxdWVzdC5jb29raWVzLmdldCgncmVkaXJlY3RfY291bnQnKTtcbiAgbGV0IGNvdW50ID0gcmVkaXJlY3RDb3VudCA/IHBhcnNlSW50KHJlZGlyZWN0Q291bnQudmFsdWUsIDEwKSA6IDA7XG4gIGNvdW50Kys7XG4gIFxuICAvLyBBbHdheXMgY2xlYXIgcmVkaXJlY3QgY291bnQgY29va2llIGZvciBsb2dpbiByb3V0ZXNcbiAgaWYgKHBhdGhuYW1lID09PSAnL2FkbWluL2xvZ2luJykge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcbiAgICByZXNwb25zZS5jb29raWVzLnNldCgncmVkaXJlY3RfY291bnQnLCAnMCcsIHtcbiAgICAgIG1heEFnZTogNjAgKiA2MCAqIDI0LCAvLyAyNCBob3Vyc1xuICAgICAgcGF0aDogJy8nLFxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKCdPbiBsb2dpbiBwYWdlLCByZXNldHRpbmcgcmVkaXJlY3QgY291bnQnKTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cbiAgXG4gIC8vIElmIGNvdW50IGdldHMgdG9vIGhpZ2gsIHdlJ3JlIHByb2JhYmx5IGluIGEgbG9vcCAtIGFsbG93IHRoZSByZXF1ZXN0IHRocm91Z2hcbiAgaWYgKGNvdW50ID4gNSkge1xuICAgIGNvbnNvbGUubG9nKCdEZXRlY3RlZCBwb3RlbnRpYWwgcmVkaXJlY3QgbG9vcCAoY291bnQ6ICcgKyBjb3VudCArICcpIC0gYWxsb3dpbmcgcmVxdWVzdCcpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcbiAgICByZXNwb25zZS5jb29raWVzLnNldCgncmVkaXJlY3RfY291bnQnLCAnMCcsIHtcbiAgICAgIG1heEFnZTogNjAgKiA2MCAqIDI0LCAvLyAyNCBob3Vyc1xuICAgICAgcGF0aDogJy8nLFxuICAgIH0pO1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuICBcbiAgLy8gU3RvcmUgdGhlIHVwZGF0ZWQgcmVkaXJlY3QgY291bnRcbiAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xuICByZXNwb25zZS5jb29raWVzLnNldCgncmVkaXJlY3RfY291bnQnLCBjb3VudC50b1N0cmluZygpLCB7XG4gICAgbWF4QWdlOiA2MCAqIDYwICogMjQsIC8vIDI0IGhvdXJzXG4gICAgcGF0aDogJy8nLFxuICB9KTtcbiAgXG4gIC8vIEhhbmRsZSBwdWJsaWMgcGF0aHMgLSBubyBhdXRoIG5lZWRlZFxuICBpZiAoaXNQdWJsaWNQYXRoKHBhdGhuYW1lKSkge1xuICAgIGNvbnNvbGUubG9nKGBQdWJsaWMgcGF0aCBkZXRlY3RlZCBbJHtwYXRobmFtZX1dOiBhbGxvd2luZyBhY2Nlc3NgKTtcbiAgICByZXR1cm4gYXBwbHlTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UsIGZhbHNlKTtcbiAgfVxuICBcbiAgLy8gSWYgdGhpcyBpcyBhbiBhZG1pbiByb3V0ZSwgd2UgbmVlZCB0byBjaGVjayBhdXRoZW50aWNhdGlvbiAod29ya3Mgb24gYW55IGRvbWFpbilcbiAgaWYgKGlzQWRtaW5Sb3V0ZShwYXRobmFtZSkpIHtcbiAgICBjb25zb2xlLmxvZygnUHJvdGVjdGVkIGFkbWluIHJvdXRlIC0gY2hlY2tpbmcgYXV0aCcpO1xuICAgIFxuICAgIC8vIENoZWNrIGZvciBhdXRoZW50aWNhdGlvbiB0b2tlbiBpbiBjb29raWVzXG4gICAgY29uc3QgYXV0aENvb2tpZSA9IHJlcXVlc3QuY29va2llcy5nZXQoJ2lkVG9rZW4nKT8udmFsdWU7XG4gICAgY29uc3QgYWNjZXNzVG9rZW4gPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KCdhY2Nlc3NUb2tlbicpPy52YWx1ZTtcbiAgICBcbiAgICAvLyBJZiBubyB0b2tlbiBmb3VuZCwgcmVkaXJlY3QgdG8gbG9naW5cbiAgICBpZiAoIWF1dGhDb29raWUgJiYgIWFjY2Vzc1Rva2VuKSB7XG4gICAgICBjb25zb2xlLmxvZygnTm8gYXV0aCB0b2tlbiBmb3VuZCAtIHJlZGlyZWN0aW5nIHRvIGxvZ2luJyk7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBhIGxvZ2luIFVSTCB3aXRoIHByb3BlciByZWRpcmVjdCBwYXJhbWV0ZXJcbiAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoJy9hZG1pbi9sb2dpbicsIHJlcXVlc3QudXJsKTtcbiAgICAgIFxuICAgICAgLy8gT25seSBhZGQgcmVkaXJlY3QgaWYgaXQncyBub3QgYWxyZWFkeSB0aGUgbG9naW4gcGFnZSB0byBhdm9pZCBsb29wc1xuICAgICAgaWYgKHBhdGhuYW1lICE9PSAnL2FkbWluL2xvZ2luJykge1xuICAgICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldCgncmVkaXJlY3QnLCBwYXRobmFtZSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHJlZGlyZWN0UmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QodXJsKTtcbiAgICAgIFxuICAgICAgLy8gVXBkYXRlIHJlZGlyZWN0IGNvdW50XG4gICAgICByZWRpcmVjdFJlc3BvbnNlLmNvb2tpZXMuc2V0KCdyZWRpcmVjdF9jb3VudCcsIGNvdW50LnRvU3RyaW5nKCksIHtcbiAgICAgICAgbWF4QWdlOiA2MCAqIDYwICogMjQsIC8vIDI0IGhvdXJzXG4gICAgICAgIHBhdGg6ICcvJyxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4gYXBwbHlTZWN1cml0eUhlYWRlcnMocmVkaXJlY3RSZXNwb25zZSwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgLy8gVXNlIHRoZSBmaXJzdCBhdmFpbGFibGUgdG9rZW5cbiAgICBjb25zdCB0b2tlbiA9IGF1dGhDb29raWUgfHwgYWNjZXNzVG9rZW4gfHwgJyc7XG4gICAgXG4gICAgLy8gSWYgdG9rZW4gaXMgaW52YWxpZCBvciBlbXB0eSwgcmVkaXJlY3QgdG8gbG9naW5cbiAgICBpZiAoIXRva2VuIHx8ICF2YWxpZGF0ZVRva2VuKHRva2VuKSkge1xuICAgICAgY29uc29sZS5sb2coJ0ludmFsaWQgdG9rZW4gLSByZWRpcmVjdGluZyB0byBsb2dpbicpO1xuICAgICAgXG4gICAgICAvLyBSZWRpcmVjdCB0byBsb2dpbiBwYWdlIHdpdGggcmV0dXJuIFVSTFxuICAgICAgY29uc3QgdXJsID0gbmV3IFVSTCgnL2FkbWluL2xvZ2luJywgcmVxdWVzdC51cmwpO1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3JlZGlyZWN0JywgcGF0aG5hbWUpO1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ2ZpeGVkJywgJ3RydWUnKTsgLy8gQWRkIGZpeGVkIHBhcmFtIHRvIGF2b2lkIGxvb3BzXG4gICAgICBcbiAgICAgIGNvbnN0IHJlZGlyZWN0UmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QodXJsKTtcbiAgICAgIFxuICAgICAgLy8gQ2xlYXIgaW52YWxpZCB0b2tlbnNcbiAgICAgIGNvbnN0IGNvb2tpZXNUb0NsZWFyID0gW1xuICAgICAgICAnaWRUb2tlbicsXG4gICAgICAgICdhY2Nlc3NUb2tlbicsXG4gICAgICAgICdyZWZyZXNoVG9rZW4nLFxuICAgICAgICAnYW1wbGlmeS1zaWduaW4td2l0aC1ob3N0ZWRVSScsXG4gICAgICAgICdhbXBsaWZ5LXJlZGlyZWN0ZWQtZnJvbS1ob3N0ZWQtdWknLFxuICAgICAgICAnYW1wbGlmeS5hdXRoLnRva2VucycsXG4gICAgICAgICdBdXRob3JpemF0aW9uJ1xuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29va2llc1RvQ2xlYXIuZm9yRWFjaChjb29raWUgPT4ge1xuICAgICAgICByZWRpcmVjdFJlc3BvbnNlLmNvb2tpZXMuZGVsZXRlKGNvb2tpZSk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIGFwcGx5U2VjdXJpdHlIZWFkZXJzKHJlZGlyZWN0UmVzcG9uc2UsIHRydWUpO1xuICAgIH1cbiAgICBcbiAgICAvLyBUb2tlbiBpcyB2YWxpZCwgYWxsb3cgYWNjZXNzIHRvIGFkbWluIHJvdXRlc1xuICAgIGNvbnNvbGUubG9nKCdWYWxpZCB0b2tlbiBmb3VuZCAtIGFsbG93aW5nIGFkbWluIGFjY2VzcycpO1xuICAgIHJldHVybiBhcHBseVNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSwgdHJ1ZSk7XG4gIH1cbiAgXG4gIC8vIERlZmF1bHQ6IGFwcGx5IHNlY3VyaXR5IGhlYWRlcnMgYW5kIGNvbnRpbnVlXG4gIHJldHVybiBhcHBseVNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSwgcGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluJykpO1xufVxuXG4vLyBDb25maWd1cmUgbWF0Y2hlcnMgdG8gcnVuIG1pZGRsZXdhcmUgb24gYWxsIHBhdGhzXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBtYXRjaGVyOiBbXG4gICAgLy8gTWF0Y2ggYWxsIHBhdGhzIGZvciBwcm9wZXIgcm91dGluZ1xuICAgICcvKC4qKScsXG4gIF0sXG59OyJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJqd3REZWNvZGUiLCJBRE1JTl9QQVRIUyIsIlBVQkxJQ19QQVRIUyIsIk1BSU5fRE9NQUlOIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0RPTUFJTiIsIkNPR05JVE9fVVNFUl9QT09MX0lEIiwiYXBwbHlTZWN1cml0eUhlYWRlcnMiLCJyZXNwb25zZSIsImlzQWRtaW5Sb3V0ZSIsInNlY3VyaXR5SGVhZGVycyIsIk9iamVjdCIsImVudHJpZXMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJoZWFkZXJzIiwic2V0IiwidmFsaWRhdGVUb2tlbiIsInRva2VuIiwiaW5jbHVkZXMiLCJjb25zb2xlIiwibG9nIiwiZGVjb2RlZFRva2VuIiwic3ViIiwiZXhwIiwiaXNzIiwiY3VycmVudFRpbWUiLCJNYXRoIiwiZmxvb3IiLCJEYXRlIiwibm93IiwiZXJyb3IiLCJpc1B1YmxpY1BhdGgiLCJwYXRobmFtZSIsImF1dGhSb3V0ZXMiLCJzb21lIiwicm91dGUiLCJwdWJsaWNQYXRoIiwic3RhcnRzV2l0aCIsIm1pZGRsZXdhcmUiLCJyZXF1ZXN0IiwibmV4dFVybCIsImhvc3RuYW1lIiwiZ2V0IiwibmV4dCIsInJlZGlyZWN0Q291bnQiLCJjb29raWVzIiwiY291bnQiLCJwYXJzZUludCIsIm1heEFnZSIsInBhdGgiLCJ0b1N0cmluZyIsImF1dGhDb29raWUiLCJhY2Nlc3NUb2tlbiIsInVybCIsIlVSTCIsInNlYXJjaFBhcmFtcyIsInJlZGlyZWN0UmVzcG9uc2UiLCJyZWRpcmVjdCIsImNvb2tpZXNUb0NsZWFyIiwiY29va2llIiwiZGVsZXRlIiwiY29uZmlnIiwibWF0Y2hlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});