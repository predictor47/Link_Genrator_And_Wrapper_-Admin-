"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var jwt_decode__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jwt-decode */ \"(middleware)/./node_modules/jwt-decode/build/esm/index.js\");\n\n\n// Define admin paths that need protection\nconst ADMIN_PATHS = [\n    \"/admin\"\n];\n// Public paths that don't require authentication\n// Only include authentication-related paths and non-admin paths\nconst PUBLIC_PATHS = [\n    \"/admin/login\",\n    \"/admin/signup\",\n    \"/admin/verify\",\n    \"/admin/forgot-password\",\n    \"/\",\n    \"/favicon.ico\",\n    \"/_next/\",\n    \"/s/\",\n    \"/survey/\",\n    \"/completion/\",\n    \"/sorry-quota-full\",\n    \"/sorry-disqualified\",\n    \"/thank-you-completed\"\n];\n// Domain configuration\nconst MAIN_DOMAIN = \"protegeresearchsurvey.com\" || 0;\nconst ADMIN_DOMAIN = \"admin.protegeresearchsurvey.com\" || 0;\n// Cognito User Pool ID - will be auto-detected in development mode\nconst COGNITO_USER_POOL_ID =  true ? \"us-east-1_SANDBOX\" // This will be overridden by the validation logic\n : 0;\n/**\r\n * Apply security headers to the response\r\n */ function applySecurityHeaders(response, isAdminRoute) {\n    // Define security headers\n    const securityHeaders = {\n        // Prevent MIME type sniffing\n        \"X-Content-Type-Options\": \"nosniff\",\n        // Prevent clickjacking\n        \"X-Frame-Options\": \"DENY\",\n        // XSS Protection header (legacy browsers)\n        \"X-XSS-Protection\": \"1; mode=block\",\n        // Disable client-side caching for sensitive areas\n        \"Cache-Control\": isAdminRoute ? \"no-store, max-age=0\" : \"public, max-age=300\",\n        // Referrer Policy\n        \"Referrer-Policy\": \"strict-origin-when-cross-origin\"\n    };\n    // Apply headers to response\n    Object.entries(securityHeaders).forEach(([key, value])=>{\n        response.headers.set(key, value);\n    });\n    return response;\n}\n/**\r\n * Validate the JWT token from Cognito\r\n * @param token JWT token to validate\r\n * @returns boolean indicating if token is valid\r\n */ function validateToken(token) {\n    try {\n        // For development mode sandbox testing\n        if (true) {\n            // Special case: if we've created a temporary sandbox token, consider it valid\n            if (token === \"dev-sandbox-token\") {\n                console.log(\"Development mode: Using temporary sandbox token\");\n                return true;\n            }\n        }\n        // Basic format check\n        if (!token || !token.includes(\".\")) {\n            console.log(\"Invalid token format\");\n            return false;\n        }\n        // Decode the token\n        const decodedToken = (0,jwt_decode__WEBPACK_IMPORTED_MODULE_1__.jwtDecode)(token);\n        console.log(\"Token decoded:\", {\n            sub: decodedToken.sub,\n            exp: decodedToken.exp,\n            iss: decodedToken.iss\n        });\n        // Check token expiration - allow expired tokens in development\n        const currentTime = Math.floor(Date.now() / 1000);\n        if (!decodedToken.exp) {\n            console.log(\"Token missing expiration\");\n            if (true) {\n                // Allow tokens without expiration in development\n                console.log(\"Token missing expiration but allowing in development mode\");\n            } else {}\n        }\n        if (decodedToken.exp && decodedToken.exp < currentTime) {\n            if (true) {\n                console.log(\"Token expired but allowing in development mode\");\n            } else {}\n        }\n        // In development/sandbox environment, be more flexible with issuer validation\n        if (true) {\n            // For sandbox, check if the token has typical JWT fields or allow any valid JWT\n            console.log(\"Development mode: Simplified token validation\");\n            return true;\n        }\n        // In production, check the exact issuer\n        if (false) {}\n        // Token is valid\n        return true;\n    } catch (error) {\n        console.error(\"Token validation error:\", error);\n        return false;\n    }\n}\n/**\r\n * Check if a path is public (doesn't require authentication)\r\n */ function isPublicPath(pathname) {\n    // Check exact matches first\n    if (PUBLIC_PATHS.includes(pathname)) {\n        return true;\n    }\n    // Check auth routes first since they must remain accessible\n    const authRoutes = [\n        \"/admin/login\",\n        \"/admin/signup\",\n        \"/admin/verify\",\n        \"/admin/forgot-password\"\n    ];\n    if (authRoutes.some((route)=>pathname === route)) {\n        return true;\n    }\n    // Check path prefixes\n    return PUBLIC_PATHS.some((publicPath)=>pathname.startsWith(publicPath) && // Ensure we don't accidentally match admin paths that should be protected\n        !(pathname.startsWith(\"/admin\") && !pathname.startsWith(\"/admin/login\") && !pathname.startsWith(\"/admin/signup\") && !pathname.startsWith(\"/admin/verify\") && !pathname.startsWith(\"/admin/forgot-password\")));\n}\nasync function middleware(request) {\n    const { pathname, host } = request.nextUrl;\n    console.log(`Middleware processing: ${pathname} on host: ${host}`);\n    // For local development\n    const isLocalhost = host.includes(\"localhost\") || host.includes(\"127.0.0.1\");\n    // For Amplify preview environments\n    const isAmplifyDomain = host.includes(\"amplifyapp.com\");\n    // Check if we're on the admin subdomain\n    const isAdminDomain = host === ADMIN_DOMAIN || isLocalhost && pathname.startsWith(\"/admin\") || isAmplifyDomain && pathname.startsWith(\"/admin\");\n    // Always allow access to Next.js static assets and favicon\n    if (pathname.startsWith(\"/_next/\") || pathname === \"/favicon.ico\") {\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n        return applySecurityHeaders(response, false);\n    }\n    // Special handling for authentication routes - always allow\n    if ([\n        \"/admin/login\",\n        \"/admin/signup\",\n        \"/admin/verify\",\n        \"/admin/forgot-password\"\n    ].some((route)=>pathname === route)) {\n        console.log(`Auth route detected: ${pathname} - allowing access`);\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n        return applySecurityHeaders(response, true);\n    }\n    // Handle outcome pages - always allow\n    if ([\n        \"/sorry-quota-full\",\n        \"/sorry-disqualified\",\n        \"/thank-you-completed\"\n    ].some((path)=>pathname === path)) {\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n        return applySecurityHeaders(response, false);\n    }\n    // When in production (not localhost/Amplify preview)\n    if (!isLocalhost && !isAmplifyDomain) {\n        // Correctly handle admin subdomain root\n        if (isAdminDomain && pathname === \"/\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/admin\", request.url));\n        }\n        // Handle admin login pages directly on subdomain without /admin prefix\n        // This is critical for the login page to work on admin.domain.com/login\n        if (isAdminDomain && (pathname === \"/login\" || pathname === \"/signup\" || pathname === \"/verify\" || pathname === \"/forgot-password\")) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(`/admin${pathname}`, request.url));\n        }\n        // Process main domain requests accessing admin section\n        if (host === MAIN_DOMAIN && pathname.startsWith(\"/admin\")) {\n            // On main domain trying to access admin, redirect to admin subdomain\n            const url = new URL(request.url);\n            url.host = ADMIN_DOMAIN;\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n        }\n    }\n    // Check if this is an admin route\n    const isAdminRoute = pathname.startsWith(\"/admin\") || isAdminDomain;\n    // If not an admin route, allow access (public-facing routes)\n    if (!isAdminRoute) {\n        console.log(`Non-admin route: ${pathname} - allowing access`);\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n        return applySecurityHeaders(response, false);\n    }\n    console.log(`Admin route detected: ${pathname}`);\n    // Check if the admin path is public (auth-related paths)\n    if (isPublicPath(pathname)) {\n        console.log(`Public admin path: ${pathname} - allowing access`);\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n        return applySecurityHeaders(response, true);\n    }\n    // For protected admin routes - check for authentication\n    console.log(\"Protected admin route - checking auth\");\n    // Check for authentication token\n    const authToken = request.cookies.get(\"idToken\")?.value;\n    const accessToken = request.cookies.get(\"accessToken\")?.value; // When in development mode with sandbox, be more flexible\n    if (true) {\n        console.log(\"Development mode: Found tokens:\", !!authToken, !!accessToken);\n        // In sandbox mode, validate the token but be more flexible\n        if (authToken || accessToken) {\n            // Use the token we have - prefer idToken, fall back to accessToken\n            const tokenToValidate = authToken || accessToken || \"\";\n            console.log(\"Development mode: Checking auth token validity\");\n            if (validateToken(tokenToValidate)) {\n                console.log(\"Development mode: Valid token - allowing access\");\n                const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n                return applySecurityHeaders(response, true);\n            } else {\n                console.log(\"Development mode: Invalid token - redirecting to login\");\n            }\n        } // If the user is coming from the login page, check for redirect loop\n        const referer = request.headers.get(\"referer\") || \"\";\n        if (referer.includes(\"/login\") && pathname === \"/admin\") {\n            console.log(\"Development mode - potential redirect loop from login page detected\");\n            // Just redirect to login rather than creating a fake token\n            const loginUrl = new URL(\"/admin/login\", request.url);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(loginUrl);\n        }\n    } else {}\n    // If we get here, authentication failed\n    console.log(\"Not authenticated or invalid token - redirecting to login\");\n    // Don't create redirect loops - if we're already on or coming from login page\n    const referer = request.headers.get(\"referer\") || \"\";\n    if (referer.includes(\"/login\") && pathname === \"/admin\") {\n        console.log(\"Preventing redirect loop - user is coming from login page\");\n        // For sandbox testing, if we detect we're in a login loop in development mode\n        // create a special sandbox session token that will bypass auth checks\n        if ( true && (isLocalhost || isAmplifyDomain)) {\n            console.log(\"Creating sandbox development token to break login loop\");\n            const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n            response.cookies.set(\"idToken\", \"dev-sandbox-token\", {\n                path: \"/\",\n                maxAge: 3600,\n                httpOnly: true,\n                secure: !isLocalhost // Only use secure in non-localhost environments\n            });\n            return applySecurityHeaders(response, true);\n        }\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n        return applySecurityHeaders(response, true);\n    }\n    const returnUrl = encodeURIComponent(pathname);\n    const loginUrl = new URL(`/admin/login?redirect=${returnUrl}`, request.url);\n    const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(loginUrl);\n    return applySecurityHeaders(response, true);\n}\n// Configure matchers to run middleware on all paths\nconst config = {\n    matcher: [\n        // Match all paths for proper routing\n        \"/(.*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFFWSxVQUFVLENBQUMsRUFBRXJCLFFBQVFVLEdBQUc7SUFDMUUsTUFBTTNDLFdBQVdaLHFEQUFZQSxDQUFDcUQsUUFBUSxDQUFDUztJQUN2QyxPQUFPbkQscUJBQXFCQyxVQUFVO0FBQ3hDO0FBRUEsb0RBQW9EO0FBQzdDLE1BQU13RCxTQUFTO0lBQ3BCQyxTQUFTO1FBQ1AscUNBQXFDO1FBQ3JDO0tBQ0Q7QUFDSCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9taWRkbGV3YXJlLnRzP2QxOTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgdHlwZSB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBqd3REZWNvZGUgfSBmcm9tICdqd3QtZGVjb2RlJztcclxuXHJcbi8vIERlZmluZSBhZG1pbiBwYXRocyB0aGF0IG5lZWQgcHJvdGVjdGlvblxyXG5jb25zdCBBRE1JTl9QQVRIUyA9IFsnL2FkbWluJ107XHJcblxyXG4vLyBQdWJsaWMgcGF0aHMgdGhhdCBkb24ndCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXHJcbi8vIE9ubHkgaW5jbHVkZSBhdXRoZW50aWNhdGlvbi1yZWxhdGVkIHBhdGhzIGFuZCBub24tYWRtaW4gcGF0aHNcclxuY29uc3QgUFVCTElDX1BBVEhTID0gW1xyXG4gICcvYWRtaW4vbG9naW4nLFxyXG4gICcvYWRtaW4vc2lnbnVwJyxcclxuICAnL2FkbWluL3ZlcmlmeScsXHJcbiAgJy9hZG1pbi9mb3Jnb3QtcGFzc3dvcmQnLFxyXG4gICcvJyxcclxuICAnL2Zhdmljb24uaWNvJyxcclxuICAnL19uZXh0LycsICAvLyBOZXh0LmpzIHN0YXRpYyBhc3NldHNcclxuICAnL3MvJywgICAgICAgLy8gU2hvcnQgbGluayByb3V0ZSAocHVibGljLWZhY2luZylcclxuICAnL3N1cnZleS8nLCAgLy8gU3VydmV5IGxpbmsgcm91dGUgKHB1YmxpYy1mYWNpbmcpXHJcbiAgJy9jb21wbGV0aW9uLycsIC8vIENvbXBsZXRpb24gcm91dGUgKHB1YmxpYy1mYWNpbmcpXHJcbiAgJy9zb3JyeS1xdW90YS1mdWxsJyxcclxuICAnL3NvcnJ5LWRpc3F1YWxpZmllZCcsXHJcbiAgJy90aGFuay15b3UtY29tcGxldGVkJ1xyXG5dO1xyXG5cclxuLy8gRG9tYWluIGNvbmZpZ3VyYXRpb25cclxuY29uc3QgTUFJTl9ET01BSU4gPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19ET01BSU4gfHwgJ3Byb3RlZ2VyZXNlYXJjaHN1cnZleS5jb20nO1xyXG5jb25zdCBBRE1JTl9ET01BSU4gPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BRE1JTl9ET01BSU4gfHwgYGFkbWluLiR7TUFJTl9ET01BSU59YDtcclxuXHJcbi8vIENvZ25pdG8gVXNlciBQb29sIElEIC0gd2lsbCBiZSBhdXRvLWRldGVjdGVkIGluIGRldmVsb3BtZW50IG1vZGVcclxuY29uc3QgQ09HTklUT19VU0VSX1BPT0xfSUQgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyBcclxuICA/ICd1cy1lYXN0LTFfU0FOREJPWCcgLy8gVGhpcyB3aWxsIGJlIG92ZXJyaWRkZW4gYnkgdGhlIHZhbGlkYXRpb24gbG9naWNcclxuICA6ICd1cy1lYXN0LTFfUUl3d01kb2t0JztcclxuXHJcbi8qKlxyXG4gKiBBcHBseSBzZWN1cml0eSBoZWFkZXJzIHRvIHRoZSByZXNwb25zZVxyXG4gKi9cclxuZnVuY3Rpb24gYXBwbHlTZWN1cml0eUhlYWRlcnMocmVzcG9uc2U6IE5leHRSZXNwb25zZSwgaXNBZG1pblJvdXRlOiBib29sZWFuKTogTmV4dFJlc3BvbnNlIHtcclxuICAvLyBEZWZpbmUgc2VjdXJpdHkgaGVhZGVyc1xyXG4gIGNvbnN0IHNlY3VyaXR5SGVhZGVycyA9IHtcclxuICAgIC8vIFByZXZlbnQgTUlNRSB0eXBlIHNuaWZmaW5nXHJcbiAgICAnWC1Db250ZW50LVR5cGUtT3B0aW9ucyc6ICdub3NuaWZmJyxcclxuICAgIFxyXG4gICAgLy8gUHJldmVudCBjbGlja2phY2tpbmdcclxuICAgICdYLUZyYW1lLU9wdGlvbnMnOiAnREVOWScsXHJcbiAgICBcclxuICAgIC8vIFhTUyBQcm90ZWN0aW9uIGhlYWRlciAobGVnYWN5IGJyb3dzZXJzKVxyXG4gICAgJ1gtWFNTLVByb3RlY3Rpb24nOiAnMTsgbW9kZT1ibG9jaycsXHJcbiAgICBcclxuICAgIC8vIERpc2FibGUgY2xpZW50LXNpZGUgY2FjaGluZyBmb3Igc2Vuc2l0aXZlIGFyZWFzXHJcbiAgICAnQ2FjaGUtQ29udHJvbCc6IGlzQWRtaW5Sb3V0ZSA/ICduby1zdG9yZSwgbWF4LWFnZT0wJyA6ICdwdWJsaWMsIG1heC1hZ2U9MzAwJyxcclxuICAgIFxyXG4gICAgLy8gUmVmZXJyZXIgUG9saWN5XHJcbiAgICAnUmVmZXJyZXItUG9saWN5JzogJ3N0cmljdC1vcmlnaW4td2hlbi1jcm9zcy1vcmlnaW4nLFxyXG4gIH07XHJcbiAgXHJcbiAgLy8gQXBwbHkgaGVhZGVycyB0byByZXNwb25zZVxyXG4gIE9iamVjdC5lbnRyaWVzKHNlY3VyaXR5SGVhZGVycykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XHJcbiAgICByZXNwb25zZS5oZWFkZXJzLnNldChrZXksIHZhbHVlKTtcclxuICB9KTtcclxuICBcclxuICByZXR1cm4gcmVzcG9uc2U7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSB0aGUgSldUIHRva2VuIGZyb20gQ29nbml0b1xyXG4gKiBAcGFyYW0gdG9rZW4gSldUIHRva2VuIHRvIHZhbGlkYXRlXHJcbiAqIEByZXR1cm5zIGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0b2tlbiBpcyB2YWxpZFxyXG4gKi9cclxuZnVuY3Rpb24gdmFsaWRhdGVUb2tlbih0b2tlbjogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIEZvciBkZXZlbG9wbWVudCBtb2RlIHNhbmRib3ggdGVzdGluZ1xyXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgIC8vIFNwZWNpYWwgY2FzZTogaWYgd2UndmUgY3JlYXRlZCBhIHRlbXBvcmFyeSBzYW5kYm94IHRva2VuLCBjb25zaWRlciBpdCB2YWxpZFxyXG4gICAgICBpZiAodG9rZW4gPT09ICdkZXYtc2FuZGJveC10b2tlbicpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnRGV2ZWxvcG1lbnQgbW9kZTogVXNpbmcgdGVtcG9yYXJ5IHNhbmRib3ggdG9rZW4nKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEJhc2ljIGZvcm1hdCBjaGVja1xyXG4gICAgaWYgKCF0b2tlbiB8fCAhdG9rZW4uaW5jbHVkZXMoJy4nKSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnSW52YWxpZCB0b2tlbiBmb3JtYXQnKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERlY29kZSB0aGUgdG9rZW5cclxuICAgIGNvbnN0IGRlY29kZWRUb2tlbiA9IGp3dERlY29kZTxhbnk+KHRva2VuKTtcclxuICAgIGNvbnNvbGUubG9nKCdUb2tlbiBkZWNvZGVkOicsIHsgc3ViOiBkZWNvZGVkVG9rZW4uc3ViLCBleHA6IGRlY29kZWRUb2tlbi5leHAsIGlzczogZGVjb2RlZFRva2VuLmlzcyB9KTtcclxuICAgIFxyXG4gICAgLy8gQ2hlY2sgdG9rZW4gZXhwaXJhdGlvbiAtIGFsbG93IGV4cGlyZWQgdG9rZW5zIGluIGRldmVsb3BtZW50XHJcbiAgICBjb25zdCBjdXJyZW50VGltZSA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApO1xyXG4gICAgaWYgKCFkZWNvZGVkVG9rZW4uZXhwKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdUb2tlbiBtaXNzaW5nIGV4cGlyYXRpb24nKTtcclxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgICAgLy8gQWxsb3cgdG9rZW5zIHdpdGhvdXQgZXhwaXJhdGlvbiBpbiBkZXZlbG9wbWVudFxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUb2tlbiBtaXNzaW5nIGV4cGlyYXRpb24gYnV0IGFsbG93aW5nIGluIGRldmVsb3BtZW50IG1vZGUnKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGRlY29kZWRUb2tlbi5leHAgJiYgZGVjb2RlZFRva2VuLmV4cCA8IGN1cnJlbnRUaW1lKSB7XHJcbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUb2tlbiBleHBpcmVkIGJ1dCBhbGxvd2luZyBpbiBkZXZlbG9wbWVudCBtb2RlJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1Rva2VuIGV4cGlyZWQnKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gSW4gZGV2ZWxvcG1lbnQvc2FuZGJveCBlbnZpcm9ubWVudCwgYmUgbW9yZSBmbGV4aWJsZSB3aXRoIGlzc3VlciB2YWxpZGF0aW9uXHJcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgICAgLy8gRm9yIHNhbmRib3gsIGNoZWNrIGlmIHRoZSB0b2tlbiBoYXMgdHlwaWNhbCBKV1QgZmllbGRzIG9yIGFsbG93IGFueSB2YWxpZCBKV1RcclxuICAgICAgY29uc29sZS5sb2coJ0RldmVsb3BtZW50IG1vZGU6IFNpbXBsaWZpZWQgdG9rZW4gdmFsaWRhdGlvbicpO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgICAgLy8gSW4gcHJvZHVjdGlvbiwgY2hlY2sgdGhlIGV4YWN0IGlzc3VlclxyXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0Jykge1xyXG4gICAgICBpZiAoZGVjb2RlZFRva2VuLmlzcyAhPT0gYGh0dHBzOi8vY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vJHtDT0dOSVRPX1VTRVJfUE9PTF9JRH1gKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1Rva2VuIGlzc3VlciBtaXNtYXRjaCcpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBUb2tlbiBpcyB2YWxpZFxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1Rva2VuIHZhbGlkYXRpb24gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENoZWNrIGlmIGEgcGF0aCBpcyBwdWJsaWMgKGRvZXNuJ3QgcmVxdWlyZSBhdXRoZW50aWNhdGlvbilcclxuICovXHJcbmZ1bmN0aW9uIGlzUHVibGljUGF0aChwYXRobmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgLy8gQ2hlY2sgZXhhY3QgbWF0Y2hlcyBmaXJzdFxyXG4gIGlmIChQVUJMSUNfUEFUSFMuaW5jbHVkZXMocGF0aG5hbWUpKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgXHJcbiAgLy8gQ2hlY2sgYXV0aCByb3V0ZXMgZmlyc3Qgc2luY2UgdGhleSBtdXN0IHJlbWFpbiBhY2Nlc3NpYmxlXHJcbiAgY29uc3QgYXV0aFJvdXRlcyA9IFsnL2FkbWluL2xvZ2luJywgJy9hZG1pbi9zaWdudXAnLCAnL2FkbWluL3ZlcmlmeScsICcvYWRtaW4vZm9yZ290LXBhc3N3b3JkJ107XHJcbiAgaWYgKGF1dGhSb3V0ZXMuc29tZShyb3V0ZSA9PiBwYXRobmFtZSA9PT0gcm91dGUpKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgXHJcbiAgLy8gQ2hlY2sgcGF0aCBwcmVmaXhlc1xyXG4gIHJldHVybiBQVUJMSUNfUEFUSFMuc29tZShwdWJsaWNQYXRoID0+IFxyXG4gICAgcGF0aG5hbWUuc3RhcnRzV2l0aChwdWJsaWNQYXRoKSAmJiBcclxuICAgIC8vIEVuc3VyZSB3ZSBkb24ndCBhY2NpZGVudGFsbHkgbWF0Y2ggYWRtaW4gcGF0aHMgdGhhdCBzaG91bGQgYmUgcHJvdGVjdGVkXHJcbiAgICAhKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hZG1pbicpICYmIFxyXG4gICAgICAhcGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluL2xvZ2luJykgJiYgXHJcbiAgICAgICFwYXRobmFtZS5zdGFydHNXaXRoKCcvYWRtaW4vc2lnbnVwJykgJiYgXHJcbiAgICAgICFwYXRobmFtZS5zdGFydHNXaXRoKCcvYWRtaW4vdmVyaWZ5JykgJiYgXHJcbiAgICAgICFwYXRobmFtZS5zdGFydHNXaXRoKCcvYWRtaW4vZm9yZ290LXBhc3N3b3JkJykpXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCB7IHBhdGhuYW1lLCBob3N0IH0gPSByZXF1ZXN0Lm5leHRVcmw7XHJcblxyXG4gIGNvbnNvbGUubG9nKGBNaWRkbGV3YXJlIHByb2Nlc3Npbmc6ICR7cGF0aG5hbWV9IG9uIGhvc3Q6ICR7aG9zdH1gKTtcclxuICBcclxuICAvLyBGb3IgbG9jYWwgZGV2ZWxvcG1lbnRcclxuICBjb25zdCBpc0xvY2FsaG9zdCA9IGhvc3QuaW5jbHVkZXMoJ2xvY2FsaG9zdCcpIHx8IGhvc3QuaW5jbHVkZXMoJzEyNy4wLjAuMScpO1xyXG4gIC8vIEZvciBBbXBsaWZ5IHByZXZpZXcgZW52aXJvbm1lbnRzXHJcbiAgY29uc3QgaXNBbXBsaWZ5RG9tYWluID0gaG9zdC5pbmNsdWRlcygnYW1wbGlmeWFwcC5jb20nKTtcclxuICBcclxuICAvLyBDaGVjayBpZiB3ZSdyZSBvbiB0aGUgYWRtaW4gc3ViZG9tYWluXHJcbiAgY29uc3QgaXNBZG1pbkRvbWFpbiA9IGhvc3QgPT09IEFETUlOX0RPTUFJTiB8fCBcclxuICAgICAgICAgICAgICAgICAgICAgICAoaXNMb2NhbGhvc3QgJiYgcGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluJykpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgKGlzQW1wbGlmeURvbWFpbiAmJiBwYXRobmFtZS5zdGFydHNXaXRoKCcvYWRtaW4nKSk7XHJcblxyXG4gIC8vIEFsd2F5cyBhbGxvdyBhY2Nlc3MgdG8gTmV4dC5qcyBzdGF0aWMgYXNzZXRzIGFuZCBmYXZpY29uXHJcbiAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9fbmV4dC8nKSB8fCBwYXRobmFtZSA9PT0gJy9mYXZpY29uLmljbycpIHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuICAgIHJldHVybiBhcHBseVNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSwgZmFsc2UpO1xyXG4gIH1cclxuICBcclxuICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBhdXRoZW50aWNhdGlvbiByb3V0ZXMgLSBhbHdheXMgYWxsb3dcclxuICBpZiAoWycvYWRtaW4vbG9naW4nLCAnL2FkbWluL3NpZ251cCcsICcvYWRtaW4vdmVyaWZ5JywgJy9hZG1pbi9mb3Jnb3QtcGFzc3dvcmQnXS5zb21lKHJvdXRlID0+IHBhdGhuYW1lID09PSByb3V0ZSkpIHtcclxuICAgIGNvbnNvbGUubG9nKGBBdXRoIHJvdXRlIGRldGVjdGVkOiAke3BhdGhuYW1lfSAtIGFsbG93aW5nIGFjY2Vzc2ApO1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gICAgcmV0dXJuIGFwcGx5U2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlLCB0cnVlKTtcclxuICB9XHJcbiAgXHJcbiAgLy8gSGFuZGxlIG91dGNvbWUgcGFnZXMgLSBhbHdheXMgYWxsb3dcclxuICBpZiAoWycvc29ycnktcXVvdGEtZnVsbCcsICcvc29ycnktZGlzcXVhbGlmaWVkJywgJy90aGFuay15b3UtY29tcGxldGVkJ10uc29tZShwYXRoID0+IHBhdGhuYW1lID09PSBwYXRoKSkge1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gICAgcmV0dXJuIGFwcGx5U2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlLCBmYWxzZSk7XHJcbiAgfVxyXG5cclxuICAvLyBXaGVuIGluIHByb2R1Y3Rpb24gKG5vdCBsb2NhbGhvc3QvQW1wbGlmeSBwcmV2aWV3KVxyXG4gIGlmICghaXNMb2NhbGhvc3QgJiYgIWlzQW1wbGlmeURvbWFpbikge1xyXG4gICAgLy8gQ29ycmVjdGx5IGhhbmRsZSBhZG1pbiBzdWJkb21haW4gcm9vdFxyXG4gICAgaWYgKGlzQWRtaW5Eb21haW4gJiYgcGF0aG5hbWUgPT09ICcvJykge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9hZG1pbicsIHJlcXVlc3QudXJsKSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEhhbmRsZSBhZG1pbiBsb2dpbiBwYWdlcyBkaXJlY3RseSBvbiBzdWJkb21haW4gd2l0aG91dCAvYWRtaW4gcHJlZml4XHJcbiAgICAvLyBUaGlzIGlzIGNyaXRpY2FsIGZvciB0aGUgbG9naW4gcGFnZSB0byB3b3JrIG9uIGFkbWluLmRvbWFpbi5jb20vbG9naW5cclxuICAgIGlmIChpc0FkbWluRG9tYWluICYmIFxyXG4gICAgICAgIChwYXRobmFtZSA9PT0gJy9sb2dpbicgfHwgXHJcbiAgICAgICAgIHBhdGhuYW1lID09PSAnL3NpZ251cCcgfHwgXHJcbiAgICAgICAgIHBhdGhuYW1lID09PSAnL3ZlcmlmeScgfHwgXHJcbiAgICAgICAgIHBhdGhuYW1lID09PSAnL2ZvcmdvdC1wYXNzd29yZCcpKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChgL2FkbWluJHtwYXRobmFtZX1gLCByZXF1ZXN0LnVybCkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFByb2Nlc3MgbWFpbiBkb21haW4gcmVxdWVzdHMgYWNjZXNzaW5nIGFkbWluIHNlY3Rpb25cclxuICAgIGlmIChob3N0ID09PSBNQUlOX0RPTUFJTiAmJiBwYXRobmFtZS5zdGFydHNXaXRoKCcvYWRtaW4nKSkge1xyXG4gICAgICAvLyBPbiBtYWluIGRvbWFpbiB0cnlpbmcgdG8gYWNjZXNzIGFkbWluLCByZWRpcmVjdCB0byBhZG1pbiBzdWJkb21haW5cclxuICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XHJcbiAgICAgIHVybC5ob3N0ID0gQURNSU5fRE9NQUlOO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KHVybCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBDaGVjayBpZiB0aGlzIGlzIGFuIGFkbWluIHJvdXRlXHJcbiAgY29uc3QgaXNBZG1pblJvdXRlID0gcGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluJykgfHwgaXNBZG1pbkRvbWFpbjtcclxuICBcclxuICAvLyBJZiBub3QgYW4gYWRtaW4gcm91dGUsIGFsbG93IGFjY2VzcyAocHVibGljLWZhY2luZyByb3V0ZXMpXHJcbiAgaWYgKCFpc0FkbWluUm91dGUpIHtcclxuICAgIGNvbnNvbGUubG9nKGBOb24tYWRtaW4gcm91dGU6ICR7cGF0aG5hbWV9IC0gYWxsb3dpbmcgYWNjZXNzYCk7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICByZXR1cm4gYXBwbHlTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UsIGZhbHNlKTtcclxuICB9XHJcbiAgXHJcbiAgY29uc29sZS5sb2coYEFkbWluIHJvdXRlIGRldGVjdGVkOiAke3BhdGhuYW1lfWApO1xyXG4gIFxyXG4gIC8vIENoZWNrIGlmIHRoZSBhZG1pbiBwYXRoIGlzIHB1YmxpYyAoYXV0aC1yZWxhdGVkIHBhdGhzKVxyXG4gIGlmIChpc1B1YmxpY1BhdGgocGF0aG5hbWUpKSB7XHJcbiAgICBjb25zb2xlLmxvZyhgUHVibGljIGFkbWluIHBhdGg6ICR7cGF0aG5hbWV9IC0gYWxsb3dpbmcgYWNjZXNzYCk7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICByZXR1cm4gYXBwbHlTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UsIHRydWUpO1xyXG4gIH1cclxuICAgIC8vIEZvciBwcm90ZWN0ZWQgYWRtaW4gcm91dGVzIC0gY2hlY2sgZm9yIGF1dGhlbnRpY2F0aW9uXHJcbiAgY29uc29sZS5sb2coJ1Byb3RlY3RlZCBhZG1pbiByb3V0ZSAtIGNoZWNraW5nIGF1dGgnKTtcclxuICBcclxuICAvLyBDaGVjayBmb3IgYXV0aGVudGljYXRpb24gdG9rZW5cclxuICBjb25zdCBhdXRoVG9rZW4gPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KCdpZFRva2VuJyk/LnZhbHVlO1xyXG4gIGNvbnN0IGFjY2Vzc1Rva2VuID0gcmVxdWVzdC5jb29raWVzLmdldCgnYWNjZXNzVG9rZW4nKT8udmFsdWU7ICAgIC8vIFdoZW4gaW4gZGV2ZWxvcG1lbnQgbW9kZSB3aXRoIHNhbmRib3gsIGJlIG1vcmUgZmxleGlibGVcclxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgIGNvbnNvbGUubG9nKCdEZXZlbG9wbWVudCBtb2RlOiBGb3VuZCB0b2tlbnM6JywgISFhdXRoVG9rZW4sICEhYWNjZXNzVG9rZW4pO1xyXG4gICAgICAvLyBJbiBzYW5kYm94IG1vZGUsIHZhbGlkYXRlIHRoZSB0b2tlbiBidXQgYmUgbW9yZSBmbGV4aWJsZVxyXG4gICAgaWYgKGF1dGhUb2tlbiB8fCBhY2Nlc3NUb2tlbikge1xyXG4gICAgICAvLyBVc2UgdGhlIHRva2VuIHdlIGhhdmUgLSBwcmVmZXIgaWRUb2tlbiwgZmFsbCBiYWNrIHRvIGFjY2Vzc1Rva2VuXHJcbiAgICAgIGNvbnN0IHRva2VuVG9WYWxpZGF0ZSA9IGF1dGhUb2tlbiB8fCBhY2Nlc3NUb2tlbiB8fCAnJztcclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKCdEZXZlbG9wbWVudCBtb2RlOiBDaGVja2luZyBhdXRoIHRva2VuIHZhbGlkaXR5Jyk7XHJcbiAgICAgIGlmICh2YWxpZGF0ZVRva2VuKHRva2VuVG9WYWxpZGF0ZSkpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnRGV2ZWxvcG1lbnQgbW9kZTogVmFsaWQgdG9rZW4gLSBhbGxvd2luZyBhY2Nlc3MnKTtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICAgICAgcmV0dXJuIGFwcGx5U2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlLCB0cnVlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnRGV2ZWxvcG1lbnQgbW9kZTogSW52YWxpZCB0b2tlbiAtIHJlZGlyZWN0aW5nIHRvIGxvZ2luJyk7XHJcbiAgICAgIH1cclxuICAgIH0gICAgLy8gSWYgdGhlIHVzZXIgaXMgY29taW5nIGZyb20gdGhlIGxvZ2luIHBhZ2UsIGNoZWNrIGZvciByZWRpcmVjdCBsb29wXHJcbiAgICBjb25zdCByZWZlcmVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgncmVmZXJlcicpIHx8ICcnO1xyXG4gICAgaWYgKHJlZmVyZXIuaW5jbHVkZXMoJy9sb2dpbicpICYmIHBhdGhuYW1lID09PSAnL2FkbWluJykge1xyXG4gICAgICBjb25zb2xlLmxvZygnRGV2ZWxvcG1lbnQgbW9kZSAtIHBvdGVudGlhbCByZWRpcmVjdCBsb29wIGZyb20gbG9naW4gcGFnZSBkZXRlY3RlZCcpO1xyXG4gICAgICAvLyBKdXN0IHJlZGlyZWN0IHRvIGxvZ2luIHJhdGhlciB0aGFuIGNyZWF0aW5nIGEgZmFrZSB0b2tlblxyXG4gICAgICBjb25zdCBsb2dpblVybCA9IG5ldyBVUkwoJy9hZG1pbi9sb2dpbicsIHJlcXVlc3QudXJsKTtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChsb2dpblVybCk7XHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vIEZvciBwcm9kdWN0aW9uLCBkbyB0aGUgZnVsbCB2YWxpZGF0aW9uXHJcbiAgICBpZiAoYXV0aFRva2VuICYmIHZhbGlkYXRlVG9rZW4oYXV0aFRva2VuKSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnVmFsaWQgYXV0aGVudGljYXRpb24gLSBhbGxvd2luZyBhY2Nlc3MgdG8gYWRtaW4gcm91dGUnKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gICAgICByZXR1cm4gYXBwbHlTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UsIHRydWUpO1xyXG4gICAgfVxyXG4gIH1cclxuICAgIC8vIElmIHdlIGdldCBoZXJlLCBhdXRoZW50aWNhdGlvbiBmYWlsZWRcclxuICBjb25zb2xlLmxvZygnTm90IGF1dGhlbnRpY2F0ZWQgb3IgaW52YWxpZCB0b2tlbiAtIHJlZGlyZWN0aW5nIHRvIGxvZ2luJyk7XHJcbiAgICAvLyBEb24ndCBjcmVhdGUgcmVkaXJlY3QgbG9vcHMgLSBpZiB3ZSdyZSBhbHJlYWR5IG9uIG9yIGNvbWluZyBmcm9tIGxvZ2luIHBhZ2VcclxuICBjb25zdCByZWZlcmVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgncmVmZXJlcicpIHx8ICcnO1xyXG4gIGlmIChyZWZlcmVyLmluY2x1ZGVzKCcvbG9naW4nKSAmJiBwYXRobmFtZSA9PT0gJy9hZG1pbicpIHtcclxuICAgIGNvbnNvbGUubG9nKCdQcmV2ZW50aW5nIHJlZGlyZWN0IGxvb3AgLSB1c2VyIGlzIGNvbWluZyBmcm9tIGxvZ2luIHBhZ2UnKTtcclxuICAgIFxyXG4gICAgLy8gRm9yIHNhbmRib3ggdGVzdGluZywgaWYgd2UgZGV0ZWN0IHdlJ3JlIGluIGEgbG9naW4gbG9vcCBpbiBkZXZlbG9wbWVudCBtb2RlXHJcbiAgICAvLyBjcmVhdGUgYSBzcGVjaWFsIHNhbmRib3ggc2Vzc2lvbiB0b2tlbiB0aGF0IHdpbGwgYnlwYXNzIGF1dGggY2hlY2tzXHJcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiYgKGlzTG9jYWxob3N0IHx8IGlzQW1wbGlmeURvbWFpbikpIHtcclxuICAgICAgY29uc29sZS5sb2coJ0NyZWF0aW5nIHNhbmRib3ggZGV2ZWxvcG1lbnQgdG9rZW4gdG8gYnJlYWsgbG9naW4gbG9vcCcpO1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KCdpZFRva2VuJywgJ2Rldi1zYW5kYm94LXRva2VuJywgeyBcclxuICAgICAgICBwYXRoOiAnLycsIFxyXG4gICAgICAgIG1heEFnZTogMzYwMCxcclxuICAgICAgICBodHRwT25seTogdHJ1ZSxcclxuICAgICAgICBzZWN1cmU6ICFpc0xvY2FsaG9zdCAvLyBPbmx5IHVzZSBzZWN1cmUgaW4gbm9uLWxvY2FsaG9zdCBlbnZpcm9ubWVudHNcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBhcHBseVNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuICAgIHJldHVybiBhcHBseVNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSwgdHJ1ZSk7XHJcbiAgfVxyXG4gIFxyXG4gIGNvbnN0IHJldHVyblVybCA9IGVuY29kZVVSSUNvbXBvbmVudChwYXRobmFtZSk7XHJcbiAgY29uc3QgbG9naW5VcmwgPSBuZXcgVVJMKGAvYWRtaW4vbG9naW4/cmVkaXJlY3Q9JHtyZXR1cm5Vcmx9YCwgcmVxdWVzdC51cmwpO1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KGxvZ2luVXJsKTtcclxuICByZXR1cm4gYXBwbHlTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UsIHRydWUpO1xyXG59XHJcblxyXG4vLyBDb25maWd1cmUgbWF0Y2hlcnMgdG8gcnVuIG1pZGRsZXdhcmUgb24gYWxsIHBhdGhzXHJcbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgbWF0Y2hlcjogW1xyXG4gICAgLy8gTWF0Y2ggYWxsIHBhdGhzIGZvciBwcm9wZXIgcm91dGluZ1xyXG4gICAgJy8oLiopJyxcclxuICBdLFxyXG59OyJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJqd3REZWNvZGUiLCJBRE1JTl9QQVRIUyIsIlBVQkxJQ19QQVRIUyIsIk1BSU5fRE9NQUlOIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0RPTUFJTiIsIkFETUlOX0RPTUFJTiIsIk5FWFRfUFVCTElDX0FETUlOX0RPTUFJTiIsIkNPR05JVE9fVVNFUl9QT09MX0lEIiwiYXBwbHlTZWN1cml0eUhlYWRlcnMiLCJyZXNwb25zZSIsImlzQWRtaW5Sb3V0ZSIsInNlY3VyaXR5SGVhZGVycyIsIk9iamVjdCIsImVudHJpZXMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJoZWFkZXJzIiwic2V0IiwidmFsaWRhdGVUb2tlbiIsInRva2VuIiwiY29uc29sZSIsImxvZyIsImluY2x1ZGVzIiwiZGVjb2RlZFRva2VuIiwic3ViIiwiZXhwIiwiaXNzIiwiY3VycmVudFRpbWUiLCJNYXRoIiwiZmxvb3IiLCJEYXRlIiwibm93IiwiZXJyb3IiLCJpc1B1YmxpY1BhdGgiLCJwYXRobmFtZSIsImF1dGhSb3V0ZXMiLCJzb21lIiwicm91dGUiLCJwdWJsaWNQYXRoIiwic3RhcnRzV2l0aCIsIm1pZGRsZXdhcmUiLCJyZXF1ZXN0IiwiaG9zdCIsIm5leHRVcmwiLCJpc0xvY2FsaG9zdCIsImlzQW1wbGlmeURvbWFpbiIsImlzQWRtaW5Eb21haW4iLCJuZXh0IiwicGF0aCIsInJlZGlyZWN0IiwiVVJMIiwidXJsIiwiYXV0aFRva2VuIiwiY29va2llcyIsImdldCIsImFjY2Vzc1Rva2VuIiwidG9rZW5Ub1ZhbGlkYXRlIiwicmVmZXJlciIsImxvZ2luVXJsIiwibWF4QWdlIiwiaHR0cE9ubHkiLCJzZWN1cmUiLCJyZXR1cm5VcmwiLCJlbmNvZGVVUklDb21wb25lbnQiLCJjb25maWciLCJtYXRjaGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});