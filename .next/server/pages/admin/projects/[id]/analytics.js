(()=>{var e={};e.id=929,e.ids=[929,888,660],e.modules={7614:(e,t,a)=>{"use strict";a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{config:()=>h,default:()=>x,getServerSideProps:()=>u,getStaticPaths:()=>g,getStaticProps:()=>p,reportWebVitals:()=>y,routeModule:()=>N,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>j});var r=a(7093),l=a(5244),d=a(1323),i=a(2899),n=a.n(i),o=a(3893),c=a(1321),m=e([c]);c=(m.then?(await m)():m)[0];let x=(0,d.l)(c,"default"),p=(0,d.l)(c,"getStaticProps"),g=(0,d.l)(c,"getStaticPaths"),u=(0,d.l)(c,"getServerSideProps"),h=(0,d.l)(c,"config"),y=(0,d.l)(c,"reportWebVitals"),j=(0,d.l)(c,"unstable_getStaticProps"),v=(0,d.l)(c,"unstable_getStaticPaths"),b=(0,d.l)(c,"unstable_getStaticParams"),f=(0,d.l)(c,"unstable_getServerProps"),w=(0,d.l)(c,"unstable_getServerSideProps"),N=new r.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/admin/projects/[id]/analytics",pathname:"/admin/projects/[id]/analytics",bundlePath:"",filename:""},components:{App:o.default,Document:n()},userland:c});s()}catch(e){s(e)}})},2956:(e,t,a)=>{"use strict";a.a(e,async(e,s)=>{try{a.d(t,{Ao:()=>o,nq:()=>d});var r=a(5838),l=e([r]);r=(l.then?(await l)():l)[0];let i=!1,n="us-east-1_QIwwMdokt";function d(){if(i)return;let e=null;try{let t=a(2048),s=a(5315);for(let a of[s.join(process.cwd(),"amplify_outputs.json"),s.join(process.cwd(),".amplify","amplify_outputs.json"),s.join(process.cwd(),"src","amplify_outputs.json")])if(t.existsSync(a)){let s=t.readFileSync(a,"utf8");e=JSON.parse(s);break}}catch(e){console.warn("Failed to load amplify_outputs.json:",e)}e?e.auth={...e.auth,userPoolId:n||e.auth?.userPoolId}:e={auth:{userPoolId:n||"us-east-1_QIwwMdokt",userPoolClientId:"your_client_id_here",identityPoolId:"your_identity_pool_id_here",region:"us-east-1"},api:{endpoint:"https://235kq6cpbbdyfizalvutob7vh4.appsync-api.us-east-1.amazonaws.com/graphql",region:"us-east-1"}};let t="us-east-1";try{let a={Auth:{Cognito:{userPoolId:n||e.auth?.userPoolId||"",userPoolClientId:e.auth?.userPoolClientId||"",identityPoolId:e.auth?.identityPoolId||""}},API:{GraphQL:{endpoint:e.api?.endpoint||"",region:e.api?.region||t,defaultAuthMode:"userPool"}}};a.region=t,r.Amplify.configure(a),i=!0,console.log("Amplify configured with User Pool ID:",n)}catch(e){console.error("Error configuring Amplify:",e)}}let o={Auth:{Cognito:{userPoolId:n||"us-east-1_QIwwMdokt",userPoolClientId:"your_client_id_here",identityPoolId:"your_identity_pool_id_here"}},API:{GraphQL:{endpoint:"https://235kq6cpbbdyfizalvutob7vh4.appsync-api.us-east-1.amazonaws.com/graphql",region:"us-east-1",defaultAuthMode:"userPool"}},domains:{main:"protegeresearchsurvey.com",admin:"admin.protegeresearchsurvey.com"}};s()}catch(e){s(e)}})},5153:(e,t,a)=>{"use strict";a.a(e,async(e,s)=>{try{a.d(t,{K:()=>c});var r=a(1534),l=a(5838),d=a(2956),i=e([r,l,d]);[r,l,d]=i.then?(await i)():i,l.Amplify.configure(d.Ao);let n=(0,r.generateClient)(),o=e=>e.data,c={projects:{create:async e=>{let t=await n.models.Project.create(e);return{data:o(t)}},get:async e=>{let t=await n.models.Project.get({id:e});return{data:o(t)}},list:async e=>({data:(await n.models.Project.list(e)).data||[]}),update:async(e,t)=>{let a=await n.models.Project.update({id:e,...t});return{data:o(a)}},delete:async e=>{let t=await n.models.Project.delete({id:e});return{data:o(t)}},getWithRelations:async e=>{let t=await n.models.Project.get({id:e});if(t.data){let a=await n.models.SurveyLink.list({filter:{projectId:{eq:e}}}),s=await n.models.Vendor.list({filter:{projectId:{eq:e}}}),r=await n.models.Question.list({filter:{projectId:{eq:e}}});return{data:{...t.data,surveyLinks:a.data||[],vendors:s.data||[],questions:r.data||[]}}}return{data:null}}},surveyLinks:{create:async e=>{let t=await n.models.SurveyLink.create(e);return{data:o(t)}},get:async e=>{let t=await n.models.SurveyLink.get({id:e});return{data:o(t)}},getByUid:async e=>{let t=await n.models.SurveyLink.list({filter:{uid:{eq:e}}});return{data:t.data&&t.data.length>0?t.data[0]:null}},update:async(e,t)=>{let a=await n.models.SurveyLink.update({id:e,...t});return{data:o(a)}},list:async e=>({data:(await n.models.SurveyLink.list(e)).data||[]}),listByProject:async e=>({data:(await n.models.SurveyLink.list({filter:{projectId:{eq:e}}})).data||[]}),delete:async e=>{let t=await n.models.SurveyLink.delete({id:e});return{data:o(t)}}},vendors:{create:async e=>{let t=await n.models.Vendor.create(e);return{data:o(t)}},get:async e=>{let t=await n.models.Vendor.get({id:e});return{data:o(t)}},list:async e=>({data:(await n.models.Vendor.list(e)).data||[]}),listByProject:async e=>({data:(await n.models.Vendor.list({filter:{projectId:{eq:e}}})).data||[]}),update:async(e,t)=>{let a=await n.models.Vendor.update({id:e,...t});return{data:o(a)}},delete:async e=>{let t=await n.models.Vendor.delete({id:e});return{data:o(t)}}},questions:{create:async e=>{let t=await n.models.Question.create(e);return{data:o(t)}},get:async e=>{let t=await n.models.Question.get({id:e});return{data:o(t)}},list:async e=>({data:(await n.models.Question.list(e)).data||[]}),listByProject:async e=>({data:(await n.models.Question.list({filter:{projectId:{eq:e}}})).data||[]}),update:async(e,t)=>{let a=await n.models.Question.update({id:e,...t});return{data:o(a)}},delete:async e=>{let t=await n.models.Question.delete({id:e});return{data:o(t)}}},responses:{create:async e=>{let t=await n.models.Response.create(e);return{data:o(t)}},get:async e=>{let t=await n.models.Response.get({id:e});return{data:o(t)}},list:async e=>({data:(await n.models.Response.list(e)).data||[]}),listByProject:async e=>({data:(await n.models.Response.list({filter:{projectId:{eq:e}}})).data||[]}),listBySurveyLink:async e=>({data:(await n.models.Response.list({filter:{surveyLinkId:{eq:e}}})).data||[]}),delete:async e=>{let t=await n.models.Response.delete({id:e});return{data:o(t)}}},flags:{create:async e=>{let t=await n.models.Flag.create(e);return{data:o(t)}},get:async e=>{let t=await n.models.Flag.get({id:e});return{data:o(t)}},list:async e=>({data:(await n.models.Flag.list(e)).data||[]}),listByProject:async e=>({data:(await n.models.Flag.list({filter:{projectId:{eq:e}}})).data||[]}),listBySurveyLink:async e=>({data:(await n.models.Flag.list({filter:{surveyLinkId:{eq:e}}})).data||[]}),delete:async e=>{let t=await n.models.Flag.delete({id:e});return{data:o(t)}}},transaction:{execute:async e=>{let t=[];for(let a of e){let e=await a;t.push(e)}return t}}};s()}catch(e){s(e)}})},3893:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var s=a(997),r=a(968),l=a.n(r);function d({Component:e,pageProps:t}){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l(),{children:[s.jsx("title",{children:"Survey Link Wrapper"}),s.jsx("meta",{name:"description",content:"Wrapping third-party survey links with a validation layer"}),s.jsx("link",{rel:"icon",href:"/favicon.ico"}),s.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),s.jsx(e,{...t})]})}a(108)},1321:(e,t,a)=>{"use strict";a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>g,getServerSideProps:()=>u});var r=a(997),l=a(6689),d=a(1163),i=a(1664),n=a.n(i),o=a(5153),c=a(9648),m=a(3767),x=a(2189),p=e([o,c,m,x]);function g({projectId:e,projectName:t,vendors:a,flags:s,geoData:i,linkTypeData:o}){(0,d.useRouter)();let[m,p]=(0,l.useState)("all"),[g,u]=(0,l.useState)("overview"),[h,y]=(0,l.useState)("all"),[j,v]=(0,l.useState)(!1),[b,f]=(0,l.useState)(null),w={labels:["Pending","Started","In Progress","Completed","Flagged"],datasets:[{data:a.reduce((e,t)=>(("all"===m||m===t.id)&&t.stats&&(e[0]+=t.stats.pending,e[1]+=t.stats.started,e[2]+=t.stats.inProgress,e[3]+=t.stats.completed,e[4]+=t.stats.flagged),e),[0,0,0,0,0]),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(5, 150, 105, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgba(59, 130, 246, 1)","rgba(16, 185, 129, 1)","rgba(245, 158, 11, 1)","rgba(5, 150, 105, 1)","rgba(239, 68, 68, 1)"],borderWidth:1}]},N={labels:a.map(e=>e.name),datasets:[{label:"Total Links",data:a.map(e=>e.stats?.total||0),backgroundColor:"rgba(59, 130, 246, 0.6)"},{label:"Completed",data:a.map(e=>e.stats?.completed||0),backgroundColor:"rgba(5, 150, 105, 0.6)"},{label:"Flagged",data:a.map(e=>e.stats?.flagged||0),backgroundColor:"rgba(239, 68, 68, 0.6)"}]},k={labels:i.map(e=>e.country),datasets:[{label:"All Responses",data:i.map(e=>e.count),backgroundColor:"rgba(59, 130, 246, 0.6)"},{label:"Completed",data:i.map(e=>e.completedCount),backgroundColor:"rgba(5, 150, 105, 0.6)"},{label:"Flagged",data:i.map(e=>e.flaggedCount),backgroundColor:"rgba(239, 68, 68, 0.6)"}]},C={labels:["Test Links","Live Links"],datasets:[{label:"Total",data:[o.test,o.live],backgroundColor:"rgba(99, 102, 241, 0.6)"},{label:"Completed",data:[o.testCompleted,o.liveCompleted],backgroundColor:"rgba(5, 150, 105, 0.6)"},{label:"Flagged",data:[o.testFlagged,o.liveFlagged],backgroundColor:"rgba(239, 68, 68, 0.6)"}]},P=async()=>{v(!0),f(null);try{let a=await c.default.get(`/api/projects/${e}/export`,{params:{vendor:"all"!==m?m:void 0,dateRange:h,format:"csv"}}),s=new Blob([a.data],{type:"text/csv"}),r=window.URL.createObjectURL(s),l=document.createElement("a");l.style.display="none",l.href=r,l.download=`${t}-analytics-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(r),document.body.removeChild(l)}catch(e){console.error("Error exporting data:",e),f(e?.response?.data?.message||"Failed to export data")}finally{v(!1)}};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[r.jsx("div",{className:"bg-white shadow",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(n(),{href:`/admin/projects/${e}`,className:"text-blue-600 hover:text-blue-800 mb-2 inline-flex items-center",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Back to Project"]}),(0,r.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:[t," Analytics"]})]}),r.jsx("div",{className:"flex space-x-3",children:(0,r.jsxs)("button",{onClick:P,disabled:j,className:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 flex items-center",children:[j?(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):r.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export Data"]})})]})})}),(0,r.jsxs)("div",{className:"container mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg mb-6",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Analytics Filters"})}),(0,r.jsxs)("div",{className:"p-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"vendor-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor"}),(0,r.jsxs)("select",{id:"vendor-filter",value:m,onChange:e=>p(e.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[r.jsx("option",{value:"all",children:"All Vendors"}),a.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"date-range",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Range"}),(0,r.jsxs)("select",{id:"date-range",value:h,onChange:e=>y(e.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[r.jsx("option",{value:"all",children:"All Time"}),r.jsx("option",{value:"today",children:"Today"}),r.jsx("option",{value:"yesterday",children:"Yesterday"}),r.jsx("option",{value:"week",children:"Last 7 Days"}),r.jsx("option",{value:"month",children:"Last 30 Days"})]})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:()=>{p("all"),y("all")},className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded",children:"Reset Filters"})})]})]}),b&&r.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:b}),r.jsx("div",{className:"border-b border-gray-200 mb-6",children:(0,r.jsxs)("nav",{className:"flex -mb-px",children:[r.jsx("button",{onClick:()=>u("overview"),className:`py-4 px-6 font-medium text-sm ${"overview"===g?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Overview"}),r.jsx("button",{onClick:()=>u("vendors"),className:`py-4 px-6 font-medium text-sm ${"vendors"===g?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Vendor Comparison"}),r.jsx("button",{onClick:()=>u("geo"),className:`py-4 px-6 font-medium text-sm ${"geo"===g?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Geographic Distribution"}),r.jsx("button",{onClick:()=>u("testlive"),className:`py-4 px-6 font-medium text-sm ${"testlive"===g?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Test vs. Live"}),r.jsx("button",{onClick:()=>u("flags"),className:`py-4 px-6 font-medium text-sm ${"flags"===g?"border-b-2 border-border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Flags"})]})}),"overview"===g&&(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg mb-8",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Status Overview"}),"all"!==m&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Filtered by vendor: ",a.find(e=>e.id===m)?.name]})]}),(0,r.jsxs)("div",{className:"p-6",children:[r.jsx("div",{className:"flex flex-col items-center",children:r.jsx("div",{className:"w-full max-w-md",children:r.jsx(x.Doughnut,{data:w,options:{plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(e){let t=e.label||"",a=e.raw||0,s=e.dataset.data.reduce((e,t)=>e+t,0);return`${t}: ${a} (${s>0?Math.round(a/s*100):0}%)`}}}}}})})}),(0,r.jsxs)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg p-6 text-white",children:[r.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Completion Rate"}),(0,r.jsxs)("div",{className:"text-4xl font-bold",children:[(()=>{let e=w.datasets[0].data.reduce((e,t)=>e+t,0),t=w.datasets[0].data[3];return e>0?Math.round(t/e*100):0})(),"%"]}),(0,r.jsxs)("p",{className:"text-green-100 mt-2",children:[w.datasets[0].data[3]," of ",w.datasets[0].data.reduce((e,t)=>e+t,0)," links completed"]})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-r from-red-500 to-pink-500 rounded-lg p-6 text-white",children:[r.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Flag Rate"}),(0,r.jsxs)("div",{className:"text-4xl font-bold",children:[(()=>{let e=w.datasets[0].data.reduce((e,t)=>e+t,0),t=w.datasets[0].data[4];return e>0?Math.round(t/e*100):0})(),"%"]}),(0,r.jsxs)("p",{className:"text-red-100 mt-2",children:[w.datasets[0].data[4]," of ",w.datasets[0].data.reduce((e,t)=>e+t,0)," links flagged"]})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg p-6 text-white",children:[r.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Quality Score"}),(0,r.jsxs)("div",{className:"text-4xl font-bold",children:[(()=>{let e=w.datasets[0].data[3],t=w.datasets[0].data[4],a=e+t;return a>0?Math.round(100-t/a*100):100})(),"/100"]}),r.jsx("p",{className:"text-blue-100 mt-2",children:"Based on completion to flag ratio"})]})]})]})]}),"vendors"===g&&(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg mb-8",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Vendor Comparison"})}),(0,r.jsxs)("div",{className:"p-6",children:[a.length>1?r.jsx("div",{className:"h-96",children:r.jsx(x.Bar,{data:N,options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!1,title:{display:!0,text:"Vendors"}},y:{stacked:!1,title:{display:!0,text:"Number of Links"}}}}})}):r.jsx("p",{className:"text-gray-500 italic",children:"You need at least two vendors to compare performance."}),(0,r.jsxs)("div",{className:"mt-8",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Vendor Statistics"}),r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vendor"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Links"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completed"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completion Rate"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Flagged"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quality Score"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(e=>{let t=e.stats||{total:0,pending:0,started:0,inProgress:0,completed:0,flagged:0},a=t.total>0?Math.round(t.completed/t.total*100):0,s=t.completed+t.flagged>0?Math.round(100-t.flagged/(t.completed+t.flagged)*100):100;return(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[e.name," ",(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.code,")"]})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.total}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.completed}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[a,"%"]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.flagged}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,r.jsxs)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s>=90?"bg-green-100 text-green-800":s>=70?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[s,"/100"]})})]},e.id)})})]})})]})]})]}),"geo"===g&&(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg mb-8",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Geographic Distribution"}),"all"!==m&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Filtered by vendor: ",a.find(e=>e.id===m)?.name]})]}),(0,r.jsxs)("div",{className:"p-6",children:[i.length>0?r.jsx("div",{className:"h-96",children:r.jsx(x.Bar,{data:k,options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!1,title:{display:!0,text:"Countries"}},y:{stacked:!1,title:{display:!0,text:"Number of Responses"}}}}})}):r.jsx("p",{className:"text-gray-500 italic",children:"No geographic data available. Geographic data is collected when users complete surveys."}),i.length>0&&(0,r.jsxs)("div",{className:"mt-8",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Geographic Statistics"}),r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Country"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Responses"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completed"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Flagged"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completion Rate"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>{let t=e.count>0?Math.round(e.completedCount/e.count*100):0;return(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.country}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.count}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.completedCount}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.flaggedCount}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[t,"%"]})]},e.country)})})]})})]})]})]}),"testlive"===g&&(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg mb-8",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Test vs. Live Comparison"}),"all"!==m&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Filtered by vendor: ",a.find(e=>e.id===m)?.name]})]}),(0,r.jsxs)("div",{className:"p-6",children:[r.jsx("div",{className:"h-96",children:r.jsx(x.Bar,{data:C,options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Link Type"}},y:{title:{display:!0,text:"Number of Links"}}}}})}),(0,r.jsxs)("div",{className:"mt-8",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Test vs. Live Metrics"}),(0,r.jsxs)("div",{className:"overflow-hidden bg-gray-50 shadow sm:rounded-lg",children:[(0,r.jsxs)("div",{className:"px-4 py-5 sm:px-6",children:[r.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Performance Comparison"}),r.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Detailed metrics for test and live environments."})]}),r.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:(0,r.jsxs)("dl",{className:"sm:divide-y sm:divide-gray-200",children:[(0,r.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-4 sm:gap-4 sm:px-6",children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Metric"}),r.jsx("dd",{className:"text-sm font-medium text-gray-700 sm:col-span-1",children:"Test Links"}),r.jsx("dd",{className:"text-sm font-medium text-gray-700 sm:col-span-1",children:"Live Links"}),r.jsx("dd",{className:"text-sm font-medium text-gray-700 sm:col-span-1",children:"Difference"})]}),(0,r.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-4 sm:gap-4 sm:px-6",children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Total Links"}),r.jsx("dd",{className:"text-sm text-gray-900 sm:col-span-1",children:o.test}),r.jsx("dd",{className:"text-sm text-gray-900 sm:col-span-1",children:o.live}),r.jsx("dd",{className:"text-sm text-gray-900 sm:col-span-1",children:"-"})]}),(0,r.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-4 sm:gap-4 sm:px-6",children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Completion Rate"}),(0,r.jsxs)("dd",{className:"text-sm text-gray-900 sm:col-span-1",children:[o.test>0?Math.round(o.testCompleted/o.test*100):0,"%"]}),(0,r.jsxs)("dd",{className:"text-sm text-gray-900 sm:col-span-1",children:[o.live>0?Math.round(o.liveCompleted/o.live*100):0,"%"]}),r.jsx("dd",{className:"text-sm text-gray-900 sm:col-span-1",children:(()=>{let e=o.test>0?o.testCompleted/o.test*100:0,t=o.live>0?o.liveCompleted/o.live*100:0,a=Math.round(e-t);return(0,r.jsxs)("span",{className:a>0?"text-green-600":a<0?"text-red-600":"text-gray-600",children:[a>0?"+":"",a,"%"]})})()})]}),(0,r.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-4 sm:gap-4 sm:px-6",children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Flag Rate"}),(0,r.jsxs)("dd",{className:"text-sm text-gray-900 sm:col-span-1",children:[o.test>0?Math.round(o.testFlagged/o.test*100):0,"%"]}),(0,r.jsxs)("dd",{className:"text-sm text-gray-900 sm:col-span-1",children:[o.live>0?Math.round(o.liveFlagged/o.live*100):0,"%"]}),r.jsx("dd",{className:"text-sm text-gray-900 sm:col-span-1",children:(()=>{let e=o.test>0?o.testFlagged/o.test*100:0,t=o.live>0?o.liveFlagged/o.live*100:0,a=Math.round(e-t);return(0,r.jsxs)("span",{className:a<0?"text-green-600":a>0?"text-red-600":"text-gray-600",children:[a>0?"+":"",a,"%"]})})()})]})]})})]})]})]})]}),"flags"===g&&(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg mb-8",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Flag Analysis"}),"all"!==m&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Filtered by vendor: ",a.find(e=>e.id===m)?.name]})]}),r.jsx("div",{className:"p-6",children:s.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-8",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Flag Reasons"}),r.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:r.jsx("div",{className:"overflow-hidden",children:r.jsx("ul",{className:"divide-y divide-gray-200",children:(()=>{let e={};return s.forEach(t=>{e[t.reason]=(e[t.reason]||0)+1}),Object.entries(e).sort((e,t)=>t[1]-e[1]).map(([e,t])=>{let a=Math.round(t/s.length*100);return(0,r.jsxs)("li",{className:"py-4",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:e}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[t," (",a,"%)"]})]}),r.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2.5",children:r.jsx("div",{className:"bg-red-600 h-2.5 rounded-full",style:{width:`${a}%`}})})]},e)})})()})})})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recent Flags"}),r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vendor"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Link Type"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.slice(0,10).map(e=>(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),r.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.reason}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.vendorName||"None"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${"TEST"===e.linkType?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:e.linkType||"LIVE"})})]},e.id))})]})})]})]}):r.jsx("p",{className:"text-gray-500 italic",children:"No flags found. Flags are created when suspicious behavior is detected."})})]})]})]})}async function u({params:e}){let{id:t}=e;try{let e=(await o.K.projects.get(t)).data;if(!e)return{notFound:!0};let a=(await o.K.vendors.list({filter:{projectId:{eq:t}}})).data||[],s=(await o.K.surveyLinks.list({filter:{projectId:{eq:t}}})).data||[],r=a.map(e=>{let t=s.filter(t=>t.vendorId===e.id),a={total:t.length,pending:t.filter(e=>"PENDING"===e.status).length,started:t.filter(e=>"STARTED"===e.status).length,inProgress:t.filter(e=>"IN_PROGRESS"===e.status).length,completed:t.filter(e=>"COMPLETED"===e.status).length,flagged:t.filter(e=>"FLAGGED"===e.status).length};return{id:e.id,name:e.name,code:e.code,createdAt:e.createdAt,stats:a}}),l=(await o.K.flags.list({filter:{projectId:{eq:t}}})).data||[],d=a.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),i=l.map(e=>{let t=s.find(t=>t.id===e.surveyLinkId),a=t?.vendorId?d[t.vendorId]:null;return{id:e.id,reason:e.reason,createdAt:e.createdAt,linkType:t?.linkType||null,vendorName:a?.name||null}}),n=(await o.K.responses.list({filter:{projectId:{eq:t}}})).data||[],c={};n.forEach(e=>{try{let t=e.metadata?JSON.parse(e.metadata):{},a=t?.geoLocation?.country||t?.ip_location?.country||t?.country||"Unknown";c[a]||(c[a]={country:a,count:0,completedCount:0,flaggedCount:0}),c[a].count++;let r=s.find(t=>t.id===e.surveyLinkId);r?.status==="COMPLETED"?c[a].completedCount++:r?.status==="FLAGGED"&&c[a].flaggedCount++}catch(e){console.error("Error parsing response metadata:",e)}});let m=Object.values(c).sort((e,t)=>t.count-e.count),x={test:0,live:0,testCompleted:0,liveCompleted:0,testFlagged:0,liveFlagged:0};return s.forEach(e=>{"TEST"===e.linkType?(x.test++,"COMPLETED"===e.status?x.testCompleted++:"FLAGGED"===e.status&&x.testFlagged++):(x.live++,"COMPLETED"===e.status?x.liveCompleted++:"FLAGGED"===e.status&&x.liveFlagged++)}),{props:{projectId:e.id,projectName:e.name,vendors:r,flags:i,geoData:m,linkTypeData:x}}}catch(e){return console.error("Error fetching analytics data:",e),{props:{projectId:t,projectName:"Error loading project",vendors:[],flags:[],geoData:[],linkTypeData:{test:0,live:0,testCompleted:0,liveCompleted:0,testFlagged:0,liveFlagged:0}}}}}[o,c,m,x]=p.then?(await p)():p,m.Chart.register(m.ArcElement,m.Tooltip,m.Legend,m.CategoryScale,m.LinearScale,m.BarElement,m.Title),s()}catch(e){s(e)}})},108:()=>{},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")},5838:e=>{"use strict";e.exports=import("aws-amplify")},1534:e=>{"use strict";e.exports=import("aws-amplify/api")},9648:e=>{"use strict";e.exports=import("axios")},3767:e=>{"use strict";e.exports=import("chart.js")},2189:e=>{"use strict";e.exports=import("react-chartjs-2")}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[899,132,163,664],()=>a(7614));module.exports=s})();