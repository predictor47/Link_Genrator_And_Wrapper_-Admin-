"use strict";(()=>{var e={};e.id=964,e.ids=[964,888,660],e.modules={2465:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{config:()=>g,default:()=>m,getServerSideProps:()=>p,getStaticPaths:()=>h,getStaticProps:()=>u,reportWebVitals:()=>f,routeModule:()=>w,unstable_getServerProps:()=>k,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>j});var r=s(7093),i=s(5244),l=s(1323),n=s(2899),c=s.n(n),d=s(3893),o=s(110),x=e([d,o]);[d,o]=x.then?(await x)():x;let m=(0,l.l)(o,"default"),u=(0,l.l)(o,"getStaticProps"),h=(0,l.l)(o,"getStaticPaths"),p=(0,l.l)(o,"getServerSideProps"),g=(0,l.l)(o,"config"),f=(0,l.l)(o,"reportWebVitals"),j=(0,l.l)(o,"unstable_getStaticProps"),y=(0,l.l)(o,"unstable_getStaticPaths"),v=(0,l.l)(o,"unstable_getStaticParams"),k=(0,l.l)(o,"unstable_getServerProps"),b=(0,l.l)(o,"unstable_getServerSideProps"),w=new r.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/admin",pathname:"/admin",bundlePath:"",filename:""},components:{App:d.default,Document:c()},userland:o});a()}catch(e){a(e)}})},5153:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{K:()=>x});var r=s(1534),i=s(5838),l=s(2956),n=e([r,i,l]);[r,i,l]=n.then?(await n)():n,i.Amplify.configure(l.A);let c=(0,r.generateClient)({authMode:"apiKey"}),d=e=>e.data,o=(e,t)=>{let s=e.message||"Unknown error",a=e.name||"Error";throw console.error(`Amplify Error (${t}):`,{name:a,message:s}),e},x={client:c,projects:{create:async e=>{try{let t=await c.models.Project.create(e);return{data:d(t)}}catch(e){o(e,"projects.create")}},get:async e=>{let t=await c.models.Project.get({id:e});return{data:d(t)}},list:async e=>({data:(await c.models.Project.list(e)).data||[]}),update:async(e,t)=>{let s=await c.models.Project.update({id:e,...t});return{data:d(s)}},delete:async e=>{let t=await c.models.Project.delete({id:e});return{data:d(t)}},getWithRelations:async e=>{let t=await c.models.Project.get({id:e});if(t.data){let s=await c.models.SurveyLink.list({filter:{projectId:{eq:e}}}),a=(await c.models.ProjectVendor.list({filter:{projectId:{eq:e}}})).data.map(e=>e.vendorId).filter(e=>null!=e),r=[];a.length>0&&(r=(await Promise.all(a.map(e=>c.models.Vendor.get({id:e})))).filter(e=>null!==e.data).map(e=>e.data));let i=await c.models.Question.list({filter:{projectId:{eq:e}}});return{data:{...t.data,surveyLinks:s.data||[],vendors:r,questions:i.data||[]}}}return{data:null}}},surveyLinks:{create:async e=>{let t=await c.models.SurveyLink.create(e);return{data:d(t)}},get:async e=>{let t=await c.models.SurveyLink.get({id:e});return{data:d(t)}},getByUid:async e=>{let t=await c.models.SurveyLink.list({filter:{uid:{eq:e}}});return{data:t.data&&t.data.length>0?t.data[0]:null}},update:async(e,t)=>{let s=await c.models.SurveyLink.update({id:e,...t});return{data:d(s)}},list:async e=>({data:(await c.models.SurveyLink.list(e)).data||[]}),listByProject:async e=>({data:(await c.models.SurveyLink.list({filter:{projectId:{eq:e}}})).data||[]}),delete:async e=>{let t=await c.models.SurveyLink.delete({id:e});return{data:d(t)}}},vendors:{create:async e=>{let t=await c.models.Vendor.create(e);return{data:d(t)}},get:async e=>{let t=await c.models.Vendor.get({id:e});return{data:d(t)}},list:async e=>({data:(await c.models.Vendor.list(e)).data||[]}),listByProject:async e=>{let t=(await c.models.ProjectVendor.list({filter:{projectId:{eq:e}}})).data.map(e=>e.vendorId).filter(e=>null!=e);return t.length>0?{data:(await Promise.all(t.map(e=>c.models.Vendor.get({id:e})))).filter(e=>null!==e.data).map(e=>e.data)}:{data:[]}},update:async(e,t)=>{let s=await c.models.Vendor.update({id:e,...t});return{data:d(s)}},delete:async e=>{let t=await c.models.Vendor.delete({id:e});return{data:d(t)}}},questions:{create:async e=>{let t=await c.models.Question.create(e);return{data:d(t)}},get:async e=>{let t=await c.models.Question.get({id:e});return{data:d(t)}},list:async e=>({data:(await c.models.Question.list(e)).data||[]}),listByProject:async e=>({data:(await c.models.Question.list({filter:{projectId:{eq:e}}})).data||[]}),update:async(e,t)=>{let s=await c.models.Question.update({id:e,...t});return{data:d(s)}},delete:async e=>{let t=await c.models.Question.delete({id:e});return{data:d(t)}}},transaction:{execute:async e=>{let t=[];for(let s of e){let e=await s;t.push(e)}return t}}};a()}catch(e){a(e)}})},2068:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{a:()=>r.a});var r=s(4685),i=e([r]);r=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},2924:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{Z:()=>c});var r=s(997);s(6689);var i=s(1163),l=s(2068),n=e([l]);function c({children:e,redirectTo:t="/admin/login"}){let{isAuthenticated:s,isLoading:a}=(0,l.a)();return((0,i.useRouter)(),a)?r.jsx("div",{className:"flex min-h-screen items-center justify-center",children:r.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):s?r.jsx(r.Fragment,{children:e}):null}l=(n.then?(await n)():n)[0],a()}catch(e){a(e)}})},110:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{default:()=>m,getServerSideProps:()=>u});var r=s(997),i=s(6689),l=s(1664),n=s.n(l),c=s(5153),d=s(9648),o=s(2924),x=e([c,d,o]);[c,d,o]=x.then?(await x)():x;let h=({value:e,max:t,color:s,size:a=60,strokeWidth:i=6})=>{let l=a/2-i,n=2*Math.PI*l,c=n-e/(t||1)*n;return(0,r.jsxs)("div",{className:"relative inline-flex",children:[(0,r.jsxs)("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[r.jsx("circle",{cx:a/2,cy:a/2,r:l,fill:"none",stroke:"#e5e7eb",strokeWidth:i}),r.jsx("circle",{cx:a/2,cy:a/2,r:l,fill:"none",stroke:s,strokeWidth:i,strokeDasharray:n,strokeDashoffset:c,strokeLinecap:"round",transform:`rotate(-90 ${a/2} ${a/2})`})]}),(0,r.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium",children:[e,"/",t]})]})};function m({projects:e,stats:t,projectStats:s}){let[a,l]=(0,i.useState)(e),[c,x]=(0,i.useState)(t),[m,u]=(0,i.useState)(null),[p,g]=(0,i.useState)(null),[f,j]=(0,i.useState)(!1),[y,v]=(0,i.useState)(null),k=async e=>{u(e),g(null);try{if((await d.default.delete(`/api/projects/delete?id=${e}`)).data.success){let t=a.filter(t=>t.id!==e);l(t),a.find(t=>t.id===e)&&x(e=>({...e,totalProjects:e.totalProjects-1})),j(!1)}else g("Failed to delete project. Please try again.")}catch(e){console.error("Error deleting project:",e),g("An error occurred while deleting the project. Please try again.")}finally{u(null)}},b=e=>{v(e),j(!0)};return r.jsx(o.Z,{children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[r.jsx("div",{className:"bg-white shadow",children:r.jsx("div",{className:"container mx-auto py-6 px-4 sm:px-6 lg:px-8",children:r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Survey Link Wrapper Admin"})})}),(0,r.jsxs)("div",{className:"container mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg mb-8 p-6",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Overall Statistics"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"relative mb-2",children:[(0,r.jsxs)("svg",{className:"w-24 h-24",children:[r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#6366F1",strokeWidth:"8",strokeDasharray:2*Math.PI*40,strokeDashoffset:"0",transform:"rotate(-90 48 48)"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"text-3xl font-bold text-gray-900",children:c.totalProjects})})]}),r.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Total Projects"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"relative mb-2",children:[(0,r.jsxs)("svg",{className:"w-24 h-24",children:[r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#6366F1",strokeWidth:"8",strokeDasharray:2*Math.PI*40,strokeDashoffset:"0",transform:"rotate(-90 48 48)"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"text-3xl font-bold text-gray-900",children:c.totalLinks})})]}),r.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Total Links"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"relative mb-2",children:[(0,r.jsxs)("svg",{className:"w-24 h-24",children:[r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#3B82F6",strokeWidth:"8",strokeDasharray:2*Math.PI*40,strokeDashoffset:2*Math.PI*40*(1-c.pendingLinks/c.totalLinks),transform:"rotate(-90 48 48)"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"text-3xl font-bold text-blue-600",children:c.pendingLinks})})]}),r.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Pending Links"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"relative mb-2",children:[(0,r.jsxs)("svg",{className:"w-24 h-24",children:[r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#10B981",strokeWidth:"8",strokeDasharray:2*Math.PI*40,strokeDashoffset:2*Math.PI*40*(1-c.startedLinks/c.totalLinks),transform:"rotate(-90 48 48)"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"text-3xl font-bold text-green-600",children:c.startedLinks})})]}),r.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Started Links"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"relative mb-2",children:[(0,r.jsxs)("svg",{className:"w-24 h-24",children:[r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#059669",strokeWidth:"8",strokeDasharray:2*Math.PI*40,strokeDashoffset:2*Math.PI*40*(1-c.completedLinks/c.totalLinks),transform:"rotate(-90 48 48)"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"text-3xl font-bold text-green-800",children:c.completedLinks})})]}),r.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Completed Links"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"relative mb-2",children:[(0,r.jsxs)("svg",{className:"w-24 h-24",children:[r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),r.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"#EF4444",strokeWidth:"8",strokeDasharray:2*Math.PI*40,strokeDashoffset:2*Math.PI*40*(1-c.flaggedLinks/c.totalLinks),transform:"rotate(-90 48 48)"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"text-3xl font-bold text-red-600",children:c.flaggedLinks})})]}),r.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Flagged Links"})]})]})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg mb-8",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Your Projects"}),r.jsx(n(),{href:"/admin/projects/new",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",children:"Create New Project"})]}),r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Links"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status Distribution"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[a.map(e=>{let t=s[e.id]||{pending:0,started:0,inProgress:0,completed:0,flagged:0},a=e._count.surveyLinks;return(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.description||"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e._count.surveyLinks}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"flex justify-center space-x-1",children:a>0?(0,r.jsxs)(r.Fragment,{children:[r.jsx(h,{value:t.pending,max:a,color:"#3B82F6"}),r.jsx(h,{value:t.started,max:a,color:"#10B981"}),r.jsx(h,{value:t.inProgress,max:a,color:"#F59E0B"}),r.jsx(h,{value:t.completed,max:a,color:"#059669"}),r.jsx(h,{value:t.flagged,max:a,color:"#EF4444"})]}):r.jsx("span",{className:"text-xs text-gray-400",children:"No links generated"})})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[r.jsx(n(),{href:`/admin/projects/${e.id}`,className:"text-blue-600 hover:text-blue-900 mr-4",children:"View"}),r.jsx(n(),{href:`/admin/projects/${e.id}/generate`,className:"text-green-600 hover:text-green-900 mr-4",children:"Generate Links"}),r.jsx("button",{onClick:()=>b(e),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id)}),0===a.length&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No projects found. Create your first project to get started."})})]})]})})]})]}),f&&y&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-md w-full",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Delete Project"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete ",r.jsx("span",{className:"font-semibold",children:y.name}),"? This will permanently delete the project and all associated data, including:"]}),(0,r.jsxs)("ul",{className:"list-disc list-inside text-gray-600 mb-6",children:[(0,r.jsxs)("li",{children:[y._count.surveyLinks," survey links"]}),r.jsx("li",{children:"All survey responses"}),r.jsx("li",{children:"All pre-survey questions"}),(0,r.jsxs)("li",{children:[y._count.flags," flags"]})]}),r.jsx("p",{className:"text-gray-600 mb-6",children:"This action cannot be undone."}),p&&r.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:p}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{onClick:()=>{v(null),j(!1),g(null)},className:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50",disabled:m===y.id,children:"Cancel"}),r.jsx("button",{onClick:()=>k(y.id),className:"bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50",disabled:m===y.id,children:m===y.id?"Deleting...":"Yes, Delete Project"})]})]})})]})})}async function u(){try{let e=(await c.K.projects.list()).data||[],t={totalProjects:e.length,totalLinks:0,pendingLinks:0,startedLinks:0,inProgressLinks:0,completedLinks:0,flaggedLinks:0},s={};e.forEach(e=>{e&&e.id&&(s[e.id]={pending:0,started:0,inProgress:0,completed:0,flagged:0})});let a=(await c.K.surveyLinks.list()).data||[];t.totalLinks=a.length,a.forEach(e=>{if(e.projectId&&e.status&&e.projectId&&s[e.projectId])switch(e.status){case"UNUSED":s[e.projectId].pending+=1,t.pendingLinks+=1;break;case"CLICKED":s[e.projectId].started+=1,t.startedLinks+=1;break;case"CLICKED":s[e.projectId].inProgress+=1,t.inProgressLinks+=1;break;case"COMPLETED":s[e.projectId].completed+=1,t.completedLinks+=1;break;case"DISQUALIFIED":case"QUOTA_FULL":s[e.projectId].flagged+=1,t.flaggedLinks+=1}});let r=[],i={};e.forEach(e=>{if(!e||!e.id)return;let t=a.filter(t=>t.projectId===e.id),s=r.filter(t=>t.projectId===e.id);i[e.id]={surveyLinks:t.length,flags:s.length}});let l=e.map(e=>e&&e.id?{id:e.id,name:e.name,description:e.description,createdAt:e.createdAt,_count:{surveyLinks:i[e.id]?.surveyLinks||0,flags:i[e.id]?.flags||0}}:null).filter(Boolean);return{props:{projects:JSON.parse(JSON.stringify(l)),stats:t,projectStats:s}}}catch(e){return console.error("Error fetching admin dashboard data:",e),{props:{projects:[],stats:{totalProjects:0,totalLinks:0,pendingLinks:0,startedLinks:0,inProgressLinks:0,completedLinks:0,flaggedLinks:0},projectStats:{}}}}}a()}catch(e){a(e)}})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},5838:e=>{e.exports=import("aws-amplify")},1534:e=>{e.exports=import("aws-amplify/api")},9779:e=>{e.exports=import("aws-amplify/auth")},9648:e=>{e.exports=import("axios")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[899,132,163,664,893],()=>s(2465));module.exports=a})();