"use strict";(()=>{var e={};e.id=6964,e.ids=[6964,2888,660],e.modules={2465:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{config:()=>g,default:()=>m,getServerSideProps:()=>p,getStaticPaths:()=>u,getStaticProps:()=>h,reportWebVitals:()=>f,routeModule:()=>w,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>N,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>j});var r=s(7093),i=s(5244),l=s(1323),n=s(2899),c=s.n(n),d=s(3893),o=s(110),x=e([d,o]);[d,o]=x.then?(await x)():x;let m=(0,l.l)(o,"default"),h=(0,l.l)(o,"getStaticProps"),u=(0,l.l)(o,"getStaticPaths"),p=(0,l.l)(o,"getServerSideProps"),g=(0,l.l)(o,"config"),f=(0,l.l)(o,"reportWebVitals"),j=(0,l.l)(o,"unstable_getStaticProps"),y=(0,l.l)(o,"unstable_getStaticPaths"),N=(0,l.l)(o,"unstable_getStaticParams"),v=(0,l.l)(o,"unstable_getServerProps"),b=(0,l.l)(o,"unstable_getServerSideProps"),w=new r.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/admin",pathname:"/admin",bundlePath:"",filename:""},components:{App:d.default,Document:c()},userland:o});a()}catch(e){a(e)}})},5153:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{d:()=>n});var r=s(1534),i=s(5838);s(4192);var l=e([r,i]);async function n(){throw Error("amplifyDataService can only be used on the client/browser.")}[r,i]=l.then?(await l)():l,a()}catch(e){a(e)}})},6227:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{OA:()=>c,XR:()=>n});var r=s(9779),i=e([r]);async function l(){let e={timestamp:new Date().toISOString(),cookies:{},session:null,user:null,errors:[]};"undefined"!=typeof document&&document.cookie.split(";").forEach(t=>{let[s,a]=t.split("=").map(e=>e.trim());(s.includes("CognitoIdentityServiceProvider")||s.includes("amplify")||s.includes("Token"))&&(e.cookies[s]=a?"present":"empty")});try{let t=await (0,r.fetchAuthSession)();e.session={hasIdToken:!!t.tokens?.idToken,hasAccessToken:!!t.tokens?.accessToken,hasTokens:!!t.tokens}}catch(t){e.errors.push({source:"fetchAuthSession",message:t instanceof Error?t.message:String(t)})}try{let t=await (0,r.getCurrentUser)();e.user={userId:t.userId,username:t.username,signInDetails:t.signInDetails}}catch(t){e.errors.push({source:"getCurrentUser",message:t instanceof Error?t.message:String(t)})}return e}async function n(){try{let e=await l();console.log("=== AUTH DIAGNOSTICS ==="),console.log(JSON.stringify(e,null,2)),console.log("=======================")}catch(e){console.error("Failed to get auth diagnostics:",e)}}async function c(){try{let e=await l();if(e.errors.length>0&&Object.keys(e.cookies).length>0)return"undefined"!=typeof document&&document.cookie.split(";").forEach(e=>{let[t]=e.split("=").map(e=>e.trim());(t.includes("CognitoIdentityServiceProvider")||t.includes("amplify")||t.includes("Token"))&&(console.log("Clearing problematic cookie:",t),document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`)}),!0;return!1}catch(e){return console.error("Failed to fix auth issues:",e),!1}}r=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},2068:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{a:()=>r.a});var r=s(4685),i=e([r]);r=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},2924:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.d(t,{Z:()=>o});var r=s(997),i=s(6689),l=s(1163),n=s(2068),c=s(6227),d=e([n,c]);function o({children:e,redirectTo:t="/admin/login"}){let{isAuthenticated:s,isLoading:a}=(0,n.a)();(0,l.useRouter)();let[c,d]=(0,i.useState)(!1);return c?r.jsx("div",{className:"flex min-h-screen items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white p-8 rounded shadow text-center max-w-md mx-auto",children:[r.jsx("h2",{className:"text-xl font-bold mb-4 text-red-600",children:"Too many login attempts"}),r.jsx("p",{className:"mb-4",children:"You have been redirected too many times. Please clear your cookies, log in again, or contact support if the problem persists."})]})}):a?r.jsx("div",{className:"flex min-h-screen items-center justify-center",children:r.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):s?r.jsx(r.Fragment,{children:e}):null}[n,c]=d.then?(await d)():d,a()}catch(e){a(e)}})},110:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{default:()=>m,getServerSideProps:()=>h});var r=s(997),i=s(6689),l=s(1163),n=s(1664),c=s.n(n),d=s(2924),o=s(5153),x=e([d,o]);[d,o]=x.then?(await x)():x;let u=({value:e,max:t,color:s,size:a=60,strokeWidth:i=6})=>{let l=a/2-i,n=2*Math.PI*l,c=n-e/(t||1)*n;return(0,r.jsxs)("div",{className:"relative inline-flex",children:[(0,r.jsxs)("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[r.jsx("circle",{cx:a/2,cy:a/2,r:l,fill:"none",stroke:"#e5e7eb",strokeWidth:i}),r.jsx("circle",{cx:a/2,cy:a/2,r:l,fill:"none",stroke:s,strokeWidth:i,strokeDasharray:n,strokeDashoffset:c,strokeLinecap:"round",transform:`rotate(-90 ${a/2} ${a/2})`})]}),(0,r.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium",children:[e,"/",t]})]})};function m(){let e=(0,l.useRouter)(),[t,a]=(0,i.useState)([]),[n,x]=(0,i.useState)(null),[m,h]=(0,i.useState)({}),[p,g]=(0,i.useState)(!0),[f,j]=(0,i.useState)(""),[y,N]=(0,i.useState)(null),[v,b]=(0,i.useState)(!1),[w,S]=(0,i.useState)(null),k=async()=>{try{g(!0),j("");let e=await (0,o.d)(),t=((await e.projects.list()).data||[]).map(e=>({id:e.id,name:e.name,description:e.description||"",status:e.status||"ACTIVE",targetCompletions:e.targetCompletions||0,currentCompletions:e.currentCompletions||0,createdAt:e.createdAt,updatedAt:e.updatedAt}));a(t);let s=(await e.surveyLinks.list()).data||[],r=t.length,i=s.length,l=s.filter(e=>"UNUSED"===e.status).length,n=s.filter(e=>"CLICKED"===e.status).length,c=s.filter(e=>"IN_PROGRESS"===e.status).length,d=s.filter(e=>"COMPLETED"===e.status).length,m=s.filter(e=>"DISQUALIFIED"===e.status).length;x({totalProjects:r,totalLinks:i,pendingLinks:l,startedLinks:n,inProgressLinks:c,completedLinks:d,flaggedLinks:m});let u={};t.forEach(e=>{let t=s.filter(t=>t.projectId===e.id);u[e.id]={pending:t.filter(e=>"UNUSED"===e.status).length,started:t.filter(e=>"CLICKED"===e.status).length,inProgress:t.filter(e=>"IN_PROGRESS"===e.status).length,completed:t.filter(e=>"COMPLETED"===e.status).length,flagged:t.filter(e=>"DISQUALIFIED"===e.status).length,total:t.length}}),h(u)}catch(e){console.error("Error fetching dashboard data:",e),j("Failed to load dashboard data. Please check your connection and try again.")}finally{g(!1)}},P=e=>{S(e),b(!0)},C=async()=>{if(w)try{N(w.id);let e=await (0,o.d)();await e.projects.delete(w.id),await k(),b(!1),S(null)}catch(e){console.error("Error deleting project:",e),j("Failed to delete project. Please try again.")}finally{N(null)}},D=async()=>{try{let{AuthService:t}=await Promise.resolve().then(s.bind(s,7200));await t.signOut(),e.push("/admin/login")}catch(e){console.error("Error signing out:",e)}};return p?r.jsx(d.Z,{children:r.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})})}):r.jsx(d.Z,{children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[r.jsx("nav",{className:"bg-white shadow-lg",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[r.jsx("div",{className:"flex items-center",children:r.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Admin Dashboard"})}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx(c(),{href:"/admin/projects/new",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",children:"Create Project"}),r.jsx("button",{onClick:D,className:"text-gray-600 hover:text-gray-800",children:"Logout"})]})]})})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[f&&(0,r.jsxs)("div",{className:"mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[f,r.jsx("button",{onClick:()=>j(""),className:"ml-4 text-red-700 hover:text-red-900",children:"\xd7"})]}),n&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[r.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:r.jsx("div",{className:"p-5",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold",children:"P"})})}),r.jsx("div",{className:"ml-5 w-0 flex-1",children:(0,r.jsxs)("dl",{children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Projects"}),r.jsx("dd",{className:"text-lg font-medium text-gray-900",children:n.totalProjects})]})})]})})}),r.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:r.jsx("div",{className:"p-5",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-md flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold",children:"L"})})}),r.jsx("div",{className:"ml-5 w-0 flex-1",children:(0,r.jsxs)("dl",{children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Links"}),r.jsx("dd",{className:"text-lg font-medium text-gray-900",children:n.totalLinks})]})})]})})}),r.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:r.jsx("div",{className:"p-5",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold",children:"C"})})}),r.jsx("div",{className:"ml-5 w-0 flex-1",children:(0,r.jsxs)("dl",{children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Completed"}),r.jsx("dd",{className:"text-lg font-medium text-gray-900",children:n.completedLinks})]})})]})})}),r.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:r.jsx("div",{className:"p-5",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-8 h-8 bg-orange-500 rounded-md flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold",children:"A"})})}),r.jsx("div",{className:"ml-5 w-0 flex-1",children:(0,r.jsxs)("dl",{children:[r.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Active Links"}),r.jsx("dd",{className:"text-lg font-medium text-gray-900",children:n.inProgressLinks})]})})]})})})]}),(0,r.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[(0,r.jsxs)("div",{className:"px-4 py-5 sm:px-6 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Projects"}),r.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Manage your research projects and survey campaigns."})]}),r.jsx("button",{onClick:k,disabled:p,className:"bg-gray-100 hover:bg-gray-200 disabled:opacity-50 text-gray-700 font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50",children:p?"Refreshing...":"Refresh"})]}),0===t.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"No projects found"}),r.jsx(c(),{href:"/admin/projects/new",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",children:"Create Your First Project"})]}):r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Project"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Links"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>{let t=m[e.id]||{pending:0,started:0,inProgress:0,completed:0,flagged:0,total:0};return(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.description&&r.jsx("div",{className:"text-sm text-gray-500",children:e.description})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${"ACTIVE"===e.status?"bg-green-100 text-green-800":"PAUSED"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:e.status})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(u,{value:e.currentCompletions,max:e.targetCompletions,color:"#10B981",size:40,strokeWidth:4}),(0,r.jsxs)("span",{className:"ml-2 text-sm text-gray-600",children:[Math.round(e.currentCompletions/(e.targetCompletions||1)*100),"%"]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,r.jsxs)("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium",children:t.total}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[t.completed," completed"]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[r.jsx(c(),{href:`/admin/projects/${e.id}`,className:"text-blue-600 hover:text-blue-900 mr-4",children:"View"}),r.jsx("button",{onClick:()=>P(e),disabled:y===e.id,className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:y===e.id?"Deleting...":"Delete"})]})]},e.id)})})]})})]})]}),v&&w&&r.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:r.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,r.jsxs)("div",{className:"mt-3 text-center",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Confirm Delete"}),r.jsx("div",{className:"mt-2 px-7 py-3",children:(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:['Are you sure you want to delete project "',w.name,'"? This action cannot be undone.']})}),(0,r.jsxs)("div",{className:"flex justify-center space-x-4 mt-4",children:[r.jsx("button",{onClick:()=>{b(!1),S(null)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Cancel"}),r.jsx("button",{onClick:C,disabled:null!==y,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50",children:y?"Deleting...":"Delete"})]})]})})})]})})}async function h(){return{props:{}}}a()}catch(e){a(e)}})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},5838:e=>{e.exports=import("aws-amplify")},1534:e=>{e.exports=import("aws-amplify/api")},9779:e=>{e.exports=import("aws-amplify/auth")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[2899,6132,1163,1664,3893],()=>s(2465));module.exports=a})();