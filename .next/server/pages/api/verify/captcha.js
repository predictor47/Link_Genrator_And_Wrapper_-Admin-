"use strict";(()=>{var e={};e.id=554,e.ids=[554],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6197:(e,t,r)=>{r.r(t),r.d(t,{config:()=>f,default:()=>c,routeModule:()=>h});var n={};r.r(n),r.d(n,{default:()=>d});var a=r(1802),o=r(7153),s=r(6249),i=r(4770),l=r.n(i);let u=process.env.CAPTCHA_SECRET_KEY||"default-challenge-key-change-me-in-production";async function d(e,t){if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),"OPTIONS"===e.method)return t.status(200).end();if("GET"===e.method){let r=e.query.fingerprint;if(!r)return t.status(400).json({success:!1,error:"Missing browser fingerprint"});try{let e=function(e){let t;let r=l().randomBytes(16).toString("hex"),n=Date.now(),a=Math.random()>.7?"math":Math.random()>.5?"drag":"flip";switch(a){case"math":default:(t=function e(){let t,r;let n=["+","-","*"];switch(n[Math.floor(Math.random()*n.length)]){case"+":return t=Math.floor(10*Math.random())+1,r=Math.floor(10*Math.random())+1,{question:`What is ${t} + ${r}?`,answer:t+r};case"-":return r=Math.floor(Math.random()*((t=Math.floor(10*Math.random())+5)-1))+1,{question:`What is ${t} - ${r}?`,answer:t-r};case"*":return t=Math.floor(5*Math.random())+1,r=Math.floor(5*Math.random())+1,{question:`What is ${t} \xd7 ${r}?`,answer:t*r};default:return e()}}()).answer;break;case"drag":(t=function(){let e=[{instruction:"Drag to order from smallest to largest",items:["5","2","9","1","7"],answer:"12579"},{instruction:"Drag to order alphabetically",items:["dog","cat","bird","fish","ant"],answer:"antbirddogcatfish"},{instruction:"Drag to order chronologically",items:["Lunch","Breakfast","Dinner","Snack"],answer:"BreakfastLunchSnackDinner"}],t=e[Math.floor(Math.random()*e.length)],r=[...t.items].sort(()=>Math.random()-.5);return{instruction:t.instruction,items:r,answer:t.answer}}()).answer;break;case"flip":(t=function(){let e=[{instruction:"Click on all images that are upside down",images:["normal-1","flipped-2","normal-3","flipped-4","normal-5","flipped-6"],answer:"135"},{instruction:"Click on all images of animals",images:["car","dog","house","cat","tree","bird"],answer:"146"}];return e[Math.floor(Math.random()*e.length)]}()).answer}let o={id:r,type:a,data:{...t,answer:void 0},timestamp:n},s=function(e,t){let r=JSON.stringify({id:e.id,type:e.type,data:e.data,timestamp:e.timestamp,fingerprint:t});return l().createHmac("sha256",u).update(r).digest("hex")}(o,e.fingerprint);return e.fingerprint,{...o,hash:s}}({fingerprint:r});return t.status(200).json({success:!0,challenge:e})}catch(e){return console.error("Error generating challenge:",e),t.status(500).json({success:!1,error:"Failed to generate challenge"})}}if("POST"===e.method)try{let{id:n,answer:a,fingerprint:o,timing:s}=e.body;if(!n||void 0===a||!o||!s)return t.status(400).json({success:!1,error:"Missing required fields"});let i=function(e){if(e.timing<500)return{valid:!1,reason:"Response was too fast, likely automated"};if(!e.answer)return{valid:!1,reason:"Empty answer"};let t=e.fingerprint;return!t||t.length<10?{valid:!1,reason:"Invalid or missing browser fingerprint"}:{valid:!0}}({id:n,answer:a,fingerprint:o,timing:s});return t.status(200).json({success:i.valid,error:i.reason,token:i.valid?function(e){let t=r(4770),n=Date.now(),a=`${e}:${n}:${process.env.CAPTCHA_SECRET_KEY||"default-secret"}`,o=t.createHash("sha256").update(a).digest("hex");return`${n}:${o}`}(o):null})}catch(e){return console.error("Error verifying challenge:",e),t.status(500).json({success:!1,error:"Failed to verify challenge"})}return t.status(405).json({error:"Method not allowed"})}let c=(0,s.l)(n,"default"),f=(0,s.l)(n,"config"),h=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/verify/captcha",pathname:"/api/verify/captcha",bundlePath:"",filename:""},userland:n})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6197);module.exports=r})();