"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/links/generate";
exports.ids = ["pages/api/links/generate"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "aws-amplify":
/*!******************************!*\
  !*** external "aws-amplify" ***!
  \******************************/
/***/ ((module) => {

module.exports = import("aws-amplify");;

/***/ }),

/***/ "aws-amplify/api":
/*!**********************************!*\
  !*** external "aws-amplify/api" ***!
  \**********************************/
/***/ ((module) => {

module.exports = import("aws-amplify/api");;

/***/ }),

/***/ "aws-amplify/auth":
/*!***********************************!*\
  !*** external "aws-amplify/auth" ***!
  \***********************************/
/***/ ((module) => {

module.exports = import("aws-amplify/auth");;

/***/ }),

/***/ "nanoid":
/*!*************************!*\
  !*** external "nanoid" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("nanoid");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Flinks%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Flinks%2Fgenerate.ts&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Flinks%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Flinks%2Fgenerate.ts&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_links_generate_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/pages/api/links/generate.ts */ \"(api)/./src/pages/api/links/generate.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_links_generate_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_links_generate_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_links_generate_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_links_generate_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/links/generate\",\n        pathname: \"/api/links/generate\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_links_generate_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmxpbmtzJTJGZ2VuZXJhdGUmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZzcmMlMkZwYWdlcyUyRmFwaSUyRmxpbmtzJTJGZ2VuZXJhdGUudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDOEQ7QUFDOUQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLDZEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyw2REFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdXJ2ZXktbGluay13cmFwcGVyLz8zYTZlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9zcmMvcGFnZXMvYXBpL2xpbmtzL2dlbmVyYXRlLnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvbGlua3MvZ2VuZXJhdGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9saW5rcy9nZW5lcmF0ZVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Flinks%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Flinks%2Fgenerate.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/lib/amplify-config.ts":
/*!***********************************!*\
  !*** ./src/lib/amplify-config.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAmplifyConfig: () => (/* binding */ getAmplifyConfig)\n/* harmony export */ });\n/* harmony import */ var _amplify_outputs_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../amplify_outputs.json */ \"(api)/./amplify_outputs.json\");\n\n// Export the Amplify Gen 2 configuration\nfunction getAmplifyConfig() {\n    return _amplify_outputs_json__WEBPACK_IMPORTED_MODULE_0__;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL2FtcGxpZnktY29uZmlnLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXdEO0FBRXhELHlDQUF5QztBQUNsQyxTQUFTQztJQUNkLE9BQU9ELGtEQUFjQTtBQUN2QiIsInNvdXJjZXMiOlsid2VicGFjazovL3N1cnZleS1saW5rLXdyYXBwZXIvLi9zcmMvbGliL2FtcGxpZnktY29uZmlnLnRzPzRhYjYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFtcGxpZnlPdXRwdXRzIGZyb20gJy4uLy4uL2FtcGxpZnlfb3V0cHV0cy5qc29uJztcblxuLy8gRXhwb3J0IHRoZSBBbXBsaWZ5IEdlbiAyIGNvbmZpZ3VyYXRpb25cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbXBsaWZ5Q29uZmlnKCkge1xuICByZXR1cm4gYW1wbGlmeU91dHB1dHM7XG59Il0sIm5hbWVzIjpbImFtcGxpZnlPdXRwdXRzIiwiZ2V0QW1wbGlmeUNvbmZpZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/amplify-config.ts\n");

/***/ }),

/***/ "(api)/./src/lib/amplify-data-service.ts":
/*!*****************************************!*\
  !*** ./src/lib/amplify-data-service.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAmplifyDataService: () => (/* binding */ getAmplifyDataService)\n/* harmony export */ });\n/* harmony import */ var aws_amplify_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aws-amplify/api */ \"aws-amplify/api\");\n/* harmony import */ var aws_amplify__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! aws-amplify */ \"aws-amplify\");\n/* harmony import */ var _amplify_config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./amplify-config */ \"(api)/./src/lib/amplify-config.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([aws_amplify_api__WEBPACK_IMPORTED_MODULE_0__, aws_amplify__WEBPACK_IMPORTED_MODULE_1__]);\n([aws_amplify_api__WEBPACK_IMPORTED_MODULE_0__, aws_amplify__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nlet amplifyDataService = null;\nasync function getAmplifyDataService() {\n    if (true) {\n        throw new Error(\"amplifyDataService can only be used on the client/browser.\");\n    }\n    if (amplifyDataService) return amplifyDataService;\n    const amplifyConfig = (0,_amplify_config__WEBPACK_IMPORTED_MODULE_2__.getAmplifyConfig)();\n    if (!amplifyConfig?.data?.url) {\n        throw new Error(\"Amplify config is missing GraphQL endpoint.\");\n    }\n    aws_amplify__WEBPACK_IMPORTED_MODULE_1__.Amplify.configure(amplifyConfig);\n    const client = (0,aws_amplify_api__WEBPACK_IMPORTED_MODULE_0__.generateClient)({\n        authMode: \"userPool\"\n    });\n    // Debug logging\n    console.log(\"Amplify Data client:\", client);\n    console.log(\"client.models:\", client.models);\n    // Check if models are available\n    if (!client.models || Object.keys(client.models).length === 0) {\n        console.error(\"client.models is empty! This usually means the Amplify backend is not properly connected.\");\n        throw new Error(\"Amplify Data models are not available. Please check your backend connection.\");\n    }\n    // Verify required models exist\n    const requiredModels = [\n        \"Project\",\n        \"Vendor\",\n        \"Question\",\n        \"SurveyLink\",\n        \"ProjectVendor\"\n    ];\n    for (const modelName of requiredModels){\n        if (!client.models[modelName]) {\n            console.error(`${modelName} model is missing from Amplify Data client!`);\n            throw new Error(`Required model ${modelName} is not available in the Amplify Data client.`);\n        }\n    }\n    console.log(\"All required models are available:\", requiredModels);\n    // Helper to safely unwrap data from Amplify responses\n    const unwrapData = (result)=>result.data;\n    // Helper to handle Amplify errors in a consistent way\n    const handleAmplifyError = (error, operation)=>{\n        const errorMessage = error.message || \"Unknown error\";\n        const errorName = error.name || \"Error\";\n        console.error(`Amplify Error (${operation}):`, {\n            name: errorName,\n            message: errorMessage\n        });\n        throw error;\n    };\n    amplifyDataService = {\n        client,\n        projects: {\n            create: async (data)=>{\n                try {\n                    const result = await client.models.Project.create(data);\n                    return {\n                        data: unwrapData(result)\n                    };\n                } catch (error) {\n                    handleAmplifyError(error, \"projects.create\");\n                    return {\n                        data: null\n                    };\n                }\n            },\n            get: async (id)=>{\n                const result = await client.models.Project.get({\n                    id\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            list: async (filter)=>{\n                const result = await client.models.Project.list(filter);\n                return {\n                    data: result.data || []\n                };\n            },\n            update: async (id, data)=>{\n                const result = await client.models.Project.update({\n                    id,\n                    ...data\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            delete: async (id)=>{\n                const result = await client.models.Project.delete({\n                    id\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            getWithRelations: async (id)=>{\n                // Fetch project and related data separately\n                const project = await client.models.Project.get({\n                    id\n                });\n                if (project.data) {\n                    // Fetch related data separately\n                    const surveyLinks = await client.models.SurveyLink.list({\n                        filter: {\n                            projectId: {\n                                eq: id\n                            }\n                        }\n                    });\n                    // First get ProjectVendor relationships for this project\n                    const projectVendors = await client.models.ProjectVendor.list({\n                        filter: {\n                            projectId: {\n                                eq: id\n                            }\n                        }\n                    });\n                    // Then get the actual vendors if there are project-vendor relationships\n                    const vendorIds = projectVendors.data.map((pv)=>pv.vendorId).filter((id)=>id !== null && id !== undefined);\n                    let vendorData = [];\n                    // Fetch vendors if there are any relationships\n                    if (vendorIds.length > 0) {\n                        const vendorResults = await Promise.all(vendorIds.map((vid)=>client.models.Vendor.get({\n                                id: vid\n                            })));\n                        // Extract data from each result\n                        vendorData = vendorResults.filter((result)=>result.data !== null).map((result)=>result.data);\n                    }\n                    const questions = await client.models.Question.list({\n                        filter: {\n                            projectId: {\n                                eq: id\n                            }\n                        }\n                    });\n                    // Combine project with its related data\n                    return {\n                        data: {\n                            ...project.data,\n                            surveyLinks: surveyLinks.data || [],\n                            vendors: vendorData,\n                            questions: questions.data || []\n                        }\n                    };\n                }\n                return {\n                    data: null\n                };\n            }\n        },\n        surveyLinks: {\n            create: async (data)=>{\n                const result = await client.models.SurveyLink.create(data);\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            get: async (id)=>{\n                const result = await client.models.SurveyLink.get({\n                    id\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            getByUid: async (uid)=>{\n                const results = await client.models.SurveyLink.list({\n                    filter: {\n                        uid: {\n                            eq: uid\n                        }\n                    }\n                });\n                return {\n                    data: results.data && results.data.length > 0 ? results.data[0] : null\n                };\n            },\n            update: async (id, data)=>{\n                const result = await client.models.SurveyLink.update({\n                    id,\n                    ...data\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            list: async (filter)=>{\n                const result = await client.models.SurveyLink.list(filter);\n                return {\n                    data: result.data || []\n                };\n            },\n            listByProject: async (projectId)=>{\n                const result = await client.models.SurveyLink.list({\n                    filter: {\n                        projectId: {\n                            eq: projectId\n                        }\n                    }\n                });\n                return {\n                    data: result.data || []\n                };\n            },\n            delete: async (id)=>{\n                const result = await client.models.SurveyLink.delete({\n                    id\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            }\n        },\n        vendors: {\n            create: async (data)=>{\n                const result = await client.models.Vendor.create(data);\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            get: async (id)=>{\n                const result = await client.models.Vendor.get({\n                    id\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            list: async (filter)=>{\n                const result = await client.models.Vendor.list(filter);\n                return {\n                    data: result.data || []\n                };\n            },\n            listByProject: async (projectId)=>{\n                // Get project-vendor relationships first\n                const projectVendors = await client.models.ProjectVendor.list({\n                    filter: {\n                        projectId: {\n                            eq: projectId\n                        }\n                    }\n                });\n                // Get vendor IDs from relationships\n                const vendorIds = projectVendors.data.map((pv)=>pv.vendorId).filter((id)=>id !== null && id !== undefined);\n                // Fetch each vendor individually if there are any relationships\n                if (vendorIds.length > 0) {\n                    const vendorResults = await Promise.all(vendorIds.map((vid)=>client.models.Vendor.get({\n                            id: vid\n                        })));\n                    // Extract data from each result and filter out nulls\n                    const vendorData = vendorResults.map((result)=>result.data).filter((v)=>v !== null);\n                    return {\n                        data: vendorData\n                    };\n                }\n                return {\n                    data: []\n                };\n            },\n            update: async (id, data)=>{\n                const result = await client.models.Vendor.update({\n                    id,\n                    ...data\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            delete: async (id)=>{\n                const result = await client.models.Vendor.delete({\n                    id\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            }\n        },\n        questions: {\n            create: async (data)=>{\n                const result = await client.models.Question.create(data);\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            get: async (id)=>{\n                const result = await client.models.Question.get({\n                    id\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            list: async (filter)=>{\n                const result = await client.models.Question.list(filter);\n                return {\n                    data: result.data || []\n                };\n            },\n            listByProject: async (projectId)=>{\n                const result = await client.models.Question.list({\n                    filter: {\n                        projectId: {\n                            eq: projectId\n                        }\n                    }\n                });\n                return {\n                    data: result.data || []\n                };\n            },\n            update: async (id, data)=>{\n                const result = await client.models.Question.update({\n                    id,\n                    ...data\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            },\n            delete: async (id)=>{\n                const result = await client.models.Question.delete({\n                    id\n                });\n                return {\n                    data: unwrapData(result)\n                };\n            }\n        },\n        // Helper for transactions (not directly supported in Amplify Data, using batch operations)\n        transaction: {\n            execute: async (operations)=>{\n                // Execute operations in sequence\n                const results = [];\n                for (const operation of operations){\n                    const result = await operation;\n                    results.push(result);\n                }\n                return results;\n            }\n        }\n    };\n    return amplifyDataService;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUM1RixPQUFPO29CQUFFbkMsTUFBTWUsT0FBT2YsSUFBSSxJQUFJLEVBQUU7Z0JBQUM7WUFDbkM7WUFDQTZCLFFBQVEsT0FBT0gsSUFBWTFCO2dCQUN6QixNQUFNZSxTQUFTLE1BQU1aLE9BQU9JLE1BQU0sQ0FBQzRDLFFBQVEsQ0FBQ3RCLE1BQU0sQ0FBQztvQkFBRUg7b0JBQUksR0FBRzFCLElBQUk7Z0JBQUM7Z0JBQ2pFLE9BQU87b0JBQUVBLE1BQU1jLFdBQVdDO2dCQUFRO1lBQ3BDO1lBQ0FlLFFBQVEsT0FBT0o7Z0JBQ2IsTUFBTVgsU0FBUyxNQUFNWixPQUFPSSxNQUFNLENBQUM0QyxRQUFRLENBQUNyQixNQUFNLENBQUM7b0JBQUVKO2dCQUFHO2dCQUN4RCxPQUFPO29CQUFFMUIsTUFBTWMsV0FBV0M7Z0JBQVE7WUFDcEM7UUFDRjtRQUVBLDJGQUEyRjtRQUMzRjJDLGFBQWE7WUFDWEMsU0FBUyxPQUFPQztnQkFDZCxpQ0FBaUM7Z0JBQ2pDLE1BQU1MLFVBQVUsRUFBRTtnQkFDbEIsS0FBSyxNQUFNdEMsYUFBYTJDLFdBQVk7b0JBQ2xDLE1BQU03QyxTQUFTLE1BQU1FO29CQUNyQnNDLFFBQVFNLElBQUksQ0FBQzlDO2dCQUNmO2dCQUNBLE9BQU93QztZQUNUO1FBQ0Y7SUFDRjtJQUVBLE9BQU8zRDtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3VydmV5LWxpbmstd3JhcHBlci8uL3NyYy9saWIvYW1wbGlmeS1kYXRhLXNlcnZpY2UudHM/NDU5ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZW5lcmF0ZUNsaWVudCB9IGZyb20gJ2F3cy1hbXBsaWZ5L2FwaSc7XG5pbXBvcnQgeyBBbXBsaWZ5IH0gZnJvbSAnYXdzLWFtcGxpZnknO1xuaW1wb3J0IHsgZ2V0QW1wbGlmeUNvbmZpZyB9IGZyb20gJy4vYW1wbGlmeS1jb25maWcnO1xuaW1wb3J0IHR5cGUgeyBTY2hlbWEgfSBmcm9tICcuLi8uLi9hbXBsaWZ5L2RhdGEvcmVzb3VyY2UnO1xuXG5sZXQgYW1wbGlmeURhdGFTZXJ2aWNlOiBhbnkgPSBudWxsO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QW1wbGlmeURhdGFTZXJ2aWNlKCkge1xuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2FtcGxpZnlEYXRhU2VydmljZSBjYW4gb25seSBiZSB1c2VkIG9uIHRoZSBjbGllbnQvYnJvd3Nlci4nKTtcbiAgfVxuICBpZiAoYW1wbGlmeURhdGFTZXJ2aWNlKSByZXR1cm4gYW1wbGlmeURhdGFTZXJ2aWNlO1xuXG4gIGNvbnN0IGFtcGxpZnlDb25maWcgPSBnZXRBbXBsaWZ5Q29uZmlnKCk7XG4gIGlmICghYW1wbGlmeUNvbmZpZz8uZGF0YT8udXJsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdBbXBsaWZ5IGNvbmZpZyBpcyBtaXNzaW5nIEdyYXBoUUwgZW5kcG9pbnQuJyk7XG4gIH1cbiAgQW1wbGlmeS5jb25maWd1cmUoYW1wbGlmeUNvbmZpZyk7XG5cbiAgY29uc3QgY2xpZW50ID0gZ2VuZXJhdGVDbGllbnQ8U2NoZW1hPih7IGF1dGhNb2RlOiAndXNlclBvb2wnIH0pO1xuICBcbiAgLy8gRGVidWcgbG9nZ2luZ1xuICBjb25zb2xlLmxvZygnQW1wbGlmeSBEYXRhIGNsaWVudDonLCBjbGllbnQpO1xuICBjb25zb2xlLmxvZygnY2xpZW50Lm1vZGVsczonLCBjbGllbnQubW9kZWxzKTtcbiAgXG4gIC8vIENoZWNrIGlmIG1vZGVscyBhcmUgYXZhaWxhYmxlXG4gIGlmICghY2xpZW50Lm1vZGVscyB8fCBPYmplY3Qua2V5cyhjbGllbnQubW9kZWxzKS5sZW5ndGggPT09IDApIHtcbiAgICBjb25zb2xlLmVycm9yKCdjbGllbnQubW9kZWxzIGlzIGVtcHR5ISBUaGlzIHVzdWFsbHkgbWVhbnMgdGhlIEFtcGxpZnkgYmFja2VuZCBpcyBub3QgcHJvcGVybHkgY29ubmVjdGVkLicpO1xuICAgIHRocm93IG5ldyBFcnJvcignQW1wbGlmeSBEYXRhIG1vZGVscyBhcmUgbm90IGF2YWlsYWJsZS4gUGxlYXNlIGNoZWNrIHlvdXIgYmFja2VuZCBjb25uZWN0aW9uLicpO1xuICB9XG4gIFxuICAvLyBWZXJpZnkgcmVxdWlyZWQgbW9kZWxzIGV4aXN0XG4gIGNvbnN0IHJlcXVpcmVkTW9kZWxzID0gWydQcm9qZWN0JywgJ1ZlbmRvcicsICdRdWVzdGlvbicsICdTdXJ2ZXlMaW5rJywgJ1Byb2plY3RWZW5kb3InXSBhcyBjb25zdDtcbiAgZm9yIChjb25zdCBtb2RlbE5hbWUgb2YgcmVxdWlyZWRNb2RlbHMpIHtcbiAgICBpZiAoIWNsaWVudC5tb2RlbHNbbW9kZWxOYW1lXSkge1xuICAgICAgY29uc29sZS5lcnJvcihgJHttb2RlbE5hbWV9IG1vZGVsIGlzIG1pc3NpbmcgZnJvbSBBbXBsaWZ5IERhdGEgY2xpZW50IWApO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZXF1aXJlZCBtb2RlbCAke21vZGVsTmFtZX0gaXMgbm90IGF2YWlsYWJsZSBpbiB0aGUgQW1wbGlmeSBEYXRhIGNsaWVudC5gKTtcbiAgICB9XG4gIH1cbiAgXG4gIGNvbnNvbGUubG9nKCdBbGwgcmVxdWlyZWQgbW9kZWxzIGFyZSBhdmFpbGFibGU6JywgcmVxdWlyZWRNb2RlbHMpO1xuXG4gIC8vIEhlbHBlciB0byBzYWZlbHkgdW53cmFwIGRhdGEgZnJvbSBBbXBsaWZ5IHJlc3BvbnNlc1xuICBjb25zdCB1bndyYXBEYXRhID0gPFQ+KHJlc3VsdDogeyBkYXRhOiBUIHwgbnVsbCB9KTogVCB8IG51bGwgPT4gcmVzdWx0LmRhdGE7XG4gIFxuICAvLyBIZWxwZXIgdG8gaGFuZGxlIEFtcGxpZnkgZXJyb3JzIGluIGEgY29uc2lzdGVudCB3YXlcbiAgY29uc3QgaGFuZGxlQW1wbGlmeUVycm9yID0gKGVycm9yOiBhbnksIG9wZXJhdGlvbjogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcic7XG4gICAgY29uc3QgZXJyb3JOYW1lID0gZXJyb3IubmFtZSB8fCAnRXJyb3InO1xuICAgIGNvbnNvbGUuZXJyb3IoYEFtcGxpZnkgRXJyb3IgKCR7b3BlcmF0aW9ufSk6YCwgeyBuYW1lOiBlcnJvck5hbWUsIG1lc3NhZ2U6IGVycm9yTWVzc2FnZSB9KTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfTtcblxuICBhbXBsaWZ5RGF0YVNlcnZpY2UgPSB7XG4gICAgY2xpZW50LFxuICAgIHByb2plY3RzOiB7XG4gICAgICBjcmVhdGU6IGFzeW5jIChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlByb2plY3QuY3JlYXRlKGRhdGEpO1xuICAgICAgICAgIHJldHVybiB7IGRhdGE6IHVud3JhcERhdGEocmVzdWx0KSB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGhhbmRsZUFtcGxpZnlFcnJvcihlcnJvciwgJ3Byb2plY3RzLmNyZWF0ZScpO1xuICAgICAgICAgIHJldHVybiB7IGRhdGE6IG51bGwgfTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGdldDogYXN5bmMgKGlkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xpZW50Lm1vZGVscy5Qcm9qZWN0LmdldCh7IGlkIH0pO1xuICAgICAgICByZXR1cm4geyBkYXRhOiB1bndyYXBEYXRhKHJlc3VsdCkgfTtcbiAgICAgIH0sXG4gICAgICBsaXN0OiBhc3luYyAoZmlsdGVyPzogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5tb2RlbHMuUHJvamVjdC5saXN0KGZpbHRlcik7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IHJlc3VsdC5kYXRhIHx8IFtdIH07XG4gICAgICB9LFxuICAgICAgdXBkYXRlOiBhc3luYyAoaWQ6IHN0cmluZywgZGF0YTogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5tb2RlbHMuUHJvamVjdC51cGRhdGUoeyBpZCwgLi4uZGF0YSB9KTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogdW53cmFwRGF0YShyZXN1bHQpIH07XG4gICAgICB9LFxuICAgICAgZGVsZXRlOiBhc3luYyAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlByb2plY3QuZGVsZXRlKHsgaWQgfSk7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IHVud3JhcERhdGEocmVzdWx0KSB9O1xuICAgICAgfSxcbiAgICAgIGdldFdpdGhSZWxhdGlvbnM6IGFzeW5jIChpZDogc3RyaW5nKSA9PiB7XG4gICAgICAgIC8vIEZldGNoIHByb2plY3QgYW5kIHJlbGF0ZWQgZGF0YSBzZXBhcmF0ZWx5XG4gICAgICAgIGNvbnN0IHByb2plY3QgPSBhd2FpdCBjbGllbnQubW9kZWxzLlByb2plY3QuZ2V0KHsgaWQgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAocHJvamVjdC5kYXRhKSB7XG4gICAgICAgICAgLy8gRmV0Y2ggcmVsYXRlZCBkYXRhIHNlcGFyYXRlbHlcbiAgICAgICAgICBjb25zdCBzdXJ2ZXlMaW5rcyA9IGF3YWl0IGNsaWVudC5tb2RlbHMuU3VydmV5TGluay5saXN0KHtcbiAgICAgICAgICAgIGZpbHRlcjogeyBwcm9qZWN0SWQ6IHsgZXE6IGlkIH0gfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZpcnN0IGdldCBQcm9qZWN0VmVuZG9yIHJlbGF0aW9uc2hpcHMgZm9yIHRoaXMgcHJvamVjdFxuICAgICAgICAgIGNvbnN0IHByb2plY3RWZW5kb3JzID0gYXdhaXQgY2xpZW50Lm1vZGVscy5Qcm9qZWN0VmVuZG9yLmxpc3Qoe1xuICAgICAgICAgICAgZmlsdGVyOiB7IHByb2plY3RJZDogeyBlcTogaWQgfSB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVGhlbiBnZXQgdGhlIGFjdHVhbCB2ZW5kb3JzIGlmIHRoZXJlIGFyZSBwcm9qZWN0LXZlbmRvciByZWxhdGlvbnNoaXBzXG4gICAgICAgICAgY29uc3QgdmVuZG9ySWRzID0gcHJvamVjdFZlbmRvcnMuZGF0YVxuICAgICAgICAgICAgLm1hcCgocHY6IGFueSkgPT4gcHYudmVuZG9ySWQpXG4gICAgICAgICAgICAuZmlsdGVyKChpZDogYW55KTogaWQgaXMgc3RyaW5nID0+IGlkICE9PSBudWxsICYmIGlkICE9PSB1bmRlZmluZWQpO1xuICAgICAgICAgIFxuICAgICAgICAgIGxldCB2ZW5kb3JEYXRhOiBhbnlbXSA9IFtdO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZldGNoIHZlbmRvcnMgaWYgdGhlcmUgYXJlIGFueSByZWxhdGlvbnNoaXBzXG4gICAgICAgICAgaWYgKHZlbmRvcklkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCB2ZW5kb3JSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgICAgICAgIHZlbmRvcklkcy5tYXAoKHZpZDogc3RyaW5nKSA9PiBjbGllbnQubW9kZWxzLlZlbmRvci5nZXQoeyBpZDogdmlkIH0pKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIC8vIEV4dHJhY3QgZGF0YSBmcm9tIGVhY2ggcmVzdWx0XG4gICAgICAgICAgICB2ZW5kb3JEYXRhID0gdmVuZG9yUmVzdWx0c1xuICAgICAgICAgICAgICAuZmlsdGVyKChyZXN1bHQ6IGFueSkgPT4gcmVzdWx0LmRhdGEgIT09IG51bGwpXG4gICAgICAgICAgICAgIC5tYXAoKHJlc3VsdDogYW55KSA9PiByZXN1bHQuZGF0YSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IHF1ZXN0aW9ucyA9IGF3YWl0IGNsaWVudC5tb2RlbHMuUXVlc3Rpb24ubGlzdCh7XG4gICAgICAgICAgICBmaWx0ZXI6IHsgcHJvamVjdElkOiB7IGVxOiBpZCB9IH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDb21iaW5lIHByb2plY3Qgd2l0aCBpdHMgcmVsYXRlZCBkYXRhXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgLi4ucHJvamVjdC5kYXRhLFxuICAgICAgICAgICAgICBzdXJ2ZXlMaW5rczogc3VydmV5TGlua3MuZGF0YSB8fCBbXSxcbiAgICAgICAgICAgICAgdmVuZG9yczogdmVuZG9yRGF0YSxcbiAgICAgICAgICAgICAgcXVlc3Rpb25zOiBxdWVzdGlvbnMuZGF0YSB8fCBbXVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IGRhdGE6IG51bGwgfTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHN1cnZleUxpbmtzOiB7XG4gICAgICBjcmVhdGU6IGFzeW5jIChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xpZW50Lm1vZGVscy5TdXJ2ZXlMaW5rLmNyZWF0ZShkYXRhKTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogdW53cmFwRGF0YShyZXN1bHQpIH07XG4gICAgICB9LFxuICAgICAgZ2V0OiBhc3luYyAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlN1cnZleUxpbmsuZ2V0KHsgaWQgfSk7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IHVud3JhcERhdGEocmVzdWx0KSB9O1xuICAgICAgfSxcbiAgICAgIGdldEJ5VWlkOiBhc3luYyAodWlkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGNsaWVudC5tb2RlbHMuU3VydmV5TGluay5saXN0KHsgZmlsdGVyOiB7IHVpZDogeyBlcTogdWlkIH0gfSB9KTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogKHJlc3VsdHMuZGF0YSAmJiByZXN1bHRzLmRhdGEubGVuZ3RoID4gMCkgPyByZXN1bHRzLmRhdGFbMF0gOiBudWxsIH07XG4gICAgICB9LFxuICAgICAgdXBkYXRlOiBhc3luYyAoaWQ6IHN0cmluZywgZGF0YTogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5tb2RlbHMuU3VydmV5TGluay51cGRhdGUoeyBpZCwgLi4uZGF0YSB9KTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogdW53cmFwRGF0YShyZXN1bHQpIH07XG4gICAgICB9LFxuICAgICAgbGlzdDogYXN5bmMgKGZpbHRlcj86IGFueSkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlN1cnZleUxpbmsubGlzdChmaWx0ZXIpO1xuICAgICAgICByZXR1cm4geyBkYXRhOiByZXN1bHQuZGF0YSB8fCBbXSB9O1xuICAgICAgfSxcbiAgICAgIGxpc3RCeVByb2plY3Q6IGFzeW5jIChwcm9qZWN0SWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlN1cnZleUxpbmsubGlzdCh7IGZpbHRlcjogeyBwcm9qZWN0SWQ6IHsgZXE6IHByb2plY3RJZCB9IH0gfSk7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IHJlc3VsdC5kYXRhIHx8IFtdIH07XG4gICAgICB9LFxuICAgICAgZGVsZXRlOiBhc3luYyAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlN1cnZleUxpbmsuZGVsZXRlKHsgaWQgfSk7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IHVud3JhcERhdGEocmVzdWx0KSB9O1xuICAgICAgfVxuICAgIH0sXG4gICAgdmVuZG9yczoge1xuICAgICAgY3JlYXRlOiBhc3luYyAoZGF0YTogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5tb2RlbHMuVmVuZG9yLmNyZWF0ZShkYXRhKTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogdW53cmFwRGF0YShyZXN1bHQpIH07XG4gICAgICB9LFxuICAgICAgZ2V0OiBhc3luYyAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlZlbmRvci5nZXQoeyBpZCB9KTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogdW53cmFwRGF0YShyZXN1bHQpIH07XG4gICAgICB9LFxuICAgICAgbGlzdDogYXN5bmMgKGZpbHRlcj86IGFueSkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlZlbmRvci5saXN0KGZpbHRlcik7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IHJlc3VsdC5kYXRhIHx8IFtdIH07XG4gICAgICB9LFxuICAgICAgbGlzdEJ5UHJvamVjdDogYXN5bmMgKHByb2plY3RJZDogc3RyaW5nKSA9PiB7XG4gICAgICAgIC8vIEdldCBwcm9qZWN0LXZlbmRvciByZWxhdGlvbnNoaXBzIGZpcnN0XG4gICAgICAgIGNvbnN0IHByb2plY3RWZW5kb3JzID0gYXdhaXQgY2xpZW50Lm1vZGVscy5Qcm9qZWN0VmVuZG9yLmxpc3Qoe1xuICAgICAgICAgIGZpbHRlcjogeyBwcm9qZWN0SWQ6IHsgZXE6IHByb2plY3RJZCB9IH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEdldCB2ZW5kb3IgSURzIGZyb20gcmVsYXRpb25zaGlwc1xuICAgICAgICBjb25zdCB2ZW5kb3JJZHMgPSBwcm9qZWN0VmVuZG9ycy5kYXRhXG4gICAgICAgICAgLm1hcCgocHY6IGFueSkgPT4gcHYudmVuZG9ySWQpXG4gICAgICAgICAgLmZpbHRlcigoaWQ6IGFueSk6IGlkIGlzIHN0cmluZyA9PiBpZCAhPT0gbnVsbCAmJiBpZCAhPT0gdW5kZWZpbmVkKTtcbiAgICAgICAgLy8gRmV0Y2ggZWFjaCB2ZW5kb3IgaW5kaXZpZHVhbGx5IGlmIHRoZXJlIGFyZSBhbnkgcmVsYXRpb25zaGlwc1xuICAgICAgICBpZiAodmVuZG9ySWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCB2ZW5kb3JSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgICAgICB2ZW5kb3JJZHMubWFwKCh2aWQ6IHN0cmluZykgPT4gY2xpZW50Lm1vZGVscy5WZW5kb3IuZ2V0KHsgaWQ6IHZpZCB9KSlcbiAgICAgICAgICApO1xuICAgICAgICAgIC8vIEV4dHJhY3QgZGF0YSBmcm9tIGVhY2ggcmVzdWx0IGFuZCBmaWx0ZXIgb3V0IG51bGxzXG4gICAgICAgICAgY29uc3QgdmVuZG9yRGF0YSA9IHZlbmRvclJlc3VsdHNcbiAgICAgICAgICAgIC5tYXAoKHJlc3VsdDogYW55KSA9PiByZXN1bHQuZGF0YSlcbiAgICAgICAgICAgIC5maWx0ZXIoKHY6IGFueSk6IHYgaXMgTm9uTnVsbGFibGU8dHlwZW9mIHY+ID0+IHYgIT09IG51bGwpO1xuICAgICAgICAgIHJldHVybiB7IGRhdGE6IHZlbmRvckRhdGEgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBkYXRhOiBbXSB9O1xuICAgICAgfSxcbiAgICAgIHVwZGF0ZTogYXN5bmMgKGlkOiBzdHJpbmcsIGRhdGE6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlZlbmRvci51cGRhdGUoeyBpZCwgLi4uZGF0YSB9KTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogdW53cmFwRGF0YShyZXN1bHQpIH07XG4gICAgICB9LFxuICAgICAgZGVsZXRlOiBhc3luYyAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlZlbmRvci5kZWxldGUoeyBpZCB9KTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogdW53cmFwRGF0YShyZXN1bHQpIH07XG4gICAgICB9XG4gICAgfSxcbiAgICBxdWVzdGlvbnM6IHtcbiAgICAgIGNyZWF0ZTogYXN5bmMgKGRhdGE6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlF1ZXN0aW9uLmNyZWF0ZShkYXRhKTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogdW53cmFwRGF0YShyZXN1bHQpIH07XG4gICAgICB9LFxuICAgICAgZ2V0OiBhc3luYyAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlF1ZXN0aW9uLmdldCh7IGlkIH0pO1xuICAgICAgICByZXR1cm4geyBkYXRhOiB1bndyYXBEYXRhKHJlc3VsdCkgfTtcbiAgICAgIH0sXG4gICAgICBsaXN0OiBhc3luYyAoZmlsdGVyPzogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5tb2RlbHMuUXVlc3Rpb24ubGlzdChmaWx0ZXIpO1xuICAgICAgICByZXR1cm4geyBkYXRhOiByZXN1bHQuZGF0YSB8fCBbXSB9O1xuICAgICAgfSxcbiAgICAgIGxpc3RCeVByb2plY3Q6IGFzeW5jIChwcm9qZWN0SWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlF1ZXN0aW9uLmxpc3QoeyBmaWx0ZXI6IHsgcHJvamVjdElkOiB7IGVxOiBwcm9qZWN0SWQgfSB9IH0pO1xuICAgICAgICByZXR1cm4geyBkYXRhOiByZXN1bHQuZGF0YSB8fCBbXSB9O1xuICAgICAgfSxcbiAgICAgIHVwZGF0ZTogYXN5bmMgKGlkOiBzdHJpbmcsIGRhdGE6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQubW9kZWxzLlF1ZXN0aW9uLnVwZGF0ZSh7IGlkLCAuLi5kYXRhIH0pO1xuICAgICAgICByZXR1cm4geyBkYXRhOiB1bndyYXBEYXRhKHJlc3VsdCkgfTtcbiAgICAgIH0sXG4gICAgICBkZWxldGU6IGFzeW5jIChpZDogc3RyaW5nKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5tb2RlbHMuUXVlc3Rpb24uZGVsZXRlKHsgaWQgfSk7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IHVud3JhcERhdGEocmVzdWx0KSB9O1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBIZWxwZXIgZm9yIHRyYW5zYWN0aW9ucyAobm90IGRpcmVjdGx5IHN1cHBvcnRlZCBpbiBBbXBsaWZ5IERhdGEsIHVzaW5nIGJhdGNoIG9wZXJhdGlvbnMpXG4gICAgdHJhbnNhY3Rpb246IHtcbiAgICAgIGV4ZWN1dGU6IGFzeW5jIChvcGVyYXRpb25zOiBhbnlbXSkgPT4ge1xuICAgICAgICAvLyBFeGVjdXRlIG9wZXJhdGlvbnMgaW4gc2VxdWVuY2VcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IG9wZXJhdGlvbiBvZiBvcGVyYXRpb25zKSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgb3BlcmF0aW9uO1xuICAgICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgXG4gIHJldHVybiBhbXBsaWZ5RGF0YVNlcnZpY2U7XG59Il0sIm5hbWVzIjpbImdlbmVyYXRlQ2xpZW50IiwiQW1wbGlmeSIsImdldEFtcGxpZnlDb25maWciLCJhbXBsaWZ5RGF0YVNlcnZpY2UiLCJnZXRBbXBsaWZ5RGF0YVNlcnZpY2UiLCJFcnJvciIsImFtcGxpZnlDb25maWciLCJkYXRhIiwidXJsIiwiY29uZmlndXJlIiwiY2xpZW50IiwiYXV0aE1vZGUiLCJjb25zb2xlIiwibG9nIiwibW9kZWxzIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsImVycm9yIiwicmVxdWlyZWRNb2RlbHMiLCJtb2RlbE5hbWUiLCJ1bndyYXBEYXRhIiwicmVzdWx0IiwiaGFuZGxlQW1wbGlmeUVycm9yIiwib3BlcmF0aW9uIiwiZXJyb3JNZXNzYWdlIiwibWVzc2FnZSIsImVycm9yTmFtZSIsIm5hbWUiLCJwcm9qZWN0cyIsImNyZWF0ZSIsIlByb2plY3QiLCJnZXQiLCJpZCIsImxpc3QiLCJmaWx0ZXIiLCJ1cGRhdGUiLCJkZWxldGUiLCJnZXRXaXRoUmVsYXRpb25zIiwicHJvamVjdCIsInN1cnZleUxpbmtzIiwiU3VydmV5TGluayIsInByb2plY3RJZCIsImVxIiwicHJvamVjdFZlbmRvcnMiLCJQcm9qZWN0VmVuZG9yIiwidmVuZG9ySWRzIiwibWFwIiwicHYiLCJ2ZW5kb3JJZCIsInVuZGVmaW5lZCIsInZlbmRvckRhdGEiLCJ2ZW5kb3JSZXN1bHRzIiwiUHJvbWlzZSIsImFsbCIsInZpZCIsIlZlbmRvciIsInF1ZXN0aW9ucyIsIlF1ZXN0aW9uIiwidmVuZG9ycyIsImdldEJ5VWlkIiwidWlkIiwicmVzdWx0cyIsImxpc3RCeVByb2plY3QiLCJ2IiwidHJhbnNhY3Rpb24iLCJleGVjdXRlIiwib3BlcmF0aW9ucyIsInB1c2giXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/amplify-data-service.ts\n");

/***/ }),

/***/ "(api)/./src/lib/amplify-server-service.ts":
/*!*******************************************!*\
  !*** ./src/lib/amplify-server-service.ts ***!
  \*******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAmplifyServerService: () => (/* binding */ getAmplifyServerService)\n/* harmony export */ });\n/* harmony import */ var aws_amplify__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aws-amplify */ \"aws-amplify\");\n/* harmony import */ var _amplify_outputs_json__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../amplify_outputs.json */ \"(api)/./amplify_outputs.json\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([aws_amplify__WEBPACK_IMPORTED_MODULE_0__]);\naws_amplify__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n// Initialize Amplify\naws_amplify__WEBPACK_IMPORTED_MODULE_0__.Amplify.configure(_amplify_outputs_json__WEBPACK_IMPORTED_MODULE_1__);\nclass AmplifyServerService {\n    constructor(){\n        this.apiEndpoint = _amplify_outputs_json__WEBPACK_IMPORTED_MODULE_1__.data.url;\n        this.apiKey = _amplify_outputs_json__WEBPACK_IMPORTED_MODULE_1__.data.api_key;\n    }\n    async makeGraphQLRequest(query, variables = {}) {\n        try {\n            const response = await fetch(this.apiEndpoint, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"x-api-key\": this.apiKey\n                },\n                body: JSON.stringify({\n                    query,\n                    variables\n                })\n            });\n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            const result = await response.json();\n            if (result.errors) {\n                console.error(`GraphQL errors:`, result.errors);\n            }\n            return result;\n        } catch (error) {\n            console.error(\"GraphQL request failed:\", error);\n            throw error;\n        }\n    }\n    // Project operations\n    async getProject(id) {\n        const query = `\n      query GetProject($id: ID!) {\n        getProject(id: $id) {\n          id\n          name\n          description\n          status\n          targetCompletions\n          currentCompletions\n          surveyUrl\n          settings\n          createdAt\n          updatedAt\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            id\n        });\n        return {\n            data: result.data?.getProject || null\n        };\n    }\n    async listProjects() {\n        const query = `\n      query ListProjects {\n        listProjects {\n          items {\n            id\n            name\n            description\n            status\n            targetCompletions\n            currentCompletions\n            surveyUrl\n            settings\n            createdAt\n            updatedAt\n          }\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query);\n        return {\n            data: result.data?.listProjects?.items || []\n        };\n    }\n    // Vendor operations\n    async getVendor(id) {\n        const query = `\n      query GetVendor($id: ID!) {\n        getVendor(id: $id) {\n          id\n          name\n          contactName\n          contactEmail\n          settings\n          createdAt\n          updatedAt\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            id\n        });\n        return {\n            data: result.data?.getVendor || null\n        };\n    }\n    async listVendors(filter) {\n        const query = `\n      query ListVendors($filter: ModelVendorFilterInput) {\n        listVendors(filter: $filter) {\n          items {\n            id\n            name\n            contactName\n            contactEmail\n            settings\n            createdAt\n            updatedAt\n          }\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            filter\n        });\n        return {\n            data: result.data?.listVendors?.items || []\n        };\n    }\n    async createVendor(input) {\n        const query = `\n      mutation CreateVendor($input: CreateVendorInput!) {\n        createVendor(input: $input) {\n          id\n          name\n          contactName\n          contactEmail\n          settings\n          createdAt\n          updatedAt\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            input\n        });\n        return {\n            data: result.data?.createVendor || null\n        };\n    }\n    async deleteVendor(input) {\n        const query = `\n      mutation DeleteVendor($input: DeleteVendorInput!) {\n        deleteVendor(input: $input) {\n          id\n          name\n          contactName\n          contactEmail\n          settings\n          createdAt\n          updatedAt\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            input\n        });\n        return {\n            data: result.data?.deleteVendor || null\n        };\n    }\n    // SurveyLink operations\n    async createSurveyLink(input) {\n        const query = `\n      mutation CreateSurveyLink($input: CreateSurveyLinkInput!) {\n        createSurveyLink(input: $input) {\n          id\n          projectId\n          uid\n          vendorId\n          status\n          metadata\n          createdAt\n          updatedAt\n          clickedAt\n          completedAt\n          ipAddress\n          userAgent\n          geoData\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            input\n        });\n        return {\n            data: result.data?.createSurveyLink || null\n        };\n    }\n    async listSurveyLinksByProject(projectId) {\n        const query = `\n      query ListSurveyLinks($filter: ModelSurveyLinkFilterInput) {\n        listSurveyLinks(filter: $filter) {\n          items {\n            id\n            projectId\n            uid\n            vendorId\n            status\n            metadata\n            createdAt\n            updatedAt\n            clickedAt\n            completedAt\n            ipAddress\n            userAgent\n            geoData\n          }\n        }\n      }\n    `;\n        const filter = {\n            projectId: {\n                eq: projectId\n            }\n        };\n        const result = await this.makeGraphQLRequest(query, {\n            filter\n        });\n        return {\n            data: result.data?.listSurveyLinks?.items || []\n        };\n    }\n    async getSurveyLinkByUid(uid) {\n        const query = `\n      query ListSurveyLinks($filter: ModelSurveyLinkFilterInput) {\n        listSurveyLinks(filter: $filter) {\n          items {\n            id\n            projectId\n            uid\n            vendorId\n            status\n            metadata\n            createdAt\n            updatedAt\n            clickedAt\n            completedAt\n            ipAddress\n            userAgent\n            geoData\n          }\n        }\n      }\n    `;\n        const filter = {\n            uid: {\n                eq: uid\n            }\n        };\n        const result = await this.makeGraphQLRequest(query, {\n            filter\n        });\n        const items = result.data?.listSurveyLinks?.items || [];\n        return {\n            data: items.length > 0 ? items[0] : null\n        };\n    }\n    async updateSurveyLink(id, input) {\n        const query = `\n      mutation UpdateSurveyLink($input: UpdateSurveyLinkInput!) {\n        updateSurveyLink(input: $input) {\n          id\n          projectId\n          uid\n          vendorId\n          status\n          metadata\n          createdAt\n          updatedAt\n          clickedAt\n          completedAt\n          ipAddress\n          userAgent\n          geoData\n        }\n      }\n    `;\n        const updateInput = {\n            id,\n            ...input\n        };\n        const result = await this.makeGraphQLRequest(query, {\n            input: updateInput\n        });\n        return {\n            data: result.data?.updateSurveyLink || null\n        };\n    }\n    // Question operations\n    async createQuestion(input) {\n        const query = `\n      mutation CreateQuestion($input: CreateQuestionInput!) {\n        createQuestion(input: $input) {\n          id\n          projectId\n          text\n          type\n          options\n          sequence\n          isRequired\n          isTrap\n          settings\n          createdAt\n          updatedAt\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            input\n        });\n        return {\n            data: result.data?.createQuestion || null\n        };\n    }\n    async listQuestionsByProject(projectId) {\n        const query = `\n      query ListQuestions($filter: ModelQuestionFilterInput) {\n        listQuestions(filter: $filter) {\n          items {\n            id\n            projectId\n            text\n            type\n            options\n            sequence\n            isRequired\n            isTrap\n            settings\n            createdAt\n            updatedAt\n          }\n        }\n      }\n    `;\n        const filter = {\n            projectId: {\n                eq: projectId\n            }\n        };\n        const result = await this.makeGraphQLRequest(query, {\n            filter\n        });\n        return {\n            data: result.data?.listQuestions?.items || []\n        };\n    }\n    async deleteQuestion(id) {\n        const query = `\n      mutation DeleteQuestion($input: DeleteQuestionInput!) {\n        deleteQuestion(input: $input) {\n          id\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            input: {\n                id\n            }\n        });\n        return {\n            data: result.data?.deleteQuestion || null\n        };\n    }\n    // Response operations\n    async createResponse(input) {\n        const query = `\n      mutation CreateResponse($input: CreateResponseInput!) {\n        createResponse(input: $input) {\n          id\n          surveyLinkId\n          questionId\n          answer\n          metadata\n          createdAt\n          updatedAt\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            input\n        });\n        return {\n            data: result.data?.createResponse || null\n        };\n    }\n    async listResponsesBySurveyLink(surveyLinkId) {\n        const query = `\n      query ListResponses($filter: ModelResponseFilterInput) {\n        listResponses(filter: $filter) {\n          items {\n            id\n            surveyLinkId\n            questionId\n            answer\n            metadata\n            createdAt\n            updatedAt\n          }\n        }\n      }\n    `;\n        const filter = {\n            surveyLinkId: {\n                eq: surveyLinkId\n            }\n        };\n        const result = await this.makeGraphQLRequest(query, {\n            filter\n        });\n        return {\n            data: result.data?.listResponses?.items || []\n        };\n    }\n    // ProjectVendor operations\n    async listProjectVendors(filter) {\n        const query = `\n      query ListProjectVendors($filter: ModelProjectVendorFilterInput) {\n        listProjectVendors(filter: $filter) {\n          items {\n            id\n            projectId\n            vendorId\n            quota\n            currentCount\n            createdAt\n            updatedAt\n          }\n        }\n      }\n    `;\n        const result = await this.makeGraphQLRequest(query, {\n            filter\n        });\n        return {\n            data: result.data?.listProjectVendors?.items || []\n        };\n    }\n    async createProjectVendor(input) {\n        const query = `\n      mutation CreateProjectVendor($input: CreateProjectVendorInput!) {\n        createProjectVendor(input: $input) {\n          id\n          projectId\n          vendorId\n          quota\n          currentCount\n          createdAt\n          updatedAt\n        }\n      }\n    `;\n        const createInput = {\n            projectId: input.projectId,\n            vendorId: input.vendorId,\n            quota: input.quota || 0,\n            currentCount: input.currentCount || 0\n        };\n        const result = await this.makeGraphQLRequest(query, {\n            input: createInput\n        });\n        return {\n            data: result.data?.createProjectVendor || null\n        };\n    }\n    async updateProjectVendor(projectId, vendorId, updates) {\n        // First find the ProjectVendor record\n        const existingResult = await this.listProjectVendors({\n            and: [\n                {\n                    projectId: {\n                        eq: projectId\n                    }\n                },\n                {\n                    vendorId: {\n                        eq: vendorId\n                    }\n                }\n            ]\n        });\n        if (existingResult.data.length === 0) {\n            return {\n                data: null\n            };\n        }\n        const projectVendor = existingResult.data[0];\n        const query = `\n      mutation UpdateProjectVendor($input: UpdateProjectVendorInput!) {\n        updateProjectVendor(input: $input) {\n          id\n          projectId\n          vendorId\n          quota\n          currentCount\n          createdAt\n          updatedAt\n        }\n      }\n    `;\n        const input = {\n            id: projectVendor.id,\n            ...updates\n        };\n        const result = await this.makeGraphQLRequest(query, {\n            input\n        });\n        return {\n            data: result.data?.updateProjectVendor || null\n        };\n    }\n}\n// Create a singleton instance\nlet serverService = null;\nfunction getAmplifyServerService() {\n    if (!serverService) {\n        serverService = new AmplifyServerService();\n    }\n    return serverService;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL2FtcGxpZnktc2VydmVyLXNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQXNDO0FBQ1c7QUFFakQscUJBQXFCO0FBQ3JCQSxnREFBT0EsQ0FBQ0UsU0FBUyxDQUFDRCxrREFBT0E7QUFpRnpCLE1BQU1FO0lBSUpDLGFBQWM7UUFDWixJQUFJLENBQUNDLFdBQVcsR0FBR0osdURBQVksQ0FBQ00sR0FBRztRQUNuQyxJQUFJLENBQUNDLE1BQU0sR0FBR1AsdURBQVksQ0FBQ1EsT0FBTztJQUNwQztJQUVBLE1BQWNDLG1CQUFzQkMsS0FBYSxFQUFFQyxZQUFpQixDQUFDLENBQUMsRUFBK0I7UUFDbkcsSUFBSTtZQUNGLE1BQU1DLFdBQVcsTUFBTUMsTUFBTSxJQUFJLENBQUNULFdBQVcsRUFBRTtnQkFDN0NVLFFBQVE7Z0JBQ1JDLFNBQVM7b0JBQ1AsZ0JBQWdCO29CQUNoQixhQUFhLElBQUksQ0FBQ1IsTUFBTTtnQkFDMUI7Z0JBQ0FTLE1BQU1DLEtBQUtDLFNBQVMsQ0FBQztvQkFDbkJSO29CQUNBQztnQkFDRjtZQUNGO1lBRUEsSUFBSSxDQUFDQyxTQUFTTyxFQUFFLEVBQUU7Z0JBQ2hCLE1BQU0sSUFBSUMsTUFBTSxDQUFDLG9CQUFvQixFQUFFUixTQUFTUyxNQUFNLENBQUMsQ0FBQztZQUMxRDtZQUVBLE1BQU1DLFNBQVMsTUFBTVYsU0FBU1csSUFBSTtZQUVsQyxJQUFJRCxPQUFPRSxNQUFNLEVBQUU7Z0JBQ2pCQyxRQUFRQyxLQUFLLENBQUMsQ0FBQyxlQUFlLENBQUMsRUFBRUosT0FBT0UsTUFBTTtZQUNoRDtZQUVBLE9BQU9GO1FBQ1QsRUFBRSxPQUFPSSxPQUFPO1lBQ2RELFFBQVFDLEtBQUssQ0FBQywyQkFBMkJBO1lBQ3pDLE1BQU1BO1FBQ1I7SUFDRjtJQUVBLHFCQUFxQjtJQUNyQixNQUFNQyxXQUFXQyxFQUFVLEVBQXFDO1FBQzlELE1BQU1sQixRQUFRLENBQUM7Ozs7Ozs7Ozs7Ozs7OztJQWVmLENBQUM7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QUFFOUIsTUFBTWlCLE9BQU9qQixJQUFJLEVBQUV3RCx1QkFBdUI7UUFBSztJQUMxRDtBQUNGO0FBRUEsOEJBQThCO0FBQzlCLElBQUlLLGdCQUE2QztBQUUxQyxTQUFTQztJQUNkLElBQUksQ0FBQ0QsZUFBZTtRQUNsQkEsZ0JBQWdCLElBQUloRTtJQUN0QjtJQUNBLE9BQU9nRTtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3VydmV5LWxpbmstd3JhcHBlci8uL3NyYy9saWIvYW1wbGlmeS1zZXJ2ZXItc2VydmljZS50cz9lYjk1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFtcGxpZnkgfSBmcm9tICdhd3MtYW1wbGlmeSc7XG5pbXBvcnQgb3V0cHV0cyBmcm9tICcuLi8uLi9hbXBsaWZ5X291dHB1dHMuanNvbic7XG5cbi8vIEluaXRpYWxpemUgQW1wbGlmeVxuQW1wbGlmeS5jb25maWd1cmUob3V0cHV0cyk7XG5cbi8vIFR5cGUgZGVmaW5pdGlvbnMgbWF0Y2hpbmcgdGhlIHNjaGVtYVxudHlwZSBQcm9qZWN0U3RhdHVzID0gJ0FDVElWRScgfCAnUEFVU0VEJyB8ICdDT01QTEVURUQnO1xudHlwZSBTdXJ2ZXlMaW5rU3RhdHVzID0gJ1VOVVNFRCcgfCAnQ0xJQ0tFRCcgfCAnQ09NUExFVEVEJyB8ICdESVNRVUFMSUZJRUQnIHwgJ1FVT1RBX0ZVTEwnO1xuXG5pbnRlcmZhY2UgUHJvamVjdCB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIHN0YXR1czogUHJvamVjdFN0YXR1cztcbiAgdGFyZ2V0Q29tcGxldGlvbnM6IG51bWJlcjtcbiAgY3VycmVudENvbXBsZXRpb25zOiBudW1iZXI7XG4gIHN1cnZleVVybDogc3RyaW5nO1xuICBzZXR0aW5ncz86IGFueTtcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XG4gIHVwZGF0ZWRBdDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgVmVuZG9yIHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBjb250YWN0TmFtZT86IHN0cmluZztcbiAgY29udGFjdEVtYWlsPzogc3RyaW5nO1xuICBzZXR0aW5ncz86IGFueTtcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XG4gIHVwZGF0ZWRBdDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgU3VydmV5TGluayB7XG4gIGlkOiBzdHJpbmc7XG4gIHByb2plY3RJZDogc3RyaW5nO1xuICB1aWQ6IHN0cmluZztcbiAgdmVuZG9ySWQ/OiBzdHJpbmc7XG4gIHN0YXR1czogU3VydmV5TGlua1N0YXR1cztcbiAgY2xpY2tlZEF0Pzogc3RyaW5nO1xuICBjb21wbGV0ZWRBdD86IHN0cmluZztcbiAgaXBBZGRyZXNzPzogc3RyaW5nO1xuICB1c2VyQWdlbnQ/OiBzdHJpbmc7XG4gIGdlb0RhdGE/OiBhbnk7XG4gIG1ldGFkYXRhPzogYW55O1xuICBjcmVhdGVkQXQ6IHN0cmluZztcbiAgdXBkYXRlZEF0OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBRdWVzdGlvbiB7XG4gIGlkOiBzdHJpbmc7XG4gIHByb2plY3RJZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbiAgb3B0aW9ucz86IGFueTtcbiAgc2VxdWVuY2U6IG51bWJlcjtcbiAgaXNSZXF1aXJlZDogYm9vbGVhbjtcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XG4gIHVwZGF0ZWRBdDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgUmVzcG9uc2Uge1xuICBpZDogc3RyaW5nO1xuICBzdXJ2ZXlMaW5rSWQ6IHN0cmluZztcbiAgcXVlc3Rpb25JZDogc3RyaW5nO1xuICBhbnN3ZXI6IHN0cmluZztcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XG4gIHVwZGF0ZWRBdDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgUHJvamVjdFZlbmRvciB7XG4gIGlkOiBzdHJpbmc7XG4gIHByb2plY3RJZDogc3RyaW5nO1xuICB2ZW5kb3JJZDogc3RyaW5nO1xuICBxdW90YTogbnVtYmVyO1xuICBjdXJyZW50Q291bnQ6IG51bWJlcjtcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XG4gIHVwZGF0ZWRBdDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgR3JhcGhRTFJlc3BvbnNlPFQ+IHtcbiAgZGF0YT86IFQ7XG4gIGVycm9ycz86IEFycmF5PHsgbWVzc2FnZTogc3RyaW5nIH0+O1xufVxuXG5jbGFzcyBBbXBsaWZ5U2VydmVyU2VydmljZSB7XG4gIHByaXZhdGUgYXBpRW5kcG9pbnQ6IHN0cmluZztcbiAgcHJpdmF0ZSBhcGlLZXk6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmFwaUVuZHBvaW50ID0gb3V0cHV0cy5kYXRhLnVybDtcbiAgICB0aGlzLmFwaUtleSA9IG91dHB1dHMuZGF0YS5hcGlfa2V5O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBtYWtlR3JhcGhRTFJlcXVlc3Q8VD4ocXVlcnk6IHN0cmluZywgdmFyaWFibGVzOiBhbnkgPSB7fSk6IFByb21pc2U8R3JhcGhRTFJlc3BvbnNlPFQ+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy5hcGlFbmRwb2ludCwge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgJ3gtYXBpLWtleSc6IHRoaXMuYXBpS2V5LFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgcXVlcnksXG4gICAgICAgICAgdmFyaWFibGVzLFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgc3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgXG4gICAgICBpZiAocmVzdWx0LmVycm9ycykge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBHcmFwaFFMIGVycm9yczpgLCByZXN1bHQuZXJyb3JzKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignR3JhcGhRTCByZXF1ZXN0IGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyBQcm9qZWN0IG9wZXJhdGlvbnNcbiAgYXN5bmMgZ2V0UHJvamVjdChpZDogc3RyaW5nKTogUHJvbWlzZTx7IGRhdGE6IFByb2plY3QgfCBudWxsIH0+IHtcbiAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgIHF1ZXJ5IEdldFByb2plY3QoJGlkOiBJRCEpIHtcbiAgICAgICAgZ2V0UHJvamVjdChpZDogJGlkKSB7XG4gICAgICAgICAgaWRcbiAgICAgICAgICBuYW1lXG4gICAgICAgICAgZGVzY3JpcHRpb25cbiAgICAgICAgICBzdGF0dXNcbiAgICAgICAgICB0YXJnZXRDb21wbGV0aW9uc1xuICAgICAgICAgIGN1cnJlbnRDb21wbGV0aW9uc1xuICAgICAgICAgIHN1cnZleVVybFxuICAgICAgICAgIHNldHRpbmdzXG4gICAgICAgICAgY3JlYXRlZEF0XG4gICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tYWtlR3JhcGhRTFJlcXVlc3Q8eyBnZXRQcm9qZWN0OiBQcm9qZWN0IH0+KHF1ZXJ5LCB7IGlkIH0pO1xuICAgIHJldHVybiB7IGRhdGE6IHJlc3VsdC5kYXRhPy5nZXRQcm9qZWN0IHx8IG51bGwgfTtcbiAgfVxuXG4gIGFzeW5jIGxpc3RQcm9qZWN0cygpOiBQcm9taXNlPHsgZGF0YTogUHJvamVjdFtdIH0+IHtcbiAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgIHF1ZXJ5IExpc3RQcm9qZWN0cyB7XG4gICAgICAgIGxpc3RQcm9qZWN0cyB7XG4gICAgICAgICAgaXRlbXMge1xuICAgICAgICAgICAgaWRcbiAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uXG4gICAgICAgICAgICBzdGF0dXNcbiAgICAgICAgICAgIHRhcmdldENvbXBsZXRpb25zXG4gICAgICAgICAgICBjdXJyZW50Q29tcGxldGlvbnNcbiAgICAgICAgICAgIHN1cnZleVVybFxuICAgICAgICAgICAgc2V0dGluZ3NcbiAgICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgYDtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWFrZUdyYXBoUUxSZXF1ZXN0PHsgbGlzdFByb2plY3RzOiB7IGl0ZW1zOiBQcm9qZWN0W10gfSB9PihxdWVyeSk7XG4gICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LmRhdGE/Lmxpc3RQcm9qZWN0cz8uaXRlbXMgfHwgW10gfTtcbiAgfVxuXG4gIC8vIFZlbmRvciBvcGVyYXRpb25zXG4gIGFzeW5jIGdldFZlbmRvcihpZDogc3RyaW5nKTogUHJvbWlzZTx7IGRhdGE6IFZlbmRvciB8IG51bGwgfT4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgcXVlcnkgR2V0VmVuZG9yKCRpZDogSUQhKSB7XG4gICAgICAgIGdldFZlbmRvcihpZDogJGlkKSB7XG4gICAgICAgICAgaWRcbiAgICAgICAgICBuYW1lXG4gICAgICAgICAgY29udGFjdE5hbWVcbiAgICAgICAgICBjb250YWN0RW1haWxcbiAgICAgICAgICBzZXR0aW5nc1xuICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICAgIHVwZGF0ZWRBdFxuICAgICAgICB9XG4gICAgICB9XG4gICAgYDtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWFrZUdyYXBoUUxSZXF1ZXN0PHsgZ2V0VmVuZG9yOiBWZW5kb3IgfT4ocXVlcnksIHsgaWQgfSk7XG4gICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LmRhdGE/LmdldFZlbmRvciB8fCBudWxsIH07XG4gIH1cblxuICBhc3luYyBsaXN0VmVuZG9ycyhmaWx0ZXI/OiBhbnkpOiBQcm9taXNlPHsgZGF0YTogVmVuZG9yW10gfT4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgcXVlcnkgTGlzdFZlbmRvcnMoJGZpbHRlcjogTW9kZWxWZW5kb3JGaWx0ZXJJbnB1dCkge1xuICAgICAgICBsaXN0VmVuZG9ycyhmaWx0ZXI6ICRmaWx0ZXIpIHtcbiAgICAgICAgICBpdGVtcyB7XG4gICAgICAgICAgICBpZFxuICAgICAgICAgICAgbmFtZVxuICAgICAgICAgICAgY29udGFjdE5hbWVcbiAgICAgICAgICAgIGNvbnRhY3RFbWFpbFxuICAgICAgICAgICAgc2V0dGluZ3NcbiAgICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgYDtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWFrZUdyYXBoUUxSZXF1ZXN0PHsgbGlzdFZlbmRvcnM6IHsgaXRlbXM6IFZlbmRvcltdIH0gfT4ocXVlcnksIHsgZmlsdGVyIH0pO1xuICAgIHJldHVybiB7IGRhdGE6IHJlc3VsdC5kYXRhPy5saXN0VmVuZG9ycz8uaXRlbXMgfHwgW10gfTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVZlbmRvcihpbnB1dDoge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBjb250YWN0TmFtZT86IHN0cmluZztcbiAgICBjb250YWN0RW1haWw/OiBzdHJpbmc7XG4gICAgc2V0dGluZ3M/OiBzdHJpbmc7XG4gIH0pOiBQcm9taXNlPHsgZGF0YTogVmVuZG9yIHwgbnVsbCB9PiB7XG4gICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICBtdXRhdGlvbiBDcmVhdGVWZW5kb3IoJGlucHV0OiBDcmVhdGVWZW5kb3JJbnB1dCEpIHtcbiAgICAgICAgY3JlYXRlVmVuZG9yKGlucHV0OiAkaW5wdXQpIHtcbiAgICAgICAgICBpZFxuICAgICAgICAgIG5hbWVcbiAgICAgICAgICBjb250YWN0TmFtZVxuICAgICAgICAgIGNvbnRhY3RFbWFpbFxuICAgICAgICAgIHNldHRpbmdzXG4gICAgICAgICAgY3JlYXRlZEF0XG4gICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tYWtlR3JhcGhRTFJlcXVlc3Q8eyBjcmVhdGVWZW5kb3I6IFZlbmRvciB9PihxdWVyeSwgeyBpbnB1dCB9KTtcbiAgICByZXR1cm4geyBkYXRhOiByZXN1bHQuZGF0YT8uY3JlYXRlVmVuZG9yIHx8IG51bGwgfTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVZlbmRvcihpbnB1dDogeyBpZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgZGF0YTogVmVuZG9yIHwgbnVsbCB9PiB7XG4gICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICBtdXRhdGlvbiBEZWxldGVWZW5kb3IoJGlucHV0OiBEZWxldGVWZW5kb3JJbnB1dCEpIHtcbiAgICAgICAgZGVsZXRlVmVuZG9yKGlucHV0OiAkaW5wdXQpIHtcbiAgICAgICAgICBpZFxuICAgICAgICAgIG5hbWVcbiAgICAgICAgICBjb250YWN0TmFtZVxuICAgICAgICAgIGNvbnRhY3RFbWFpbFxuICAgICAgICAgIHNldHRpbmdzXG4gICAgICAgICAgY3JlYXRlZEF0XG4gICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tYWtlR3JhcGhRTFJlcXVlc3Q8eyBkZWxldGVWZW5kb3I6IFZlbmRvciB9PihxdWVyeSwgeyBpbnB1dCB9KTtcbiAgICByZXR1cm4geyBkYXRhOiByZXN1bHQuZGF0YT8uZGVsZXRlVmVuZG9yIHx8IG51bGwgfTtcbiAgfVxuXG4gIC8vIFN1cnZleUxpbmsgb3BlcmF0aW9uc1xuICBhc3luYyBjcmVhdGVTdXJ2ZXlMaW5rKGlucHV0OiB7XG4gICAgcHJvamVjdElkOiBzdHJpbmc7XG4gICAgdWlkOiBzdHJpbmc7XG4gICAgdmVuZG9ySWQ/OiBzdHJpbmc7XG4gICAgc3RhdHVzOiBzdHJpbmc7XG4gICAgbWV0YWRhdGE/OiBzdHJpbmc7XG4gICAgZ2VvRGF0YT86IGFueTtcbiAgfSk6IFByb21pc2U8eyBkYXRhOiBTdXJ2ZXlMaW5rIHwgbnVsbCB9PiB7XG4gICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICBtdXRhdGlvbiBDcmVhdGVTdXJ2ZXlMaW5rKCRpbnB1dDogQ3JlYXRlU3VydmV5TGlua0lucHV0ISkge1xuICAgICAgICBjcmVhdGVTdXJ2ZXlMaW5rKGlucHV0OiAkaW5wdXQpIHtcbiAgICAgICAgICBpZFxuICAgICAgICAgIHByb2plY3RJZFxuICAgICAgICAgIHVpZFxuICAgICAgICAgIHZlbmRvcklkXG4gICAgICAgICAgc3RhdHVzXG4gICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICBjcmVhdGVkQXRcbiAgICAgICAgICB1cGRhdGVkQXRcbiAgICAgICAgICBjbGlja2VkQXRcbiAgICAgICAgICBjb21wbGV0ZWRBdFxuICAgICAgICAgIGlwQWRkcmVzc1xuICAgICAgICAgIHVzZXJBZ2VudFxuICAgICAgICAgIGdlb0RhdGFcbiAgICAgICAgfVxuICAgICAgfVxuICAgIGA7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLm1ha2VHcmFwaFFMUmVxdWVzdDx7IGNyZWF0ZVN1cnZleUxpbms6IFN1cnZleUxpbmsgfT4ocXVlcnksIHsgaW5wdXQgfSk7XG4gICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LmRhdGE/LmNyZWF0ZVN1cnZleUxpbmsgfHwgbnVsbCB9O1xuICB9XG5cbiAgYXN5bmMgbGlzdFN1cnZleUxpbmtzQnlQcm9qZWN0KHByb2plY3RJZDogc3RyaW5nKTogUHJvbWlzZTx7IGRhdGE6IFN1cnZleUxpbmtbXSB9PiB7XG4gICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICBxdWVyeSBMaXN0U3VydmV5TGlua3MoJGZpbHRlcjogTW9kZWxTdXJ2ZXlMaW5rRmlsdGVySW5wdXQpIHtcbiAgICAgICAgbGlzdFN1cnZleUxpbmtzKGZpbHRlcjogJGZpbHRlcikge1xuICAgICAgICAgIGl0ZW1zIHtcbiAgICAgICAgICAgIGlkXG4gICAgICAgICAgICBwcm9qZWN0SWRcbiAgICAgICAgICAgIHVpZFxuICAgICAgICAgICAgdmVuZG9ySWRcbiAgICAgICAgICAgIHN0YXR1c1xuICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgICAgICBjbGlja2VkQXRcbiAgICAgICAgICAgIGNvbXBsZXRlZEF0XG4gICAgICAgICAgICBpcEFkZHJlc3NcbiAgICAgICAgICAgIHVzZXJBZ2VudFxuICAgICAgICAgICAgZ2VvRGF0YVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIGA7XG5cbiAgICBjb25zdCBmaWx0ZXIgPSB7XG4gICAgICBwcm9qZWN0SWQ6IHsgZXE6IHByb2plY3RJZCB9XG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWFrZUdyYXBoUUxSZXF1ZXN0PHsgbGlzdFN1cnZleUxpbmtzOiB7IGl0ZW1zOiBTdXJ2ZXlMaW5rW10gfSB9PihxdWVyeSwgeyBmaWx0ZXIgfSk7XG4gICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LmRhdGE/Lmxpc3RTdXJ2ZXlMaW5rcz8uaXRlbXMgfHwgW10gfTtcbiAgfVxuXG4gIGFzeW5jIGdldFN1cnZleUxpbmtCeVVpZCh1aWQ6IHN0cmluZyk6IFByb21pc2U8eyBkYXRhOiBTdXJ2ZXlMaW5rIHwgbnVsbCB9PiB7XG4gICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICBxdWVyeSBMaXN0U3VydmV5TGlua3MoJGZpbHRlcjogTW9kZWxTdXJ2ZXlMaW5rRmlsdGVySW5wdXQpIHtcbiAgICAgICAgbGlzdFN1cnZleUxpbmtzKGZpbHRlcjogJGZpbHRlcikge1xuICAgICAgICAgIGl0ZW1zIHtcbiAgICAgICAgICAgIGlkXG4gICAgICAgICAgICBwcm9qZWN0SWRcbiAgICAgICAgICAgIHVpZFxuICAgICAgICAgICAgdmVuZG9ySWRcbiAgICAgICAgICAgIHN0YXR1c1xuICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgICAgICBjbGlja2VkQXRcbiAgICAgICAgICAgIGNvbXBsZXRlZEF0XG4gICAgICAgICAgICBpcEFkZHJlc3NcbiAgICAgICAgICAgIHVzZXJBZ2VudFxuICAgICAgICAgICAgZ2VvRGF0YVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIGA7XG5cbiAgICBjb25zdCBmaWx0ZXIgPSB7XG4gICAgICB1aWQ6IHsgZXE6IHVpZCB9XG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWFrZUdyYXBoUUxSZXF1ZXN0PHsgbGlzdFN1cnZleUxpbmtzOiB7IGl0ZW1zOiBTdXJ2ZXlMaW5rW10gfSB9PihxdWVyeSwgeyBmaWx0ZXIgfSk7XG4gICAgY29uc3QgaXRlbXMgPSByZXN1bHQuZGF0YT8ubGlzdFN1cnZleUxpbmtzPy5pdGVtcyB8fCBbXTtcbiAgICByZXR1cm4geyBkYXRhOiBpdGVtcy5sZW5ndGggPiAwID8gaXRlbXNbMF0gOiBudWxsIH07XG4gIH1cblxuICBhc3luYyB1cGRhdGVTdXJ2ZXlMaW5rKGlkOiBzdHJpbmcsIGlucHV0OiB7XG4gICAgc3RhdHVzPzogc3RyaW5nO1xuICAgIGNsaWNrZWRBdD86IHN0cmluZztcbiAgICBjb21wbGV0ZWRBdD86IHN0cmluZztcbiAgICBpcEFkZHJlc3M/OiBzdHJpbmc7XG4gICAgdXNlckFnZW50Pzogc3RyaW5nO1xuICAgIGdlb0RhdGE/OiBhbnk7XG4gICAgbWV0YWRhdGE/OiBzdHJpbmc7XG4gIH0pOiBQcm9taXNlPHsgZGF0YTogU3VydmV5TGluayB8IG51bGwgfT4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgbXV0YXRpb24gVXBkYXRlU3VydmV5TGluaygkaW5wdXQ6IFVwZGF0ZVN1cnZleUxpbmtJbnB1dCEpIHtcbiAgICAgICAgdXBkYXRlU3VydmV5TGluayhpbnB1dDogJGlucHV0KSB7XG4gICAgICAgICAgaWRcbiAgICAgICAgICBwcm9qZWN0SWRcbiAgICAgICAgICB1aWRcbiAgICAgICAgICB2ZW5kb3JJZFxuICAgICAgICAgIHN0YXR1c1xuICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICAgY3JlYXRlZEF0XG4gICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgICAgY2xpY2tlZEF0XG4gICAgICAgICAgY29tcGxldGVkQXRcbiAgICAgICAgICBpcEFkZHJlc3NcbiAgICAgICAgICB1c2VyQWdlbnRcbiAgICAgICAgICBnZW9EYXRhXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgO1xuXG4gICAgY29uc3QgdXBkYXRlSW5wdXQgPSB7IGlkLCAuLi5pbnB1dCB9O1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWFrZUdyYXBoUUxSZXF1ZXN0PHsgdXBkYXRlU3VydmV5TGluazogU3VydmV5TGluayB9PihxdWVyeSwgeyBpbnB1dDogdXBkYXRlSW5wdXQgfSk7XG4gICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LmRhdGE/LnVwZGF0ZVN1cnZleUxpbmsgfHwgbnVsbCB9O1xuICB9XG5cbiAgLy8gUXVlc3Rpb24gb3BlcmF0aW9uc1xuICBhc3luYyBjcmVhdGVRdWVzdGlvbihpbnB1dDoge1xuICAgIHByb2plY3RJZDogc3RyaW5nO1xuICAgIHRleHQ6IHN0cmluZztcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgb3B0aW9ucz86IGFueTtcbiAgICBzZXF1ZW5jZTogbnVtYmVyO1xuICAgIGlzUmVxdWlyZWQ/OiBib29sZWFuO1xuICAgIGlzVHJhcD86IGJvb2xlYW47XG4gICAgc2V0dGluZ3M/OiBhbnk7XG4gIH0pOiBQcm9taXNlPHsgZGF0YTogYW55IHwgbnVsbCB9PiB7XG4gICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICBtdXRhdGlvbiBDcmVhdGVRdWVzdGlvbigkaW5wdXQ6IENyZWF0ZVF1ZXN0aW9uSW5wdXQhKSB7XG4gICAgICAgIGNyZWF0ZVF1ZXN0aW9uKGlucHV0OiAkaW5wdXQpIHtcbiAgICAgICAgICBpZFxuICAgICAgICAgIHByb2plY3RJZFxuICAgICAgICAgIHRleHRcbiAgICAgICAgICB0eXBlXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICAgIHNlcXVlbmNlXG4gICAgICAgICAgaXNSZXF1aXJlZFxuICAgICAgICAgIGlzVHJhcFxuICAgICAgICAgIHNldHRpbmdzXG4gICAgICAgICAgY3JlYXRlZEF0XG4gICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tYWtlR3JhcGhRTFJlcXVlc3Q8eyBjcmVhdGVRdWVzdGlvbjogYW55IH0+KHF1ZXJ5LCB7IGlucHV0IH0pO1xuICAgIHJldHVybiB7IGRhdGE6IHJlc3VsdC5kYXRhPy5jcmVhdGVRdWVzdGlvbiB8fCBudWxsIH07XG4gIH1cblxuICBhc3luYyBsaXN0UXVlc3Rpb25zQnlQcm9qZWN0KHByb2plY3RJZDogc3RyaW5nKTogUHJvbWlzZTx7IGRhdGE6IGFueVtdIH0+IHtcbiAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgIHF1ZXJ5IExpc3RRdWVzdGlvbnMoJGZpbHRlcjogTW9kZWxRdWVzdGlvbkZpbHRlcklucHV0KSB7XG4gICAgICAgIGxpc3RRdWVzdGlvbnMoZmlsdGVyOiAkZmlsdGVyKSB7XG4gICAgICAgICAgaXRlbXMge1xuICAgICAgICAgICAgaWRcbiAgICAgICAgICAgIHByb2plY3RJZFxuICAgICAgICAgICAgdGV4dFxuICAgICAgICAgICAgdHlwZVxuICAgICAgICAgICAgb3B0aW9uc1xuICAgICAgICAgICAgc2VxdWVuY2VcbiAgICAgICAgICAgIGlzUmVxdWlyZWRcbiAgICAgICAgICAgIGlzVHJhcFxuICAgICAgICAgICAgc2V0dGluZ3NcbiAgICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgYDtcblxuICAgIGNvbnN0IGZpbHRlciA9IHtcbiAgICAgIHByb2plY3RJZDogeyBlcTogcHJvamVjdElkIH1cbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tYWtlR3JhcGhRTFJlcXVlc3Q8eyBsaXN0UXVlc3Rpb25zOiB7IGl0ZW1zOiBhbnlbXSB9IH0+KHF1ZXJ5LCB7IGZpbHRlciB9KTtcbiAgICByZXR1cm4geyBkYXRhOiByZXN1bHQuZGF0YT8ubGlzdFF1ZXN0aW9ucz8uaXRlbXMgfHwgW10gfTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVF1ZXN0aW9uKGlkOiBzdHJpbmcpOiBQcm9taXNlPHsgZGF0YTogYW55IHwgbnVsbCB9PiB7XG4gICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICBtdXRhdGlvbiBEZWxldGVRdWVzdGlvbigkaW5wdXQ6IERlbGV0ZVF1ZXN0aW9uSW5wdXQhKSB7XG4gICAgICAgIGRlbGV0ZVF1ZXN0aW9uKGlucHV0OiAkaW5wdXQpIHtcbiAgICAgICAgICBpZFxuICAgICAgICB9XG4gICAgICB9XG4gICAgYDtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWFrZUdyYXBoUUxSZXF1ZXN0PHsgZGVsZXRlUXVlc3Rpb246IGFueSB9PihxdWVyeSwgeyBpbnB1dDogeyBpZCB9IH0pO1xuICAgIHJldHVybiB7IGRhdGE6IHJlc3VsdC5kYXRhPy5kZWxldGVRdWVzdGlvbiB8fCBudWxsIH07XG4gIH1cblxuICAvLyBSZXNwb25zZSBvcGVyYXRpb25zXG4gIGFzeW5jIGNyZWF0ZVJlc3BvbnNlKGlucHV0OiB7XG4gICAgc3VydmV5TGlua0lkOiBzdHJpbmc7XG4gICAgcXVlc3Rpb25JZDogc3RyaW5nO1xuICAgIGFuc3dlcjogc3RyaW5nO1xuICAgIG1ldGFkYXRhPzogYW55O1xuICB9KTogUHJvbWlzZTx7IGRhdGE6IGFueSB8IG51bGwgfT4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgbXV0YXRpb24gQ3JlYXRlUmVzcG9uc2UoJGlucHV0OiBDcmVhdGVSZXNwb25zZUlucHV0ISkge1xuICAgICAgICBjcmVhdGVSZXNwb25zZShpbnB1dDogJGlucHV0KSB7XG4gICAgICAgICAgaWRcbiAgICAgICAgICBzdXJ2ZXlMaW5rSWRcbiAgICAgICAgICBxdWVzdGlvbklkXG4gICAgICAgICAgYW5zd2VyXG4gICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICBjcmVhdGVkQXRcbiAgICAgICAgICB1cGRhdGVkQXRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIGA7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLm1ha2VHcmFwaFFMUmVxdWVzdDx7IGNyZWF0ZVJlc3BvbnNlOiBhbnkgfT4ocXVlcnksIHsgaW5wdXQgfSk7XG4gICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LmRhdGE/LmNyZWF0ZVJlc3BvbnNlIHx8IG51bGwgfTtcbiAgfVxuXG4gIGFzeW5jIGxpc3RSZXNwb25zZXNCeVN1cnZleUxpbmsoc3VydmV5TGlua0lkOiBzdHJpbmcpOiBQcm9taXNlPHsgZGF0YTogYW55W10gfT4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgcXVlcnkgTGlzdFJlc3BvbnNlcygkZmlsdGVyOiBNb2RlbFJlc3BvbnNlRmlsdGVySW5wdXQpIHtcbiAgICAgICAgbGlzdFJlc3BvbnNlcyhmaWx0ZXI6ICRmaWx0ZXIpIHtcbiAgICAgICAgICBpdGVtcyB7XG4gICAgICAgICAgICBpZFxuICAgICAgICAgICAgc3VydmV5TGlua0lkXG4gICAgICAgICAgICBxdWVzdGlvbklkXG4gICAgICAgICAgICBhbnN3ZXJcbiAgICAgICAgICAgIG1ldGFkYXRhXG4gICAgICAgICAgICBjcmVhdGVkQXRcbiAgICAgICAgICAgIHVwZGF0ZWRBdFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIGA7XG5cbiAgICBjb25zdCBmaWx0ZXIgPSB7XG4gICAgICBzdXJ2ZXlMaW5rSWQ6IHsgZXE6IHN1cnZleUxpbmtJZCB9XG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubWFrZUdyYXBoUUxSZXF1ZXN0PHsgbGlzdFJlc3BvbnNlczogeyBpdGVtczogYW55W10gfSB9PihxdWVyeSwgeyBmaWx0ZXIgfSk7XG4gICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LmRhdGE/Lmxpc3RSZXNwb25zZXM/Lml0ZW1zIHx8IFtdIH07XG4gIH1cblxuICAvLyBQcm9qZWN0VmVuZG9yIG9wZXJhdGlvbnNcbiAgYXN5bmMgbGlzdFByb2plY3RWZW5kb3JzKGZpbHRlcj86IGFueSk6IFByb21pc2U8eyBkYXRhOiBhbnlbXSB9PiB7XG4gICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICBxdWVyeSBMaXN0UHJvamVjdFZlbmRvcnMoJGZpbHRlcjogTW9kZWxQcm9qZWN0VmVuZG9yRmlsdGVySW5wdXQpIHtcbiAgICAgICAgbGlzdFByb2plY3RWZW5kb3JzKGZpbHRlcjogJGZpbHRlcikge1xuICAgICAgICAgIGl0ZW1zIHtcbiAgICAgICAgICAgIGlkXG4gICAgICAgICAgICBwcm9qZWN0SWRcbiAgICAgICAgICAgIHZlbmRvcklkXG4gICAgICAgICAgICBxdW90YVxuICAgICAgICAgICAgY3VycmVudENvdW50XG4gICAgICAgICAgICBjcmVhdGVkQXRcbiAgICAgICAgICAgIHVwZGF0ZWRBdFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIGA7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLm1ha2VHcmFwaFFMUmVxdWVzdDx7IGxpc3RQcm9qZWN0VmVuZG9yczogeyBpdGVtczogYW55W10gfSB9PihxdWVyeSwgeyBmaWx0ZXIgfSk7XG4gICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LmRhdGE/Lmxpc3RQcm9qZWN0VmVuZG9ycz8uaXRlbXMgfHwgW10gfTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVByb2plY3RWZW5kb3IoaW5wdXQ6IHtcbiAgICBwcm9qZWN0SWQ6IHN0cmluZztcbiAgICB2ZW5kb3JJZDogc3RyaW5nO1xuICAgIHF1b3RhPzogbnVtYmVyO1xuICAgIGN1cnJlbnRDb3VudD86IG51bWJlcjtcbiAgfSk6IFByb21pc2U8eyBkYXRhOiBhbnkgfCBudWxsIH0+IHtcbiAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgIG11dGF0aW9uIENyZWF0ZVByb2plY3RWZW5kb3IoJGlucHV0OiBDcmVhdGVQcm9qZWN0VmVuZG9ySW5wdXQhKSB7XG4gICAgICAgIGNyZWF0ZVByb2plY3RWZW5kb3IoaW5wdXQ6ICRpbnB1dCkge1xuICAgICAgICAgIGlkXG4gICAgICAgICAgcHJvamVjdElkXG4gICAgICAgICAgdmVuZG9ySWRcbiAgICAgICAgICBxdW90YVxuICAgICAgICAgIGN1cnJlbnRDb3VudFxuICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICAgIHVwZGF0ZWRBdFxuICAgICAgICB9XG4gICAgICB9XG4gICAgYDtcblxuICAgIGNvbnN0IGNyZWF0ZUlucHV0ID0ge1xuICAgICAgcHJvamVjdElkOiBpbnB1dC5wcm9qZWN0SWQsXG4gICAgICB2ZW5kb3JJZDogaW5wdXQudmVuZG9ySWQsXG4gICAgICBxdW90YTogaW5wdXQucXVvdGEgfHwgMCxcbiAgICAgIGN1cnJlbnRDb3VudDogaW5wdXQuY3VycmVudENvdW50IHx8IDBcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tYWtlR3JhcGhRTFJlcXVlc3Q8eyBjcmVhdGVQcm9qZWN0VmVuZG9yOiBhbnkgfT4ocXVlcnksIHsgaW5wdXQ6IGNyZWF0ZUlucHV0IH0pO1xuICAgIHJldHVybiB7IGRhdGE6IHJlc3VsdC5kYXRhPy5jcmVhdGVQcm9qZWN0VmVuZG9yIHx8IG51bGwgfTtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZVByb2plY3RWZW5kb3IocHJvamVjdElkOiBzdHJpbmcsIHZlbmRvcklkOiBzdHJpbmcsIHVwZGF0ZXM6IHtcbiAgICBjdXJyZW50Q291bnQ/OiBudW1iZXI7XG4gICAgcXVvdGE/OiBudW1iZXI7XG4gIH0pOiBQcm9taXNlPHsgZGF0YTogYW55IHwgbnVsbCB9PiB7XG4gICAgLy8gRmlyc3QgZmluZCB0aGUgUHJvamVjdFZlbmRvciByZWNvcmRcbiAgICBjb25zdCBleGlzdGluZ1Jlc3VsdCA9IGF3YWl0IHRoaXMubGlzdFByb2plY3RWZW5kb3JzKHtcbiAgICAgIGFuZDogW1xuICAgICAgICB7IHByb2plY3RJZDogeyBlcTogcHJvamVjdElkIH0gfSxcbiAgICAgICAgeyB2ZW5kb3JJZDogeyBlcTogdmVuZG9ySWQgfSB9XG4gICAgICBdXG4gICAgfSk7XG5cbiAgICBpZiAoZXhpc3RpbmdSZXN1bHQuZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7IGRhdGE6IG51bGwgfTtcbiAgICB9XG5cbiAgICBjb25zdCBwcm9qZWN0VmVuZG9yID0gZXhpc3RpbmdSZXN1bHQuZGF0YVswXTtcblxuICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgbXV0YXRpb24gVXBkYXRlUHJvamVjdFZlbmRvcigkaW5wdXQ6IFVwZGF0ZVByb2plY3RWZW5kb3JJbnB1dCEpIHtcbiAgICAgICAgdXBkYXRlUHJvamVjdFZlbmRvcihpbnB1dDogJGlucHV0KSB7XG4gICAgICAgICAgaWRcbiAgICAgICAgICBwcm9qZWN0SWRcbiAgICAgICAgICB2ZW5kb3JJZFxuICAgICAgICAgIHF1b3RhXG4gICAgICAgICAgY3VycmVudENvdW50XG4gICAgICAgICAgY3JlYXRlZEF0XG4gICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgO1xuXG4gICAgY29uc3QgaW5wdXQgPSB7XG4gICAgICBpZDogcHJvamVjdFZlbmRvci5pZCxcbiAgICAgIC4uLnVwZGF0ZXNcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tYWtlR3JhcGhRTFJlcXVlc3Q8eyB1cGRhdGVQcm9qZWN0VmVuZG9yOiBhbnkgfT4ocXVlcnksIHsgaW5wdXQgfSk7XG4gICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LmRhdGE/LnVwZGF0ZVByb2plY3RWZW5kb3IgfHwgbnVsbCB9O1xuICB9XG59XG5cbi8vIENyZWF0ZSBhIHNpbmdsZXRvbiBpbnN0YW5jZVxubGV0IHNlcnZlclNlcnZpY2U6IEFtcGxpZnlTZXJ2ZXJTZXJ2aWNlIHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbXBsaWZ5U2VydmVyU2VydmljZSgpOiBBbXBsaWZ5U2VydmVyU2VydmljZSB7XG4gIGlmICghc2VydmVyU2VydmljZSkge1xuICAgIHNlcnZlclNlcnZpY2UgPSBuZXcgQW1wbGlmeVNlcnZlclNlcnZpY2UoKTtcbiAgfVxuICByZXR1cm4gc2VydmVyU2VydmljZTtcbn1cbiJdLCJuYW1lcyI6WyJBbXBsaWZ5Iiwib3V0cHV0cyIsImNvbmZpZ3VyZSIsIkFtcGxpZnlTZXJ2ZXJTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJhcGlFbmRwb2ludCIsImRhdGEiLCJ1cmwiLCJhcGlLZXkiLCJhcGlfa2V5IiwibWFrZUdyYXBoUUxSZXF1ZXN0IiwicXVlcnkiLCJ2YXJpYWJsZXMiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwib2siLCJFcnJvciIsInN0YXR1cyIsInJlc3VsdCIsImpzb24iLCJlcnJvcnMiLCJjb25zb2xlIiwiZXJyb3IiLCJnZXRQcm9qZWN0IiwiaWQiLCJsaXN0UHJvamVjdHMiLCJpdGVtcyIsImdldFZlbmRvciIsImxpc3RWZW5kb3JzIiwiZmlsdGVyIiwiY3JlYXRlVmVuZG9yIiwiaW5wdXQiLCJkZWxldGVWZW5kb3IiLCJjcmVhdGVTdXJ2ZXlMaW5rIiwibGlzdFN1cnZleUxpbmtzQnlQcm9qZWN0IiwicHJvamVjdElkIiwiZXEiLCJsaXN0U3VydmV5TGlua3MiLCJnZXRTdXJ2ZXlMaW5rQnlVaWQiLCJ1aWQiLCJsZW5ndGgiLCJ1cGRhdGVTdXJ2ZXlMaW5rIiwidXBkYXRlSW5wdXQiLCJjcmVhdGVRdWVzdGlvbiIsImxpc3RRdWVzdGlvbnNCeVByb2plY3QiLCJsaXN0UXVlc3Rpb25zIiwiZGVsZXRlUXVlc3Rpb24iLCJjcmVhdGVSZXNwb25zZSIsImxpc3RSZXNwb25zZXNCeVN1cnZleUxpbmsiLCJzdXJ2ZXlMaW5rSWQiLCJsaXN0UmVzcG9uc2VzIiwibGlzdFByb2plY3RWZW5kb3JzIiwiY3JlYXRlUHJvamVjdFZlbmRvciIsImNyZWF0ZUlucHV0IiwidmVuZG9ySWQiLCJxdW90YSIsImN1cnJlbnRDb3VudCIsInVwZGF0ZVByb2plY3RWZW5kb3IiLCJ1cGRhdGVzIiwiZXhpc3RpbmdSZXN1bHQiLCJhbmQiLCJwcm9qZWN0VmVuZG9yIiwic2VydmVyU2VydmljZSIsImdldEFtcGxpZnlTZXJ2ZXJTZXJ2aWNlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/amplify-server-service.ts\n");

/***/ }),

/***/ "(api)/./src/lib/security-service.ts":
/*!*************************************!*\
  !*** ./src/lib/security-service.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   securityService: () => (/* binding */ securityService)\n/* harmony export */ });\n/* harmony import */ var aws_amplify_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aws-amplify/auth */ \"aws-amplify/auth\");\n/* harmony import */ var _amplify_data_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./amplify-data-service */ \"(api)/./src/lib/amplify-data-service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([aws_amplify_auth__WEBPACK_IMPORTED_MODULE_0__, _amplify_data_service__WEBPACK_IMPORTED_MODULE_1__]);\n([aws_amplify_auth__WEBPACK_IMPORTED_MODULE_0__, _amplify_data_service__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n// Domain configuration\nconst MAIN_DOMAIN = \"protegeresearchsurvey.com\" || 0;\nconst SHORT_URL_BASE = \"https://protegeresearchsurvey.com/s\" || 0;\n// Create stubs for the missing functions that will be implemented later\nconst getVpnStatus = async (ip)=>{\n    // TODO: Implement VPN detection\n    console.log(\"Checking VPN status for IP:\", ip);\n    return {\n        isVpn: false\n    };\n};\nconst getCaptchaVerification = async (token, ip)=>{\n    // TODO: Implement CAPTCHA verification\n    console.log(\"Verifying CAPTCHA token:\", token, \"IP:\", ip);\n    return {\n        score: 0.9\n    };\n};\nconst getGeoLocation = async (ip)=>{\n    // TODO: Implement geo-location lookup\n    console.log(\"Getting geo-location for IP:\", ip);\n    return {\n        country: \"US\",\n        city: \"Unknown\",\n        ip\n    };\n};\n/**\n * Security Service - Handles security features for MCP server integration\n * Centralizes authentication, geo-restriction, VPN detection, and captcha verification\n */ const securityService = {\n    /**\n   * Get current security context including authentication status, geo info, VPN detection\n   */ getSecurityContext: async (ip, captchaToken)=>{\n        // Initialize security context\n        const securityContext = {\n            authenticated: false,\n            detectedVpn: false\n        };\n        try {\n            // Check authentication status using Amplify v6 APIs\n            try {\n                const currentUser = await (0,aws_amplify_auth__WEBPACK_IMPORTED_MODULE_0__.getCurrentUser)();\n                const session = await (0,aws_amplify_auth__WEBPACK_IMPORTED_MODULE_0__.fetchAuthSession)();\n                securityContext.authenticated = true;\n                securityContext.userId = currentUser.userId;\n                // Extract user groups from Cognito tokens using new API structure\n                const accessToken = session.tokens?.accessToken;\n                const payload = accessToken?.payload;\n                securityContext.userGroups = payload?.[\"cognito:groups\"] || [];\n            } catch (error) {\n                // User is not authenticated\n                securityContext.authenticated = false;\n            }\n            // Get geo-location information\n            const geoInfo = await getGeoLocation(ip);\n            if (geoInfo) {\n                securityContext.geoLocation = {\n                    country: geoInfo.country,\n                    city: geoInfo.city,\n                    ip: geoInfo.ip\n                };\n            }\n            // Check VPN status\n            const vpnStatus = await getVpnStatus(ip);\n            securityContext.detectedVpn = vpnStatus.isVpn;\n            // Verify captcha if token provided\n            if (captchaToken) {\n                const captchaResult = await getCaptchaVerification(captchaToken, ip);\n                securityContext.captchaScore = captchaResult.score;\n            }\n            return securityContext;\n        } catch (error) {\n            console.error(\"Error getting security context:\", error);\n            return securityContext;\n        }\n    },\n    /**\n   * Verify access to a survey link based on geo-restrictions and other security rules\n   */ verifySurveyLinkAccess: async (surveyLinkUid, ip, captchaToken)=>{\n        try {\n            const securityContext = await securityService.getSecurityContext(ip, captchaToken);\n            // Get survey link with proper null check\n            if (!surveyLinkUid) {\n                return {\n                    allowed: false,\n                    reason: \"INVALID_LINK_ID\",\n                    securityContext\n                };\n            }\n            const amplifyDataService = await (0,_amplify_data_service__WEBPACK_IMPORTED_MODULE_1__.getAmplifyDataService)();\n            const surveyLink = await amplifyDataService.surveyLinks.getByUid(surveyLinkUid);\n            if (!surveyLink) {\n                return {\n                    allowed: false,\n                    reason: \"LINK_NOT_FOUND\",\n                    securityContext\n                };\n            }\n            // Check if link is already completed or flagged\n            if (surveyLink.data && surveyLink.data.status && [\n                \"COMPLETED\",\n                \"FLAGGED\"\n            ].includes(surveyLink.data.status)) {\n                return {\n                    allowed: false,\n                    reason: \"LINK_ALREADY_USED\",\n                    securityContext\n                };\n            } // Check geo-restrictions if set in project settings\n            if (surveyLink.data && surveyLink.data.projectId && securityContext.geoLocation) {\n                try {\n                    const project = await amplifyDataService.projects.get(surveyLink.data.projectId);\n                    // Get geo-restrictions from project settings if available\n                    const settings = project.data?.settings;\n                    const geoRestriction = settings?.geoRestriction;\n                    if (geoRestriction) {\n                        const allowedCountries = typeof geoRestriction === \"string\" ? JSON.parse(geoRestriction) : geoRestriction;\n                        if (Array.isArray(allowedCountries) && allowedCountries.length > 0 && !allowedCountries.includes(securityContext.geoLocation.country)) {\n                            return {\n                                allowed: false,\n                                reason: \"GEO_RESTRICTED\",\n                                securityContext\n                            };\n                        }\n                    }\n                } catch (e) {\n                    console.error(\"Error parsing geo restrictions:\", e);\n                }\n            }\n            // Check VPN usage if detected (linkType field no longer exists in model)\n            if (securityContext.detectedVpn && surveyLink.data) {\n                return {\n                    allowed: false,\n                    reason: \"VPN_DETECTED\",\n                    securityContext\n                };\n            }\n            // Check captcha score if provided\n            if (captchaToken && securityContext.captchaScore !== undefined && securityContext.captchaScore < 0.5) {\n                return {\n                    allowed: false,\n                    reason: \"CAPTCHA_FAILED\",\n                    securityContext\n                };\n            }\n            return {\n                allowed: true,\n                securityContext\n            };\n        } catch (error) {\n            console.error(\"Error verifying survey link access:\", error);\n            return {\n                allowed: false,\n                reason: \"INTERNAL_ERROR\",\n                securityContext: {\n                    authenticated: false,\n                    detectedVpn: false\n                }\n            };\n        }\n    },\n    /**\n   * Generate survey links using the custom domain\n   */ generateSurveyLink: (projectId, uid, type = \"short\")=>{\n        if (type === \"short\") {\n            return `${SHORT_URL_BASE}/${projectId}/${uid}`;\n        } else {\n            return `https://${MAIN_DOMAIN}/survey/${projectId}/${uid}`;\n        }\n    },\n    /**\n   * Generate completion page link using the custom domain\n   */ generateCompletionLink: (projectId, uid)=>{\n        return `https://${MAIN_DOMAIN}/completion/${projectId}/${uid}`;\n    },\n    /**\n   * Log security events to help with auditing and threat detection\n   */ logSecurityEvent: async (eventType, details)=>{\n        console.log(`[SECURITY_EVENT] ${eventType}:`, details);\n    // In a production environment, this would send events to a logging service\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Um5CO2dCQUNGO1lBQ0Y7WUFFQSxrQ0FBa0M7WUFDbEMsSUFBSUQsZ0JBQWdCQyxnQkFBZ0JlLFlBQVksS0FBS3lCLGFBQWF4QyxnQkFBZ0JlLFlBQVksR0FBRyxLQUFLO2dCQUNwRyxPQUFPO29CQUNMRyxTQUFTO29CQUNUQyxRQUFRO29CQUNSbkI7Z0JBQ0Y7WUFDRjtZQUVBLE9BQU87Z0JBQ0xrQixTQUFTO2dCQUNUbEI7WUFDRjtRQUNGLEVBQUUsT0FBT1UsT0FBTztZQUNkdEIsUUFBUXNCLEtBQUssQ0FBQyx1Q0FBdUNBO1lBQ3JELE9BQU87Z0JBQ0xRLFNBQVM7Z0JBQ1RDLFFBQVE7Z0JBQ1JuQixpQkFBaUI7b0JBQ2ZDLGVBQWU7b0JBQ2ZDLGFBQWE7Z0JBQ2Y7WUFDRjtRQUNGO0lBQ0Y7SUFFQTs7R0FFQyxHQUNEdUMsb0JBQW9CLENBQUNkLFdBQW1CZSxLQUFhQyxPQUFlLE9BQU87UUFDekUsSUFBSUEsU0FBUyxTQUFTO1lBQ3BCLE9BQU8sQ0FBQyxFQUFFM0QsZUFBZSxDQUFDLEVBQUUyQyxVQUFVLENBQUMsRUFBRWUsSUFBSSxDQUFDO1FBQ2hELE9BQU87WUFDTCxPQUFPLENBQUMsUUFBUSxFQUFFOUQsWUFBWSxRQUFRLEVBQUUrQyxVQUFVLENBQUMsRUFBRWUsSUFBSSxDQUFDO1FBQzVEO0lBQ0Y7SUFFQTs7R0FFQyxHQUNERSx3QkFBd0IsQ0FBQ2pCLFdBQW1CZTtRQUMxQyxPQUFPLENBQUMsUUFBUSxFQUFFOUQsWUFBWSxZQUFZLEVBQUUrQyxVQUFVLENBQUMsRUFBRWUsSUFBSSxDQUFDO0lBQ2hFO0lBRUE7O0dBRUMsR0FDREcsa0JBQWtCLE9BQU9DLFdBQW1CQztRQUMxQzNELFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGlCQUFpQixFQUFFeUQsVUFBVSxDQUFDLENBQUMsRUFBRUM7SUFDOUMsMkVBQTJFO0lBQzdFO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL3N1cnZleS1saW5rLXdyYXBwZXIvLi9zcmMvbGliL3NlY3VyaXR5LXNlcnZpY2UudHM/MWFmMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmZXRjaEF1dGhTZXNzaW9uLCBnZXRDdXJyZW50VXNlciB9IGZyb20gJ2F3cy1hbXBsaWZ5L2F1dGgnO1xuaW1wb3J0IHsgZ2V0QW1wbGlmeURhdGFTZXJ2aWNlIH0gZnJvbSAnLi9hbXBsaWZ5LWRhdGEtc2VydmljZSc7XG5cbi8vIERvbWFpbiBjb25maWd1cmF0aW9uXG5jb25zdCBNQUlOX0RPTUFJTiA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0RPTUFJTiB8fCAncHJvdGVnZXJlc2VhcmNoc3VydmV5LmNvbSc7XG5jb25zdCBTSE9SVF9VUkxfQkFTRSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUlZFWV9TSE9SVF9VUkwgfHwgYGh0dHBzOi8vJHtNQUlOX0RPTUFJTn0vc2A7XG5cbi8vIENyZWF0ZSBzdHVicyBmb3IgdGhlIG1pc3NpbmcgZnVuY3Rpb25zIHRoYXQgd2lsbCBiZSBpbXBsZW1lbnRlZCBsYXRlclxuY29uc3QgZ2V0VnBuU3RhdHVzID0gYXN5bmMgKGlwOiBzdHJpbmcpID0+IHtcbiAgLy8gVE9ETzogSW1wbGVtZW50IFZQTiBkZXRlY3Rpb25cbiAgY29uc29sZS5sb2coJ0NoZWNraW5nIFZQTiBzdGF0dXMgZm9yIElQOicsIGlwKTtcbiAgcmV0dXJuIHsgaXNWcG46IGZhbHNlIH07XG59O1xuXG5jb25zdCBnZXRDYXB0Y2hhVmVyaWZpY2F0aW9uID0gYXN5bmMgKHRva2VuOiBzdHJpbmcsIGlwOiBzdHJpbmcpID0+IHtcbiAgLy8gVE9ETzogSW1wbGVtZW50IENBUFRDSEEgdmVyaWZpY2F0aW9uXG4gIGNvbnNvbGUubG9nKCdWZXJpZnlpbmcgQ0FQVENIQSB0b2tlbjonLCB0b2tlbiwgJ0lQOicsIGlwKTtcbiAgcmV0dXJuIHsgc2NvcmU6IDAuOSB9O1xufTtcblxuY29uc3QgZ2V0R2VvTG9jYXRpb24gPSBhc3luYyAoaXA6IHN0cmluZykgPT4ge1xuICAvLyBUT0RPOiBJbXBsZW1lbnQgZ2VvLWxvY2F0aW9uIGxvb2t1cFxuICBjb25zb2xlLmxvZygnR2V0dGluZyBnZW8tbG9jYXRpb24gZm9yIElQOicsIGlwKTtcbiAgcmV0dXJuIHsgY291bnRyeTogJ1VTJywgY2l0eTogJ1Vua25vd24nLCBpcCB9O1xufTtcblxuZXhwb3J0IGludGVyZmFjZSBTZWN1cml0eUNvbnRleHQge1xuICBhdXRoZW50aWNhdGVkOiBib29sZWFuO1xuICB1c2VySWQ/OiBzdHJpbmc7XG4gIHVzZXJHcm91cHM/OiBzdHJpbmdbXTtcbiAgZ2VvTG9jYXRpb24/OiB7XG4gICAgY291bnRyeTogc3RyaW5nO1xuICAgIGNpdHk6IHN0cmluZztcbiAgICBpcDogc3RyaW5nO1xuICB9O1xuICBkZXRlY3RlZFZwbjogYm9vbGVhbjtcbiAgY2FwdGNoYVNjb3JlPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIFNlY3VyaXR5IFNlcnZpY2UgLSBIYW5kbGVzIHNlY3VyaXR5IGZlYXR1cmVzIGZvciBNQ1Agc2VydmVyIGludGVncmF0aW9uXG4gKiBDZW50cmFsaXplcyBhdXRoZW50aWNhdGlvbiwgZ2VvLXJlc3RyaWN0aW9uLCBWUE4gZGV0ZWN0aW9uLCBhbmQgY2FwdGNoYSB2ZXJpZmljYXRpb25cbiAqL1xuZXhwb3J0IGNvbnN0IHNlY3VyaXR5U2VydmljZSA9IHtcbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHNlY3VyaXR5IGNvbnRleHQgaW5jbHVkaW5nIGF1dGhlbnRpY2F0aW9uIHN0YXR1cywgZ2VvIGluZm8sIFZQTiBkZXRlY3Rpb25cbiAgICovXG4gIGdldFNlY3VyaXR5Q29udGV4dDogYXN5bmMgKGlwOiBzdHJpbmcsIGNhcHRjaGFUb2tlbj86IHN0cmluZyk6IFByb21pc2U8U2VjdXJpdHlDb250ZXh0PiA9PiB7XG4gICAgLy8gSW5pdGlhbGl6ZSBzZWN1cml0eSBjb250ZXh0XG4gICAgY29uc3Qgc2VjdXJpdHlDb250ZXh0OiBTZWN1cml0eUNvbnRleHQgPSB7XG4gICAgICBhdXRoZW50aWNhdGVkOiBmYWxzZSxcbiAgICAgIGRldGVjdGVkVnBuOiBmYWxzZVxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgYXV0aGVudGljYXRpb24gc3RhdHVzIHVzaW5nIEFtcGxpZnkgdjYgQVBJc1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBhd2FpdCBnZXRDdXJyZW50VXNlcigpO1xuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZmV0Y2hBdXRoU2Vzc2lvbigpO1xuICAgICAgICBzZWN1cml0eUNvbnRleHQuYXV0aGVudGljYXRlZCA9IHRydWU7XG4gICAgICAgIHNlY3VyaXR5Q29udGV4dC51c2VySWQgPSBjdXJyZW50VXNlci51c2VySWQ7XG4gICAgICAgIFxuICAgICAgICAvLyBFeHRyYWN0IHVzZXIgZ3JvdXBzIGZyb20gQ29nbml0byB0b2tlbnMgdXNpbmcgbmV3IEFQSSBzdHJ1Y3R1cmVcbiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBzZXNzaW9uLnRva2Vucz8uYWNjZXNzVG9rZW47XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBhY2Nlc3NUb2tlbj8ucGF5bG9hZCBhcyBhbnk7XG4gICAgICAgIHNlY3VyaXR5Q29udGV4dC51c2VyR3JvdXBzID0gcGF5bG9hZD8uWydjb2duaXRvOmdyb3VwcyddIHx8IFtdO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gVXNlciBpcyBub3QgYXV0aGVudGljYXRlZFxuICAgICAgICBzZWN1cml0eUNvbnRleHQuYXV0aGVudGljYXRlZCA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgZ2VvLWxvY2F0aW9uIGluZm9ybWF0aW9uXG4gICAgICBjb25zdCBnZW9JbmZvID0gYXdhaXQgZ2V0R2VvTG9jYXRpb24oaXApO1xuICAgICAgaWYgKGdlb0luZm8pIHtcbiAgICAgICAgc2VjdXJpdHlDb250ZXh0Lmdlb0xvY2F0aW9uID0ge1xuICAgICAgICAgIGNvdW50cnk6IGdlb0luZm8uY291bnRyeSxcbiAgICAgICAgICBjaXR5OiBnZW9JbmZvLmNpdHksXG4gICAgICAgICAgaXA6IGdlb0luZm8uaXBcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgVlBOIHN0YXR1c1xuICAgICAgY29uc3QgdnBuU3RhdHVzID0gYXdhaXQgZ2V0VnBuU3RhdHVzKGlwKTtcbiAgICAgIHNlY3VyaXR5Q29udGV4dC5kZXRlY3RlZFZwbiA9IHZwblN0YXR1cy5pc1ZwbjtcblxuICAgICAgLy8gVmVyaWZ5IGNhcHRjaGEgaWYgdG9rZW4gcHJvdmlkZWRcbiAgICAgIGlmIChjYXB0Y2hhVG9rZW4pIHtcbiAgICAgICAgY29uc3QgY2FwdGNoYVJlc3VsdCA9IGF3YWl0IGdldENhcHRjaGFWZXJpZmljYXRpb24oY2FwdGNoYVRva2VuLCBpcCk7XG4gICAgICAgIHNlY3VyaXR5Q29udGV4dC5jYXB0Y2hhU2NvcmUgPSBjYXB0Y2hhUmVzdWx0LnNjb3JlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2VjdXJpdHlDb250ZXh0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIHNlY3VyaXR5IGNvbnRleHQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHNlY3VyaXR5Q29udGV4dDtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFZlcmlmeSBhY2Nlc3MgdG8gYSBzdXJ2ZXkgbGluayBiYXNlZCBvbiBnZW8tcmVzdHJpY3Rpb25zIGFuZCBvdGhlciBzZWN1cml0eSBydWxlc1xuICAgKi9cbiAgdmVyaWZ5U3VydmV5TGlua0FjY2VzczogYXN5bmMgKHN1cnZleUxpbmtVaWQ6IHN0cmluZywgaXA6IHN0cmluZywgY2FwdGNoYVRva2VuPzogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgYWxsb3dlZDogYm9vbGVhbjtcbiAgICByZWFzb24/OiBzdHJpbmc7XG4gICAgc2VjdXJpdHlDb250ZXh0OiBTZWN1cml0eUNvbnRleHQ7XG4gIH0+ID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2VjdXJpdHlDb250ZXh0ID0gYXdhaXQgc2VjdXJpdHlTZXJ2aWNlLmdldFNlY3VyaXR5Q29udGV4dChpcCwgY2FwdGNoYVRva2VuKTtcbiAgICAgIFxuICAgICAgLy8gR2V0IHN1cnZleSBsaW5rIHdpdGggcHJvcGVyIG51bGwgY2hlY2tcbiAgICAgIGlmICghc3VydmV5TGlua1VpZCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICAgIHJlYXNvbjogJ0lOVkFMSURfTElOS19JRCcsXG4gICAgICAgICAgc2VjdXJpdHlDb250ZXh0XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGFtcGxpZnlEYXRhU2VydmljZSA9IGF3YWl0IGdldEFtcGxpZnlEYXRhU2VydmljZSgpO1xuICAgICAgY29uc3Qgc3VydmV5TGluayA9IGF3YWl0IGFtcGxpZnlEYXRhU2VydmljZS5zdXJ2ZXlMaW5rcy5nZXRCeVVpZChzdXJ2ZXlMaW5rVWlkKTtcbiAgICAgIFxuICAgICAgaWYgKCFzdXJ2ZXlMaW5rKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgICAgcmVhc29uOiAnTElOS19OT1RfRk9VTkQnLFxuICAgICAgICAgIHNlY3VyaXR5Q29udGV4dFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBsaW5rIGlzIGFscmVhZHkgY29tcGxldGVkIG9yIGZsYWdnZWRcbiAgICAgIGlmIChzdXJ2ZXlMaW5rLmRhdGEgJiYgc3VydmV5TGluay5kYXRhLnN0YXR1cyAmJiBbJ0NPTVBMRVRFRCcsICdGTEFHR0VEJ10uaW5jbHVkZXMoc3VydmV5TGluay5kYXRhLnN0YXR1cykpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgICAgICByZWFzb246ICdMSU5LX0FMUkVBRFlfVVNFRCcsXG4gICAgICAgICAgc2VjdXJpdHlDb250ZXh0XG4gICAgICAgIH07XG4gICAgICB9ICAgICAgICAvLyBDaGVjayBnZW8tcmVzdHJpY3Rpb25zIGlmIHNldCBpbiBwcm9qZWN0IHNldHRpbmdzXG4gICAgICBpZiAoc3VydmV5TGluay5kYXRhICYmIHN1cnZleUxpbmsuZGF0YS5wcm9qZWN0SWQgJiYgc2VjdXJpdHlDb250ZXh0Lmdlb0xvY2F0aW9uKSB7ICAgICAgICAgIC8vIEdldCBwcm9qZWN0IHRvIGNoZWNrIGdlby1yZXN0cmljdGlvbnNcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdCA9IGF3YWl0IGFtcGxpZnlEYXRhU2VydmljZS5wcm9qZWN0cy5nZXQoc3VydmV5TGluay5kYXRhLnByb2plY3RJZCk7XG4gICAgICAgICAgICAgICAgLy8gR2V0IGdlby1yZXN0cmljdGlvbnMgZnJvbSBwcm9qZWN0IHNldHRpbmdzIGlmIGF2YWlsYWJsZVxuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBwcm9qZWN0LmRhdGE/LnNldHRpbmdzIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IGdlb1Jlc3RyaWN0aW9uID0gc2V0dGluZ3M/Lmdlb1Jlc3RyaWN0aW9uO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChnZW9SZXN0cmljdGlvbikge1xuICAgICAgICAgICAgY29uc3QgYWxsb3dlZENvdW50cmllcyA9IHR5cGVvZiBnZW9SZXN0cmljdGlvbiA9PT0gJ3N0cmluZycgXG4gICAgICAgICAgICAgID8gSlNPTi5wYXJzZShnZW9SZXN0cmljdGlvbikgXG4gICAgICAgICAgICAgIDogZ2VvUmVzdHJpY3Rpb247XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYWxsb3dlZENvdW50cmllcykgJiYgXG4gICAgICAgICAgICAgICAgYWxsb3dlZENvdW50cmllcy5sZW5ndGggPiAwICYmIFxuICAgICAgICAgICAgICAgICFhbGxvd2VkQ291bnRyaWVzLmluY2x1ZGVzKHNlY3VyaXR5Q29udGV4dC5nZW9Mb2NhdGlvbi5jb3VudHJ5KSkge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlYXNvbjogJ0dFT19SRVNUUklDVEVEJyxcbiAgICAgICAgICAgICAgICBzZWN1cml0eUNvbnRleHRcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIGdlbyByZXN0cmljdGlvbnM6JywgZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgVlBOIHVzYWdlIGlmIGRldGVjdGVkIChsaW5rVHlwZSBmaWVsZCBubyBsb25nZXIgZXhpc3RzIGluIG1vZGVsKVxuICAgICAgaWYgKHNlY3VyaXR5Q29udGV4dC5kZXRlY3RlZFZwbiAmJiBzdXJ2ZXlMaW5rLmRhdGEpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgICAgICByZWFzb246ICdWUE5fREVURUNURUQnLFxuICAgICAgICAgIHNlY3VyaXR5Q29udGV4dFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDaGVjayBjYXB0Y2hhIHNjb3JlIGlmIHByb3ZpZGVkXG4gICAgICBpZiAoY2FwdGNoYVRva2VuICYmIHNlY3VyaXR5Q29udGV4dC5jYXB0Y2hhU2NvcmUgIT09IHVuZGVmaW5lZCAmJiBzZWN1cml0eUNvbnRleHQuY2FwdGNoYVNjb3JlIDwgMC41KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgICAgcmVhc29uOiAnQ0FQVENIQV9GQUlMRUQnLFxuICAgICAgICAgIHNlY3VyaXR5Q29udGV4dFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgICBzZWN1cml0eUNvbnRleHRcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHZlcmlmeWluZyBzdXJ2ZXkgbGluayBhY2Nlc3M6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgIHJlYXNvbjogJ0lOVEVSTkFMX0VSUk9SJyxcbiAgICAgICAgc2VjdXJpdHlDb250ZXh0OiB7IFxuICAgICAgICAgIGF1dGhlbnRpY2F0ZWQ6IGZhbHNlLCBcbiAgICAgICAgICBkZXRlY3RlZFZwbjogZmFsc2UgXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9LFxuICBcbiAgLyoqXG4gICAqIEdlbmVyYXRlIHN1cnZleSBsaW5rcyB1c2luZyB0aGUgY3VzdG9tIGRvbWFpblxuICAgKi9cbiAgZ2VuZXJhdGVTdXJ2ZXlMaW5rOiAocHJvamVjdElkOiBzdHJpbmcsIHVpZDogc3RyaW5nLCB0eXBlOiBzdHJpbmcgPSAnc2hvcnQnKTogc3RyaW5nID0+IHtcbiAgICBpZiAodHlwZSA9PT0gJ3Nob3J0Jykge1xuICAgICAgcmV0dXJuIGAke1NIT1JUX1VSTF9CQVNFfS8ke3Byb2plY3RJZH0vJHt1aWR9YDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGBodHRwczovLyR7TUFJTl9ET01BSU59L3N1cnZleS8ke3Byb2plY3RJZH0vJHt1aWR9YDtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGNvbXBsZXRpb24gcGFnZSBsaW5rIHVzaW5nIHRoZSBjdXN0b20gZG9tYWluXG4gICAqL1xuICBnZW5lcmF0ZUNvbXBsZXRpb25MaW5rOiAocHJvamVjdElkOiBzdHJpbmcsIHVpZDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICByZXR1cm4gYGh0dHBzOi8vJHtNQUlOX0RPTUFJTn0vY29tcGxldGlvbi8ke3Byb2plY3RJZH0vJHt1aWR9YDtcbiAgfSxcblxuICAvKipcbiAgICogTG9nIHNlY3VyaXR5IGV2ZW50cyB0byBoZWxwIHdpdGggYXVkaXRpbmcgYW5kIHRocmVhdCBkZXRlY3Rpb25cbiAgICovXG4gIGxvZ1NlY3VyaXR5RXZlbnQ6IGFzeW5jIChldmVudFR5cGU6IHN0cmluZywgZGV0YWlsczogYW55KTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgY29uc29sZS5sb2coYFtTRUNVUklUWV9FVkVOVF0gJHtldmVudFR5cGV9OmAsIGRldGFpbHMpO1xuICAgIC8vIEluIGEgcHJvZHVjdGlvbiBlbnZpcm9ubWVudCwgdGhpcyB3b3VsZCBzZW5kIGV2ZW50cyB0byBhIGxvZ2dpbmcgc2VydmljZVxuICB9XG59OyJdLCJuYW1lcyI6WyJmZXRjaEF1dGhTZXNzaW9uIiwiZ2V0Q3VycmVudFVzZXIiLCJnZXRBbXBsaWZ5RGF0YVNlcnZpY2UiLCJNQUlOX0RPTUFJTiIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19ET01BSU4iLCJTSE9SVF9VUkxfQkFTRSIsIk5FWFRfUFVCTElDX1NVUlZFWV9TSE9SVF9VUkwiLCJnZXRWcG5TdGF0dXMiLCJpcCIsImNvbnNvbGUiLCJsb2ciLCJpc1ZwbiIsImdldENhcHRjaGFWZXJpZmljYXRpb24iLCJ0b2tlbiIsInNjb3JlIiwiZ2V0R2VvTG9jYXRpb24iLCJjb3VudHJ5IiwiY2l0eSIsInNlY3VyaXR5U2VydmljZSIsImdldFNlY3VyaXR5Q29udGV4dCIsImNhcHRjaGFUb2tlbiIsInNlY3VyaXR5Q29udGV4dCIsImF1dGhlbnRpY2F0ZWQiLCJkZXRlY3RlZFZwbiIsImN1cnJlbnRVc2VyIiwic2Vzc2lvbiIsInVzZXJJZCIsImFjY2Vzc1Rva2VuIiwidG9rZW5zIiwicGF5bG9hZCIsInVzZXJHcm91cHMiLCJlcnJvciIsImdlb0luZm8iLCJnZW9Mb2NhdGlvbiIsInZwblN0YXR1cyIsImNhcHRjaGFSZXN1bHQiLCJjYXB0Y2hhU2NvcmUiLCJ2ZXJpZnlTdXJ2ZXlMaW5rQWNjZXNzIiwic3VydmV5TGlua1VpZCIsImFsbG93ZWQiLCJyZWFzb24iLCJhbXBsaWZ5RGF0YVNlcnZpY2UiLCJzdXJ2ZXlMaW5rIiwic3VydmV5TGlua3MiLCJnZXRCeVVpZCIsImRhdGEiLCJzdGF0dXMiLCJpbmNsdWRlcyIsInByb2plY3RJZCIsInByb2plY3QiLCJwcm9qZWN0cyIsImdldCIsInNldHRpbmdzIiwiZ2VvUmVzdHJpY3Rpb24iLCJhbGxvd2VkQ291bnRyaWVzIiwiSlNPTiIsInBhcnNlIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiZSIsInVuZGVmaW5lZCIsImdlbmVyYXRlU3VydmV5TGluayIsInVpZCIsInR5cGUiLCJnZW5lcmF0ZUNvbXBsZXRpb25MaW5rIiwibG9nU2VjdXJpdHlFdmVudCIsImV2ZW50VHlwZSIsImRldGFpbHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/security-service.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/links/generate.ts":
/*!*****************************************!*\
  !*** ./src/pages/api/links/generate.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var nanoid__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! nanoid */ \"nanoid\");\n/* harmony import */ var _lib_amplify_server_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/amplify-server-service */ \"(api)/./src/lib/amplify-server-service.ts\");\n/* harmony import */ var _lib_security_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/security-service */ \"(api)/./src/lib/security-service.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([nanoid__WEBPACK_IMPORTED_MODULE_0__, _lib_amplify_server_service__WEBPACK_IMPORTED_MODULE_1__, _lib_security_service__WEBPACK_IMPORTED_MODULE_2__]);\n([nanoid__WEBPACK_IMPORTED_MODULE_0__, _lib_amplify_server_service__WEBPACK_IMPORTED_MODULE_1__, _lib_security_service__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n// Domain configuration\nconst PRODUCTION_DOMAIN = \"protegeresearchsurvey.com\" || 0;\nconst DEVELOPMENT_DOMAIN = \"localhost:3000\";\nconst getDomain = (useDevelopment)=>{\n    return useDevelopment ? DEVELOPMENT_DOMAIN : PRODUCTION_DOMAIN;\n};\nconst getShortUrl = (useDevelopment)=>{\n    const domain = getDomain(useDevelopment);\n    const protocol = useDevelopment ? \"http\" : \"https\";\n    return `${protocol}://${domain}/s`;\n};\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            success: false,\n            message: \"Method not allowed\"\n        });\n    }\n    try {\n        const amplifyServerService = (0,_lib_amplify_server_service__WEBPACK_IMPORTED_MODULE_1__.getAmplifyServerService)();\n        const { projectId, originalUrl, count, vendorId, linkType, geoRestriction, testCount, liveCount, useDevelopmentDomain } = req.body;\n        // Get client IP for security logging\n        const ip = req.headers[\"x-forwarded-for\"]?.toString() || req.socket.remoteAddress || \"unknown\";\n        // Log security event\n        await _lib_security_service__WEBPACK_IMPORTED_MODULE_2__.securityService.logSecurityEvent(\"LINK_GENERATION_ATTEMPT\", {\n            projectId,\n            vendorId,\n            ip,\n            count: count || (testCount && liveCount ? testCount + liveCount : 0)\n        });\n        if (!projectId || !originalUrl) {\n            return res.status(400).json({\n                success: false,\n                message: \"Missing required parameters\"\n            });\n        }\n        // Validate count logic\n        let totalCount = count;\n        if (testCount !== undefined && liveCount !== undefined) {\n            // If both test and live counts are provided, use those instead\n            totalCount = testCount + liveCount;\n            if (totalCount < 1 || totalCount > 1000) {\n                return res.status(400).json({\n                    success: false,\n                    message: \"Total count must be between 1 and 1000\"\n                });\n            }\n        } else {\n            // Otherwise use the total count value\n            if (!count || count < 1 || count > 1000) {\n                return res.status(400).json({\n                    success: false,\n                    message: \"Count must be between 1 and 1000\"\n                });\n            }\n        }\n        // Validate project exists\n        const projectResult = await amplifyServerService.getProject(projectId);\n        // Fix: Extract project correctly by accessing .data property\n        const project = projectResult.data;\n        if (!project) {\n            return res.status(404).json({\n                success: false,\n                message: \"Project not found\"\n            });\n        }\n        // Validate vendor if provided\n        if (vendorId) {\n            const vendorResult = await amplifyServerService.getVendor(vendorId);\n            const vendor = vendorResult?.data;\n            if (!vendor) {\n                return res.status(404).json({\n                    success: false,\n                    message: \"Vendor not found\"\n                });\n            }\n            // Check if vendor belongs to this project by checking the ProjectVendor relationship\n            const projectVendorResult = await amplifyServerService.listProjectVendors({\n                and: [\n                    {\n                        projectId: {\n                            eq: projectId\n                        }\n                    },\n                    {\n                        vendorId: {\n                            eq: vendorId\n                        }\n                    }\n                ]\n            });\n            if (!projectVendorResult.data || projectVendorResult.data.length === 0) {\n                return res.status(400).json({\n                    success: false,\n                    message: \"Vendor does not belong to this project\"\n                });\n            }\n        }\n        // Generate links\n        const links = [];\n        const creationPromises = [];\n        // Get vendor code for UID generation if vendor is specified\n        let vendorCode = \"\";\n        if (vendorId) {\n            const vendorResult = await amplifyServerService.getVendor(vendorId);\n            const vendor = vendorResult?.data;\n            if (vendor && vendor.settings) {\n                try {\n                    const settings = JSON.parse(vendor.settings);\n                    vendorCode = settings.code || \"\";\n                } catch (e) {\n                    console.error(\"Error parsing vendor settings:\", e);\n                }\n            }\n        }\n        // Handle mixed TEST/LIVE links if counts are provided\n        if (testCount !== undefined && liveCount !== undefined) {\n            // Generate TEST links\n            for(let i = 0; i < testCount; i++){\n                const baseUid = (0,nanoid__WEBPACK_IMPORTED_MODULE_0__.nanoid)(8); // Generate a shorter base ID\n                const uid = vendorCode ? `${vendorCode}_TEST_${baseUid}` : `TEST_${baseUid}`;\n                const linkData = {\n                    projectId,\n                    uid,\n                    vendorId: vendorId || undefined,\n                    status: \"UNUSED\",\n                    metadata: JSON.stringify({\n                        originalUrl,\n                        linkType: \"TEST\",\n                        geoRestriction: geoRestriction && geoRestriction.length > 0 ? geoRestriction : undefined\n                    })\n                };\n                creationPromises.push(amplifyServerService.createSurveyLink(linkData));\n            }\n            // Generate LIVE links\n            for(let i = 0; i < liveCount; i++){\n                const baseUid = (0,nanoid__WEBPACK_IMPORTED_MODULE_0__.nanoid)(8); // Generate a shorter base ID\n                const uid = vendorCode ? `${vendorCode}_LIVE_${baseUid}` : `LIVE_${baseUid}`;\n                const linkData = {\n                    projectId,\n                    uid,\n                    vendorId: vendorId || undefined,\n                    status: \"UNUSED\",\n                    metadata: JSON.stringify({\n                        originalUrl,\n                        linkType: \"LIVE\",\n                        geoRestriction: geoRestriction && geoRestriction.length > 0 ? geoRestriction : undefined\n                    })\n                };\n                creationPromises.push(amplifyServerService.createSurveyLink(linkData));\n            }\n        } else {\n            // Original behavior - generate all links of the same type\n            for(let i = 0; i < count; i++){\n                const baseUid = (0,nanoid__WEBPACK_IMPORTED_MODULE_0__.nanoid)(8); // Generate a shorter base ID\n                const linkType_prefix = linkType || \"LIVE\";\n                const uid = vendorCode ? `${vendorCode}_${linkType_prefix}_${baseUid}` : `${linkType_prefix}_${baseUid}`;\n                const linkData = {\n                    projectId,\n                    uid,\n                    vendorId: vendorId || undefined,\n                    status: \"UNUSED\",\n                    metadata: JSON.stringify({\n                        originalUrl,\n                        linkType: linkType || \"LIVE\",\n                        geoRestriction: geoRestriction && geoRestriction.length > 0 ? geoRestriction : undefined\n                    })\n                };\n                creationPromises.push(amplifyServerService.createSurveyLink(linkData));\n            }\n        }\n        // Execute all creation promises\n        const createdLinksResults = await Promise.all(creationPromises);\n        // Get the created links with vendor information\n        const createdLinksResponse = await amplifyServerService.listSurveyLinksByProject(projectId);\n        // Sort by creation date with null safety\n        const sortedLinks = createdLinksResponse.data.filter((link)=>{\n            // Check if metadata contains originalUrl\n            try {\n                const metadata = link.metadata ? JSON.parse(link.metadata) : {};\n                return metadata.originalUrl === originalUrl;\n            } catch (e) {\n                return false;\n            }\n        }).sort((a, b)=>{\n            // First sort by vendor (links without vendor come first)\n            const vendorA = a.vendorId || \"\";\n            const vendorB = b.vendorId || \"\";\n            if (vendorA !== vendorB) {\n                if (!vendorA) return -1; // No vendor links first\n                if (!vendorB) return 1;\n                return vendorA.localeCompare(vendorB); // Then alphabetically by vendor ID\n            }\n            // Within same vendor, sort by creation date (newest first)\n            const dateA = a.createdAt ? new Date(a.createdAt).getTime() : 0;\n            const dateB = b.createdAt ? new Date(b.createdAt).getTime() : 0;\n            return dateB - dateA;\n        }).slice(0, totalCount);\n        // Get vendor information for links that have vendors\n        const vendorIds = sortedLinks.filter((link)=>link.vendorId).map((link)=>link.vendorId); // Add type assertion to ensure string type\n        const vendorResults = vendorIds.length > 0 ? await amplifyServerService.listVendors({\n            id: {\n                in: vendorIds\n            }\n        }) : {\n            data: []\n        };\n        const vendors = vendorResults.data.reduce((acc, vendor)=>{\n            // Fix: Add null safety for vendor id index access\n            if (vendor && vendor.id) {\n                // Extract vendor code from settings if it exists\n                let vendorCode = \"\";\n                try {\n                    const settings = vendor.settings ? JSON.parse(vendor.settings) : {};\n                    vendorCode = settings.code || \"\";\n                } catch (e) {\n                    // If parsing fails, use an empty string\n                    vendorCode = \"\";\n                }\n                acc[vendor.id] = {\n                    name: vendor.name || \"\",\n                    code: vendorCode\n                };\n            }\n            return acc;\n        }, {});\n        // Use the appropriate domain for link generation\n        const domain = getDomain(useDevelopmentDomain);\n        const protocol = useDevelopmentDomain ? \"http\" : \"https\";\n        const baseUrl = `${protocol}://${domain}`; // Format the response with complete URLs\n        const formattedLinks = sortedLinks.map((link)=>{\n            const fullUrl = `${baseUrl}/s/${projectId}/${link.uid}`;\n            // Extract data from metadata JSON\n            let linkMetadata = {};\n            try {\n                linkMetadata = link.metadata ? JSON.parse(link.metadata) : {};\n            } catch (e) {\n                // If parsing fails, use an empty object\n                linkMetadata = {};\n            }\n            // Get geo restriction data\n            let geoRestrictionData = null;\n            if (linkMetadata.geoRestriction) {\n                geoRestrictionData = linkMetadata.geoRestriction;\n            }\n            return {\n                id: link.id,\n                uid: link.uid,\n                originalUrl: linkMetadata.originalUrl || \"\",\n                status: link.status,\n                linkType: linkMetadata.linkType || \"LIVE\",\n                fullUrl: fullUrl,\n                geoRestriction: geoRestrictionData,\n                vendor: link.vendorId ? vendors[link.vendorId] : null,\n                createdAt: link.createdAt\n            };\n        });\n        // Log successful creation\n        await _lib_security_service__WEBPACK_IMPORTED_MODULE_2__.securityService.logSecurityEvent(\"LINK_GENERATION_SUCCESS\", {\n            projectId,\n            count: formattedLinks.length\n        });\n        return res.status(200).json({\n            success: true,\n            count: formattedLinks.length,\n            links: formattedLinks\n        });\n    } catch (error) {\n        console.error(\"Error generating links:\", error);\n        // Log error\n        await _lib_security_service__WEBPACK_IMPORTED_MODULE_2__.securityService.logSecurityEvent(\"LINK_GENERATION_ERROR\", {\n            // Fix: Handle unknown error type properly\n            error: error instanceof Error ? error.message : String(error)\n        });\n        return res.status(500).json({\n            success: false,\n            message: \"Failed to generate links\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL2xpbmtzL2dlbmVyYXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFDZ0M7QUFDdUM7QUFDZDtBQTJDekQsdUJBQXVCO0FBQ3ZCLE1BQU1HLG9CQUFvQkMsMkJBQThCLElBQUk7QUFDNUQsTUFBTUcscUJBQXFCO0FBRTNCLE1BQU1DLFlBQVksQ0FBQ0M7SUFDakIsT0FBT0EsaUJBQWlCRixxQkFBcUJKO0FBQy9DO0FBRUEsTUFBTU8sY0FBYyxDQUFDRDtJQUNuQixNQUFNRSxTQUFTSCxVQUFVQztJQUN6QixNQUFNRyxXQUFXSCxpQkFBaUIsU0FBUztJQUMzQyxPQUFPLENBQUMsRUFBRUcsU0FBUyxHQUFHLEVBQUVELE9BQU8sRUFBRSxDQUFDO0FBQ3BDO0FBRWUsZUFBZUUsUUFDNUJDLEdBQW1CLEVBQ25CQyxHQUFvQjtJQUVwQixJQUFJRCxJQUFJRSxNQUFNLEtBQUssUUFBUTtRQUN6QixPQUFPRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLFNBQVM7WUFBT0MsU0FBUztRQUFxQjtJQUM5RTtJQUVBLElBQUk7UUFDRixNQUFNQyx1QkFBdUJwQixvRkFBdUJBO1FBRXBELE1BQU0sRUFDSnFCLFNBQVMsRUFDVEMsV0FBVyxFQUNYQyxLQUFLLEVBQ0xDLFFBQVEsRUFDUkMsUUFBUSxFQUNSQyxjQUFjLEVBQ2RDLFNBQVMsRUFDVEMsU0FBUyxFQUNUQyxvQkFBb0IsRUFDckIsR0FBR2hCLElBQUlpQixJQUFJO1FBRVoscUNBQXFDO1FBQ3JDLE1BQU1DLEtBQUtsQixJQUFJbUIsT0FBTyxDQUFDLGtCQUFrQixFQUFFQyxjQUNoQ3BCLElBQUlxQixNQUFNLENBQUNDLGFBQWEsSUFDeEI7UUFFWCxxQkFBcUI7UUFDckIsTUFBTWxDLGtFQUFlQSxDQUFDbUMsZ0JBQWdCLENBQUMsMkJBQTJCO1lBQ2hFZjtZQUNBRztZQUNBTztZQUNBUixPQUFPQSxTQUFVSSxDQUFBQSxhQUFhQyxZQUFZRCxZQUFZQyxZQUFZO1FBQ3BFO1FBRUEsSUFBSSxDQUFDUCxhQUFhLENBQUNDLGFBQWE7WUFDOUIsT0FBT1IsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsU0FBUztnQkFBT0MsU0FBUztZQUE4QjtRQUN2RjtRQUVBLHVCQUF1QjtRQUN2QixJQUFJa0IsYUFBYWQ7UUFDakIsSUFBSUksY0FBY1csYUFBYVYsY0FBY1UsV0FBVztZQUN0RCwrREFBK0Q7WUFDL0RELGFBQWFWLFlBQVlDO1lBRXpCLElBQUlTLGFBQWEsS0FBS0EsYUFBYSxNQUFNO2dCQUN2QyxPQUFPdkIsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsU0FBUztvQkFBT0MsU0FBUztnQkFBeUM7WUFDbEc7UUFDRixPQUFPO1lBQ0wsc0NBQXNDO1lBQ3RDLElBQUksQ0FBQ0ksU0FBU0EsUUFBUSxLQUFLQSxRQUFRLE1BQU07Z0JBQ3ZDLE9BQU9ULElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVDLFNBQVM7b0JBQU9DLFNBQVM7Z0JBQW1DO1lBQzVGO1FBQ0Y7UUFFQSwwQkFBMEI7UUFDMUIsTUFBTW9CLGdCQUFnQixNQUFNbkIscUJBQXFCb0IsVUFBVSxDQUFDbkI7UUFFNUQsNkRBQTZEO1FBQzdELE1BQU1vQixVQUFVRixjQUFjRyxJQUFJO1FBRWxDLElBQUksQ0FBQ0QsU0FBUztZQUNaLE9BQU8zQixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxTQUFTO2dCQUFPQyxTQUFTO1lBQW9CO1FBQzdFO1FBQ0EsOEJBQThCO1FBQzlCLElBQUlLLFVBQVU7WUFDWixNQUFNbUIsZUFBZSxNQUFNdkIscUJBQXFCd0IsU0FBUyxDQUFDcEI7WUFDMUQsTUFBTXFCLFNBQVNGLGNBQWNEO1lBRTdCLElBQUksQ0FBQ0csUUFBUTtnQkFDWCxPQUFPL0IsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsU0FBUztvQkFBT0MsU0FBUztnQkFBbUI7WUFDNUU7WUFFQSxxRkFBcUY7WUFDckYsTUFBTTJCLHNCQUFzQixNQUFNMUIscUJBQXFCMkIsa0JBQWtCLENBQUM7Z0JBQ3hFQyxLQUFLO29CQUNIO3dCQUFFM0IsV0FBVzs0QkFBRTRCLElBQUk1Qjt3QkFBVTtvQkFBRTtvQkFDL0I7d0JBQUVHLFVBQVU7NEJBQUV5QixJQUFJekI7d0JBQVM7b0JBQUU7aUJBQzlCO1lBQ0g7WUFFQSxJQUFJLENBQUNzQixvQkFBb0JKLElBQUksSUFBSUksb0JBQW9CSixJQUFJLENBQUNRLE1BQU0sS0FBSyxHQUFHO2dCQUN0RSxPQUFPcEMsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsU0FBUztvQkFBT0MsU0FBUztnQkFBeUM7WUFDbEc7UUFDRjtRQUVBLGlCQUFpQjtRQUNqQixNQUFNZ0MsUUFBUSxFQUFFO1FBQ2hCLE1BQU1DLG1CQUFtQixFQUFFO1FBRTNCLDREQUE0RDtRQUM1RCxJQUFJQyxhQUFhO1FBQ2pCLElBQUk3QixVQUFVO1lBQ1osTUFBTW1CLGVBQWUsTUFBTXZCLHFCQUFxQndCLFNBQVMsQ0FBQ3BCO1lBQzFELE1BQU1xQixTQUFTRixjQUFjRDtZQUM3QixJQUFJRyxVQUFVQSxPQUFPUyxRQUFRLEVBQUU7Z0JBQzdCLElBQUk7b0JBQ0YsTUFBTUEsV0FBV0MsS0FBS0MsS0FBSyxDQUFDWCxPQUFPUyxRQUFRO29CQUMzQ0QsYUFBYUMsU0FBU0csSUFBSSxJQUFJO2dCQUNoQyxFQUFFLE9BQU9DLEdBQUc7b0JBQ1ZDLFFBQVFDLEtBQUssQ0FBQyxrQ0FBa0NGO2dCQUNsRDtZQUNGO1FBQ0Y7UUFFRSxzREFBc0Q7UUFDeEQsSUFBSS9CLGNBQWNXLGFBQWFWLGNBQWNVLFdBQVc7WUFDdEQsc0JBQXNCO1lBQ3RCLElBQUssSUFBSXVCLElBQUksR0FBR0EsSUFBSWxDLFdBQVdrQyxJQUFLO2dCQUNsQyxNQUFNQyxVQUFVL0QsOENBQU1BLENBQUMsSUFBSSw2QkFBNkI7Z0JBQ3hELE1BQU1nRSxNQUFNVixhQUFhLENBQUMsRUFBRUEsV0FBVyxNQUFNLEVBQUVTLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFQSxRQUFRLENBQUM7Z0JBQzVFLE1BQU1FLFdBQVc7b0JBQ2YzQztvQkFDQTBDO29CQUNBdkMsVUFBVUEsWUFBWWM7b0JBQ3RCdEIsUUFBUTtvQkFDUmlELFVBQVVWLEtBQUtXLFNBQVMsQ0FBQzt3QkFDdkI1Qzt3QkFDQUcsVUFBVTt3QkFDVkMsZ0JBQWdCQSxrQkFBa0JBLGVBQWV3QixNQUFNLEdBQUcsSUFBSXhCLGlCQUFpQlk7b0JBQ2pGO2dCQUNGO2dCQUVBYyxpQkFBaUJlLElBQUksQ0FBQy9DLHFCQUFxQmdELGdCQUFnQixDQUFDSjtZQUM5RDtZQUNFLHNCQUFzQjtZQUN4QixJQUFLLElBQUlILElBQUksR0FBR0EsSUFBSWpDLFdBQVdpQyxJQUFLO2dCQUNsQyxNQUFNQyxVQUFVL0QsOENBQU1BLENBQUMsSUFBSSw2QkFBNkI7Z0JBQ3hELE1BQU1nRSxNQUFNVixhQUFhLENBQUMsRUFBRUEsV0FBVyxNQUFNLEVBQUVTLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFQSxRQUFRLENBQUM7Z0JBQzVFLE1BQU1FLFdBQVc7b0JBQ2YzQztvQkFDQTBDO29CQUNBdkMsVUFBVUEsWUFBWWM7b0JBQ3RCdEIsUUFBUTtvQkFDUmlELFVBQVVWLEtBQUtXLFNBQVMsQ0FBQzt3QkFDdkI1Qzt3QkFDQUcsVUFBVTt3QkFDVkMsZ0JBQWdCQSxrQkFBa0JBLGVBQWV3QixNQUFNLEdBQUcsSUFBSXhCLGlCQUFpQlk7b0JBQ2pGO2dCQUNGO2dCQUVBYyxpQkFBaUJlLElBQUksQ0FBQy9DLHFCQUFxQmdELGdCQUFnQixDQUFDSjtZQUM5RDtRQUFLLE9BQU87WUFDWiwwREFBMEQ7WUFDMUQsSUFBSyxJQUFJSCxJQUFJLEdBQUdBLElBQUl0QyxPQUFPc0MsSUFBSztnQkFDOUIsTUFBTUMsVUFBVS9ELDhDQUFNQSxDQUFDLElBQUksNkJBQTZCO2dCQUN4RCxNQUFNc0Usa0JBQWtCNUMsWUFBWTtnQkFDcEMsTUFBTXNDLE1BQU1WLGFBQWEsQ0FBQyxFQUFFQSxXQUFXLENBQUMsRUFBRWdCLGdCQUFnQixDQUFDLEVBQUVQLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRU8sZ0JBQWdCLENBQUMsRUFBRVAsUUFBUSxDQUFDO2dCQUN4RyxNQUFNRSxXQUFXO29CQUNmM0M7b0JBQ0EwQztvQkFDQXZDLFVBQVVBLFlBQVljO29CQUN0QnRCLFFBQVE7b0JBQ1JpRCxVQUFVVixLQUFLVyxTQUFTLENBQUM7d0JBQ3ZCNUM7d0JBQ0FHLFVBQVVBLFlBQVk7d0JBQ3RCQyxnQkFBZ0JBLGtCQUFrQkEsZUFBZXdCLE1BQU0sR0FBRyxJQUFJeEIsaUJBQWlCWTtvQkFDakY7Z0JBQ0Y7Z0JBRUFjLGlCQUFpQmUsSUFBSSxDQUFDL0MscUJBQXFCZ0QsZ0JBQWdCLENBQUNKO1lBQzlEO1FBQ0Y7UUFFQSxnQ0FBZ0M7UUFDaEMsTUFBTU0sc0JBQXNCLE1BQU1DLFFBQVFDLEdBQUcsQ0FBQ3BCO1FBRTlDLGdEQUFnRDtRQUNoRCxNQUFNcUIsdUJBQXVCLE1BQU1yRCxxQkFBcUJzRCx3QkFBd0IsQ0FBQ3JEO1FBQy9FLHlDQUF5QztRQUMzQyxNQUFNc0QsY0FBY0YscUJBQXFCL0IsSUFBSSxDQUMxQ2tDLE1BQU0sQ0FBQyxDQUFDQztZQUNQLHlDQUF5QztZQUN6QyxJQUFJO2dCQUNGLE1BQU1aLFdBQVdZLEtBQUtaLFFBQVEsR0FBR1YsS0FBS0MsS0FBSyxDQUFDcUIsS0FBS1osUUFBUSxJQUFjLENBQUM7Z0JBQ3hFLE9BQU9BLFNBQVMzQyxXQUFXLEtBQUtBO1lBQ2xDLEVBQUUsT0FBT29DLEdBQUc7Z0JBQ1YsT0FBTztZQUNUO1FBQ0YsR0FDQ29CLElBQUksQ0FBQyxDQUFDQyxHQUFlQztZQUNwQix5REFBeUQ7WUFDekQsTUFBTUMsVUFBVUYsRUFBRXZELFFBQVEsSUFBSTtZQUM5QixNQUFNMEQsVUFBVUYsRUFBRXhELFFBQVEsSUFBSTtZQUU5QixJQUFJeUQsWUFBWUMsU0FBUztnQkFDdkIsSUFBSSxDQUFDRCxTQUFTLE9BQU8sQ0FBQyxHQUFHLHdCQUF3QjtnQkFDakQsSUFBSSxDQUFDQyxTQUFTLE9BQU87Z0JBQ3JCLE9BQU9ELFFBQVFFLGFBQWEsQ0FBQ0QsVUFBVSxtQ0FBbUM7WUFDNUU7WUFFQSwyREFBMkQ7WUFDM0QsTUFBTUUsUUFBUUwsRUFBRU0sU0FBUyxHQUFHLElBQUlDLEtBQUtQLEVBQUVNLFNBQVMsRUFBRUUsT0FBTyxLQUFLO1lBQzlELE1BQU1DLFFBQVFSLEVBQUVLLFNBQVMsR0FBRyxJQUFJQyxLQUFLTixFQUFFSyxTQUFTLEVBQUVFLE9BQU8sS0FBSztZQUM5RCxPQUFPQyxRQUFRSjtRQUNqQixHQUNDSyxLQUFLLENBQUMsR0FBR3BEO1FBRVoscURBQXFEO1FBQ3JELE1BQU1xRCxZQUFZZixZQUNmQyxNQUFNLENBQUMsQ0FBQ0MsT0FBcUJBLEtBQUtyRCxRQUFRLEVBQzFDbUUsR0FBRyxDQUFDLENBQUNkLE9BQXFCQSxLQUFLckQsUUFBUSxHQUFjLDJDQUEyQztRQUVuRyxNQUFNb0UsZ0JBQWdCRixVQUFVeEMsTUFBTSxHQUFHLElBQ3ZDLE1BQU05QixxQkFBcUJ5RSxXQUFXLENBQUM7WUFBRUMsSUFBSTtnQkFBRUMsSUFBSUw7WUFBVTtRQUFFLEtBQy9EO1lBQUVoRCxNQUFNLEVBQUU7UUFBQztRQUNYLE1BQU1zRCxVQUFVSixjQUFjbEQsSUFBSSxDQUFDdUQsTUFBTSxDQUFDLENBQUNDLEtBQXFEckQ7WUFDaEcsa0RBQWtEO1lBQ2xELElBQUlBLFVBQVVBLE9BQU9pRCxFQUFFLEVBQUU7Z0JBQ3ZCLGlEQUFpRDtnQkFDakQsSUFBSXpDLGFBQWE7Z0JBQ2pCLElBQUk7b0JBQ0YsTUFBTUMsV0FBV1QsT0FBT1MsUUFBUSxHQUFHQyxLQUFLQyxLQUFLLENBQUNYLE9BQU9TLFFBQVEsSUFBYyxDQUFDO29CQUM1RUQsYUFBYUMsU0FBU0csSUFBSSxJQUFJO2dCQUNoQyxFQUFFLE9BQU9DLEdBQUc7b0JBQ1Ysd0NBQXdDO29CQUN4Q0wsYUFBYTtnQkFDZjtnQkFFQTZDLEdBQUcsQ0FBQ3JELE9BQU9pRCxFQUFFLENBQUMsR0FBRztvQkFDZkssTUFBTXRELE9BQU9zRCxJQUFJLElBQUk7b0JBQ3JCMUMsTUFBTUo7Z0JBQ1I7WUFDRjtZQUNBLE9BQU82QztRQUNULEdBQUcsQ0FBQztRQUVKLGlEQUFpRDtRQUNqRCxNQUFNeEYsU0FBU0gsVUFBVXNCO1FBQ3pCLE1BQU1sQixXQUFXa0IsdUJBQXVCLFNBQVM7UUFDakQsTUFBTXVFLFVBQVUsQ0FBQyxFQUFFekYsU0FBUyxHQUFHLEVBQUVELE9BQU8sQ0FBQyxFQUFLLHlDQUF5QztRQUN2RixNQUFNMkYsaUJBQWlCMUIsWUFBWWdCLEdBQUcsQ0FBQyxDQUFDZDtZQUN0QyxNQUFNeUIsVUFBVSxDQUFDLEVBQUVGLFFBQVEsR0FBRyxFQUFFL0UsVUFBVSxDQUFDLEVBQUV3RCxLQUFLZCxHQUFHLENBQUMsQ0FBQztZQUV2RCxrQ0FBa0M7WUFDbEMsSUFBSXdDLGVBQW9CLENBQUM7WUFDekIsSUFBSTtnQkFDRkEsZUFBZTFCLEtBQUtaLFFBQVEsR0FBR1YsS0FBS0MsS0FBSyxDQUFDcUIsS0FBS1osUUFBUSxJQUFjLENBQUM7WUFDeEUsRUFBRSxPQUFPUCxHQUFHO2dCQUNWLHdDQUF3QztnQkFDeEM2QyxlQUFlLENBQUM7WUFDbEI7WUFFQSwyQkFBMkI7WUFDM0IsSUFBSUMscUJBQXFCO1lBQ3pCLElBQUlELGFBQWE3RSxjQUFjLEVBQUU7Z0JBQy9COEUscUJBQXFCRCxhQUFhN0UsY0FBYztZQUNsRDtZQUVBLE9BQU87Z0JBQ0xvRSxJQUFJakIsS0FBS2lCLEVBQUU7Z0JBQ1gvQixLQUFLYyxLQUFLZCxHQUFHO2dCQUNiekMsYUFBYWlGLGFBQWFqRixXQUFXLElBQUk7Z0JBQ3pDTixRQUFRNkQsS0FBSzdELE1BQU07Z0JBQ25CUyxVQUFVOEUsYUFBYTlFLFFBQVEsSUFBSTtnQkFDbkM2RSxTQUFTQTtnQkFDVDVFLGdCQUFnQjhFO2dCQUNoQjNELFFBQVFnQyxLQUFLckQsUUFBUSxHQUFHd0UsT0FBTyxDQUFDbkIsS0FBS3JELFFBQVEsQ0FBQyxHQUFHO2dCQUNqRDZELFdBQVdSLEtBQUtRLFNBQVM7WUFDM0I7UUFDRjtRQUVBLDBCQUEwQjtRQUMxQixNQUFNcEYsa0VBQWVBLENBQUNtQyxnQkFBZ0IsQ0FBQywyQkFBMkI7WUFDaEVmO1lBQ0FFLE9BQU84RSxlQUFlbkQsTUFBTTtRQUM5QjtRQUVBLE9BQU9wQyxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCQyxTQUFTO1lBQ1RLLE9BQU84RSxlQUFlbkQsTUFBTTtZQUM1QkMsT0FBT2tEO1FBQ1Q7SUFDRixFQUFFLE9BQU96QyxPQUFPO1FBQ2RELFFBQVFDLEtBQUssQ0FBQywyQkFBMkJBO1FBRXpDLFlBQVk7UUFDWixNQUFNM0Qsa0VBQWVBLENBQUNtQyxnQkFBZ0IsQ0FBQyx5QkFBeUI7WUFDOUQsMENBQTBDO1lBQzFDd0IsT0FBT0EsaUJBQWlCNkMsUUFBUTdDLE1BQU16QyxPQUFPLEdBQUd1RixPQUFPOUM7UUFDekQ7UUFFQSxPQUFPOUMsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQkMsU0FBUztZQUNUQyxTQUFTO1FBQ1g7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3VydmV5LWxpbmstd3JhcHBlci8uL3NyYy9wYWdlcy9hcGkvbGlua3MvZ2VuZXJhdGUudHM/NWIwMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IG5hbm9pZCB9IGZyb20gJ25hbm9pZCc7XG5pbXBvcnQgeyBnZXRBbXBsaWZ5U2VydmVyU2VydmljZSB9IGZyb20gJ0AvbGliL2FtcGxpZnktc2VydmVyLXNlcnZpY2UnO1xuaW1wb3J0IHsgc2VjdXJpdHlTZXJ2aWNlIH0gZnJvbSAnQC9saWIvc2VjdXJpdHktc2VydmljZSc7XG5cbi8vIFVzZSB0eXBlcyB0aGF0IG1hdGNoIG91ciBzZXJ2ZXIgc2VydmljZVxudHlwZSBTdXJ2ZXlMaW5rU3RhdHVzID0gJ1VOVVNFRCcgfCAnQ0xJQ0tFRCcgfCAnQ09NUExFVEVEJyB8ICdESVNRVUFMSUZJRUQnIHwgJ1FVT1RBX0ZVTEwnO1xuXG5pbnRlcmZhY2UgU3VydmV5TGluayB7XG4gIGlkOiBzdHJpbmc7XG4gIHByb2plY3RJZDogc3RyaW5nO1xuICB1aWQ6IHN0cmluZztcbiAgdmVuZG9ySWQ/OiBzdHJpbmc7XG4gIHN0YXR1czogU3VydmV5TGlua1N0YXR1cztcbiAgY2xpY2tlZEF0Pzogc3RyaW5nO1xuICBjb21wbGV0ZWRBdD86IHN0cmluZztcbiAgaXBBZGRyZXNzPzogc3RyaW5nO1xuICB1c2VyQWdlbnQ/OiBzdHJpbmc7XG4gIGdlb0RhdGE/OiBhbnk7XG4gIG1ldGFkYXRhPzogYW55O1xuICBjcmVhdGVkQXQ6IHN0cmluZztcbiAgdXBkYXRlZEF0OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBWZW5kb3Ige1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGNvbnRhY3ROYW1lPzogc3RyaW5nO1xuICBjb250YWN0RW1haWw/OiBzdHJpbmc7XG4gIHNldHRpbmdzPzogYW55O1xuICBjcmVhdGVkQXQ6IHN0cmluZztcbiAgdXBkYXRlZEF0OiBzdHJpbmc7XG59XG5cbnR5cGUgR2VuZXJhdGVMaW5rc1JlcXVlc3QgPSB7XG4gIHByb2plY3RJZDogc3RyaW5nO1xuICBvcmlnaW5hbFVybDogc3RyaW5nO1xuICBjb3VudDogbnVtYmVyO1xuICB2ZW5kb3JJZD86IHN0cmluZztcbiAgbGlua1R5cGU6ICdURVNUJyB8ICdMSVZFJztcbiAgZ2VvUmVzdHJpY3Rpb24/OiBzdHJpbmdbXTtcbiAgdGVzdENvdW50PzogbnVtYmVyOyAvLyBGb3Igc3BsaXQgYmV0d2VlbiB0ZXN0L2xpdmUgbGlua3NcbiAgbGl2ZUNvdW50PzogbnVtYmVyOyAvLyBGb3Igc3BsaXQgYmV0d2VlbiB0ZXN0L2xpdmUgbGlua3NcbiAgdXNlRGV2ZWxvcG1lbnREb21haW4/OiBib29sZWFuOyAvLyBGb3IgbG9jYWxob3N0IGRldmVsb3BtZW50XG59O1xuXG4vLyBEb21haW4gY29uZmlndXJhdGlvblxuY29uc3QgUFJPRFVDVElPTl9ET01BSU4gPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19ET01BSU4gfHwgJ3Byb3RlZ2VyZXNlYXJjaHN1cnZleS5jb20nO1xuY29uc3QgREVWRUxPUE1FTlRfRE9NQUlOID0gJ2xvY2FsaG9zdDozMDAwJztcblxuY29uc3QgZ2V0RG9tYWluID0gKHVzZURldmVsb3BtZW50PzogYm9vbGVhbikgPT4ge1xuICByZXR1cm4gdXNlRGV2ZWxvcG1lbnQgPyBERVZFTE9QTUVOVF9ET01BSU4gOiBQUk9EVUNUSU9OX0RPTUFJTjtcbn07XG5cbmNvbnN0IGdldFNob3J0VXJsID0gKHVzZURldmVsb3BtZW50PzogYm9vbGVhbikgPT4ge1xuICBjb25zdCBkb21haW4gPSBnZXREb21haW4odXNlRGV2ZWxvcG1lbnQpO1xuICBjb25zdCBwcm90b2NvbCA9IHVzZURldmVsb3BtZW50ID8gJ2h0dHAnIDogJ2h0dHBzJztcbiAgcmV0dXJuIGAke3Byb3RvY29sfTovLyR7ZG9tYWlufS9zYDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlXG4pIHtcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgYW1wbGlmeVNlcnZlclNlcnZpY2UgPSBnZXRBbXBsaWZ5U2VydmVyU2VydmljZSgpO1xuICAgIFxuICAgIGNvbnN0IHsgXG4gICAgICBwcm9qZWN0SWQsIFxuICAgICAgb3JpZ2luYWxVcmwsIFxuICAgICAgY291bnQsIFxuICAgICAgdmVuZG9ySWQsIFxuICAgICAgbGlua1R5cGUsIFxuICAgICAgZ2VvUmVzdHJpY3Rpb24sXG4gICAgICB0ZXN0Q291bnQsXG4gICAgICBsaXZlQ291bnQsXG4gICAgICB1c2VEZXZlbG9wbWVudERvbWFpbiBcbiAgICB9ID0gcmVxLmJvZHkgYXMgR2VuZXJhdGVMaW5rc1JlcXVlc3Q7XG5cbiAgICAvLyBHZXQgY2xpZW50IElQIGZvciBzZWN1cml0eSBsb2dnaW5nXG4gICAgY29uc3QgaXAgPSByZXEuaGVhZGVyc1sneC1mb3J3YXJkZWQtZm9yJ10/LnRvU3RyaW5nKCkgfHwgXG4gICAgICAgICAgICAgICByZXEuc29ja2V0LnJlbW90ZUFkZHJlc3MgfHwgXG4gICAgICAgICAgICAgICAndW5rbm93bic7XG4gICAgXG4gICAgLy8gTG9nIHNlY3VyaXR5IGV2ZW50XG4gICAgYXdhaXQgc2VjdXJpdHlTZXJ2aWNlLmxvZ1NlY3VyaXR5RXZlbnQoJ0xJTktfR0VORVJBVElPTl9BVFRFTVBUJywge1xuICAgICAgcHJvamVjdElkLFxuICAgICAgdmVuZG9ySWQsXG4gICAgICBpcCxcbiAgICAgIGNvdW50OiBjb3VudCB8fCAodGVzdENvdW50ICYmIGxpdmVDb3VudCA/IHRlc3RDb3VudCArIGxpdmVDb3VudCA6IDApXG4gICAgfSk7XG5cbiAgICBpZiAoIXByb2plY3RJZCB8fCAhb3JpZ2luYWxVcmwpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnTWlzc2luZyByZXF1aXJlZCBwYXJhbWV0ZXJzJyB9KTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBjb3VudCBsb2dpY1xuICAgIGxldCB0b3RhbENvdW50ID0gY291bnQ7XG4gICAgaWYgKHRlc3RDb3VudCAhPT0gdW5kZWZpbmVkICYmIGxpdmVDb3VudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBJZiBib3RoIHRlc3QgYW5kIGxpdmUgY291bnRzIGFyZSBwcm92aWRlZCwgdXNlIHRob3NlIGluc3RlYWRcbiAgICAgIHRvdGFsQ291bnQgPSB0ZXN0Q291bnQgKyBsaXZlQ291bnQ7XG4gICAgICBcbiAgICAgIGlmICh0b3RhbENvdW50IDwgMSB8fCB0b3RhbENvdW50ID4gMTAwMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ1RvdGFsIGNvdW50IG11c3QgYmUgYmV0d2VlbiAxIGFuZCAxMDAwJyB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gT3RoZXJ3aXNlIHVzZSB0aGUgdG90YWwgY291bnQgdmFsdWVcbiAgICAgIGlmICghY291bnQgfHwgY291bnQgPCAxIHx8IGNvdW50ID4gMTAwMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ0NvdW50IG11c3QgYmUgYmV0d2VlbiAxIGFuZCAxMDAwJyB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBwcm9qZWN0IGV4aXN0c1xuICAgIGNvbnN0IHByb2plY3RSZXN1bHQgPSBhd2FpdCBhbXBsaWZ5U2VydmVyU2VydmljZS5nZXRQcm9qZWN0KHByb2plY3RJZCk7XG4gICAgXG4gICAgLy8gRml4OiBFeHRyYWN0IHByb2plY3QgY29ycmVjdGx5IGJ5IGFjY2Vzc2luZyAuZGF0YSBwcm9wZXJ0eVxuICAgIGNvbnN0IHByb2plY3QgPSBwcm9qZWN0UmVzdWx0LmRhdGE7XG5cbiAgICBpZiAoIXByb2plY3QpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnUHJvamVjdCBub3QgZm91bmQnIH0pO1xuICAgIH1cbiAgICAvLyBWYWxpZGF0ZSB2ZW5kb3IgaWYgcHJvdmlkZWRcbiAgICBpZiAodmVuZG9ySWQpIHtcbiAgICAgIGNvbnN0IHZlbmRvclJlc3VsdCA9IGF3YWl0IGFtcGxpZnlTZXJ2ZXJTZXJ2aWNlLmdldFZlbmRvcih2ZW5kb3JJZCk7XG4gICAgICBjb25zdCB2ZW5kb3IgPSB2ZW5kb3JSZXN1bHQ/LmRhdGE7XG5cbiAgICAgIGlmICghdmVuZG9yKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnVmVuZG9yIG5vdCBmb3VuZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHZlbmRvciBiZWxvbmdzIHRvIHRoaXMgcHJvamVjdCBieSBjaGVja2luZyB0aGUgUHJvamVjdFZlbmRvciByZWxhdGlvbnNoaXBcbiAgICAgIGNvbnN0IHByb2plY3RWZW5kb3JSZXN1bHQgPSBhd2FpdCBhbXBsaWZ5U2VydmVyU2VydmljZS5saXN0UHJvamVjdFZlbmRvcnMoe1xuICAgICAgICBhbmQ6IFtcbiAgICAgICAgICB7IHByb2plY3RJZDogeyBlcTogcHJvamVjdElkIH0gfSxcbiAgICAgICAgICB7IHZlbmRvcklkOiB7IGVxOiB2ZW5kb3JJZCB9IH1cbiAgICAgICAgXVxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcHJvamVjdFZlbmRvclJlc3VsdC5kYXRhIHx8IHByb2plY3RWZW5kb3JSZXN1bHQuZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdWZW5kb3IgZG9lcyBub3QgYmVsb25nIHRvIHRoaXMgcHJvamVjdCcgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgbGlua3NcbiAgICBjb25zdCBsaW5rcyA9IFtdO1xuICAgIGNvbnN0IGNyZWF0aW9uUHJvbWlzZXMgPSBbXTtcbiAgICBcbiAgICAvLyBHZXQgdmVuZG9yIGNvZGUgZm9yIFVJRCBnZW5lcmF0aW9uIGlmIHZlbmRvciBpcyBzcGVjaWZpZWRcbiAgICBsZXQgdmVuZG9yQ29kZSA9ICcnO1xuICAgIGlmICh2ZW5kb3JJZCkge1xuICAgICAgY29uc3QgdmVuZG9yUmVzdWx0ID0gYXdhaXQgYW1wbGlmeVNlcnZlclNlcnZpY2UuZ2V0VmVuZG9yKHZlbmRvcklkKTtcbiAgICAgIGNvbnN0IHZlbmRvciA9IHZlbmRvclJlc3VsdD8uZGF0YTtcbiAgICAgIGlmICh2ZW5kb3IgJiYgdmVuZG9yLnNldHRpbmdzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBKU09OLnBhcnNlKHZlbmRvci5zZXR0aW5ncyBhcyBzdHJpbmcpO1xuICAgICAgICAgIHZlbmRvckNvZGUgPSBzZXR0aW5ncy5jb2RlIHx8ICcnO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyB2ZW5kb3Igc2V0dGluZ3M6JywgZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgICAvLyBIYW5kbGUgbWl4ZWQgVEVTVC9MSVZFIGxpbmtzIGlmIGNvdW50cyBhcmUgcHJvdmlkZWRcbiAgICBpZiAodGVzdENvdW50ICE9PSB1bmRlZmluZWQgJiYgbGl2ZUNvdW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIEdlbmVyYXRlIFRFU1QgbGlua3NcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGVzdENvdW50OyBpKyspIHtcbiAgICAgICAgY29uc3QgYmFzZVVpZCA9IG5hbm9pZCg4KTsgLy8gR2VuZXJhdGUgYSBzaG9ydGVyIGJhc2UgSURcbiAgICAgICAgY29uc3QgdWlkID0gdmVuZG9yQ29kZSA/IGAke3ZlbmRvckNvZGV9X1RFU1RfJHtiYXNlVWlkfWAgOiBgVEVTVF8ke2Jhc2VVaWR9YDtcbiAgICAgICAgY29uc3QgbGlua0RhdGEgPSB7XG4gICAgICAgICAgcHJvamVjdElkLFxuICAgICAgICAgIHVpZCxcbiAgICAgICAgICB2ZW5kb3JJZDogdmVuZG9ySWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIHN0YXR1czogJ1VOVVNFRCcsXG4gICAgICAgICAgbWV0YWRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIG9yaWdpbmFsVXJsLFxuICAgICAgICAgICAgbGlua1R5cGU6ICdURVNUJyxcbiAgICAgICAgICAgIGdlb1Jlc3RyaWN0aW9uOiBnZW9SZXN0cmljdGlvbiAmJiBnZW9SZXN0cmljdGlvbi5sZW5ndGggPiAwID8gZ2VvUmVzdHJpY3Rpb24gOiB1bmRlZmluZWRcbiAgICAgICAgICB9KVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgY3JlYXRpb25Qcm9taXNlcy5wdXNoKGFtcGxpZnlTZXJ2ZXJTZXJ2aWNlLmNyZWF0ZVN1cnZleUxpbmsobGlua0RhdGEpKTtcbiAgICAgIH1cbiAgICAgICAgLy8gR2VuZXJhdGUgTElWRSBsaW5rc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXZlQ291bnQ7IGkrKykge1xuICAgICAgICBjb25zdCBiYXNlVWlkID0gbmFub2lkKDgpOyAvLyBHZW5lcmF0ZSBhIHNob3J0ZXIgYmFzZSBJRFxuICAgICAgICBjb25zdCB1aWQgPSB2ZW5kb3JDb2RlID8gYCR7dmVuZG9yQ29kZX1fTElWRV8ke2Jhc2VVaWR9YCA6IGBMSVZFXyR7YmFzZVVpZH1gO1xuICAgICAgICBjb25zdCBsaW5rRGF0YSA9IHtcbiAgICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgICAgdWlkLFxuICAgICAgICAgIHZlbmRvcklkOiB2ZW5kb3JJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgc3RhdHVzOiAnVU5VU0VEJyxcbiAgICAgICAgICBtZXRhZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgb3JpZ2luYWxVcmwsXG4gICAgICAgICAgICBsaW5rVHlwZTogJ0xJVkUnLFxuICAgICAgICAgICAgZ2VvUmVzdHJpY3Rpb246IGdlb1Jlc3RyaWN0aW9uICYmIGdlb1Jlc3RyaWN0aW9uLmxlbmd0aCA+IDAgPyBnZW9SZXN0cmljdGlvbiA6IHVuZGVmaW5lZFxuICAgICAgICAgIH0pXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBjcmVhdGlvblByb21pc2VzLnB1c2goYW1wbGlmeVNlcnZlclNlcnZpY2UuY3JlYXRlU3VydmV5TGluayhsaW5rRGF0YSkpO1xuICAgICAgfSAgICB9IGVsc2Uge1xuICAgICAgLy8gT3JpZ2luYWwgYmVoYXZpb3IgLSBnZW5lcmF0ZSBhbGwgbGlua3Mgb2YgdGhlIHNhbWUgdHlwZVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGJhc2VVaWQgPSBuYW5vaWQoOCk7IC8vIEdlbmVyYXRlIGEgc2hvcnRlciBiYXNlIElEXG4gICAgICAgIGNvbnN0IGxpbmtUeXBlX3ByZWZpeCA9IGxpbmtUeXBlIHx8ICdMSVZFJztcbiAgICAgICAgY29uc3QgdWlkID0gdmVuZG9yQ29kZSA/IGAke3ZlbmRvckNvZGV9XyR7bGlua1R5cGVfcHJlZml4fV8ke2Jhc2VVaWR9YCA6IGAke2xpbmtUeXBlX3ByZWZpeH1fJHtiYXNlVWlkfWA7XG4gICAgICAgIGNvbnN0IGxpbmtEYXRhID0ge1xuICAgICAgICAgIHByb2plY3RJZCxcbiAgICAgICAgICB1aWQsXG4gICAgICAgICAgdmVuZG9ySWQ6IHZlbmRvcklkIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICBzdGF0dXM6ICdVTlVTRUQnLFxuICAgICAgICAgIG1ldGFkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBvcmlnaW5hbFVybCxcbiAgICAgICAgICAgIGxpbmtUeXBlOiBsaW5rVHlwZSB8fCAnTElWRScsXG4gICAgICAgICAgICBnZW9SZXN0cmljdGlvbjogZ2VvUmVzdHJpY3Rpb24gJiYgZ2VvUmVzdHJpY3Rpb24ubGVuZ3RoID4gMCA/IGdlb1Jlc3RyaWN0aW9uIDogdW5kZWZpbmVkXG4gICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGNyZWF0aW9uUHJvbWlzZXMucHVzaChhbXBsaWZ5U2VydmVyU2VydmljZS5jcmVhdGVTdXJ2ZXlMaW5rKGxpbmtEYXRhKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRXhlY3V0ZSBhbGwgY3JlYXRpb24gcHJvbWlzZXNcbiAgICBjb25zdCBjcmVhdGVkTGlua3NSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoY3JlYXRpb25Qcm9taXNlcyk7XG4gICAgXG4gICAgLy8gR2V0IHRoZSBjcmVhdGVkIGxpbmtzIHdpdGggdmVuZG9yIGluZm9ybWF0aW9uXG4gICAgY29uc3QgY3JlYXRlZExpbmtzUmVzcG9uc2UgPSBhd2FpdCBhbXBsaWZ5U2VydmVyU2VydmljZS5saXN0U3VydmV5TGlua3NCeVByb2plY3QocHJvamVjdElkKTtcbiAgICAgIC8vIFNvcnQgYnkgY3JlYXRpb24gZGF0ZSB3aXRoIG51bGwgc2FmZXR5XG4gICAgY29uc3Qgc29ydGVkTGlua3MgPSBjcmVhdGVkTGlua3NSZXNwb25zZS5kYXRhXG4gICAgICAuZmlsdGVyKChsaW5rOiBTdXJ2ZXlMaW5rKSA9PiB7XG4gICAgICAgIC8vIENoZWNrIGlmIG1ldGFkYXRhIGNvbnRhaW5zIG9yaWdpbmFsVXJsXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBsaW5rLm1ldGFkYXRhID8gSlNPTi5wYXJzZShsaW5rLm1ldGFkYXRhIGFzIHN0cmluZykgOiB7fTtcbiAgICAgICAgICByZXR1cm4gbWV0YWRhdGEub3JpZ2luYWxVcmwgPT09IG9yaWdpbmFsVXJsO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLnNvcnQoKGE6IFN1cnZleUxpbmssIGI6IFN1cnZleUxpbmspID0+IHtcbiAgICAgICAgLy8gRmlyc3Qgc29ydCBieSB2ZW5kb3IgKGxpbmtzIHdpdGhvdXQgdmVuZG9yIGNvbWUgZmlyc3QpXG4gICAgICAgIGNvbnN0IHZlbmRvckEgPSBhLnZlbmRvcklkIHx8ICcnO1xuICAgICAgICBjb25zdCB2ZW5kb3JCID0gYi52ZW5kb3JJZCB8fCAnJztcbiAgICAgICAgXG4gICAgICAgIGlmICh2ZW5kb3JBICE9PSB2ZW5kb3JCKSB7XG4gICAgICAgICAgaWYgKCF2ZW5kb3JBKSByZXR1cm4gLTE7IC8vIE5vIHZlbmRvciBsaW5rcyBmaXJzdFxuICAgICAgICAgIGlmICghdmVuZG9yQikgcmV0dXJuIDE7XG4gICAgICAgICAgcmV0dXJuIHZlbmRvckEubG9jYWxlQ29tcGFyZSh2ZW5kb3JCKTsgLy8gVGhlbiBhbHBoYWJldGljYWxseSBieSB2ZW5kb3IgSURcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gV2l0aGluIHNhbWUgdmVuZG9yLCBzb3J0IGJ5IGNyZWF0aW9uIGRhdGUgKG5ld2VzdCBmaXJzdClcbiAgICAgICAgY29uc3QgZGF0ZUEgPSBhLmNyZWF0ZWRBdCA/IG5ldyBEYXRlKGEuY3JlYXRlZEF0KS5nZXRUaW1lKCkgOiAwO1xuICAgICAgICBjb25zdCBkYXRlQiA9IGIuY3JlYXRlZEF0ID8gbmV3IERhdGUoYi5jcmVhdGVkQXQpLmdldFRpbWUoKSA6IDA7XG4gICAgICAgIHJldHVybiBkYXRlQiAtIGRhdGVBO1xuICAgICAgfSlcbiAgICAgIC5zbGljZSgwLCB0b3RhbENvdW50KTtcbiAgICBcbiAgICAvLyBHZXQgdmVuZG9yIGluZm9ybWF0aW9uIGZvciBsaW5rcyB0aGF0IGhhdmUgdmVuZG9yc1xuICAgIGNvbnN0IHZlbmRvcklkcyA9IHNvcnRlZExpbmtzXG4gICAgICAuZmlsdGVyKChsaW5rOiBTdXJ2ZXlMaW5rKSA9PiBsaW5rLnZlbmRvcklkKVxuICAgICAgLm1hcCgobGluazogU3VydmV5TGluaykgPT4gbGluay52ZW5kb3JJZCBhcyBzdHJpbmcpOyAgLy8gQWRkIHR5cGUgYXNzZXJ0aW9uIHRvIGVuc3VyZSBzdHJpbmcgdHlwZVxuICAgIFxuICAgIGNvbnN0IHZlbmRvclJlc3VsdHMgPSB2ZW5kb3JJZHMubGVuZ3RoID4gMCA/IFxuICAgICAgYXdhaXQgYW1wbGlmeVNlcnZlclNlcnZpY2UubGlzdFZlbmRvcnMoeyBpZDogeyBpbjogdmVuZG9ySWRzIH0gfSkgOiBcbiAgICAgIHsgZGF0YTogW10gfTtcbiAgICAgIGNvbnN0IHZlbmRvcnMgPSB2ZW5kb3JSZXN1bHRzLmRhdGEucmVkdWNlKChhY2M6IFJlY29yZDxzdHJpbmcsIHsgbmFtZTogc3RyaW5nOyBjb2RlOiBzdHJpbmcgfT4sIHZlbmRvcjogVmVuZG9yKSA9PiB7XG4gICAgICAvLyBGaXg6IEFkZCBudWxsIHNhZmV0eSBmb3IgdmVuZG9yIGlkIGluZGV4IGFjY2Vzc1xuICAgICAgaWYgKHZlbmRvciAmJiB2ZW5kb3IuaWQpIHtcbiAgICAgICAgLy8gRXh0cmFjdCB2ZW5kb3IgY29kZSBmcm9tIHNldHRpbmdzIGlmIGl0IGV4aXN0c1xuICAgICAgICBsZXQgdmVuZG9yQ29kZSA9ICcnO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gdmVuZG9yLnNldHRpbmdzID8gSlNPTi5wYXJzZSh2ZW5kb3Iuc2V0dGluZ3MgYXMgc3RyaW5nKSA6IHt9O1xuICAgICAgICAgIHZlbmRvckNvZGUgPSBzZXR0aW5ncy5jb2RlIHx8ICcnO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgLy8gSWYgcGFyc2luZyBmYWlscywgdXNlIGFuIGVtcHR5IHN0cmluZ1xuICAgICAgICAgIHZlbmRvckNvZGUgPSAnJztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgYWNjW3ZlbmRvci5pZF0gPSB7IFxuICAgICAgICAgIG5hbWU6IHZlbmRvci5uYW1lIHx8ICcnLCBcbiAgICAgICAgICBjb2RlOiB2ZW5kb3JDb2RlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIHsgbmFtZTogc3RyaW5nOyBjb2RlOiBzdHJpbmcgfT4pO1xuXG4gICAgLy8gVXNlIHRoZSBhcHByb3ByaWF0ZSBkb21haW4gZm9yIGxpbmsgZ2VuZXJhdGlvblxuICAgIGNvbnN0IGRvbWFpbiA9IGdldERvbWFpbih1c2VEZXZlbG9wbWVudERvbWFpbik7XG4gICAgY29uc3QgcHJvdG9jb2wgPSB1c2VEZXZlbG9wbWVudERvbWFpbiA/ICdodHRwJyA6ICdodHRwcyc7XG4gICAgY29uc3QgYmFzZVVybCA9IGAke3Byb3RvY29sfTovLyR7ZG9tYWlufWA7ICAgIC8vIEZvcm1hdCB0aGUgcmVzcG9uc2Ugd2l0aCBjb21wbGV0ZSBVUkxzXG4gICAgY29uc3QgZm9ybWF0dGVkTGlua3MgPSBzb3J0ZWRMaW5rcy5tYXAoKGxpbms6IFN1cnZleUxpbmspID0+IHtcbiAgICAgIGNvbnN0IGZ1bGxVcmwgPSBgJHtiYXNlVXJsfS9zLyR7cHJvamVjdElkfS8ke2xpbmsudWlkfWA7XG4gICAgICBcbiAgICAgIC8vIEV4dHJhY3QgZGF0YSBmcm9tIG1ldGFkYXRhIEpTT05cbiAgICAgIGxldCBsaW5rTWV0YWRhdGE6IGFueSA9IHt9O1xuICAgICAgdHJ5IHtcbiAgICAgICAgbGlua01ldGFkYXRhID0gbGluay5tZXRhZGF0YSA/IEpTT04ucGFyc2UobGluay5tZXRhZGF0YSBhcyBzdHJpbmcpIDoge307XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIElmIHBhcnNpbmcgZmFpbHMsIHVzZSBhbiBlbXB0eSBvYmplY3RcbiAgICAgICAgbGlua01ldGFkYXRhID0ge307XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEdldCBnZW8gcmVzdHJpY3Rpb24gZGF0YVxuICAgICAgbGV0IGdlb1Jlc3RyaWN0aW9uRGF0YSA9IG51bGw7XG4gICAgICBpZiAobGlua01ldGFkYXRhLmdlb1Jlc3RyaWN0aW9uKSB7XG4gICAgICAgIGdlb1Jlc3RyaWN0aW9uRGF0YSA9IGxpbmtNZXRhZGF0YS5nZW9SZXN0cmljdGlvbjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGxpbmsuaWQsXG4gICAgICAgIHVpZDogbGluay51aWQsXG4gICAgICAgIG9yaWdpbmFsVXJsOiBsaW5rTWV0YWRhdGEub3JpZ2luYWxVcmwgfHwgJycsIC8vIEdldCBvcmlnaW5hbFVybCBmcm9tIG1ldGFkYXRhXG4gICAgICAgIHN0YXR1czogbGluay5zdGF0dXMsXG4gICAgICAgIGxpbmtUeXBlOiBsaW5rTWV0YWRhdGEubGlua1R5cGUgfHwgJ0xJVkUnLFxuICAgICAgICBmdWxsVXJsOiBmdWxsVXJsLFxuICAgICAgICBnZW9SZXN0cmljdGlvbjogZ2VvUmVzdHJpY3Rpb25EYXRhLFxuICAgICAgICB2ZW5kb3I6IGxpbmsudmVuZG9ySWQgPyB2ZW5kb3JzW2xpbmsudmVuZG9ySWRdIDogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBsaW5rLmNyZWF0ZWRBdFxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIC8vIExvZyBzdWNjZXNzZnVsIGNyZWF0aW9uXG4gICAgYXdhaXQgc2VjdXJpdHlTZXJ2aWNlLmxvZ1NlY3VyaXR5RXZlbnQoJ0xJTktfR0VORVJBVElPTl9TVUNDRVNTJywge1xuICAgICAgcHJvamVjdElkLFxuICAgICAgY291bnQ6IGZvcm1hdHRlZExpbmtzLmxlbmd0aFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBjb3VudDogZm9ybWF0dGVkTGlua3MubGVuZ3RoLFxuICAgICAgbGlua3M6IGZvcm1hdHRlZExpbmtzXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2VuZXJhdGluZyBsaW5rczonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gTG9nIGVycm9yXG4gICAgYXdhaXQgc2VjdXJpdHlTZXJ2aWNlLmxvZ1NlY3VyaXR5RXZlbnQoJ0xJTktfR0VORVJBVElPTl9FUlJPUicsIHtcbiAgICAgIC8vIEZpeDogSGFuZGxlIHVua25vd24gZXJyb3IgdHlwZSBwcm9wZXJseVxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKVxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxuICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZW5lcmF0ZSBsaW5rcycgXG4gICAgfSk7XG4gIH1cbn0iXSwibmFtZXMiOlsibmFub2lkIiwiZ2V0QW1wbGlmeVNlcnZlclNlcnZpY2UiLCJzZWN1cml0eVNlcnZpY2UiLCJQUk9EVUNUSU9OX0RPTUFJTiIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19ET01BSU4iLCJERVZFTE9QTUVOVF9ET01BSU4iLCJnZXREb21haW4iLCJ1c2VEZXZlbG9wbWVudCIsImdldFNob3J0VXJsIiwiZG9tYWluIiwicHJvdG9jb2wiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiYW1wbGlmeVNlcnZlclNlcnZpY2UiLCJwcm9qZWN0SWQiLCJvcmlnaW5hbFVybCIsImNvdW50IiwidmVuZG9ySWQiLCJsaW5rVHlwZSIsImdlb1Jlc3RyaWN0aW9uIiwidGVzdENvdW50IiwibGl2ZUNvdW50IiwidXNlRGV2ZWxvcG1lbnREb21haW4iLCJib2R5IiwiaXAiLCJoZWFkZXJzIiwidG9TdHJpbmciLCJzb2NrZXQiLCJyZW1vdGVBZGRyZXNzIiwibG9nU2VjdXJpdHlFdmVudCIsInRvdGFsQ291bnQiLCJ1bmRlZmluZWQiLCJwcm9qZWN0UmVzdWx0IiwiZ2V0UHJvamVjdCIsInByb2plY3QiLCJkYXRhIiwidmVuZG9yUmVzdWx0IiwiZ2V0VmVuZG9yIiwidmVuZG9yIiwicHJvamVjdFZlbmRvclJlc3VsdCIsImxpc3RQcm9qZWN0VmVuZG9ycyIsImFuZCIsImVxIiwibGVuZ3RoIiwibGlua3MiLCJjcmVhdGlvblByb21pc2VzIiwidmVuZG9yQ29kZSIsInNldHRpbmdzIiwiSlNPTiIsInBhcnNlIiwiY29kZSIsImUiLCJjb25zb2xlIiwiZXJyb3IiLCJpIiwiYmFzZVVpZCIsInVpZCIsImxpbmtEYXRhIiwibWV0YWRhdGEiLCJzdHJpbmdpZnkiLCJwdXNoIiwiY3JlYXRlU3VydmV5TGluayIsImxpbmtUeXBlX3ByZWZpeCIsImNyZWF0ZWRMaW5rc1Jlc3VsdHMiLCJQcm9taXNlIiwiYWxsIiwiY3JlYXRlZExpbmtzUmVzcG9uc2UiLCJsaXN0U3VydmV5TGlua3NCeVByb2plY3QiLCJzb3J0ZWRMaW5rcyIsImZpbHRlciIsImxpbmsiLCJzb3J0IiwiYSIsImIiLCJ2ZW5kb3JBIiwidmVuZG9yQiIsImxvY2FsZUNvbXBhcmUiLCJkYXRlQSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJnZXRUaW1lIiwiZGF0ZUIiLCJzbGljZSIsInZlbmRvcklkcyIsIm1hcCIsInZlbmRvclJlc3VsdHMiLCJsaXN0VmVuZG9ycyIsImlkIiwiaW4iLCJ2ZW5kb3JzIiwicmVkdWNlIiwiYWNjIiwibmFtZSIsImJhc2VVcmwiLCJmb3JtYXR0ZWRMaW5rcyIsImZ1bGxVcmwiLCJsaW5rTWV0YWRhdGEiLCJnZW9SZXN0cmljdGlvbkRhdGEiLCJFcnJvciIsIlN0cmluZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/links/generate.ts\n");

/***/ }),

/***/ "(api)/./amplify_outputs.json":
/*!******************************!*\
  !*** ./amplify_outputs.json ***!
  \******************************/
/***/ ((module) => {

module.exports = /*#__PURE__*/JSON.parse('{"auth":{"user_pool_id":"us-east-1_Gh00T12dW","aws_region":"us-east-1","user_pool_client_id":"5e5a5drp00jd43tr7ph1ceg412","identity_pool_id":"us-east-1:a0b02f73-93a3-4b52-b1cb-eaa306375a33","mfa_methods":["SMS"],"standard_required_attributes":["email"],"username_attributes":["email"],"user_verification_types":["email"],"groups":[],"mfa_configuration":"OPTIONAL","password_policy":{"min_length":8,"require_lowercase":true,"require_numbers":true,"require_symbols":true,"require_uppercase":true},"unauthenticated_identities_enabled":true},"data":{"url":"https://vth6pntotrhvfpxo2gwn3kzqry.appsync-api.us-east-1.amazonaws.com/graphql","aws_region":"us-east-1","api_key":"da2-ee26yqskvzfpjpquwbi53shbvu","default_authorization_type":"AWS_IAM","authorization_types":["API_KEY","AMAZON_COGNITO_USER_POOLS"],"model_introspection":{"version":1,"models":{"Project":{"name":"Project","fields":{"id":{"name":"id","isArray":false,"type":"ID","isRequired":true,"attributes":[]},"name":{"name":"name","isArray":false,"type":"String","isRequired":true,"attributes":[]},"description":{"name":"description","isArray":false,"type":"String","isRequired":false,"attributes":[]},"status":{"name":"status","isArray":false,"type":{"enum":"ProjectStatus"},"isRequired":false,"attributes":[]},"targetCompletions":{"name":"targetCompletions","isArray":false,"type":"Int","isRequired":true,"attributes":[]},"currentCompletions":{"name":"currentCompletions","isArray":false,"type":"Int","isRequired":true,"attributes":[]},"surveyUrl":{"name":"surveyUrl","isArray":false,"type":"String","isRequired":true,"attributes":[]},"createdAt":{"name":"createdAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]},"updatedAt":{"name":"updatedAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]},"settings":{"name":"settings","isArray":false,"type":"AWSJSON","isRequired":false,"attributes":[]}},"syncable":true,"pluralName":"Projects","attributes":[{"type":"model","properties":{}},{"type":"auth","properties":{"rules":[{"allow":"private","operations":["create","read","update","delete"]}]}}],"primaryKeyInfo":{"isCustomPrimaryKey":false,"primaryKeyFieldName":"id","sortKeyFieldNames":[]}},"Question":{"name":"Question","fields":{"id":{"name":"id","isArray":false,"type":"ID","isRequired":true,"attributes":[]},"projectId":{"name":"projectId","isArray":false,"type":"ID","isRequired":false,"attributes":[]},"text":{"name":"text","isArray":false,"type":"String","isRequired":true,"attributes":[]},"type":{"name":"type","isArray":false,"type":{"enum":"QuestionType"},"isRequired":false,"attributes":[]},"options":{"name":"options","isArray":false,"type":"AWSJSON","isRequired":false,"attributes":[]},"sequence":{"name":"sequence","isArray":false,"type":"Int","isRequired":true,"attributes":[]},"isRequired":{"name":"isRequired","isArray":false,"type":"Boolean","isRequired":true,"attributes":[]},"createdAt":{"name":"createdAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]},"updatedAt":{"name":"updatedAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]}},"syncable":true,"pluralName":"Questions","attributes":[{"type":"model","properties":{}},{"type":"auth","properties":{"rules":[{"allow":"private","operations":["create","read","update","delete"]}]}}],"primaryKeyInfo":{"isCustomPrimaryKey":false,"primaryKeyFieldName":"id","sortKeyFieldNames":[]}},"SurveyLink":{"name":"SurveyLink","fields":{"id":{"name":"id","isArray":false,"type":"ID","isRequired":true,"attributes":[]},"projectId":{"name":"projectId","isArray":false,"type":"ID","isRequired":false,"attributes":[]},"uid":{"name":"uid","isArray":false,"type":"String","isRequired":true,"attributes":[]},"status":{"name":"status","isArray":false,"type":{"enum":"SurveyLinkStatus"},"isRequired":false,"attributes":[]},"createdAt":{"name":"createdAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]},"updatedAt":{"name":"updatedAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]},"clickedAt":{"name":"clickedAt","isArray":false,"type":"AWSDateTime","isRequired":false,"attributes":[]},"completedAt":{"name":"completedAt","isArray":false,"type":"AWSDateTime","isRequired":false,"attributes":[]},"ipAddress":{"name":"ipAddress","isArray":false,"type":"String","isRequired":false,"attributes":[]},"userAgent":{"name":"userAgent","isArray":false,"type":"String","isRequired":false,"attributes":[]},"geoData":{"name":"geoData","isArray":false,"type":"AWSJSON","isRequired":false,"attributes":[]},"metadata":{"name":"metadata","isArray":false,"type":"AWSJSON","isRequired":false,"attributes":[]},"vendorId":{"name":"vendorId","isArray":false,"type":"ID","isRequired":false,"attributes":[]}},"syncable":true,"pluralName":"SurveyLinks","attributes":[{"type":"model","properties":{}},{"type":"auth","properties":{"rules":[{"allow":"private","operations":["create","read","update","delete"]},{"allow":"public","provider":"iam","operations":["read","update"]}]}}],"primaryKeyInfo":{"isCustomPrimaryKey":false,"primaryKeyFieldName":"id","sortKeyFieldNames":[]}},"Vendor":{"name":"Vendor","fields":{"id":{"name":"id","isArray":false,"type":"ID","isRequired":true,"attributes":[]},"name":{"name":"name","isArray":false,"type":"String","isRequired":true,"attributes":[]},"contactName":{"name":"contactName","isArray":false,"type":"String","isRequired":false,"attributes":[]},"contactEmail":{"name":"contactEmail","isArray":false,"type":"String","isRequired":false,"attributes":[]},"settings":{"name":"settings","isArray":false,"type":"AWSJSON","isRequired":false,"attributes":[]},"createdAt":{"name":"createdAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]},"updatedAt":{"name":"updatedAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]}},"syncable":true,"pluralName":"Vendors","attributes":[{"type":"model","properties":{}},{"type":"auth","properties":{"rules":[{"allow":"private","operations":["create","read","update","delete"]}]}}],"primaryKeyInfo":{"isCustomPrimaryKey":false,"primaryKeyFieldName":"id","sortKeyFieldNames":[]}},"ProjectVendor":{"name":"ProjectVendor","fields":{"id":{"name":"id","isArray":false,"type":"ID","isRequired":true,"attributes":[]},"projectId":{"name":"projectId","isArray":false,"type":"ID","isRequired":false,"attributes":[]},"vendorId":{"name":"vendorId","isArray":false,"type":"ID","isRequired":false,"attributes":[]},"quota":{"name":"quota","isArray":false,"type":"Int","isRequired":true,"attributes":[]},"currentCount":{"name":"currentCount","isArray":false,"type":"Int","isRequired":true,"attributes":[]},"createdAt":{"name":"createdAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]},"updatedAt":{"name":"updatedAt","isArray":false,"type":"AWSDateTime","isRequired":true,"attributes":[]}},"syncable":true,"pluralName":"ProjectVendors","attributes":[{"type":"model","properties":{}},{"type":"auth","properties":{"rules":[{"allow":"private","operations":["create","read","update","delete"]}]}}],"primaryKeyInfo":{"isCustomPrimaryKey":false,"primaryKeyFieldName":"id","sortKeyFieldNames":[]}}},"enums":{"ProjectStatus":{"name":"ProjectStatus","values":["ACTIVE","PAUSED","COMPLETED"]},"QuestionType":{"name":"QuestionType","values":["MULTIPLE_CHOICE","TEXT","COUNTRY","SCALE"]},"SurveyLinkStatus":{"name":"SurveyLinkStatus","values":["UNUSED","CLICKED","COMPLETED","DISQUALIFIED","QUOTA_FULL"]}},"nonModels":{}}},"version":"1.3"}');

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Flinks%2Fgenerate&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Flinks%2Fgenerate.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();